/*!
 * Bilibili Dash Player v1.10.3 (233-878b8464)
 * 
 * Copyright 2018 - 2021 bilibili, Inc.
 * Released in Tue Dec 07 2021 11:22:53 GMT+0800 (China Standard Time)
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.DashPlayer=t():e.DashPlayer=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t,n){"use strict";var r=function(){var e=void 0,t=[],n={},r={};function i(e,n){for(var r in t){var i=t[r];if(i.context===e&&i.name===n)return i.instance}return null}function a(e,t){return t[e]}function o(e,t,n){e in n&&(n[e]=t)}function s(t,n,r){var i=void 0,a=t.__dashjs_factory_name,o=n[a];if(o){var s=o.instance;if(!o.override)return s.apply({context:n,factory:e},r);for(var u in i=t.apply({context:n},r),s=s.apply({context:n,factory:e,parent:i},r))i.hasOwnProperty(u)&&(i[u]=s[u])}else i=t.apply({context:n},r);return i.getClassName=function(){return a},i}return e={extend:function(e,t,n,r){!r[e]&&t&&(r[e]={instance:t,override:n})},getSingletonInstance:i,setSingletonInstance:function(e,n,r){for(var i in t){var a=t[i];if(a.context===e&&a.name===n)return void(t[i].instance=r)}t.push({name:n,context:e,instance:r})},getSingletonFactory:function(e){var r=a(e.__dashjs_factory_name,n);return r||(r=function(n){var r=void 0;return void 0===n&&(n={}),{getInstance:function(){return r||(r=i(n,e.__dashjs_factory_name)),r||(r=s(e,n,arguments),t.push({name:e.__dashjs_factory_name,context:n,instance:r})),r}}},n[e.__dashjs_factory_name]=r),r},getSingletonFactoryByName:function(e){return a(e,n)},updateSingletonFactory:function(e,t){o(e,t,n)},getClassFactory:function(e){var t=a(e.__dashjs_factory_name,r);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return s(e,t,arguments)}}},r[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return a(e,r)},updateClassFactory:function(e,t){o(e,t,r)}},e}();t.a=r},function(e,t,n){
/*! codem-isoboxer v0.3.7 https://github.com/madebyhiro/codem-isoboxer/blob/master/LICENSE.txt */
var r={parseBuffer:function(e){return new i(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(a.prototype._boxProcessors[e]=t)},createFile:function(){return new i},createBox:function(e,t,n){var r=a.create(e);return t&&t.append(r,n),r},createFullBox:function(e,t,n){var i=r.createBox(e,t,n);return i.version=0,i.flags=0,i},Utils:{}};r.Utils.dataViewToString=function(e,t){var n=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(n).decode(e);var r=[],i=0;if("utf-8"===n)for(;i<e.byteLength;){var a=e.getUint8(i++);a<128||(a<224?(a=(31&a)<<6,a|=63&e.getUint8(i++)):a<240?(a=(15&a)<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++)):(a=(7&a)<<18,a|=(63&e.getUint8(i++))<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++))),r.push(String.fromCharCode(a))}else for(;i<e.byteLength;)r.push(String.fromCharCode(e.getUint8(i++)));return r.join("")},r.Utils.utf8ToByteArray=function(e){var t,n;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},r.Utils.appendBox=function(e,t,n){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==n)if(null!=n){var r,i=-1;if("number"==typeof n)i=n;else{if("string"==typeof n)r=n;else{if("object"!=typeof n||!n.type)return void e.boxes.push(t);r=n.type}for(var a=0;a<e.boxes.length;a++)if(r===e.boxes[a].type){i=a+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=r.parseBuffer,t.addBoxProcessor=r.addBoxProcessor,t.createFile=r.createFile,t.createBox=r.createBox,t.createFullBox=r.createFullBox,t.Utils=r.Utils,r.Cursor=function(e){this.offset=void 0===e?0:e};var i=function(e){this._cursor=new r.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};i.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},i.prototype.fetchAll=function(e,t){var n=[];return i._sweep.call(this,e,n,t),n},i.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=a.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},i._sweep=function(e,t,n){for(var r in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&n)return;i._sweep.call(this.boxes[r],e,t,n)}},i.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var n=new Uint8Array(t);for(this._rawo=new DataView(n.buffer),this.bytes=n,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return n.buffer},i.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)};var a=function(){this._cursor=new r.Cursor};a.parse=function(e){var t=new a;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},a.create=function(e){var t=new a;return t.type=e,t.boxes=[],t},a.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],a.prototype._boxProcessors={},a.prototype._procField=function(e,t,n){this._parsing?this[e]=this._readField(t,n):this._writeField(t,n,this[e])},a.prototype._procFieldArray=function(e,t,n,r){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(n,r);else for(i=0;i<this[e].length;i++)this._writeField(n,r,this[e][i])},a.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},a.prototype._procEntries=function(e,t,n){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push({}),n.call(this,this[e][r]);else for(r=0;r<t;r++)n.call(this,this[e][r])},a.prototype._procSubEntries=function(e,t,n,r){var i;if(this._parsing)for(e[t]=[],i=0;i<n;i++)e[t].push({}),r.call(this,e[t][i]);else for(i=0;i<n;i++)r.call(this,e[t][i])},
a.prototype._procEntryField=function(e,t,n,r){this._parsing?e[t]=this._readField(n,r):this._writeField(n,r,e[t])},a.prototype._procSubBoxes=function(e,t){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push(a.parse(this));else for(n=0;n<t;n++)this._rawo?this[e][n].write():this.size+=this[e][n].getLength()},a.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},a.prototype._readInt=function(e){var t=null,n=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(n);break;case 16:t=this._raw.getInt16(n);break;case 32:t=this._raw.getInt32(n);break;case 64:var r=this._raw.getInt32(n),i=this._raw.getInt32(n+4);t=r*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},a.prototype._readUint=function(e){var t,n,r=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:r=this._raw.getUint8(i);break;case 16:r=this._raw.getUint16(i);break;case 24:r=((t=this._raw.getUint16(i))<<8)+(n=this._raw.getUint8(i+2));break;case 32:r=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),n=this._raw.getUint32(i+4),r=t*Math.pow(2,32)+n}return this._cursor.offset+=e>>3,r},a.prototype._readString=function(e){for(var t="",n=0;n<e;n++){var r=this._readUint(8);t+=String.fromCharCode(r)}return t},a.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},a.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},a.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var n=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,n}return null},a.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?r.Utils.dataViewToString(t):t},a.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},a.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},a.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(a.parse(this))},a.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)},a.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),
this.size},a.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},a.prototype._writeInt=function(e,t){if(this._rawo){var n=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(n,t);break;case 16:this._rawo.setInt16(n,t);break;case 32:this._rawo.setInt32(n,t);break;case 64:var r=Math.floor(t/Math.pow(2,32)),i=t-r*Math.pow(2,32);this._rawo.setUint32(n,r),this._rawo.setUint32(n+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},a.prototype._writeUint=function(e,t){if(this._rawo){var n,r,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:n=(16776960&t)>>8,r=255&t,this._rawo.setUint16(i,n),this._rawo.setUint8(i+2,r);break;case 32:this._rawo.setUint32(i,t);break;case 64:r=t-(n=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,n),this._rawo.setUint32(i+4,r)}this._cursor.offset+=e>>3}else this.size+=e>>3},a.prototype._writeString=function(e,t){for(var n=0;n<e;n++)this._writeUint(8,t.charCodeAt(n))},a.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},a.prototype._writeTemplate=function(e,t){var n=Math.floor(t),r=(t-n)*Math.pow(2,e/2);this._writeUint(e/2,n),this._writeUint(e/2,r)},a.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,n=0;n<e.length;n++)this._rawo.setInt8(t+n,e[n]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},a.prototype._writeUTF8String=function(e){var t=r.Utils.utf8ToByteArray(e);if(this._rawo)for(var n=new DataView(this._rawo.buffer,this._cursor.offset,t.length),i=0;i<t.length;i++)n.setUint8(i,t[i]);else this.size+=t.length},a.prototype._writeField=function(e,t,n){switch(e){case"uint":this._writeUint(t,n);break;case"int":this._writeInt(t,n);break;case"template":this._writeTemplate(t,n);break;case"string":-1==t?this._writeTerminatedString(n):this._writeString(t,n);break;case"data":this._writeData(n);break;case"utf8":this._writeUTF8String(n)}},a.prototype._boxProcessors.avc1=a.prototype._boxProcessors.avc2=a.prototype._boxProcessors.avc3=a.prototype._boxProcessors.avc4=a.prototype._boxProcessors.hvc1=a.prototype._boxProcessors.hev1=a.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},a.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},
a.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)}))},a.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},a.prototype._boxProcessors.free=a.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},a.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},a.prototype._boxProcessors.ftyp=a.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},a.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},a.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},a.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},a.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},a.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},a.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},a.prototype._boxProcessors.mp4a=a.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},a.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},a.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},a.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),
this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},a.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},a.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},a.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)}))},a.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},a.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,(function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)}))}))},a.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},a.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,(function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)}))}))},a.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},a.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},a.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},a.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(e){
this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},a.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},a.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},a.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},a.prototype._boxProcessors["url "]=a.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},a.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},a.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},a.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},a.prototype._boxProcessors.vtte=function(){}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));function r(){return"2.7.0"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.getLocalStorage=function(e){var t="";try{t=window.localStorage.getItem(e)}catch(e){}return t},e.setLocalStorage=function(e,t){try{window.localStorage.setItem(e,t)}catch(e){}},e.getSessionStorage=function(e){var t="";try{t=window.sessionStorage.getItem(e)}catch(e){}return t},e.setSessionStorage=function(e,t){try{window.sessionStorage.setItem(e,t)}catch(e){}},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_CODE=t.DOLBY_AUDIO_QN=t.STRING=t.ERROR=t.EVENTS=void 0;t.EVENTS={SCRIPT_LOADED:"scripLoaded",VIDEO_INFO:"videoInfo",WARNING:"warning",AST_IN_FUTURE:"astInFuture",BUFFER_EMPTY:"bufferStalled",BUFFER_LOADED:"bufferLoaded",BUFFER_LEVEL_STATE_CHANGED:"bufferStateChanged",ERROR:"error",FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted",FRAGMENT_LOADING_HEADER_RECEIVED:"fragmentLoadingHeaderReceived",FRAGMENT_LOADING_PROGRESS:"fragmentLoadingProgress",FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",FRAGMENT_LOADING_ABANDONED:"fragmentLoadingAbandoned",FRAGMENT_LOADED_ERROR:"fragmentLoadedError",FRAGMENT_P2P_LOAD_INFO:"fragmentP2pLoadInfo",CDN_LOAD_INFO:"cdnLoadInfo",PCDN_LOADED_ERROR:"pcdnLoadedError",LOG:"log",MANIFEST_LOADED:"manifestLoaded",METRICS_CHANGED:"metricsChanged",METRIC_CHANGED:"metricChanged",METRIC_ADDED:"metricAdded",METRIC_UPDATED:"metricUpdated",PERIOD_SWITCH_COMPLETED:"periodSwitchCompleted",
PERIOD_SWITCH_STARTED:"periodSwitchStarted",QUALITY_CHANGE_REQUESTED:"qualityChangeRequested",QUALITY_CHANGE_RENDERED:"qualityChangeRendered",TRACK_CHANGE_RENDERED:"trackChangeRendered",SOURCE_INITIALIZED:"sourceInitialized",STREAM_INITIALIZED:"streamInitialized",STREAM_TEARDOWN_COMPLETE:"streamTeardownComplete",TEXT_TRACKS_ADDED:"allTextTracksAdded",TEXT_TRACK_ADDED:"textTrackAdded",TTML_PARSED:"ttmlParsed",TTML_TO_PARSE:"ttmlToParse",CAN_PLAY:"canPlay",PLAYBACK_ENDED:"playbackEnded",PLAYBACK_ERROR:"playbackError",PLAYBACK_NOT_ALLOWED:"playbackNotAllowed",PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",PLAYBACK_PAUSED:"playbackPaused",PLAYBACK_PLAYING:"playbackPlaying",PLAYBACK_PROGRESS:"playbackProgress",PLAYBACK_RATE_CHANGED:"playbackRateChanged",PLAYBACK_SEEKED:"playbackSeeked",PLAYBACK_SEEKING:"playbackSeeking",PLAYBACK_SEEK_ASKED:"playbackSeekAsked",PLAYBACK_STARTED:"playbackStarted",PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",PLAYBACK_WAITING:"playbackWaiting",MANIFEST_VALIDITY_CHANGED:"manifestValidityChanged",KEY_ADDED:"public_keyAdded",KEY_ERROR:"public_keyError",KEY_MESSAGE:"public_keyMessage",KEY_SESSION_CLOSED:"public_keySessionClosed",KEY_SESSION_CREATED:"public_keySessionCreated",KEY_SESSION_REMOVED:"public_keySessionRemoved",KEY_STATUSES_CHANGED:"public_keyStatusesChanged",KEY_SYSTEM_ACCESS_COMPLETE:"public_keySystemAccessComplete",KEY_SYSTEM_SELECTED:"public_keySystemSelected",LICENSE_REQUEST_COMPLETE:"public_licenseRequestComplete",PROTECTION_CREATED:"public_protectioncreated",PROTECTION_DESTROYED:"public_protectiondestroyed",DELAY_TO_APPEND_TO_BUFFER:"delayToAppendBuffer",QUALITY_CHANGE_DOWNLOADED:"qualityChangeDownloaded",QUOTA_EXCEEDED:"quotaExceeded",GET_NEXT_FRAGMENT:"getNextFragment",APPENDING_NEXT_SOURCE:"appendingNextSource",APPENDED_NEXT_SOURCE:"appendedNextSource",APPENDED_NEXT_SOURCE_DURATION_CHANGED:"appendedNextSourceDurationChanged",START_OFFSET_TIME_WARNING:"startOffsetTimeWarning",BUFFERING_OPTIMIZATION:"buffering_optimization",QUALITY_CHANGE_ABNORMAL:"qualityChangeAbnormal"};t.ERROR={INTERNAL_ERROR:-1,DURATION_IS_NOT_ALL_EQUAL:-2,DURATION_DEVIATION_IS_TOO_LARGE:-3,START_OFFSET_TIME_WARNING:-4,DOWNLOAD_ERROR:4,DOWNLOAD_MPD_ERROR:4001,DOWNLOAD_XINK_ERROR:4002,DOWNLOAD_INIT_SEGMENT_ERROR:4003,DOWNLOAD_MEDIA_SEGMENT_ERROR:4004,DOWNLOAD_INDEX_SEGMENT_ERROR:4005,DOWNLOAD_SWITCHING_SEGMENT_ERROR:4006,DOWNLOAD_OTHER_ERROR:4007,DOWNLOAD_FRAGMENT_ERROR:4101,DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS:4102,DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE:4103,DOWNLOAD_FRAGMENT_ERROR_TIMEOUT:4105,CONNECT_FRAGMENT_ERROR_TIMEOUT:4106,MANIFEST_ERROR:5,MANIFEST_TYPE_ERROR:5001,MANIFEST_RESOLVE_ERROR:5002,MEDIA_ERROR:6,MEDIA_ABORTED_ERROR:6001,MEDIA_NETWORK_ERROR:6002,MEDIA_DECODE_ERROR:6003,MEDIA_SUPPORTED_ERROR:6004,MEDIA_ENCRYPTED_ERROR:6005,MEDIA_UNKNOWN_ERROR:6e3};var r,i;t.STRING={VIDEO:"video",AUDIO:"audio",LOG:"log",WARNING:"warning",ERROR:"error",ABR_DYNAMIC:"abrDynamic",ABR_BOLA:"abrBola",ABR_THROUGHPUT:"abrThroughput",SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME:"bilidp-switch-source-transition-canvas"},function(e){e[e.AUDIO=30255]="AUDIO",e[e.AMTOS=30250]="AMTOS"}(r||(r={})),t.DOLBY_AUDIO_QN=r,function(e){e[e.SET_QUALITY_ERR=2e4]="SET_QUALITY_ERR",e[e.SET_QUALITY_VALUE_ERR=20001]="SET_QUALITY_VALUE_ERR",e[e.SET_QUALITY_TYPE_ERR=20002]="SET_QUALITY_TYPE_ERR",e[e.SET_QUALITY_APENDING_ERR=20003]="SET_QUALITY_APENDING_ERR",e[e.SET_QUALITY_SAME_VALUE=20004]="SET_QUALITY_SAME_VALUE",e[e.SET_QUALITY_TIME_OUT=20005]="SET_QUALITY_TIME_OUT",e[e.SET_QUALITY_RENDER_CHANGED=20006]="SET_QUALITY_RENDER_CHANGED"}(i||(i={})),t.ERROR_CODE=i},function(e,t,n){"use strict";var r=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.FRAGMENTED_TEXT="fragmentedText",this.EMBEDDED_TEXT="embeddedText",this.MUXED="muxed",this.IMAGE="image",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",
this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.UTF8="utf-8",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma"},e}());var i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors"},e}());var a=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.DOWNLOAD_ERROR=4,this.DOWNLOAD_MPD_ERROR=4001,this.DOWNLOAD_XINK_ERROR=4002,this.DOWNLOAD_INIT_SEGMENT_ERROR=4003,this.DOWNLOAD_MEDIA_SEGMENT_ERROR=4004,this.DOWNLOAD_INDEX_SEGMENT_ERROR=4005,this.DOWNLOAD_SWITCHING_SEGMENT_ERROR=4006,this.DOWNLOAD_OTHER_ERROR=4007,this.DOWNLOAD_FRAGMENT_ERROR=4101,this.DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS=4102,this.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE=4103,this.DOWNLOAD_FRAGMENT_ERROR_RANGE=4104,this.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT=4105,this.CONNECT_FRAGMENT_ERROR_TIMEOUT=4106,this.CONNECT_NC_FRAGMENT_ERROR_TIMEOUT=4107,this.DOWNLOAD_PCDN_SCRIPT_ERROR=4201,this.DOWNLOAD_PCDN_SCRIPT_TIMEOUT=4202,this.DOWNLOAD_PCDN_DISABLED=4203,this.MANIFEST_ERROR=5,this.MANIFEST_TYPE_ERROR=5001,this.MANIFEST_RESOLVE_ERROR=5002,this.MEDIA_ERROR=6,this.MEDIA_ABORTED_ERROR=6001,this.MEDIA_NETWORK_ERROR=6002,this.MEDIA_DECODE_ERROR=6003,this.MEDIA_SUPPORTED_ERROR=6004,this.MEDIA_ENCRYPTED_ERROR=6005,this.MEDIA_UNKNOWN_ERROR=6e3},e}());var o=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""},s=n(0);function u(){var e={};function t(t,n,r){var i=-1;return e[t]?(e[t].some((function(e,t){if(e&&e.callback===n&&(!r||r===e.scope))return i=t,!0})),i):i}var n={on:function(n,r,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!n)throw new Error("event type cannot be null or undefined");if(!r||"function"!=typeof r)throw new Error("listener must be a function: "+r);if(!(t(n,r,i)>=0)){e[n]=e[n]||[];var o={callback:r,scope:i,priority:a},s=e[n].some((function(t,r){if(t&&a>t.priority)return e[n].splice(r,0,o),!0}));s||e[n].push(o)}},off:function(n,r,i){if(n&&r&&e[n]){var a=t(n,r,i);a<0||(e[n][a]=null)}},trigger:function(t,n){if(t&&e[t]){if((n=n||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");n.type=t,e[t]=e[t].filter((function(e){return e})),e[t].forEach((function(e){return e&&e.callback.call(e.scope,n)}))}},reset:function(){e={}}};return n}u.__dashjs_factory_name="EventBus";var l=s.a.getSingletonFactory(u);l.EVENT_PRIORITY_LOW=0,l.EVENT_PRIORITY_HIGH=5e3,s.a.updateSingletonFactory(u.__dashjs_factory_name,l);var d=l;var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.prototype.extend=function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!n||r&&-1===e[i].indexOf("public_")||(this[i]=e[i])}},e}();function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){
if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=function(e){function t(){return f(this,t),p(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return n.BUFFERING_COMPLETED="bufferingCompleted",n.BUFFER_CLEARED="bufferCleared",n.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",n.BYTES_APPENDED="bytesAppended",n.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",n.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",n.CURRENT_TRACK_CHANGED="currentTrackChanged",n.DATA_UPDATE_COMPLETED="dataUpdateCompleted",n.DATA_UPDATE_STARTED="dataUpdateStarted",n.INITIALIZATION_LOADED="initializationLoaded",n.INIT_FRAGMENT_LOADED="initFragmentLoaded",n.INIT_REQUESTED="initRequested",n.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",n.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",n.LOADING_COMPLETED="loadingCompleted",n.LOADING_PROGRESS="loadingProgress",n.LOADING_DATA_PROGRESS="loadingDataProgress",n.LOADING_ABANDONED="loadingAborted",n.MANIFEST_UPDATED="manifestUpdated",n.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",n.QUOTA_EXCEEDED="quotaExceeded",n.REPRESENTATION_UPDATED="representationUpdated",n.SEGMENTS_LOADED="segmentsLoaded",n.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",n.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",n.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",n.STREAMS_COMPOSED="streamsComposed",n.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",n.STREAM_COMPLETED="streamCompleted",n.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",n.TIMED_TEXT_REQUESTED="timedTextRequested",n.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",n.URL_RESOLUTION_FAILED="urlResolutionFailed",n.VIDEO_CHUNK_RECEIVED="videoChunkReceived",n.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",n.XLINK_ELEMENT_LOADED="xlinkElementLoaded",n.XLINK_READY="xlinkReady",n.REQUEST_RETRYED="requestRetryed",n.BUFFER_CREATED="bufferCreated",n.VERIFY_SEGMENT_WARNING="verifySegmentWarning",n.INIT_HID="initHID",n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(c)),g=new h;var m=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null,this.timeout=1e4};m.ACTION_DOWNLOAD="download",m.ACTION_COMPLETE="complete";var E=m;function _(){var e,t=this.context,n=d(t).getInstance(),r=void 0,i=void 0,a=void 0,o=void 0;return e={log:function(){var e="",t=null;i&&(t=(new Date).getTime(),e+="["+(t-o)+"]"),a&&this&&this.getClassName&&(e+="["+this.getClassName()+"]",this.getType&&(e+="["+this.getType()+"]")),e.length>0&&(e+=" "),
Array.apply(null,arguments).forEach((function(t){e+=t+" "})),r&&console.log(e),n.trigger(g.LOG,{message:e})},setLogTimestampVisible:function(e){i=e},setCalleeNameVisible:function(e){a=e},setLogToBrowserConsole:function(e){r=e},getLogToBrowserConsole:function(){return r}},r=!1,i=!0,a=!1,o=(new Date).getTime(),e}_.__dashjs_factory_name="Debug";var T=s.a.getSingletonFactory(_),y="loading",v="executed",A="failed";function I(e){e=e||{};var t=this.context,n=T(t).getInstance().log,r=d(t).getInstance(),i=e.metricsModel,a=e.fragmentLoader,o={},s=void 0,u=void 0,l=void 0,c=void 0;function f(e){var t;return!!e&&(t=!1,l.some((function(n){if(r=e,i=n,!isNaN(r.index)&&r.startTime===i.startTime&&r.adaptationIndex===i.adaptationIndex&&r.type===i.type||function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality}(e,n)||function(e,t){return e.action===E.ACTION_COMPLETE&&e.action===t.action}(e,n))return t=!0;var r,i})),t)}function p(e){return isNaN(e.duration)?.25:e.duration/8}function h(e){l=l.filter((function(t){var n=p(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-n}))}function m(e,t){t<=e+.5||(l=l.filter((function(n){var r=p(n);return isNaN(n.startTime)||n.startTime>=t-r||isNaN(n.duration)||n.startTime+n.duration<=e+r})))}function _(e,t,n){for(var r=e.length-1;r>=0;r--){var i=e[r],a=i.startTime,o=a+i.duration;if(n=isNaN(n)?p(i):n,!isNaN(a)&&!isNaN(o)&&t+n>=a&&t-n<o||isNaN(a)&&isNaN(t))return i}return null}function I(e,t){i.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t),i.addRequestsQueue(e.mediaType,c,l)}function R(e){if(e.sender===a&&!e.error){if(c.splice(c.indexOf(e.request),1),e.response&&!e.error){var t=l&&l[l.length-1],i=u.getPlaybackController().getTime()||0,o=e.request,s=t&&(isNaN(t.index)||isNaN(t.startTime)&&isNaN(t.duration)),d=o&&(isNaN(o.index)||isNaN(o.startTime)&&isNaN(o.duration)),f=t&&(0===i||o.startTime-1<=i&&o.startTime+o.duration+1>=i),p=t&&o.index-t.index==1||l&&l.length&&l.filter((function(e){return o.index-e.index==1})).length||0===o.index;if(n("push",o.mediaType,JSON.stringify({index:o.index,isLastNaNRequest:s,isCurrentNaNRequest:d,isCurrentTimeInFirstRequest:f,isMediaRequest:p,currentTime:i,range:o.range})),!d&&f&&l.length>1&&!p&&l.splice(1,l.length-1),t&&!d&&!f&&!p)return void u.getScheduleController().start();l.push(e.request)}I(e.request,e.error?A:v),r.trigger(g.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this}),e.request&&e.request.p2pLoadInfo&&"{}"!=JSON.stringify(e.request.p2pLoadInfo)&&r.trigger(g.FRAGMENT_P2P_LOAD_INFO,{p2pLoadInfo:e.request.p2pLoadInfo}),e.request&&e.request.loadInfo&&"{}"!=JSON.stringify(e.request.loadInfo)&&r.trigger(g.CDN_LOAD_INFO,{loadInfo:e.request.loadInfo,NCInfo:e.request.NCInfo})}}function S(e){e.sender===a&&r.trigger(g.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this})}function N(e){if(e.sender===a&&(r.trigger(g.FRAGMENT_LOADING_ABANDONED,{streamProcessor:this.getStreamProcessor(),request:e.request,mediaType:e.mediaType}),e.request&&e.request.NCInfo&&"{}"!=JSON.stringify(e.request.NCInfo))){var t=e.request;if(o!=={}&&o.mediaType===t.mediaType&&o.quality===t.quality&&o.range===t.range&&o.delayLoadingTime===t.delayLoadingTime)return;o={mediaType:t.mediaType,quality:t.quality,range:t.range,delayLoadingTime:t.delayLoadingTime},r.trigger(g.CDN_LOAD_INFO,{NCInfo:e.request.NCInfo})}}function D(){null,l=[],c=[]}return s={setStreamProcessor:function(e){u=e},getStreamProcessor:function(){return u},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],n=[];return t.forEach((function(t){var r=function(e){var t=void 0;switch(e){case y:t=c;break;case v:t=l;break;default:t=[]}return t}(t);n=n.concat(function(e,t){if(t.hasOwnProperty("time"))return[_(e,t.time,t.threshold)];return e.filter((function(e){for(var n in t)if("state"!==n&&t.hasOwnProperty(n)&&e[n]!=t[n])return!1;return!0}))}(r,e))})),n},isFragmentLoaded:f,isFragmentLoadedOrPending:function(e){var t=!1,n=0,r=void 0
;if(!(t=f(e)))for(n=0;n<c.length;n++)r=c[n],e.url===r.url&&e.startTime===r.startTime&&(t=!0);return t},removeExecutedRequestsBeforeTime:h,removeExecutedRequestsAfterTime:function(e){l=l.filter((function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<=e}))},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var n=0,r=0,i=e.length;r<i;r++)m(n,e.start(r)),n=e.end(r);t>0&&m(n,t)}else h()},clearExecutedRequestBySeeking:function(){l=[]},abortRequests:function(){a.abort(),c=[]},executeRequest:function(e){switch(e.action){case E.ACTION_COMPLETE:l.push(e),I(e,v),n("[FragmentModel] executeRequest trigger STREAM_COMPLETED"),r.trigger(g.STREAM_COMPLETED,{request:e,fragmentModel:this});break;case E.ACTION_DOWNLOAD:I(e,y),c.push(e),function(e){r.trigger(g.FRAGMENT_LOADING_STARTED,{sender:s,request:e});var t=u&&u.getBufferLevel();e.bufferLevel=t,a.load(e)}(e);break;default:n("Unknown request action.")}},reset:function(){r.off(g.LOADING_COMPLETED,R,this),r.off(g.LOADING_DATA_PROGRESS,S,this),r.off(g.LOADING_ABANDONED,N,this),a&&a.reset(),D()},addExecutedRequest:function(){},resetInitialSettings:D,resetPreloadData:function(){a&&a.resetPreloadData()}},D(),r.on(g.LOADING_COMPLETED,R,s),r.on(g.LOADING_DATA_PROGRESS,S,s),r.on(g.LOADING_ABANDONED,N,s),s}I.__dashjs_factory_name="FragmentModel";var R=s.a.getClassFactory(I);R.FRAGMENT_MODEL_LOADING=y,R.FRAGMENT_MODEL_EXECUTED=v,R.FRAGMENT_MODEL_CANCELED="canceled",R.FRAGMENT_MODEL_FAILED=A,s.a.updateClassFactory(I.__dashjs_factory_name,R);var S=R;var N=function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=n||null,this.data=r||null,this.errorCode=i||null,this.httpCode=a||null};function D(e,t,n){var r=this.context,i=T(r).getInstance().log,a=d(r).getInstance(),o=void 0,s=void 0,u=[],l=n;function c(){return o?o.buffered:[]}function f(){var e=this;if(u.length>0){s=!0;var t=u[0];u.splice(0,1);var n=[],r=function(){var r=c();!function(e,t,n,r){t&&t.length>0&&t.length<n.length&&function(e,t){for(var n=0;n<e.length;n++){var r=Math.round(e.start(n)),i=Math.round(e.end(n));if(i===t.start||r===t.end||t.start>=r&&t.end<=i)return!0}return!1}(t,r)&&a.trigger(g.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:e,from:n.end(n.length-2),to:n.start(n.length-1),unintended:!0})}(e,n,r,t),u.length>0?f.call(this):(s=!1,l&&l({chunk:t}))};try{0===t.bytes.length?r.call(this):(n=c(),o.appendBuffer?o.appendBuffer(t.bytes):o.append(t.bytes,t),p(o,r.bind(this)))}catch(e){i('SourceBuffer append failed "'+e+'"'),u.length>0?f():s=!1,l&&l({chunk:t,error:new N(e.code,e.message,null)})}}}function p(e,t){var n=void 0,r=function(){e.updating||(clearInterval(n),t())};if(e.updating)if("function"==typeof e.addEventListener)try{e.addEventListener("updateend",(function n(){e.updating||(e.removeEventListener("updateend",n,!1),t())}),!1)}catch(e){n=setInterval(r,50)}else n=setInterval(r,50);else t()}var h={getAllBufferRanges:c,getBuffer:function(){return o},append:function(e){u.push(e),s||p(o,f.bind(this))},remove:function(t,n,r){var i=this;p(o,(function(){try{t>=0&&n>t&&(r||"ended"!==e.readyState)&&o.remove(t,n),p(o,(function(){a.trigger(g.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:i,from:t,to:n,unintended:!1})}))}catch(e){a.trigger(g.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:i,from:t,to:n,unintended:!1,error:new N(e.code,e.message,null)})}}))},abort:function(){try{("open"===e.readyState||o.setTextTrack&&"ended"===e.readyState)&&o.abort()}catch(e){i('SourceBuffer append abort failed: "'+e+'"')}u=[]},reset:function(){if(o){try{e.removeSourceBuffer(o)}catch(e){i("Failed to remove source buffer from media source.")}s=!1,o=null}u=[],l=null},setAppendWindowEnd:function t(n){n<=0||p(o,(function(){if("open"===e.readyState)o.appendWindowEnd=n;else var r=setTimeout((function(){clearTimeout(r),t(n)}),50)}))},updateTimestampOffset:function(e){o.timestampOffset===e||isNaN(e)||p(o,(function(){o.timestampOffset=e}))}};return function(){s=!1;var n=t.codec;try{
if(n.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))throw new Error("not really supported");o=e.addSourceBuffer(n)}catch(e){throw e}}(),h}D.__dashjs_factory_name="SourceBufferSink";var O=s.a.getClassFactory(D);function C(e){var t=this.context,n=T(t).getInstance().log,r=[],i=void 0,a=e;function o(e,t){r=r.filter((function(n){return!((isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e))}))}return{getAllBufferRanges:function(){for(var e=[],t=0;t<r.length;t++){var n=r[t];0===e.length||n.start>e[e.length-1].end?e.push({start:n.start,end:n.end}):e[e.length-1].end=n.end}var i={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(i,"length",{get:function(){return e.length}}),i},append:function(e){"InitializationSegment"!==e.segmentType?(r.push(e),r.sort((function(e,t){return e.start-t.start})),i=null):i=e,n("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),a&&a({chunk:e})},remove:o,abort:function(){},discharge:function(e,t){var n=function(e,t){return r.filter((function(n){return(isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e)}))}(e,t);return i&&(n.push(i),i=null),o(e,t),n},reset:function(){r=[],i=null,a=null}}}C.__dashjs_factory_name="PreBufferSink";var M=s.a.getClassFactory(C),P={DEFAULT:.5,STRONG:1,WEAK:0};function L(e,t,n){var r,i;return r=void 0===e?-1:e,i=function(e){var t=P.DEFAULT;return e!==P.DEFAULT&&e!==P.STRONG&&e!==P.WEAK||(t=e),t}(n),{quality:r,reason:void 0===t?null:t,priority:i}}L.__dashjs_factory_name="SwitchRequest";var b=s.a.getClassFactory(L);b.NO_CHANGE=-1,b.PRIORITY=P,s.a.updateClassFactory(L.__dashjs_factory_name,b);var w=b;function F(e){e=e||{};var t=this.context,n=T(t).getInstance().log,r=e.metricsModel;return{getMaxIndex:function(e){var i=w(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getStreamProcessor")))return i;!function(){if(!r||!r.hasOwnProperty("getReadOnlyMetricsFor"))throw new Error("Missing config parameter(s)")}();var a=e.getMediaInfo(),o=e.getMediaType(),s=r.getReadOnlyMetricsFor(o),u=e.getStreamProcessor(),l=e.getAbrController(),d=e.getStreamInfo(),c=d&&d.manifestInfo?d.manifestInfo.isDynamic:null,f=l.getThroughputHistory(),p=f.getSafeAverageThroughput(o,c),h=f.getAverageLatency(o),g=s.BufferState.length>0?s.BufferState[s.BufferState.length-1]:null,m=e.useBufferOccupancyABR();return!s||isNaN(p)||!g||m||l.getAbandonmentStateFor(o)!==le.ABANDON_LOAD&&(g||c)&&(i.quality=l.getQualityForBitrate(a,p,h),u.getScheduleController().setTimeToLoadDelay(0),n("ThroughputRule requesting switch to index: ",i.quality,"type: ",o,"Average throughput",Math.round(p),"kbps"),i.reason={throughput:p,latency:h}),i},reset:function(){}}}F.__dashjs_factory_name="ThroughputRule";var x=s.a.getClassFactory(F);function U(e){e=e||{};var t=this.context,n=T(t).getInstance().log,r=e.mediaPlayerModel,i=e.metricsModel,a=e.dashMetrics,o=void 0,s=void 0,u=void 0;function l(){o={},s={},u=[]}var d={shouldAbandon:function(e){var l=w(t).create(w.NO_CHANGE,{name:U.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return l;var d,c,f=e.getMediaInfo(),p=e.getMediaType(),h=e.getCurrentRequest();if(!isNaN(h.index)){d=p,c=h.index,o[d]=o[d]||{},o[d][c]=o[d][c]||{};var g=r.getStableBufferTime();if(a.getCurrentBufferLevel(i.getReadOnlyMetricsFor(p))>g)return l;var m=o[p][h.index];if(null===m||null===h.firstByteDate||s.hasOwnProperty(m.id))return l;if(void 0===m.firstByteTime&&(u[p]=[],m.firstByteTime=h.firstByteDate.getTime(),m.segmentDuration=h.duration,m.bytesTotal=h.bytesTotal,m.id=h.index),m.bytesLoaded=h.bytesLoaded,m.elapsedTime=(new Date).getTime()-m.firstByteTime,m.bytesLoaded>0&&m.elapsedTime>0&&function(e,t){u[e]=u[e]||[],u[e].push(t)}(p,Math.round(8*m.bytesLoaded/m.elapsedTime)),u[p].length>=5&&m.elapsedTime>500&&m.bytesLoaded<m.bytesTotal){var E=u[p].reduce((function(e,t){return e+t
}),0);if(m.measuredBandwidthInKbps=Math.round(E/u[p].length),m.estimatedTimeOfDownload=+(8*m.bytesTotal/m.measuredBandwidthInKbps/1e3).toFixed(2),m.estimatedTimeOfDownload<1.8*m.segmentDuration||0===e.getRepresentationInfo().quality)return l;if(!s.hasOwnProperty(m.id)){var _=e.getAbrController(),T=m.bytesTotal-m.bytesLoaded,y=_.getBitrateList(f),v=_.getQualityForBitrate(f,m.measuredBandwidthInKbps*r.getBandwidthSafetyFactor());T>m.bytesTotal*y[v].bitrate/y[_.getQualityFor(p,f.streamInfo)].bitrate&&(l.quality=v,l.reason.throughput=m.measuredBandwidthInKbps,l.reason.fragmentID=m.id,s[m.id]=m,n("AbandonRequestsRule ( ",p,"frag id",m.id,") is asking to abandon and switch to quality to ",v," measured bandwidth was",m.measuredBandwidthInKbps),delete o[p][m.id])}}else m.bytesLoaded===m.bytesTotal&&delete o[p][m.id]}return l},reset:l};return l(),d}U.__dashjs_factory_name="AbandonRequestsRule";var B=s.a.getClassFactory(U);function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var k=function e(){G(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._responseHeaders=null,this._serviceLocation=null},H=function e(){G(this,e),this.s=null,this.d=null,this.b=[]};k.GET="GET",k.HEAD="HEAD",k.MPD_TYPE="MPD",k.XLINK_EXPANSION_TYPE="XLinkExpansion",k.INIT_SEGMENT_TYPE="InitializationSegment",k.INDEX_SEGMENT_TYPE="IndexSegment",k.MEDIA_SEGMENT_TYPE="MediaSegment",k.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",k.OTHER_TYPE="other";var V=10;function Y(e){e=e||{};var t=this.context,n=T(t).getInstance().log,r=e.dashMetrics,a=e.metricsModel,o=e.mediaPlayerModel,s=d(t).getInstance(),u=void 0,l=void 0;function c(e,t,n){var r=n.reduce((function(e,t,r){return t>n[e]?r:e}),0);if(0===r)return null;var i=Math.max(e,V+2*t.length),a=(n[r]-1)/(i/V-1);return{gp:a,Vp:V/a}}function f(e){var t={},n=e.getMediaInfo().bitrateList.map((function(e){return e.bandwidth})),r=function(e){return e.map((function(e){return Math.log(e)}))}(n);r=r.map((function(e){return e-r[0]+1}));var i=o.getStableBufferTime(),a=c(i,n,r);return a?(t.state=1,t.bitrates=n,t.utilities=r,t.stableBufferTime=i,t.Vp=a.Vp,t.gp=a.gp,t.lastQuality=0,p(t)):t.state=0,t}function p(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function h(e,t){var n=o.getStableBufferTime();if(e.stableBufferTime!==n){var i=c(n,e.bitrates,e.utilities);if(i.Vp!==e.Vp||i.gp!==e.gp){var s=r.getCurrentBufferLevel(a.getReadOnlyMetricsFor(t)),u=s+e.placeholderBuffer;u-=V,u*=i.Vp/e.Vp,u+=V,e.stableBufferTime=n,e.Vp=i.Vp,e.gp=i.gp,e.placeholderBuffer=Math.max(0,u-s)}}}function m(e,t){return e.Vp*(e.utilities[t]+e.gp)}function E(e,t){for(var n=e.bitrates[t],r=e.utilities[t],i=0,a=t-1;a>=0;--a)if(e.utilities[a]<e.utilities[t]){var o=e.bitrates[a],s=e.utilities[a],u=e.Vp*(e.gp+(n*s-o*r)/(n-o));i=Math.max(i,u)}return i}function _(){for(var e in l)l.hasOwnProperty(e)&&2===l[e].state&&(l[e].placeholderBuffer=0)}function y(){for(var e in l)if(l.hasOwnProperty(e)){var t=l[e];0!==t.state&&(t.state=1,p(t))}}function v(){}function A(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=l[e.chunk.mediaInfo.type];if(t&&0!==t.state){var n=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||n>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=n,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=n,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,R(t,e.chunk.mediaInfo.type)}}}function I(e){if(e&&e.metric===i.HTTP_REQUEST&&e.value&&e.value.type===k.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=l[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),R(t,e.mediaType))}}function R(e,t){
if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var n=r.getCurrentBufferLevel(a.getReadOnlyMetricsFor(t))+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),i=m(e,e.lastQuality),o=Math.max(0,i-n);e.placeholderBuffer=Math.min(o,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function S(e){if(e){var t=l[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function N(e){if(e){var t=l[e.mediaType];if(t&&0!==t.state){var n=r.getCurrentBufferLevel(a.getReadOnlyMetricsFor(e.mediaType)),i=void 0;i=t.abrQuality>0?E(t,t.abrQuality):V;var o=Math.max(0,i-n);t.placeholderBuffer=Math.min(t.placeholderBuffer,o)}}}function D(){l={}}return u={getMaxIndex:function(e){var i=e.getMediaInfo(),o=e.getMediaType(),s=a.getReadOnlyMetricsFor(o),u=e.getStreamProcessor(),d=e.getStreamInfo(),c=e.getAbrController(),g=c.getThroughputHistory(),_=d?d.id:null,T=d&&d.manifestInfo&&d.manifestInfo.isDynamic,y=e.useBufferOccupancyABR(),v=w(t).create();if(v.reason=v.reason||{},!y)return v;u.getScheduleController().setTimeToLoadDelay(0);var A=function(e){var t=e.getMediaType(),n=l[t];return n?0!==n.state&&h(n,t):(n=f(e),l[t]=n),n}(e);if(0===A.state)return v;var I=r.getCurrentBufferLevel(s),R=g.getAverageThroughput(o,T),S=g.getSafeAverageThroughput(o,T),N=g.getAverageLatency(o),D=void 0;if(v.reason.state=A.state,v.reason.throughput=R,v.reason.latency=N,isNaN(R))return v;switch(A.state){case 1:D=c.getQualityForBitrate(i,S,N),v.quality=D,v.reason.throughput=S,A.placeholderBuffer=Math.max(0,E(A,D)-I),A.lastQuality=D,!isNaN(A.lastSegmentDurationS)&&I>=A.lastSegmentDurationS&&(A.state=2);break;case 2:!function(e,t){var n=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){var r=.001*(n-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,r)}}else{var i=.001*(n-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,i)}e.lastCallTimeMs=n,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,h(e,t)}(A,o),D=function(e,t){for(var n=e.bitrates.length,r=NaN,i=NaN,a=0;a<n;++a){var o=(e.Vp*(e.utilities[a]+e.gp)-t)/e.bitrates[a];(isNaN(i)||o>=i)&&(i=o,r=a)}return r}(A,I+A.placeholderBuffer);var O=c.getQualityForBitrate(i,S,N);D>A.lastQuality&&D>O&&(D=Math.max(O,A.lastQuality));var C=Math.max(0,I+A.placeholderBuffer-m(A,D));C<=A.placeholderBuffer?(A.placeholderBuffer-=C,C=0):(C-=A.placeholderBuffer,A.placeholderBuffer=0,D<c.getTopQualityIndexFor(o,_)?u.getScheduleController().setTimeToLoadDelay(1e3*C):C=0),v.quality=D,v.reason.throughput=R,v.reason.latency=N,v.reason.bufferLevel=I,v.reason.placeholderBuffer=A.placeholderBuffer,v.reason.delay=C,A.lastQuality=D;break;default:n("BOLA ABR rule invoked in bad state."),v.quality=c.getQualityForBitrate(i,S,N),v.reason.state=A.state,v.reason.throughput=S,v.reason.latency=N,A.state=1,p(A)}return v},reset:function(){D(),s.off(g.BUFFER_EMPTY,_,u),s.off(g.PLAYBACK_SEEKING,y,u),s.off(g.PERIOD_SWITCH_STARTED,v,u),s.off(g.MEDIA_FRAGMENT_LOADED,A,u),s.off(g.METRIC_ADDED,I,u),s.off(g.QUALITY_CHANGE_REQUESTED,S,u),s.off(g.FRAGMENT_LOADING_ABANDONED,N,u)}},D(),s.on(g.BUFFER_EMPTY,_,u),s.on(g.PLAYBACK_SEEKING,y,u),s.on(g.PERIOD_SWITCH_STARTED,v,u),s.on(g.MEDIA_FRAGMENT_LOADED,A,u),s.on(g.METRIC_ADDED,I,u),s.on(g.QUALITY_CHANGE_REQUESTED,S,u),s.on(g.FRAGMENT_LOADING_ABANDONED,N,u),u}Y.__dashjs_factory_name="BolaRule";var q=s.a.getClassFactory(Y),Q="qualitySwitchRules",W="abandonFragmentRules";function K(e){e=e||{};var t=this.context,n=e.mediaPlayerModel,r=e.metricsModel,i=e.dashMetrics,a=void 0,o=void 0;function s(e){return e.filter((function(e){return e.quality>w.NO_CHANGE}))}function u(e){var n,r={},i=void 0,a=void 0,o=void 0,s=void 0;if(0!==e.length){for(r[w.PRIORITY.STRONG]=w.NO_CHANGE,r[w.PRIORITY.WEAK]=w.NO_CHANGE,r[w.PRIORITY.DEFAULT]=w.NO_CHANGE,i=0,
n=e.length;i<n;i+=1)(a=e[i]).quality!==w.NO_CHANGE&&(r[a.priority]=r[a.priority]>w.NO_CHANGE?Math.min(r[a.priority],a.quality):a.quality);return r[w.PRIORITY.WEAK]!==w.NO_CHANGE&&(o=r[w.PRIORITY.WEAK]),r[w.PRIORITY.DEFAULT]!==w.NO_CHANGE&&(o=r[w.PRIORITY.DEFAULT]),r[w.PRIORITY.STRONG]!==w.NO_CHANGE&&(o=r[w.PRIORITY.STRONG]),o!==w.NO_CHANGE&&(s=o),w(t).create(s)}}return{initialize:function(){a=[],o=[],n.getUseDefaultABRRules()&&(a.push(q(t).create({metricsModel:r,dashMetrics:i,mediaPlayerModel:n})),a.push(x(t).create({metricsModel:r,dashMetrics:i})),o.push(B(t).create({metricsModel:r,dashMetrics:i,mediaPlayerModel:n}))),n.getABRCustomRules().forEach((function(e){e.type===Q&&a.push(e.rule(t).create()),e.type===W&&o.push(e.rule(t).create())}))},reset:function(){[a,o].forEach((function(e){e&&e.length&&e.forEach((function(e){return e.reset&&e.reset()}))})),a=[],o=[]},getMaxQuality:function(e){return u(s(a.map((function(t){return t.getMaxIndex(e)}))))||w(t).create()},shouldAbandonFragment:function(e){return u(s(o.map((function(t){return t.shouldAbandon(e)}))))||w(t).create()}}}K.__dashjs_factory_name="ABRRulesCollection";var j=s.a.getClassFactory(K);j.QUALITY_SWITCH_RULES=Q,j.ABANDON_FRAGMENT_RULES=W,s.a.updateSingletonFactory(K.__dashjs_factory_name,j);var z=j;var X=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN,this.id=""};function Z(e){var t=(e=e||{}).abrController,n=e.streamProcessor,r=e.streamProcessor.getCurrentRepresentationInfo(),i=e.switchHistory,a=e.droppedFramesHistory,o=e.currentRequest,s=e.useBufferOccupancyABR;return{getMediaType:function(){return r.mediaInfo.type},getMediaInfo:function(){return r.mediaInfo},getDroppedFramesHistory:function(){return a},getCurrentRequest:function(){return o},getSwitchHistory:function(){return i},getStreamInfo:function(){return r.mediaInfo.streamInfo},getStreamProcessor:function(){return n},getAbrController:function(){return t},getRepresentationInfo:function(){return r},useBufferOccupancyABR:function(){return s}}}Z.__dashjs_factory_name="RulesContext";var J=s.a.getClassFactory(Z);function $(){var e=[],t=[];return{push:function(n){n.newValue===w.NO_CHANGE&&(n.newValue=n.oldValue),e[n.oldValue]||(e[n.oldValue]={noDrops:0,drops:0,dropSize:0});var r=n.newValue-n.oldValue,i=r<0?1:0,a=i?-r:0,o=i?0:1;if(e[n.oldValue].drops+=i,e[n.oldValue].dropSize+=a,e[n.oldValue].noDrops+=o,t.push({idx:n.oldValue,noDrop:o,drop:i,dropSize:a}),t.length>8){var s=t.shift();e[s.idx].drops-=s.drop,e[s.idx].dropSize-=s.dropSize,e[s.idx].noDrops-=s.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}$.__dashjs_factory_name="SwitchRequestHistory";var ee=s.a.getClassFactory($);function te(){var e=[],t=0,n=0;return{push:function(r,i){var a=i&&i.droppedVideoFrames?i.droppedVideoFrames:0,o=i&&i.totalVideoFrames?i.totalVideoFrames:0,s=a-t;t=a;var u=o-n;n=o,isNaN(r)||(e[r]?(e[r].droppedVideoFrames+=s,e[r].totalVideoFrames+=u):e[r]={droppedVideoFrames:s,totalVideoFrames:u})},getFrameHistory:function(){return e},getFrameInfo:function(){return{droppedFrames:t,totalFrames:n}},reset:function(r){e=[],t=r.droppedVideoFrames,n=r.totalVideoFrames}}}te.__dashjs_factory_name="DroppedFramesHistory";var ne=s.a.getClassFactory(te);function re(e){var t=(e=e||{}).mediaPlayerModel,n=void 0,i=void 0,a=void 0,o=void 0,s=void 0;function u(e,t,n,r){var i=Math.pow(.5,n/r.fast);e.fastEstimate=(1-i)*t+i*e.fastEstimate;var a=Math.pow(.5,n/r.slow);e.slowEstimate=(1-a)*t+a*e.slowEstimate,e.totalWeight+=n}function l(e,u,l){return t.getMovingAverageMethod()!==r.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var n=e?s.throughputHalfLife:s.latencyHalfLife,r=e?a[t]:o[t];if(!r||r.totalWeight<=0)return NaN;var i=r.fastEstimate/(1-Math.pow(.5,r.totalWeight/n.fast)),u=r.slowEstimate/(1-Math.pow(.5,r.totalWeight/n.slow));return e?Math.min(i,u):Math.max(i,u)}(e,u):function(e,t,r){var a=function(e,t,r){var a=void 0,o=void 0;if(e?(a=n[t],o=r?3:4):(a=i[t],
o=4),a){if(o>=a.length)o=a.length;else if(e)for(var s=1;s<o;++s){var u=a[s]/a[s-1];if((u>=1.3||u<=1/1.3)&&(o+=1)===a.length)break}}else o=0;return o}(e,t,r),o=(e?n:i)[t];if(0===a||!o||0===o.length)return NaN;return(o=o.slice(-a)).reduce((function(e,t){return e+t}))/o.length}(e,u,l)}function d(e,t){return l(!0,e,t)}function c(e){n[e]=n[e]||[],i[e]=i[e]||[],a[e]=a[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},o[e]=o[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function f(){n={},i={},a={},o={}}var p={push:function(e,l,d){if(l.trace&&l.trace.length){!1;var f=l.tresponse.getTime()-l.trequest.getTime()||1,p=l._tfinish.getTime()-l.tresponse.getTime()||1,h=l.trace.reduce((function(e,t){return e+t.b[0]}),0),g=f+p,m=Math.round(8*h/g);if(!(h<1e4)){if(c(e),function(e,n,i){return e===r.VIDEO?i+n<t.getCacheLoadThresholdForType(r.VIDEO):e===r.AUDIO?i+n<t.getCacheLoadThresholdForType(r.AUDIO):void 0}(e,f,p)){if(n[e].length>0&&!n[e].hasCachedEntries)return;n[e].hasCachedEntries=!0}else n[e]&&n[e].hasCachedEntries&&function(e){delete n[e],delete i[e],delete a[e],delete o[e],c(e)}(e);n[e].push(m),n[e].length>5&&n[e].shift(),i[e].push(f),i[e].length>5&&i[e].shift(),u(a[e],m,.001*p,s.throughputHalfLife),u(o[e],f,1,s.latencyHalfLife)}}},getAverageThroughput:d,getSafeAverageThroughput:function(e,n){var r=d(e,n);return isNaN(r)||(r*=t.getBandwidthSafetyFactor()),r},getAverageLatency:function(e){return l(!1,e)},getDict:function(e){return{throughput:n[e],latency:i[e]}},reset:f};return s={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},f(),p}re.__dashjs_factory_name="ThroughputHistory";var ie=s.a.getClassFactory(re),ae="abandonload",oe="allowload";function se(){var e=this.context,t=T(e).getInstance(),n=d(e).getInstance(),a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,p=void 0,h=void 0,m=void 0,E=void 0,_=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,N=void 0,D=void 0,O=void 0,C=void 0,M=void 0,P=void 0,L=void 0,b=void 0,F=void 0,x=void 0,U=void 0,B=void 0,G=void 0,H=void 0,V=void 0,Y={video:0,audio:0},q={video:{},audio:{}};function Q(e){e||(l={video:!0,audio:!0}),c={},f={},p={},h={},E={},m={},b={},U={},y=!1,H=!0,v=!1,void 0===A&&(A=!1),L=void 0,F=void 0,x=void 0,clearTimeout(_),_=null}function W(e){e.mediaType===r.VIDEO&&(L=e.oldQuality,F.push(L,C.getPlaybackQuality()))}function K(e){e.metric!==i.HTTP_REQUEST||!e.value||e.value.type!==k.MEDIA_SEGMENT_TYPE||e.mediaType!==r.AUDIO&&e.mediaType!==r.VIDEO||x.push(e.mediaType,e.value,H),e.metric!==i.BUFFER_LEVEL||e.mediaType!==r.AUDIO&&e.mediaType!==r.VIDEO||function(e,t){var n=M.getABRStrategy();if(n===r.ABR_STRATEGY_BOLA)return void(U[e]=!0);if(n===r.ABR_STRATEGY_THROUGHPUT)return void(U[e]=!1);var i=M.getStableBufferTime(),a=i,s=.5*i,u=U[e],l=t>(u?s:a);U[e]=l,l!==u&&o(l?"AbrController ("+e+") switching from throughput to buffer occupancy ABR rule (buffer: "+t.toFixed(3)+").":"AbrController ("+e+") switching from buffer occupancy to throughput ABR rule (buffer: "+t.toFixed(3)+").")}(e.mediaType,.001*e.value.level)}function j(e,t){var n=void 0;return c[t]=c[t]||{},c[t].hasOwnProperty(e)||(c[t][e]=0),n=function(e,t){var n=e;if(!m[t])return n;var r=re(t);void 0!==r&&(n=Math.max(e,r));var i=te(t);void 0!==i&&(n=Math.min(n,i));return n}(c[t][e],e),n=function(e,t,n){var r=se(t);if(isNaN(r)||r>=1||r<0)return e;return Math.min(e,Math.round(n*r))}(n,e,c[t][e]),n=function(e,t){if(t!==r.VIDEO||!y||!m[t])return e;A||me();var n=N.getValue(),i=D.getAdaptationForType(n,0,t).Representation,a=e;if(I>0&&R>0){for(;a>0&&i[a]&&I<i[a].width&&I-i[a-1].width<i[a].width-I;)a-=1;i.length-2>=a&&i[a].width===i[a+1].width&&(a=Math.min(e,a+1))}return a}(n,e),n}function Z(e){return p.hasOwnProperty("max")&&p.max.hasOwnProperty(e)?p.max[e]:NaN}function $(e){return p.hasOwnProperty("min")&&p.min.hasOwnProperty(e)?p.min[e]:NaN}function te(e){var t=Z(e);return t?fe(m[e].getMediaInfo(),t):void 0}function re(e){var t=$(e);if(t){var n=pe(m[e].getMediaInfo()),r=fe(m[e].getMediaInfo(),t);return n[r]&&r<n.length-1&&n[r].bitrate<1e3*t&&r++,r}}function se(e){
return h.hasOwnProperty("max")&&h.max.hasOwnProperty(e)?h.max[e]:1}function ue(e){return l[e]}function le(e,t,n,r){var i=t.id,a=ge(e);if(!(null!==n&&!isNaN(n)&&n%1==0))throw new Error("argument is not an integer");var o=j(e,i);n!==a&&n>=0&&n<=o&&de(e,a,n,o,r)}function de(e,r,i,a,s){if(e&&m[e]){var u=m[e].getStreamInfo(),l=u?u.id:null;if(t.getLogToBrowserConsole()){var d=G.getCurrentBufferLevel(B.getReadOnlyMetricsFor(e));o("AbrController ("+e+") switch from "+r+" to "+i+"/"+a+" (buffer: "+d+") "+(s?JSON.stringify(s):"."))}!function(e,t,n){f[t]=f[t]||{},f[t][e]=n}(e,l,i),n.trigger(g.QUALITY_CHANGE_REQUESTED,{mediaType:e,streamInfo:u,oldQuality:r,newQuality:i,reason:s})}}function ce(e,t){E[e].state=t}function fe(e,t,n){if(H&&n&&m[e.type].getCurrentRepresentationInfo()&&m[e.type].getCurrentRepresentationInfo().fragmentDuration){n/=1e3;var r=m[e.type].getCurrentRepresentationInfo().fragmentDuration;if(n>r)return 0;t*=1-n/r}var i=pe(e);if(!i||0===i.length)return 0;for(var a=i.length-1;a>=0;a--){if(1e3*t>=i[a].bitrate)return a}return 0}function pe(e){if(!e||!e.bitrateList)return null;for(var t=e.bitrateList,n=e.type,r=[],i=void 0,a=0,o=t.length;a<o;a++)(i=new X).mediaType=n,i.qualityIndex=a,i.id=t[a].id,i.bitrate=t[a].bandwidth,i.width=t[a].width,i.height=t[a].height,i.scanType=t[a].scanType,r.push(i);return r}function he(e){return U[e]}function ge(e){if(e&&m[e]){var t=m[e].getStreamInfo(),n=t?t.id:null;if(n)return f[n]=f[n]||{},f[n].hasOwnProperty(e)||(f[n][e]=_e(e,!1)||0),f[n][e]}return 0}function me(){if(C){var e=v&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;I=C.getClientWidth()*e,R=C.getClientHeight()*e}}function Ee(t){var n=t.request.mediaType;if(ue(n)){var r=m[n];if(!r)return;var i=J(e).create({abrController:a,streamProcessor:r,currentRequest:t.request,useBufferOccupancyABR:he(n)}),o=s.shouldAbandonFragment(i);if(o.quality>w.NO_CHANGE){var l=r.getFragmentModel();l.getRequests({state:S.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(l.abortRequests(),ce(n,ae),b[n].reset(),b[n].push({oldValue:ge(n,u.getActiveStreamInfo()),newValue:o.quality,confidence:1,reason:o.reason}),le(n,u.getActiveStreamInfo(),o.quality,o.reason),clearTimeout(_),_=setTimeout((function(){ce(n,oe),_=null}),M.getAbandonLoadTimeout()))}}}function _e(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var n=M.getPreloadData();if(n&&n[e+"id"])return m[e].getRepresentationController().getQualityForRepresentationId(n[e+"id"])}return Y[e]||0}return a={isPlayingAtTopQuality:function(e){var t=e.id,n=ge(r.AUDIO),i=ge(r.VIDEO);return n===j(r.AUDIO,t)&&i===j(r.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,n=e.streamInfo.id,r=e.representationCount-1;return function(e,t,n){c[t]=c[t]||{},c[t][e]=n}(t,n,r),r},getThroughputHistory:function(){return x},getBitrateList:pe,getQualityForBitrate:fe,getMaxAllowedBitrateFor:Z,getTopBitrateInfoFor:function(e){if(e&&m&&m[e]){var t=m[e].getStreamInfo();if(t.id){var n=j(e,t.id),r=pe(m[e].getMediaInfo());return r[n]?r[n]:null}}return null},getMinAllowedBitrateFor:$,setMaxAllowedBitrateFor:function(e,t){p.max=p.max||{},p.max[e]=t},setMinAllowedBitrateFor:function(e,t){p.min=p.min||{},p.min[e]=t},getMaxAllowedIndexFor:te,getMinAllowedIndexFor:re,getMaxAllowedRepresentationRatioFor:se,setMaxAllowedRepresentationRatioFor:function(e,t){h.max=h.max||{},h.max[e]=t},getInitialBitrateFor:function(e){var t=P.getSavedBitrateSettings(e);if(!p.hasOwnProperty(e))if(h.hasOwnProperty(e)){var n=N.getValue(),i=D.getAdaptationForType(n,0,e).Representation;if(Array.isArray(i)){var a=Math.max(Math.round(i.length*h[e])-1,0);p[e]=i[a].bandwidth}else p[e]=0}else isNaN(t)?p[e]=e===r.VIDEO?1e3:100:p[e]=t;return p[e]},setInitialBitrateFor:function(e,t){p[e]=t},getInitialRepresentationRatioFor:function(e){return h.hasOwnProperty(e)?h[e]:null},setInitialRepresentationRatioFor:function(e,t){h[e]=t},setAutoSwitchBitrateFor:function(e,t){l[e]=t},getAutoSwitchBitrateFor:ue,getUseDeadTimeLatency:function(){return H},setUseDeadTimeLatency:function(e){H=e},setLimitBitrateByPortal:function(e){y=e},
getLimitBitrateByPortal:function(){return y},getUsePixelRatioInLimitBitrateByPortal:function(){return v},setUsePixelRatioInLimitBitrateByPortal:function(e){v=e},getQualityFor:ge,getAbandonmentStateFor:function(e){return E[e]?E[e].state:null},setPlaybackQuality:le,checkPlaybackQuality:function(n){if(n&&m&&m[n]){var r=m[n].getStreamInfo(),i=r?r.id:null,u=ge(n),l=J(e).create({abrController:a,streamProcessor:m[n],currentValue:u,switchHistory:b[n],droppedFramesHistory:F,useBufferOccupancyABR:he(n)});if(F){var d=C.getPlaybackQuality();d&&F.push(L,d)}if(ue(n)){var c=re(n),f=j(n,i),p=s.getMaxQuality(l),h=p.quality;if(void 0!==c&&h<c&&(h=c),h>f&&(h=f),b[n].push({oldValue:u,newValue:h}),h>w.NO_CHANGE&&h!=u)E[n].state!==oe&&h===u||de(n,u,h,f,p.reason);else if(t.getLogToBrowserConsole()){var g=G.getCurrentBufferLevel(B.getReadOnlyMetricsFor(n));o("AbrController ("+n+") stay on "+u+"/"+f+" (buffer: "+g+")")}}}},getTopQualityIndexFor:j,setElementSize:me,setWindowResizeEventCalled:function(e){A=e},createAbrRulesCollection:function(){(s=z(e).create({metricsModel:B,dashMetrics:G,mediaPlayerModel:M,adapter:O})).initialize()},registerStreamType:function(t,i){b[t]=ee(e).create(),m[t]=i,E[t]=E[t]||{},E[t].state=oe,U[t]=!1,n.on(g.LOADING_PROGRESS,Ee,this),t==r.VIDEO&&(n.on(g.QUALITY_CHANGE_RENDERED,W,this),F=ne(e).create()),n.on(g.METRIC_ADDED,K,this),x=ie(e).create({mediaPlayerModel:M})},unRegisterStreamType:function(e){delete m[e]},setDefaultQualityFor:function(e,t){Y[e]=Number(t)||0,o("Set default quality for "+e+" - "+Y[e])},getDefaultQualityFor:_e,getDroppedFramesInfo:function(){return F&&F.getFrameInfo&&F.getFrameInfo()||{}},setCurrentSegmentInfoFor:function(e,t){q[e]=t},getCurrentSegmentInfoFor:function(e){return q[e]},getInitializeDate:function(){return V},setConfig:function(e){e&&(e.streamController&&(u=e.streamController),e.domStorage&&(P=e.domStorage),e.mediaPlayerModel&&(M=e.mediaPlayerModel),e.metricsModel&&(B=e.metricsModel),e.dashMetrics&&(G=e.dashMetrics),e.dashManifestModel&&(D=e.dashManifestModel),e.adapter&&(O=e.adapter),e.manifestModel&&(N=e.manifestModel),e.videoModel&&(C=e.videoModel),e.initializeDate&&(V=e.initializeDate))},reset:function(){Q(!0),n.off(g.LOADING_PROGRESS,Ee,this),n.off(g.QUALITY_CHANGE_RENDERED,W,this),n.off(g.METRIC_ADDED,K,this),s&&s.reset()}},o=t.log.bind(a),Q(),a}se.__dashjs_factory_name="AbrController";var ue=s.a.getSingletonFactory(se);ue.ABANDON_LOAD=ae,ue.QUALITY_DEFAULT=0,s.a.updateSingletonFactory(se.__dashjs_factory_name,ue);var le=ue,de="neverReplace",ce="alwaysReplace",fe="highestBitrate",pe="widestRange",he=fe;function ge(){var e,t=this.context,n=T(t).getInstance().log,i=d(t).getInstance(),a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=[ce,de],f=[fe,pe],p={video:0,audio:0};function h(e,t){if(!e||!t)return[];var n=t.id;return a[n]&&a[n][e]?a[n][e].list:[]}function m(e,t){return!e||!t||t&&!a[t.id]?null:a[t.id][e].current}function E(e){if(e){var t=e.type,n=e.streamInfo,r=n.id,o=m(t,n);if(a[r]&&a[r][t]&&(!o||!I(e,o))){a[r][t].current=e,o&&i.trigger(g.CURRENT_TRACK_CHANGED,{oldMediaInfo:o,newMediaInfo:e,switchMode:u[t]});var s=function(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}(e);s&&a[r][t].storeLastSettings&&(s.roles&&(s.role=s.roles[0],delete s.roles),s.accessibility&&(s.accessibility=s.accessibility[0]),s.audioChannelConfiguration&&(s.audioChannelConfiguration=s.audioChannelConfiguration[0]),l.setSavedMediaSettings(t,s))}}}function _(e,t){e&&t&&(o[e]=t)}function y(e){return e?o[e]:null}function v(){return s||he}function A(e){return e===r.AUDIO||e===r.VIDEO||e===r.TEXT||e===r.FRAGMENTED_TEXT||e===r.IMAGE}function I(e,t){
var n=e.id===t.id,r=e.viewpoint===t.viewpoint,i=e.lang===t.lang,a=e.roles.toString()===t.roles.toString(),o=e.accessibility.toString()===t.accessibility.toString(),s=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&r&&i&&a&&o&&s}function R(){a={},o={audio:null,video:null},u={audio:ce,video:de}}function S(e,t){var n=!e.lang||e.lang===t.lang,r=!e.viewpoint||e.viewpoint===t.viewpoint,i=!e.role||!!t.roles.filter((function(t){return t===e.role}))[0],a=!e.accessibility||!!t.accessibility.filter((function(t){return t===e.accessibility}))[0],o=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0];return n&&r&&i&&a&&o}function N(e){var t=v(),r=[],i=function(e){var t=0,n=[],r=void 0;return e.forEach((function(e){(r=Math.max.apply(Math,e.bitrateList.map((function(e){return e.bandwidth}))))>t?(t=r,n=[e]):r===t&&n.push(e)})),n},a=function(e){var t=0,n=[],r=void 0;return e.forEach((function(e){(r=e.representationCount)>t?(t=r,n=[e]):r===t&&n.push(e)})),n};switch(t){case fe:(r=i(e)).length>1&&(r=a(r));break;case pe:(r=a(e)).length>1&&(r=i(e));break;default:n("track selection mode is not supported: "+t)}return r[0]}return e={checkInitialMediaSettingsForType:function(e,t){var n=y(e),i=h(e,t),a=[];e!==r.FRAGMENTED_TEXT?(n||_(e,n=l.getSavedMediaSettings(e)),i&&0!==i.length&&(n&&i.forEach((function(e){S(n,e)&&a.push(e)})),0===a.length?E(N(i)):a.length>1?E(N(a)):E(a[0]))):E(i[0])},addTrack:function(e){if(e){var t=e.type;if(A(t)){var n=e.streamInfo.id;a[n]||(a[n]={audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}});for(var r=a[n][t].list,i=0,o=r.length;i<o;++i)if(I(r[i],e))return;r.push(e);var s=y(t);s&&S(s,e)&&!m(t,e.streamInfo)&&E(e)}}},getTracksFor:h,getCurrentTrackFor:m,isCurrentTrack:function(e){var t=e.type,n=e.streamInfo.id;return a[n]&&a[n][t]&&I(a[n][t].current,e)},setTrack:E,setInitialSettings:_,getInitialSettings:y,setSwitchMode:function(e,t){-1!==c.indexOf(t)?u[e]=t:n("track switch mode is not supported: "+t)},getSwitchMode:function(e){return u[e]},setSelectionModeForInitialTrack:function(e){-1!==f.indexOf(e)?s=e:n("track selection mode is not supported: "+e)},getSelectionModeForInitialTrack:v,isMultiTrackSupportedByType:A,isTracksEqual:I,setStartOffsetTimeForType:function(e,t){e&&t>0&&(p[e]=t)},getStartOffsetTimeForType:function(e){return p[e]||0},setConfig:function(e){e&&(e.errHandler&&e.errHandler,e.domStorage&&(l=e.domStorage))},reset:R},R(),e}ge.__dashjs_factory_name="MediaController";var me=s.a.getSingletonFactory(ge);me.TRACK_SWITCH_MODE_NEVER_REPLACE=de,me.TRACK_SWITCH_MODE_ALWAYS_REPLACE=ce,me.TRACK_SELECTION_MODE_HIGHEST_BITRATE=fe,me.TRACK_SELECTION_MODE_WIDEST_RANGE=pe,me.DEFAULT_INIT_TRACK_SELECTION_MODE=he,s.a.updateSingletonFactory(ge.__dashjs_factory_name,me);var Ee=me;var _e=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var n=0;n<t.boxes.length;n++)this.boxes.push(new e(t.boxes[n]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var r=0;r<t.references.length;r++){var i={reference_type:t.references[r].reference_type,referenced_size:t.references[r].referenced_size,subsegment_duration:t.references[r].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":case"mvhd":this.timescale=t.timescale;break;case"mfhd":
this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var a=0,o=t.samples.length;a<o;a++){var s={sample_size:t.samples[a].sample_size,sample_duration:t.samples[a].sample_duration,sample_composition_time_offset:t.samples[a].sample_composition_time_offset};this.samples.push(s)}}break;case"elst":this.boxes=t.entries}}return e.prototype.getChildBox=function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]},e.prototype.getChildBoxes=function(e){for(var t=[],n=0;n<this.boxes.length;n++)this.boxes[n].type===e&&t.push(this.boxes[n]);return t},e}();function Te(){var e=void 0;function t(t){var r=[];if(!t||!e||"function"!=typeof e.fetchAll)return r;for(var i=e.fetchAll(t),a=void 0,o=0,s=i.length;o<s;o++)(a=n(i[o]))&&r.push(a);return r}function n(e){if(!e)return null;var t=new _e(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(t){return t&&e&&e.boxes&&0!==e.boxes.length&&"function"==typeof e.fetch?n(e.fetch(t)):null},getBoxes:t,setData:function(t){e=t},getLastBox:function(){if(!e||!e.boxes||!e.boxes.length)return null;var n=t(e.boxes[e.boxes.length-1].type);return n.length>0?n[n.length-1]:null}}}Te.__dashjs_factory_name="IsoFile";var ye=s.a.getClassFactory(Te),ve=n(1),Ae=n.n(ve);var Ie=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=t,this.found=n,this.size=r};function Re(){var e=this.context;function t(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function n(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return{parse:function(t){if(!t)return null;void 0===t.fileStart&&(t.fileStart=0);var n=Ae.a.parseBuffer(t),r=ye(e).create();return r.setData(n),r},findLastTopIsoBoxCompleted:function(e,r,i){if(void 0===i&&(i=0),!r||i+8>=r.byteLength)return new Ie(0,!1);for(var a=r instanceof ArrayBuffer?new Uint8Array(r):r,o=void 0,s=0;i<a.byteLength;){var u=t(a,i),l=n(a,i+4);if(0===u)break;i+u<=a.byteLength&&(e.indexOf(l)>=0?o=new Ie(i,!0,u):s=i+u),i+=u}return o||new Ie(s,!1)}}}Re.__dashjs_factory_name="BoxParser";var Se=s.a.getSingletonFactory(Re);function Ne(){var e={};return{save:function(t){var n=t.streamId,r=t.representationId;e[n]=e[n]||{},e[n][r]=t},extract:function(t,n){return e&&e[t]&&e[t][n]?e[t][n]:null},reset:function(){e={}}}}Ne.__dashjs_factory_name="InitCache";var De=s.a.getSingletonFactory(Ne),Oe="bufferLoaded",Ce="bufferStalled",Me=.5,Pe=.5,Le=.01,be="BufferController";function we(e){e=e||{};var t=this.context,n=d(t).getInstance(),i=e.metricsModel,a=e.mediaPlayerModel,o=e.errHandler,s=e.streamController,u=e.mediaController,l=e.adapter,c=e.abrController,f=e.playbackController,p=e.type,h=e.streamProcessor,m=void 0,E=void 0,_=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,N=void 0,D=void 0,C=void 0,P=void 0,L=void 0,b=void 0,w=void 0,F=void 0,x=void 0,U=void 0,B=void 0,G=void 0,H=void 0,V=void 0,Y=void 0,q=void 0,Q=void 0,W=void 0,K=void 0;function j(e){if(!x||!e||!h)return null;if(I)try{"function"==typeof(D=O(t).create(I,e,$.bind(this))).getBuffer().initialize&&D.getBuffer().initialize(p,h),n.trigger(g.BUFFER_CREATED,{mediaType:e.type})}catch(e){E("Caught error on create SourceBuffer: "+e),o.mediaSourceError("Error creating "+p+" source buffer.")}else D=M(t).create($.bind(this))
;h.getRepresentationInfoForQuality(_)&&_e(h.getRepresentationInfoForQuality(_).MSETimeOffset)}function z(e){e.fragmentModel===h.getFragmentModel()&&(E("Init fragment finished loading saving to",p+"'s init cache"),E("Append Init fragment",p," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality),D?D.setAppendWindowEnd(a.getCachedDurationOffset("duration")):K=function(){var e=a.getCachedDurationOffset("duration");D.setAppendWindowEnd(e)},Z(e.chunk))}function X(e){if(e.fragmentModel===h.getFragmentModel()){var n=e.chunk,r=n.bytes,i=n.quality,a=h.getRepresentationInfoForQuality(i),o=l.getEventsFor(a.mediaInfo,h),s=l.getEventsFor(a,h);if(o&&o.length>0||s&&s.length>0){var u=function(e,n,r,i){for(var a=Math.max(!n||isNaN(n.startTime)?0:n.startTime,0),o=[],s=[],u=r.concat(i),d=0,c=u.length;d<c;d++)o[u[d].schemeIdUri]=u[d];for(var f=Se(t).getInstance().parse(e).getBoxes("emsg"),p=0,h=f.length;p<h;p++){var g=l.getEvent(f[p],o,a);g&&s.push(g)}return s}(r,h.getFragmentModel().getRequests({state:S.FRAGMENT_MODEL_EXECUTED,quality:i,index:n.index})[0],o,s);h.getEventController().addInbandEvents(u)}if(V){Y=n;var d=D&&D.getAllBufferRanges();d&&d.length>0&&f.getTimeToStreamEnd()>Me&&(E("Clearing buffer because track changed - "+(d.end(d.length-1)+.5)),he([{start:0,end:d.end(d.length-1)+.5,force:!0}]))}else Z(n)}}function Z(e,t){!w||t?(w=!0,L=e,e.startOffsetTime=u.getStartOffsetTimeForType(e.mediaInfo.type),D?D.append(e):q.push(e),e.mediaInfo.type===r.VIDEO&&n.trigger(g.VIDEO_CHUNK_RECEIVED,{chunk:e})):H.push(e)}function J(e){if(e.mediaType===p&&(K&&(K(),K=null),q.length))for(var t=Date.now(),r=e.mediaType,i=c.getInitializeDate(),o=0;o<q.length;o++){var s=q[o];s&&s.mediaInfo.type===r&&D&&D.append&&(q[o]=null,Q&&(_e(Q),Q=0),D.append(s),n.trigger(g.DELAY_TO_APPEND_TO_BUFFER,{mediaType:r,appendTime:t-i,createdTime:Date.now()-i,isPreload:!!a.getPreloadData()}))}}function $(e){if(e.error){if(22===e.error.code&&(A=.8*we(),E("Quota exceeded for type: "+p+", Critical Buffer: "+A),A>0)){var t=Math.max(.2*A,1),r=A-t;a.setBufferToKeep(parseFloat(t).toFixed(5)),a.setBufferAheadToKeep(parseFloat(r).toFixed(5))}22!==e.error.code&&Fe()||(E("Clearing playback buffer to overcome quota exceed situation for type: "+p),n.trigger(g.QUOTA_EXCEEDED,{sender:m,criticalBufferLevel:A,mediaType:p}),ne(),w=!1)}else{(L=e.chunk)&&!isNaN(L.index)&&(R=Math.max(L.index,R),de());var i=D.getAllBufferRanges();if(L.segmentType===k.MEDIA_SEGMENT_TYPE)re();else if(V){var o=f.getTime();E("[BufferController][",p,"] appendToBuffer seek target should be "+o),h.getScheduleController().setSeekTarget(o),l.setIndexHandlerTime(h,o)}var s={sender:m,quality:L.quality,startTime:L.start,index:L.index,bufferedRanges:i};if(L&&!L.endFragment?n.trigger(g.BYTES_APPENDED,s):L&&n.trigger(g.BYTES_APPENDED_END_FRAGMENT,s),0===H.length)w=!1;else Z(H.shift(),!0)}}function ee(e){_!==e.newQuality&&p===e.mediaType&&h.getStreamInfo().id===e.streamInfo.id&&(_e(h.getRepresentationInfoForQuality(e.newQuality).MSETimeOffset),_=e.newQuality)}function te(){if(y&&(B=!0,y=!1,N=Number.POSITIVE_INFINITY),H=[],w=!1,p!==r.FRAGMENTED_TEXT){var e=D.getAllBufferRanges(),t=!0;if(e&&e.length>0)for(var n=f.getTime(),i=0,a=e.length;i<a;i++)n>=e.start(i)&&n<=e.end(i)-1&&(t=!1);t?(h.getFragmentModel().clearExecutedRequestBySeeking(),ne()):re()}else re();U=void 0}function ne(){var e=function(){var e=[],t=D.getAllBufferRanges();if(!t||0===t.length)return e;var n=f.getTime(),r=t.end(t.length-1)+Pe,i=h.getFragmentModel().getRequests({state:S.FRAGMENT_MODEL_EXECUTED,time:n,threshold:Le})[0];if(i){var a={start:0,end:i.startTime-Me},o=h.getFragmentModel().getRequests({state:S.FRAGMENT_MODEL_EXECUTED,time:i.startTime-i.duration/2,threshold:Le})[0];o&&o.startTime!=i.startTime&&(a.end=o.startTime),a.start<a.end&&a.end>t.start(0)&&e.push(a);var s={start:i.startTime+i.duration+Me,end:r},u=h.getFragmentModel().getRequests({state:S.FRAGMENT_MODEL_EXECUTED,time:i.startTime+i.duration+Me,threshold:Le})[0];u&&u.startTime!==i.startTime&&(s.start=u.startTime+u.duration+Me),s.start<s.end&&s.start<r&&e.push(s)
}else E("getAllRangesWithSafetyFactor for",p,"- No request found in current time position, removing full buffer 0 -",r),e.push({start:0,end:r});return e}();e&&0!==e.length||re(),he(e)}function re(){V||(se(),ue())}function ie(){ce()}function ae(){ce()}function oe(e,t){var n=D&&D.getAllBufferRanges(),r=0,i=0,a=null,o=null,s=0,u=void 0,l=void 0,d=t||.15;if(null!=n){for(l=0,u=n.length;l<u;l++)if(r=n.start(l),i=n.end(l),null===a)s=Math.abs(r-e),(e>=r&&e<i||s<=d)&&(a=r,o=i);else{if(!((s=r-o)<=d))break;o=i}if(null!==a)return{start:a,end:o}}return null}function se(){var e,t,r;f&&(e=function(){var e=f.getTime();if(U){var t=D.getAllBufferRanges();t&&t.length&&(e=Math.max(t.start(0),U))}return e}()||0,v=null===(r=oe(e,t))?0:r.end-e,n.trigger(g.BUFFER_LEVEL_UPDATED,{sender:m,bufferLevel:v}),ce())}function ue(){h&&s&&h.getStreamInfo().id===s.getActiveStreamInfo().id&&(i.addBufferState(p,P,h.getScheduleController().getBufferTarget()),i.addBufferLevel(p,new Date,1e3*v))}function de(){R>=N-1&&!y&&void 0===D.discharge&&(y=!0,E("[BufferController]["+p+"] checkIfBufferingCompleted trigger BUFFERING_COMPLETED"),n.trigger(g.BUFFERING_COMPLETED,{sender:m,streamInfo:h.getStreamInfo()}))}function ce(){"audio"!==p&&"video"!==p||(B&&!y&&f&&f.getTimeToStreamEnd()-v<Me&&(B=!1,y=!0,E("[BufferController]["+p+"] checkIfSufficientBuffer trigger BUFFERING_COMPLETED"),n.trigger(g.BUFFERING_COMPLETED,{sender:m,streamInfo:h.getStreamInfo()})),v<Me&&!y?fe(Ce):(y||v>=a.getStableBufferTime())&&fe(Oe))}function fe(e){P===e||e===Ce&&0===f.getTime()||(P=e,ue(),n.trigger(g.BUFFER_LEVEL_STATE_CHANGED,{sender:m,state:e,mediaType:p,streamInfo:h.getStreamInfo()}),n.trigger(e===Oe?g.BUFFER_LOADED:g.BUFFER_EMPTY,{mediaType:p}),E(e===Oe?"Got enough buffer to start for "+p:"Waiting for more buffer before starting playback for "+p))}function pe(){D&&p!==r.FRAGMENTED_TEXT&&(y||he(function(){var e=[],t=D.getAllBufferRanges();if(!t||0===t.length)return e;var n=f.getTime(),r={start:Math.max(0,n-a.getBufferToKeep()),end:n+a.getBufferAheadToKeep()},i=h.getFragmentModel().getRequests({state:S.FRAGMENT_MODEL_EXECUTED,time:n,threshold:Le})[0];if(i)r.start=Math.min(i.startTime,r.start),r.end=Math.max(i.startTime+i.duration,r.end);else if(0===n&&f.getIsDynamic())return[];if(t.start(0)<=r.start){for(var o={start:0,end:r.start},s=0;s<t.length&&t.end(s)<=r.start;s++)o.end=t.end(s);o.start<o.end&&e.push(o)}if(t.end(t.length-1)>=r.end){var u={start:r.end,end:t.end(t.length-1)+Le};u.start<u.end&&e.push(u)}return e}()))}function he(e){e&&D&&0!==e.length&&(G.push.apply(G,e),F||ge())}function ge(){if(0===G.length||!D)return E("Nothing to prune, halt pruning"),G=[],void(F=!1);var e=D.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return E("SourceBuffer is empty (or does not exist), halt pruning"),G=[],void(F=!1);var t=G.shift();E("Removing",p,"buffer from:",t.start,"to",t.end),F=!0;var n=f.getTime();n<t.end&&(y=!1,R=0,V||(h.getScheduleController().setSeekTarget(n),l.setIndexHandlerTime(h,n)));var r=s.getDuration()-1;r&&0===t.start&&t.end>=r&&(t.force=!0),D.remove(t.start,t.end,t.force)}function me(e){D===e.buffer&&(E("[BufferController][",p,"] onRemoved buffer from:",e.from,"to",e.to),0===G.length&&(F=!1),e.unintended&&(E("[BufferController][",p,"] detected unintended removal from:",e.from,"to",e.to,"setting index handler time to",e.from),l.setIndexHandlerTime(h,e.from)),F?ge():(V?(V=!1,Y&&Z(Y)):(E("onRemoved : call updateBufferLevel"),se()),n.trigger(g.BUFFER_CLEARED,{sender:m,from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:Fe()})))}function _e(e){0!==e&&(D&&D.updateTimestampOffset?D.updateTimestampOffset(e):Q=e)}function Te(e){if(e.sender.getStreamProcessor()===h&&!e.error){var t=0;try{t=e.currentRepresentation.segmentAvailabilityRange.start}catch(e){}_e(t)}}function ye(e){e.fragmentModel===h.getFragmentModel()&&(N=e.request.index,de())}function ve(e){var t=D&&D.getAllBufferRanges();t&&e.newMediaInfo.type===p&&e.newMediaInfo.streamInfo.id===h.getStreamInfo().id&&(E("[BufferController]["+p+"] track change asked"),
u.getSwitchMode(p)===Ee.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&t&&t.length>0&&f.getTimeToStreamEnd()>Me&&(y=!1,N=Number.POSITIVE_INFINITY))}function Ae(){++b*(a.getWallclockTimeUpdateInterval()/1e3)>=a.getBufferPruningInterval()&&(b=0,pe())}function Ie(){ce()}function Re(){if(a.getAppendingSourceState()){y=!1,N=Number.POSITIVE_INFINITY,x.reset();var e=a.getCachedDurationOffset("offset");l.setIndexHandlerTime(h,e),h.resetPreloadData(),h.getFragmentModel().resetInitialSettings()}}function Ne(e,t){I=e,D&&t&&"function"==typeof D.discharge&&(C=D,j(t))}function we(){var e,t=D.getAllBufferRanges(),n=0,r=void 0;if(!t)return n;for(r=0,e=t.length;r<e;r++)n+=t.end(r)-t.start(r);return n}function Fe(){return we()<A}function xe(e){A=Number.POSITIVE_INFINITY,P=void 0,_=le.QUALITY_DEFAULT,N=Number.POSITIVE_INFINITY,R=0,L=null,y=!1,w=!1,F=!1,B=!1,v=0,b=0,G=[],q=[],D&&(e||D.abort(),D.reset(),D=null),V=!1}return m={getBufferControllerType:function(){return be},initialize:function(e){0,Ne(e),_=c.getQualityFor(p,h.getStreamInfo()),n.on(g.DATA_UPDATE_COMPLETED,Te,this),n.on(g.INIT_FRAGMENT_LOADED,z,this),n.on(g.MEDIA_FRAGMENT_LOADED,X,this),n.on(g.QUALITY_CHANGE_REQUESTED,ee,this),n.on(g.STREAM_COMPLETED,ye,this),n.on(g.PLAYBACK_PLAYING,ae,this),n.on(g.PLAYBACK_PROGRESS,re,this),n.on(g.PLAYBACK_TIME_UPDATED,re,this),n.on(g.PLAYBACK_RATE_CHANGED,Ie,this),n.on(g.PLAYBACK_SEEKING,te,this),n.on(g.PLAYBACK_STALLED,ie,this),n.on(g.WALLCLOCK_TIME_UPDATED,Ae,this),n.on(g.CURRENT_TRACK_CHANGED,ve,this,d.EVENT_PRIORITY_HIGH),n.on(g.SOURCEBUFFER_REMOVE_COMPLETED,me,this),n.on(g.BUFFER_CREATED,J,this),n.on(g.APPENDING_NEXT_SOURCE,Re,this)},createBuffer:j,dischargePreBuffer:function(){if(D&&C&&"function"==typeof C.discharge){var e=C.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+p+"PreBuffer discharge, adding buffer for:",n=0;n<e.length;n++)t+=" start: "+e.start(n)+", end: "+e.end(n)+";";E(t)}else E("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");for(var r=C.discharge(),i=null,a=0;a<r.length;a++){var o=r[a],s=x.extract(o.streamId,o.representationId);s&&(i!==s&&(D.append(s),i=s),D.append(o))}C.reset(),C=null}},getType:function(){return p},getStreamProcessor:function(){return h},setSeekStartTime:function(e){U=e},getBuffer:function(){return D},getBufferLevel:function(){return v},getRangeAt:oe,setMediaSource:Ne,getMediaSource:function(){return I},getIsBufferingCompleted:function(){return y},switchInitData:function(e,t,r){var i=x.extract(e,t);V=!0===r&&r,W=a.getAppendingSourceState(),i&&!W?(E("Append Init fragment",p," with representationId:",i.representationId," and quality:",i.quality),Z(i)):(W&&(W=!1,V=!1),n.trigger(g.INIT_REQUESTED,{sender:m}))},getIsPruningInProgress:function(){return F},reset:function(e){n.off(g.DATA_UPDATE_COMPLETED,Te,this),n.off(g.QUALITY_CHANGE_REQUESTED,ee,this),n.off(g.INIT_FRAGMENT_LOADED,z,this),n.off(g.MEDIA_FRAGMENT_LOADED,X,this),n.off(g.STREAM_COMPLETED,ye,this),n.off(g.CURRENT_TRACK_CHANGED,ve,this),n.off(g.PLAYBACK_PLAYING,ae,this),n.off(g.PLAYBACK_PROGRESS,re,this),n.off(g.PLAYBACK_TIME_UPDATED,re,this),n.off(g.PLAYBACK_RATE_CHANGED,Ie,this),n.off(g.PLAYBACK_SEEKING,te,this),n.off(g.PLAYBACK_STALLED,ie,this),n.off(g.WALLCLOCK_TIME_UPDATED,Ae,this),n.off(g.SOURCEBUFFER_REMOVE_COMPLETED,me,this),n.off(g.BUFFER_CREATED,J,this),n.off(g.APPENDING_NEXT_SOURCE,Re,this),xe(e)}},E=T(t).getInstance().log.bind(m),x=De(t).getInstance(),H=[],q=[],Q=0,xe(),m}we.__dashjs_factory_name=be;var Fe=s.a.getClassFactory(we);Fe.BUFFER_LOADED=Oe,Fe.BUFFER_EMPTY=Ce,s.a.updateClassFactory(we.__dashjs_factory_name,Fe);var xe=Fe;var Ue=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};function Be(){var e=void 0;return{initialize:function(t){if(e=new Ue,!t)return null;var n=t.indexOf("#");if(-1!==n)for(var r=t.substr(n+1).split("&"),i=0,a=r.length;i<a;++i){var o=r[i],s=o.indexOf("=");if(-1!==s){var u=o.substring(0,s);e.hasOwnProperty(u)&&(e[u]=o.substr(s+1))}}},
getURIFragmentData:function(){return e}}}Be.__dashjs_factory_name="URIFragmentModel";var Ge=s.a.getSingletonFactory(Be);function ke(){var e,t=this.context,n=T(t).getInstance().log,i=d(t).getInstance(),a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,p=void 0,h=void 0,m=void 0,E=void 0,_=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,S=void 0;function N(e){!v&&e.fromStreamInfo&&void 0!==m[e.fromStreamInfo.id]&&(delete _[e.fromStreamInfo.id],delete m[e.fromStreamInfo.id])}function D(){var e=G(!0),t=v?e-y.start:0;return parseFloat((e+(y.duration-t)-b()).toFixed(5))}function O(){if(y&&f&&f.getElement())return f.play();I=!0}function C(){return y&&f?f.isPaused():null}function M(){y&&f&&f.pause()}function P(){return y&&f?f.isSeeking():null}function L(e){y&&f&&(i.trigger(g.PLAYBACK_SEEK_ASKED),n("Requesting seek to time: "+e),f.setCurrentTime(e))}function b(){return y&&f?f.getTime():null}function w(){return y&&f?f.getPlaybackRate():null}function F(){return y&&f?f.getEnded():null}function x(){return v}function U(){0,p=NaN,h=null,I=!1,m={},E=0,S=0,_={},f&&(i.off(g.DATA_UPDATE_COMPLETED,Y,this),i.off(g.BUFFER_LEVEL_STATE_CHANGED,ie,this),i.off(g.BYTES_APPENDED_END_FRAGMENT,re,this),i.off(g.PERIOD_SWITCH_STARTED,N,this),H(),f.removeEventListener("canplay",q),f.removeEventListener("play",Q),f.removeEventListener("waiting",W),f.removeEventListener("playing",K),f.removeEventListener("pause",j),f.removeEventListener("error",ne),f.removeEventListener("seeking",z),f.removeEventListener("seeked",X),f.removeEventListener("timeupdate",Z),f.removeEventListener("progress",J),f.removeEventListener("ratechange",$),f.removeEventListener("loadedmetadata",ee),f.removeEventListener("ended",te),f.removeEventListener("stalled",ae)),f=null,y=null,v=null}function B(){var e=Ge(t).getInstance().getURIFragmentData(),n=void 0;if(e){n={};var r=parseInt(e.r,10);r>=0&&y&&r<y.manifestInfo.DVRWindowSize&&null===e.t&&(e.t=Math.floor(Date.now()/1e3)-y.manifestInfo.DVRWindowSize+r),n.fragS=parseInt(e.s,10),n.fragT=parseInt(e.t,10)}return n}function G(e,t){var n=void 0,r=NaN,i=B();if(r=i?e?y.start:isNaN(i.fragS)?i.fragT:i.fragS:0,v)isNaN(r)||((n=r-y.manifestInfo.availableFrom.getTime()/1e3)>p||n<(isNaN(t)?NaN:t-y.manifestInfo.DVRWindowSize))&&(n=null),n=n||p;else if(!isNaN(r)&&r<Math.max(y.manifestInfo.duration,y.duration)&&r>=0)n=r;else{var a=m[y.id];n=void 0!==a?Math.max(void 0!==a.audio?a.audio:0,void 0!==a.video?a.video:0,y.start):y.start}return n}function k(){if(null===h){h=setInterval((function(){var e;i.trigger(g.WALLCLOCK_TIME_UPDATED,{isDynamic:v,time:new Date}),x()&&C()&&(e=Date.now(),(!R||e>R+500)&&(R=e,Z()))}),A.getWallclockTimeUpdateInterval())}}function H(){clearInterval(h),h=null}function V(){if(!C()&&v&&0!==f.getReadyState()){var e=b(),t=function(e){var t=o.getReadOnlyMetricsFor(r.VIDEO)||o.getReadOnlyMetricsFor(r.AUDIO),n=s.getCurrentDVRInfo(t),i=n?n.range:null,a=void 0;if(!i)return NaN;if(e>i.end)a=Math.max(i.end-2*y.manifestInfo.minBufferTime,i.start);else{if(!(e+.25<i.start))return e;a=i.start}return a}(e);!isNaN(t)&&t!==e&&L(t)}}function Y(e){if(!e.error){var t=c.convertDataToRepresentationInfo(e.currentRepresentation).mediaInfo.streamInfo;y.id===t.id&&(y=t,V())}}function q(){i.trigger(g.CAN_PLAY)}function Q(){n("Native video element event: play"),V(),k(),i.trigger(g.PLAYBACK_STARTED,{startTime:b()})}function W(){n("Native video element event: waiting"),i.trigger(g.PLAYBACK_WAITING,{playingTime:b()})}function K(){n("Native video element event: playing"),i.trigger(g.PLAYBACK_PLAYING,{playingTime:b()})}function j(){n("Native video element event: pause"),i.trigger(g.PLAYBACK_PAUSED,{ended:F()})}function z(){var e=b();n("Seeking to: "+e),k(),i.trigger(g.PLAYBACK_SEEKING,{seekTime:e})}function X(){n("Native video element event: seeked"),i.trigger(g.PLAYBACK_SEEKED)}function Z(){var e=b();e,i.trigger(g.PLAYBACK_TIME_UPDATED,{timeToEnd:D(),time:e})}function J(){i.trigger(g.PLAYBACK_PROGRESS)}function $(){var e=w();n("Native video element event: ratechange: ",e),i.trigger(g.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function ee(){
n("Native video element event: loadedmetadata"),i.trigger(g.PLAYBACK_METADATA_LOADED),k()}function te(){n("Native video element event: ended"),M(),H(),i.trigger(g.PLAYBACK_ENDED,{isNativeEnded:!0})}function ne(e){var t=e.target||e.srcElement;i.trigger(g.PLAYBACK_ERROR,{error:t.error})}function re(e){var t,n=void 0,r=e.bufferedRanges;if(r&&r.length&&(!m[y.id]||!0!==m[y.id].started)){var i=e.sender.getType();void 0===_[y.id]&&(_[y.id]=[]),_[y.id][i]=r,void 0===m[y.id]&&(m[y.id]=[],m[y.id].started=!1),void 0===m[y.id][i]&&(m[y.id][i]=Math.max(r.start(0),y.start));var o=a.isVideoTrackPresent(),s=a.isAudioTrackPresent();t=G(!1),s&&o?isNaN(m[y.id].audio)||isNaN(m[y.id].video)||(m[y.id].audio<m[y.id].video?(n=m[y.id].video>t?m[y.id].video:t,r=_[y.id].audio):(n=m[y.id].audio>t?m[y.id].audio:t,r=_[y.id].video),function(e,t){if(t&&t.length>0)for(var n=0,r=t.length;n<r;n++)if(e>=t.start(n)&&e<t.end(n))return!0;return!1}(n,r)&&(P()||0===n||L(n),m[y.id].started=!0)):m[y.id][i]&&(n=m[y.id][i]>t?m[y.id][i]:t,P()||L(n),m[y.id].started=!0)}}function ie(e){e.streamInfo.id===y.id&&f.setStallState(e.mediaType,e.state===xe.BUFFER_EMPTY)}function ae(e){n("Native video element event: stalled",e),i.trigger(g.PLAYBACK_STALLED,{e:e})}return e={initialize:function(e){y=e,f.addEventListener("canplay",q),f.addEventListener("play",Q),f.addEventListener("waiting",W),f.addEventListener("playing",K),f.addEventListener("pause",j),f.addEventListener("error",ne),f.addEventListener("seeking",z),f.addEventListener("seeked",X),f.addEventListener("timeupdate",Z),f.addEventListener("progress",J),f.addEventListener("ratechange",$),f.addEventListener("loadedmetadata",ee),f.addEventListener("ended",te),f.addEventListener("stalled",ae),v=y.manifestInfo.isDynamic,p=y.start,i.on(g.DATA_UPDATE_COMPLETED,Y,this),i.on(g.BYTES_APPENDED_END_FRAGMENT,re,this),i.on(g.BUFFER_LEVEL_STATE_CHANGED,ie,this),i.on(g.PERIOD_SWITCH_STARTED,N,this),I&&(I=!1,O())},setConfig:function(e){e&&(e.streamController&&(a=e.streamController),e.metricsModel&&(o=e.metricsModel),e.dashMetrics&&(s=e.dashMetrics),e.manifestModel&&(u=e.manifestModel),e.dashManifestModel&&(l=e.dashManifestModel),e.mediaPlayerModel&&(A=e.mediaPlayerModel),e.adapter&&(c=e.adapter),e.videoModel&&(f=e.videoModel))},getStartTimeFromUriParameters:B,getStreamStartTime:G,getTimeToStreamEnd:D,getTime:b,getPlaybackRate:w,getPlayedRanges:function(){return y&&f?f.getPlayedRanges():null},getEnded:F,getIsDynamic:x,getStreamController:function(){return a},setLiveStartTime:function(e){p=e},getLiveStartTime:function(){return p},computeLiveDelay:function(e,t){var n=l.getMpd(u.getValue()),i=void 0,a=void 0;if(i=A.getUseSuggestedPresentationDelay()&&n.hasOwnProperty(r.SUGGESTED_PRESENTATION_DELAY)?n.suggestedPresentationDelay:A.getLowLatencyEnabled()?0:A.getLiveDelay()?A.getLiveDelay():isNaN(e)?2*y.manifestInfo.minBufferTime:e*A.getLiveDelayFragmentCount(),n.availabilityStartTime&&(S=n.availabilityStartTime.getTime()),t>0){var o=Math.max(t-10,t/2);a=Math.min(i,o)}else a=i;return E=a,a},getLiveDelay:function(){return E},getCurrentLiveLatency:function(){if(!v||isNaN(S))return NaN;var e=b();return isNaN(e)||0===e?0:(Math.round((new Date).getTime()-(1e3*e+S))/1e3).toFixed(3)},play:O,isPaused:C,pause:M,isSeeking:P,seek:L,reset:U},U(),e}ke.__dashjs_factory_name="PlaybackController";var He=s.a.getSingletonFactory(ke);function Ve(e){var t=(e=e||{}).timelineConverter,n=e.streamProcessor;return{getLiveEdge:function(){!function(){if(!(t&&t.hasOwnProperty("getExpectedLiveEdge")&&n&&n.hasOwnProperty("getCurrentRepresentationInfo")))throw new Error("Missing config parameter(s)")}();var e=n.getCurrentRepresentationInfo(),r=e.DVRWindow.end;return e.useCalculatedLiveEdgeTime&&(r=t.getExpectedLiveEdge(),t.setClientTimeOffset(r-e.DVRWindow.end)),r},reset:function(){t=null,n=null}}}Ve.__dashjs_factory_name="LiveEdgeFinder";var Ye=s.a.getClassFactory(Ve);function qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Qe=function e(){qe(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]}
;Qe.INITIAL_PLAYOUT_START_REASON="initial_playout",Qe.SEEK_START_REASON="seek",Qe.RESUME_FROM_PAUSE_START_REASON="resume",Qe.METRICS_COLLECTION_START_REASON="metrics_collection_start";var We=function e(){qe(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};function Ke(e){var t=(e=e||{}).dashMetrics,n=e.metricsModel,i=e.mediaPlayerModel,a=e.abrController;function o(e,o,s){var u=NaN,l=e.getCurrentRepresentationInfo();if(o===r.FRAGMENTED_TEXT);else if(o===r.AUDIO&&s){var d=t.getCurrentBufferLevel(n.getReadOnlyMetricsFor(r.VIDEO));u=isNaN(l.fragmentDuration)?d:Math.max(d,l.fragmentDuration)}else{var c=l.mediaInfo.streamInfo;if(a.isPlayingAtTopQuality(c))u=c.manifestInfo.duration>=i.getLongFormContentDurationThreshold()?i.getBufferTimeAtTopQualityLongForm():i.getBufferTimeAtTopQuality();else u=i.getStableBufferTime()}return u}return{execute:function(e,r,i){return t.getCurrentBufferLevel(n.getReadOnlyMetricsFor(r))<o(e,r,i)},getBufferTarget:o}}We.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",We.REBUFFERING_REASON="rebuffering",We.USER_REQUEST_STOP_REASON="user_request",We.END_OF_PERIOD_STOP_REASON="end_of_period",We.END_OF_CONTENT_STOP_REASON="end_of_content",We.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",We.FAILURE_STOP_REASON="failure",Ke.__dashjs_factory_name="BufferLevelRule";var je=s.a.getClassFactory(Ke);function ze(e){e=e||{};var t=this.context,n=T(t).getInstance().log,r=e.adapter;return{execute:function(e,t){var i=e.getCurrentRepresentationInfo(),a=i.mediaInfo.type,o=e.getScheduleController(),s=o.getSeekTarget(),u=!isNaN(s),l=e.getBufferController(),d=u?s:r.getIndexHandlerTime(e);if(isNaN(d))return null;if(u&&o.setSeekTarget(NaN),l){var c=l.getRangeAt(d);null===c||u||(n("Prior to making a request for time, NextFragmentRequestRule is aligning index handler's currentTime with bufferedRange.end for",a,".",d,"was changed to",c.end),d=c.end)}var f=void 0;if(t)d=t.startTime+t.duration/2,f=r.getFragmentRequestForTime(e,i,d,{timeThreshold:0,ignoreIsFinished:!0});else{for(f=r.getFragmentRequestForTime(e,i,d,{keepIdx:!u});f&&f.action!==E.ACTION_COMPLETE&&e.getFragmentModel().isFragmentLoaded(f);)f=r.getNextFragmentRequest(e,i);f&&(isNaN(f.startTime+f.duration)||r.setIndexHandlerTime(e,f.startTime+f.duration),f.delayLoadingTime=(new Date).getTime()+o.getTimeToLoadDelay(),o.setTimeToLoadDelay(0))}return f}}}ze.__dashjs_factory_name="NextFragmentRequestRule";var Xe=s.a.getClassFactory(ze);function Ze(e){e=e||{};var t=this.context,n=d(t).getInstance(),i=e.metricsModel,a=e.adapter,o=e.dashMetrics,s=e.dashManifestModel,u=e.timelineConverter,l=e.mediaPlayerModel,c=e.abrController,f=e.playbackController,p=e.streamController,h=e.type,m=e.streamProcessor,E=e.mediaController,_=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,N=void 0,D=void 0,O=void 0,C=void 0,M=void 0,P=void 0,L=void 0,b=void 0,w=void 0,F=void 0,x=void 0,U=void 0,B=void 0,G=void 0,k=void 0,H=void 0,V=void 0,Y=void 0,q={video:-1,audio:-1};function Q(){A&&!m.isBufferingCompleted()?(y("[ScheduleController][",h,"] start"),Re(),R=!1,I&&(I=!1),Z(!1),z(0)):y("[ScheduleController][",h,"] start denied")}function W(){R||(y("[ScheduleController][",h,"] stop"),R=!0,clearTimeout(P))}function K(e,t){U[t]=U[t]||{};var n=c.getTopQualityIndexFor(e,t);return U[t][e]!=n&&(y("Top quality "+e+" index has changed from "+U[t][e]+" to "+n),U[t][e]=n,!0)}function j(){var e=m.getBufferController();if(R||C||f.isPaused()&&!F)y("[ScheduleController][",h,"] - schedule stop!");else if(e.getIsBufferingCompleted())y("Schedule stop because buffering is completed!");else{!function(){var e=1.5*(A.fragmentDuration||5),t=v.getRequests({state:S.FRAGMENT_MODEL_EXECUTED,time:f.getTime()+e,threshold:0})[0];if(t&&-1===G.indexOf(t)&&!s.getIsTextTrack(h)){var n=l.getFastSwitchEnabled(),r=m.getBufferLevel(),i=c.getAbandonmentStateFor(h);t.mediaType&&c.setCurrentSegmentInfoFor(t.mediaType,{index:t.index,startTime:t.startTime,duration:t.duration,url:t.url})
;var a=!E.isCurrentTrack(t.mediaInfo)&&E.getSwitchMode(t.mediaInfo.type)===Ee.TRACK_SWITCH_MODE_NEVER_REPLACE,o=t.quality!==A.quality;n&&(a||o)&&r>=e&&i!==le.ABANDON_LOAD?(ee(t),y("Reloading outdated fragment at index: ",t.index)):t.quality>A.quality&&(y("The buffer has better quality it in then what we would request so set append point to end of buffer!!"),ve(f.getTime()+m.getBufferLevel()))}}();var t=G.length>0,r=m.getStreamInfo();if(H||isNaN(B)||k||t||K(A.mediaInfo.type,r.id)||b.execute(m,h,p.isVideoTrackPresent())){Z(!0),t||k||c.checkPlaybackQuality(h),function(){n.trigger(g.GET_NEXT_FRAGMENT,{mediaType:h,currentTime:m.getPlaybackController().getTime(),bufferLevel:m.getBufferLevel(),bufferResetInProgress:H,lastInitQuality:isNaN(B),switchTrack:k,isReplacement:t,hasTopQualityChanged:K(A.mediaInfo.type,r.id),bufferLevelRule:b.execute(m,h,p.isVideoTrackPresent()),final:H||isNaN(B)||k||t||K(A.mediaInfo.type,r.id)||b.execute(m,h,p.isVideoTrackPresent())});var e=m.getFragmentController();if(A.quality!==B)y("ScheduleController - "+h+" - quality has changed, get init request for representationid = "+A.id),B=A.quality,m.switchInitData(A.id);else if(k)y("ScheduleController - "+h+" - switch track has been asked, get init request for "+h+" with representationid = "+A.id),H=E.getSwitchMode(h)===Ee.TRACK_SWITCH_MODE_ALWAYS_REPLACE,m.switchInitData(A.id,H),B=A.quality,k=!1;else{var i=G.shift();if(e.isInitializationRequest(i))m.switchInitData(i.representationId);else{var a=void 0;m.getBufferController().getIsPruningInProgress()||!(a=w.execute(m,i))&&r.manifestInfo&&r.manifestInfo.isDynamic&&y("getNextFragment - "+h+" - Playing at the bleeding live edge and frag is not available yet"),a?(y("ScheduleController - "+h+" - getNextFragment - request is "+a.url),v.executeRequest(a)):(Z(!1),z(500))}}}()}else z(500)}}function z(e){clearTimeout(P),P=setTimeout(j,e)}function X(e){e.sender&&e.sender.getStreamProcessor()===m&&J(A.quality)}function Z(e){C!==e?C=e:y("[ScheduleController][",h,"] isFragmentProcessingInProgress is already equal to",e)}function J(e){var t=a.getInitRequest(m,e);t&&(t.mediaType&&c.setCurrentSegmentInfoFor(t.mediaType,{index:t.index,startTime:t.startTime,duration:t.duration,url:t.url}),Z(!0),v.executeRequest(t))}function $(){k=!0}function ee(e){G.push(e)}function te(e){if(h===e.mediaType&&m.getStreamInfo().id===e.streamInfo.id){if(null==(A=m.getRepresentationInfoForQuality(e.newQuality)))throw new Error("Unexpected error! - currentRepresentationInfo is null or undefined");q[h]=e.newQuality,Ie(new Date,We.REPRESENTATION_SWITCH_STOP_REASON),Re(),f.isPaused()&&(Y={type:h,oldQuality:e.oldQuality})}}function ne(e){if(f&&v){var t=v.getRequests({state:S.FRAGMENT_MODEL_EXECUTED,time:f.getTime(),threshold:0})[0];t&&f.getTime()>=t.startTime&&((!x.mediaInfo||t.mediaInfo.type===x.mediaInfo.type&&t.mediaInfo.id!==x.mediaInfo.id)&&e&&n.trigger(g.TRACK_CHANGE_RENDERED,{mediaType:h,oldMediaInfo:x.mediaInfo,newMediaInfo:t.mediaInfo}),t.quality===x.quality&&t.adaptationIndex===x.adaptationIndex||!e||q[h]===t.quality&&(n.trigger(g.QUALITY_CHANGE_RENDERED,{mediaType:h,oldQuality:x.quality,newQuality:t.quality}),q[h]=-1,Y=null),x={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function re(e){e.error||e.sender.getStreamProcessor()!==m||(A=a.convertDataToRepresentationInfo(e.currentRepresentation),l.getAppendingSourceState()&&$())}function ie(e){e.error||m.getStreamInfo().id!==e.streamInfo.id||(A=m.getCurrentRepresentationInfo(),I&&(f.getIsDynamic()?(u.setTimeSyncCompleted(!0),function(){var e=m.getLiveEdgeFinder();if(e){var t=e.getLiveEdge(),n=A.mediaInfo.streamInfo.manifestInfo.DVRWindowSize/2,s=t-f.computeLiveDelay(A.fragmentDuration,n),d=a.getFragmentRequestForTime(m,A,s,{ignoreIsFinished:!0});if(l.getLowLatencyEnabled()){var c=d.duration<l.getLiveDelay()?d.startTime:d.startTime+d.duration-l.getLiveDelay();f.setLiveStartTime(c)}else f.setLiveStartTime(d.startTime);(L=f.getStreamStartTime(!1,t))>A.mediaInfo.streamInfo.start+A.mediaInfo.streamInfo.duration&&f.seek(L)
;var p=o.getCurrentManifestUpdate(i.getMetricsFor(r.STREAM));i.updateManifestUpdateInfo(p,{currentTime:L,presentationStartTime:t,latency:t-L,clientTimeOffset:u.getClientTimeOffset()})}}()):(L=f.getStreamStartTime(!1),m.getBufferController().setSeekStartTime(L))),R&&Q())}function ae(e){e.fragmentModel===v&&(W(),Z(!1),y("[ScheduleController] Stream is complete"),l.getAppendingSourceState()&&Q())}function oe(e){e.sender===v&&(y("[ScheduleController][",h,"] - onFragmentLoadingCompleted"),s.getIsTextTrack(h)&&Z(!1),e.error&&e.request.serviceLocation&&!R&&Z(!1),H&&(V=e.request),f.isPaused()&&Y&&e.request.quality===q[h]&&(n.trigger(g.QUALITY_CHANGE_RENDERED,{mediaType:h,oldQuality:x.quality||Y.oldQuality,newQuality:e.request.quality}),q[h]=-1,Y=null))}function se(){ne(!0)}function ue(e){e.sender.getStreamProcessor()===m&&(H&&!isNaN(e.startTime)&&(H=!1,v.addExecutedRequest(V)),Z(!1),z(0))}function de(e){e.streamProcessor===m&&(y("[ScheduleController][onFragmentLoadingAbandoned] for "+h+", request: "+e.request.url+" has been aborted"),f.isSeeking()||k||(y("[ScheduleController][onFragmentLoadingAbandoned] for "+h+", request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),ee(e.request)),Z(!1),z(0))}function ce(e){e.sender.getStreamProcessor()===m&&W()}function fe(e){e.sender.getStreamProcessor()===m&&(e.unintended?m.getFragmentModel().removeExecutedRequestsAfterTime(e.from,m.getStreamInfo().duration):m.getFragmentModel().syncExecutedRequestsWithBufferedRange(m.getBufferController().getBuffer().getAllBufferRanges(),m.getStreamInfo().duration),e.hasEnoughSpaceToAppend&&R&&Q())}function pe(e){e.sender.getStreamProcessor()!==m||e.state!==xe.BUFFER_EMPTY||f.isSeeking()||(y("[ScheduleController][",h,"] - Buffer is empty! Stalling!"),Ie(new Date,We.REBUFFERING_REASON))}function he(e){e.sender.getStreamProcessor()===m&&(W(),Z(!1))}function ge(){v.abortRequests(),W()}function me(e){e.sender.getStreamProcessor()===m&&J(e.index)}function _e(){!R&&F||Q()}function Te(e){L=e.seekTime,Ae(0),R&&Q();var t=o.getCurrentManifestUpdate(i.getMetricsFor(r.STREAM)),n=A.DVRWindow&&f?A.DVRWindow.end-f.getTime():NaN;i.updateManifestUpdateInfo(t,{latency:n}),C?(y("[ScheduleController][onPlaybackSeeking] for "+h+", call fragmentModel.abortRequests in order to seek quicker"),v.abortRequests(),q[h]>=0&&(a.setIndexHandlerTime(m,L),m.switchInitData(A.id)),Z(!1),z(500)):z(0)}function ye(e){D&&(D.playbackspeed=e.playbackRate.toString())}function ve(e){L=e}function Ae(e){M=e}function Ie(e,t){if(N&&!1===O){var n=D.start,r=e.getTime()-n.getTime();D.duration=r,D.stopreason=t,N.trace.push(D),O=!0}}function Re(){N&&!0===O&&A&&(O=!1,(D=new We).representationid=A.id,D.start=new Date,D.mstart=1e3*f.getTime(),D.playbackspeed=f.getPlaybackRate().toString())}function Se(){B=NaN}function Ne(){C=!1,M=0,L=NaN,N=null,D=null,O=!0,I=!0,B=NaN,x={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},U={},G=[],R=!0,k=!1,H=!1,V=null}return _={initialize:function(){v=m.getFragmentModel(),F=l.getScheduleWhilePaused(),b=je(t).create({abrController:c,dashMetrics:o,metricsModel:i,mediaPlayerModel:l}),w=Xe(t).create({adapter:a}),s.getIsTextTrack(h)&&n.on(g.TIMED_TEXT_REQUESTED,me,this),n.on(g.QUALITY_CHANGE_REQUESTED,te,this),n.on(g.DATA_UPDATE_STARTED,ce,this),n.on(g.DATA_UPDATE_COMPLETED,re,this),n.on(g.FRAGMENT_LOADING_COMPLETED,oe,this),n.on(g.STREAM_COMPLETED,ae,this),n.on(g.STREAM_INITIALIZED,ie,this),n.on(g.BUFFER_LEVEL_STATE_CHANGED,pe,this),n.on(g.BUFFER_CLEARED,fe,this),n.on(g.BYTES_APPENDED_END_FRAGMENT,ue,this),n.on(g.INIT_REQUESTED,X,this),n.on(g.QUOTA_EXCEEDED,he,this),n.on(g.PLAYBACK_SEEKING,Te,this),n.on(g.PLAYBACK_STARTED,_e,this),n.on(g.PLAYBACK_RATE_CHANGED,ye,this),n.on(g.PLAYBACK_TIME_UPDATED,se,this),n.on(g.URL_RESOLUTION_FAILED,ge,this),n.on(g.FRAGMENT_LOADING_ABANDONED,de,this),n.on(g.MANIFEST_UPDATED,Se,this)},getType:function(){return h},getSeekTarget:function(){return L},setSeekTarget:ve,setTimeToLoadDelay:Ae,getTimeToLoadDelay:function(){return M},replaceRequest:ee,switchTrackAsked:$,isStarted:function(){return!1===R},
start:Q,stop:W,reset:function(){n.off(g.DATA_UPDATE_STARTED,ce,this),n.off(g.DATA_UPDATE_COMPLETED,re,this),n.off(g.BUFFER_LEVEL_STATE_CHANGED,pe,this),n.off(g.QUALITY_CHANGE_REQUESTED,te,this),n.off(g.FRAGMENT_LOADING_COMPLETED,oe,this),n.off(g.STREAM_COMPLETED,ae,this),n.off(g.STREAM_INITIALIZED,ie,this),n.off(g.QUOTA_EXCEEDED,he,this),n.off(g.BYTES_APPENDED_END_FRAGMENT,ue,this),n.off(g.BUFFER_CLEARED,fe,this),n.off(g.INIT_REQUESTED,X,this),n.off(g.PLAYBACK_RATE_CHANGED,ye,this),n.off(g.PLAYBACK_SEEKING,Te,this),n.off(g.PLAYBACK_STARTED,_e,this),n.off(g.PLAYBACK_TIME_UPDATED,se,this),n.off(g.URL_RESOLUTION_FAILED,ge,this),n.off(g.FRAGMENT_LOADING_ABANDONED,de,this),n.off(g.MANIFEST_UPDATED,Se,this),s.getIsTextTrack(h)&&n.off(g.TIMED_TEXT_REQUESTED,me,this),W(),ne(!1),Ne()},setPlayList:function(e){N=e},getBufferTarget:function(){return b.getBufferTarget(m,h,p.isVideoTrackPresent())},finalisePlayList:function(e,t){Ie(e,t),N=null}},y=T(t).getInstance().log.bind(_),Ne(),_}Ze.__dashjs_factory_name="ScheduleController";var Je=s.a.getClassFactory(Ze);var $e=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return e.prototype.init=function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.INTERACTIVE="interactive",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",
this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight"},e}());var et=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}return e.hasInitialization=function(e){return null!==e.initialization||null!==e.range},e.hasSegments=function(e){return e.segmentInfoType!==$e.BASE_URL&&e.segmentInfoType!==$e.SEGMENT_BASE&&!e.indexRange},e}();function tt(){var e=this.context,t=d(e).getInstance(),n=void 0,i=void 0,a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,p=void 0,h=void 0,m=void 0,E=void 0,_=void 0,T=void 0,y=void 0,v=[];function A(){return o}function I(){return u}function R(){i=null,a=-1,o=!0,s=[],l=null,f=null,p=null,h=null,m=null,E=null,_=null}function S(){var e=new Date,t=I(),n=1e3*f.getTime();p.addRepresentationSwitch(t.adaptation.type,e,n,t.id)}function D(){var e=T.getStreamInfo(),t=e?e.manifestInfo:null,n=t?t.isDynamic:null,r=m.calcSegmentAvailabilityRange(u,n);p.addDVRInfo(T.getType(),f.getTime(),t,r)}function O(e){return s[e]}function C(e){return s.indexOf(e)}function M(e){var r=e;o=!1,t.trigger(g.AST_IN_FUTURE,{delay:r}),setTimeout((function(){if(!A()){o=!0,t.trigger(g.DATA_UPDATE_STARTED,{sender:n}),s.forEach((function(e){e.segmentAvailabilityRange=null}));for(var e=0;e<s.length;e++)c.updateRepresentation(s[e],!0)}}),r)}function P(e){if(e.sender.getStreamProcessor()===T&&A()){var n=e.representation,a=p.getMetricsFor(r.STREAM),d=I().adaptation.type,c=p.getMetricsFor(I().adaptation.type),h=_.getCurrentManifestUpdate(a),m=!1,E=0,y=void 0,v=void 0;if(n.adaptation.period.mpd.manifest.type===$e.DYNAMIC&&!n.adaptation.period.mpd.manifest.ignorePostponeTimePeriod){var R=n.segmentAvailabilityRange.end-n.segmentAvailabilityRange.start;E=1e3*(f.computeLiveDelay(u.segmentDuration,T.getStreamInfo().manifestInfo.DVRWindowSize)-R)}if(E>0)return D(),M(E),v=new N(1,"Segments update failed",null),void t.trigger(g.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u,error:v});if(h){for(var O=0;O<h.representationInfo.length;O++)if((y=h.representationInfo[O]).index===n.index&&y.mediaType===T.getType()){m=!0;break}m||p.addManifestUpdateRepresentationInfo(h,n.id,n.index,n.adaptation.period.index,T.getType(),n.presentationTimeOffset,n.startNumber,n.segmentInfoType)}(function(e){var t=l.getQualityFor(e),n=T.getStreamInfo(),r=l.getTopQualityIndexFor(e,n.id),i=l.getMinAllowedIndexFor(e);void 0!==i&&t<i&&(t=i),t>r&&(t=r);for(var a=t;a<1;a++){var o=s[a].segmentInfoType;if(null===s[a].segmentAvailabilityRange||!et.hasInitialization(s[a])||(o===$e.SEGMENT_BASE||o===$e.BASE_URL)&&!s[a].segments)return!1}return!0})(d)&&(o=!1,l.setPlaybackQuality(T.getType(),T.getStreamInfo(),C(u)),p.updateManifestUpdateInfo(h,{latency:u.segmentAvailabilityRange.end-f.getTime()}),_.getCurrentRepresentationSwitch(c)||S(),t.trigger(g.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u}))}}function L(e){e.isDynamic&&function(e){for(var t=void 0,n=0,r=s.length;n<r;n++)(t=s[n]).segmentAvailabilityRange=m.calcSegmentAvailabilityRange(t,e)}(e.isDynamic)}function b(e){e.sender.getStreamProcessor()===T&&(y.getValue().doNotUpdateDVRWindowOnBufferUpdated||D())}function w(e){if(e.mediaType===T.getType()&&T.getStreamInfo().id===e.streamInfo.id&&e.oldQuality!==e.newQuality){var t=e.newQuality
;v[t]||(v[t]=!0,c.updateRepresentation(s[t],!0)),u=O(e.newQuality);var n=l.getThroughputHistory().getAverageThroughput(e.mediaType);isNaN(n)||h.setSavedBitrateSettings(e.mediaType,n),S()}}function F(e){if(e.newDuration){var t=I();if(t&&t.adaptation.period)t.adaptation.period.duration=e.newDuration}}return n={initialize:function(){c=T.getIndexHandler()},setConfig:function(e){e.abrController&&(l=e.abrController),e.domStorage&&(h=e.domStorage),e.metricsModel&&(p=e.metricsModel),e.dashMetrics&&(_=e.dashMetrics),e.dashManifestModel&&(E=e.dashManifestModel),e.playbackController&&(f=e.playbackController),e.timelineConverter&&(m=e.timelineConverter),e.manifestModel&&(y=e.manifestModel),e.streamProcessor&&(T=e.streamProcessor)},getData:function(){return i},getDataIndex:function(){return a},isUpdating:A,updateData:function(e,n,d){var f=T.getStreamInfo(),p=l.getTopQualityIndexFor(d,f.id),h=l.getMinAllowedIndexFor(d),m=void 0;if(o=!0,t.trigger(g.DATA_UPDATE_STARTED,{sender:this}),s=function(e){return a=E.getIndexForAdaptation(i,e.period.mpd.manifest,e.period.index),E.getRepresentationsForAdaptation(e)}(n),null!==i&&i.id==e.id||d===r.FRAGMENTED_TEXT||(l.getThroughputHistory().getAverageThroughput(d)||l.getInitialBitrateFor(d,f)),m=l.getQualityFor(d),void 0!==h&&m<h&&(m=h),m>p&&(m=p),u=O(m),i=e,d!==r.VIDEO&&d!==r.AUDIO&&d!==r.FRAGMENTED_TEXT)return o=!1,void t.trigger(g.DATA_UPDATE_COMPLETED,{sender:this,data:i,currentRepresentation:u});(v=[])[m]=!0,c.updateRepresentation(s[m],!0)},getStreamProcessor:function(){return T},getCurrentRepresentation:I,getRepresentationForQuality:O,getQualityForRepresentationId:function(e){return C(s.find((function(t){return t.id===e})))},reset:function(){t.off(g.QUALITY_CHANGE_REQUESTED,w,n),t.off(g.REPRESENTATION_UPDATED,P,n),t.off(g.WALLCLOCK_TIME_UPDATED,L,n),t.off(g.BUFFER_LEVEL_UPDATED,b,n),t.off(g.MANIFEST_VALIDITY_CHANGED,F,n),R(),v=[]}},R(),t.on(g.QUALITY_CHANGE_REQUESTED,w,n),t.on(g.REPRESENTATION_UPDATED,P,n),t.on(g.WALLCLOCK_TIME_UPDATED,L,n),t.on(g.BUFFER_LEVEL_UPDATED,b,n),t.on(g.MANIFEST_VALIDITY_CHANGED,F,n),n}tt.__dashjs_factory_name="RepresentationController";var nt=s.a.getClassFactory(tt);function rt(){var e=void 0,t=/^[a-z][a-z0-9+\-.]*:/i,n=/^https?:\/\//i,r=/^https:\/\//i,i=/^([a-z][a-z0-9+\-.]*:\/\/[^\/]+)\/?/i,a=function(e,t){try{return new window.URL(e,t).toString()}catch(t){return e}},o=function(e,t){var n=s;if(!t)return e;if(!d(e))return e;c(e)&&(n=u),f(e)&&(n=l);var r=n(t),i="/"!==r.charAt(r.length-1)&&"/"!==e.charAt(0)?"/":"";return[r,e].join(i)};function s(e){var t=e.indexOf("/"),n=e.lastIndexOf("/");return-1!==t?n===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,n+1)):""}function u(e){var t=e.match(i);return t?t[1]:""}function l(e){var n=e.match(t);return n?n[0]:""}function d(e){return!t.test(e)}function c(e){return d(e)&&"/"===e.charAt(0)}function f(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y");e=a}catch(e){}finally{e=e||o}}(),{parseBaseUrl:s,parseOrigin:u,parseScheme:l,isRelative:d,isPathAbsolute:c,isSchemeRelative:f,isHTTPURL:function(e){return n.test(e)},isHTTPS:function(e){return r.test(e)},resolve:function(t,n){return e(t,n)}}}rt.__dashjs_factory_name="URLUtils";var it=s.a.getSingletonFactory(rt);var at=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null};function ot(e,t){for(;e.length<t;)e="0"+e;return e}function st(e,t){return e.representation.startNumber+t}function ut(e,t,n){var r=void 0,i=void 0,a=void 0,o=void 0,s=void 0,u=void 0,l=t.length,d="%0".length;if(!e)return e;for(;;){if((r=e.indexOf("$"+t))<0)return e;if((i=e.indexOf("$",r+l))<0)return e;if((a=e.indexOf("%0",r+l))>r&&a<i)switch(o=e.charAt(i-1),
s=parseInt(e.substring(a+d,i-1),10),o){case"d":case"i":case"u":u=ot(n.toString(),s);break;case"x":u=ot(n.toString(16),s);break;case"X":u=ot(n.toString(16),s).toUpperCase();break;case"o":u=ot(n.toString(8),s);break;default:return e}else u=n;e=e.substring(0,r)+u+e.substring(i+1)}}function lt(e,t,n,r){var i,a,o=void 0,s=void 0;return s=n.segmentDuration,isNaN(s)&&(s=n.adaptation.period.duration),i=parseFloat((n.adaptation.period.start+r*s).toFixed(5)),a=parseFloat((i+s).toFixed(5)),(o=new at).representation=n,o.duration=s,o.presentationStartTime=i,o.mediaStartTime=e.calcMediaTimeFromPresentationTime(o.presentationStartTime,n),o.availabilityStartTime=e.calcAvailabilityStartTimeFromPresentationTime(o.presentationStartTime,n.adaptation.period.mpd,t),o.availabilityEndTime=e.calcAvailabilityEndTimeFromPresentationTime(a,n.adaptation.period.mpd,t),o.wallStartTime=e.calcWallTimeForSegment(o,t),o.replacementNumber=st(o,r),o.availabilityIdx=r,o}function dt(e,t,n,r,i,a,o,s,u,l){var d,c,f=r/a,p=Math.min(i/a,n.adaptation.period.mpd.maxSegmentDuration),h=void 0;return c=(d=e.calcPresentationTimeFromMediaTime(f,n))+p,(h=new at).representation=n,h.duration=p,h.mediaStartTime=f,h.presentationStartTime=d,h.availabilityStartTime=n.adaptation.period.mpd.manifest.loadedTime,h.availabilityEndTime=e.calcAvailabilityEndTimeFromPresentationTime(c,n.adaptation.period.mpd,t),h.wallStartTime=e.calcWallTimeForSegment(h,t),h.replacementTime=l||r,h.replacementNumber=st(h,u),o=ut(o,"Number",h.replacementNumber),o=ut(o,"Time",h.replacementTime),h.media=o,h.mediaRange=s,h.availabilityIdx=u,h}function ct(e,t){if(!t||!t.segments)return null;var n=t.segments.length,r=void 0,i=void 0;if(e<n&&(r=t.segments[e])&&r.availabilityIdx===e)return r;for(i=0;i<n;i++)if((r=t.segments[i])&&r.availabilityIdx===e)return r;return null}function ft(e,t,n,r,i,a){var o=n.segmentDuration,s=n.adaptation.period.mpd.manifest.minBufferTime,u=n.segmentAvailabilityRange,l={start:e.calcPeriodRelativeTimeFromMpdRelativeTime(n,u.start),end:e.calcPeriodRelativeTimeFromMpdRelativeTime(n,u.end)},d=n.segments,c=2*o,f=a||Math.max(2*s,10*o),p=NaN,h=null,g=void 0;return l.start=Math.max(l.start,0),t&&!e.isTimeSyncCompleted()?{start:g=Math.floor(l.start/o),end:Math.floor(l.end/o)}:(p=d&&d.length>0?(h=ct(i,n))?e.calcPeriodRelativeTimeFromMpdRelativeTime(n,h.presentationStartTime):i>0?i*o:e.calcPeriodRelativeTimeFromMpdRelativeTime(n,r):i>0?i*o:t?l.end:l.start,{start:g=Math.floor(Math.max(p-c,l.start)/o),end:Math.floor(Math.min(g+f/o,l.end/o))})}function pt(e,t){var n=(e=e||{}).timelineConverter;return{getSegments:function(e,r,i,a){if(function(){if(!(n&&n.hasOwnProperty("calcMediaTimeFromPresentationTime")&&n.hasOwnProperty("calcSegmentAvailabilityRange")&&n.hasOwnProperty("calcMediaTimeFromPresentationTime")))throw new Error("Missing config parameter(s)")}(),!e)throw new Error("no representation");void 0===r&&(r=null);var o=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,s=o.SegmentTimeline,u=o.SegmentURL_asArray,l=e.availableSegmentsNumber>0,d=void 0;d=a||(i>-1||null!==r?10:1/0);var c,f,p,h=0,g=0,m=-1,E=[],_=null,T=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,S=void 0,N=void 0,D=function(r,i){var a=o.media,s=r.mediaRange;return u&&(a=u[i].media||"",s=u[i].mediaRange),dt(n,t,e,h,r.d,N,a,s,m,r.tManifest)};for(N=e.timescale,c=s.S_asArray,p=i,null!==r&&(_=n.calcMediaTimeFromPresentationTime(r,e)),y=0,f=c.length;y<f;y++){if(A=0,(T=c[y]).hasOwnProperty("r")&&(A=T.r),T.hasOwnProperty("t")&&(g=(h=T.t)/N),A<0){if((R=c[y+1])&&R.hasOwnProperty("t"))I=R.t/N;else{var O=e.segmentAvailabilityRange?e.segmentAvailabilityRange.end:n.calcSegmentAvailabilityRange(e,t).end;I=n.calcMediaTimeFromPresentationTime(O,e),e.segmentDuration=T.d/N}A=Math.ceil((I-g)/(T.d/N))-1}if(S){if(l)break;m+=A+1}else for(v=0;v<=A;v++)if(m++,E.length>d){
if(S=!0,l)break}else null!==_?g>=_-T.d/N*1.5&&E.push(D(T,m)):m>=p&&E.push(D(T,m)),g=(h+=T.d)/N}return l||(e.availableSegmentsNumber=m+1),E}}}pt.__dashjs_factory_name="TimelineSegmentsGetter";var ht=s.a.getClassFactory(pt);function gt(e,t){var n=e.timelineConverter;return{getSegments:function(e,r,i,a){var o,s,u,l=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate,d=e.segmentDuration,c=e.segmentAvailabilityRange,f=[],p=null,h=null,g=void 0,m=void 0;for(u=e.startNumber,o=(g=isNaN(d)&&!t?{start:u,end:u}:ft(n,t,e,r,i,a)).start,s=g.end,m=o;m<=s;m++)(h=lt(n,t,e,m)).replacementTime=(u+m-1)*e.segmentDuration,p=ut(p=l.media,"Number",h.replacementNumber),p=ut(p,"Time",h.replacementTime),h.media=p,f.push(h),h=null;return isNaN(d)?e.availableSegmentsNumber=1:e.availableSegmentsNumber=Math.ceil((c.end-c.start)/d),f}}}gt.__dashjs_factory_name="TemplateSegmentsGetter";var mt=s.a.getClassFactory(gt);function Et(e,t){var n=(e=e||{}).timelineConverter;return{getSegments:function(e,r,i,a){var o,s,u,l,d=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,c=d.SegmentURL_asArray.length,f=[],p=void 0,h=void 0,g=void 0;for(l=e.startNumber,o=ft(n,t,e,r,i,a),s=Math.max(o.start,0),u=Math.min(o.end,d.SegmentURL_asArray.length-1),p=s;p<=u;p++)g=d.SegmentURL_asArray[p],(h=lt(n,t,e,p)).replacementTime=(l+p-1)*e.segmentDuration,h.media=g.media?g.media:"",h.mediaRange=g.mediaRange,h.index=g.index,h.indexRange=g.indexRange,f.push(h),h=null;return e.availableSegmentsNumber=c,f}}}Et.__dashjs_factory_name="ListSegmentsGetter";var _t=s.a.getClassFactory(Et);function Tt(e,t){var n,r=this.context,i=void 0,a=void 0,o=void 0;return n={getSegments:function(e,t,n,r,s){var u=void 0,l=e.segmentInfoType;l!==$e.SEGMENT_BASE&&l!==$e.BASE_URL&&function(e,t){var n=e.segments,r=!1,i=void 0,a=void 0;n&&0!==n.length?(a=n[0].availabilityIdx,i=n[n.length-1].availabilityIdx,r=t<a||t>i):r=!0;return r}(e,n)?(l===$e.SEGMENT_TIMELINE?u=i.getSegments(e,t,n,s):l===$e.SEGMENT_TEMPLATE?u=a.getSegments(e,t,n,s):l===$e.SEGMENT_LIST&&(u=o.getSegments(e,t,n,s)),r&&r(e,u)):u=e.segments}},i=ht(r).create(e,t),a=mt(r).create(e,t),o=_t(r).create(e,t),n}Tt.__dashjs_factory_name="SegmentsGetter";var yt=s.a.getClassFactory(Tt);function vt(){return{modifyRequestURL:function(e){return e},modifyRequestHeader:function(e){return e}}}vt.__dashjs_factory_name="RequestModifier";var At=s.a.getSingletonFactory(vt);function It(e){var t=(e=e||{}).requestModifier;return{load:function(e){var n=new Date,r=e.request,i=new XMLHttpRequest;i.open(e.method,e.url,!0),r.responseType&&(i.responseType=r.responseType),r.range&&i.setRequestHeader("Range","bytes="+r.range),r.requestStartDate||(r.requestStartDate=n),t&&(i=t.modifyRequestHeader(i)),i.withCredentials=e.withCredentials,e.request.loadInfo={rType:"XHR",cdn:0},i.onload=e.onload,i.onloadend=e.onend,i.onerror=e.onerror,i.timeout=e.timeout,i.ontimeout=e.ontimeout,i.onprogress=e.progress,i.onabort=e.onabort,i.onNcFail=e.onNcFail,i.onreadystatechange=function(){2===i.readyState&&e.onHeadersReceived()},i.send(),e.response=i},abort:function(e){e.response.abort()},getP2pType:function(){return""}}}It.__dashjs_factory_name="XHRLoader";var Rt=s.a.getClassFactory(It);function St(e){var t=void 0,n={cdn:0,p2p:0},r=void 0,i=(e=e||{}).p2pType,a=!1,o=T(this.context).getInstance().log,s="[P2PLoader]";return{load:function(u){r=u;var l=u.request;t||(t=new e.supplier(u.url,e.video,l.mediaType),o(s,"["+i+"] new sdk loader ["+l.mediaType+"]")),t.onDataArrival=function(e){var r=t&&t.loadInfo();r&&(l.p2pLoadInfo||(l.p2pLoadInfo={cdn:0,p2p:0}),l.p2pLoadInfo.url=r.url),u.progress&&u.progress(null,e,r&&{cdn:r.cdn-n.cdn,p2p:r.p2p-n.p2p,rType:"PCDN"}),n=r||n},t.onError=function(e,t){o(s,"["+i+"] error, status:"+e+", msg:"+t+", type:"+l.mediaType),u.response={status:e,statusText:t},a=!1,u.onerror(),u.onend()},t.onComplete=function(){
o(s,"["+i+"] onComplete, type:"+r.request.mediaType),a=!1,u.onload(),u.onend()};var d=void 0;if(l.range){var c=l.range.split("-");d={from:parseInt(c[0]),to:parseInt(c[1]||"-1")}}else d={from:0,to:-1};o(s,"["+i+"] load "+l.mediaType+" url:"+u.url+", range: "+d.from+"-"+d.to),t.load(d,u.withCredentials);var f=t.loadInfo();f&&(l.p2pLoadInfo||(l.p2pLoadInfo={cdn:0,p2p:0}),l.p2pLoadInfo.url=f.url),a=!0},abort:function(){a=!1,t&&(t.abort(),t.onDataArrival=void 0,t.onError=void 0,t.onComplete=void 0),r.onabort(),r.onend(),o(s,"["+i+"] abort sdk ["+r.request.mediaType+"]")},destroySdk:function(){var e=function(){a=!1,t&&(t.destroy(),t=void 0,o(s,"["+i+"] destroy sdk ["+r.request.mediaType+"]")),n={cdn:0,p2p:0}};a?(t.onError=function(t,n){o(s,"["+i+"] error, status:"+t+", msg:"+n+", type:"+r.request.mediaType),r.response={status:t,statusText:n},r.onerror(),r.onend(),e()},t.onComplete=function(){o(s,"["+i+"] detroy sdk onComplete, type:"+r.request.mediaType),r.onload(),r.onend(),e()}):e()},getUrl:function(){return r.url||""},getP2pType:function(){return i}}}St.__dashjs_factory_name="P2PLoader";var Nt=s.a.getClassFactory(St);function Dt(e){var t,n,r=void 0,i=void 0;n=(e=e||{}).hid;var a=!1;if(window.localStorage&&localStorage.getItem)try{var o=JSON.parse(localStorage.getItem("bp_nc_config"));o&&1===o.showLog&&(a=!0)}catch(e){}T(this.context).getInstance().log;function s(){var e="bpNC";return n&&(e+="_"+n),window[e]}return t={load:function(e){r=e;var t=e.request,n=s();n&&(i=n.getToken(),n.getData({url:t.url,range:t.range,token:i,bitrate:t.bitrate||0,latency:t.latency||5e3}).then((function(n){if(a){var r=0,i="";n&&n.responseData&&(n.responseData.getDataTime&&(r=Math.round(8*n.responseData.gotDataByte/1e3/(n.responseData.getDataTime/1e3))),n.responseData.path&&(i=n.responseData.path),n.peers=n.responseData.usePeerSids&&n.responseData.usePeerSids.length||0),console.log("--\x3e "+i+" nc success, speed is",r,"Kbps, res:",n)}e.progress&&e.progress(null,n.responseData.data,{nc:n.responseData.data.byteLength,cdn:0,rType:"NC",url:t.url}),e.onNCInfo&&e.onNCInfo(n),e.onload&&e.onload(),e.onend&&e.onend()}),(function(n){if(a){var r=0,i="";n&&n.responseData&&(n.responseData.getDataTime&&(r=Math.round(8*n.responseData.gotDataByte/1e3/(n.responseData.getDataTime/1e3))),n.responseData.path&&(i=n.responseData.path),n.peers=n.responseData.usePeerSids&&n.responseData.usePeerSids.length||0),console.log("--\x3e "+i+" nc fail, speed is",r,"Kbps, res:",n)}if(e.onNCFail&&n.responseData){var o=n.responseData.data?n.responseData.data.byteLength:0,s=n.responseData.gotDataByte?n.responseData.gotDataByte:0;e.onNCFail({ncFail:o,nc:s,ncGotFail:s,cdn:0,rType:"NC",url:t.url})}e.onNCInfo&&e.onNCInfo(n),e.onerror&&e.onerror()})))},abort:function(e){var t=s();t&&i&&t.abortGetData(i),r.onNCInfo&&r.onNCInfo({code:4999,qn:parseInt(e.representationId,10)||0,responseData:{}}),r&&r.onabort&&r.onabort(),r&&r.onend&&r.onend()},getP2pType:function(){return""}},t}Dt.__dashjs_factory_name="NCLoader";var Ot=s.a.getClassFactory(Dt);function Ct(e){var t=(e=e||{}).requestModifier;function n(e,t){e.reader.read().then(t).catch((function(){}))}return{load:function(e){var r=new Date,i=e.request,a=new Headers;i.range&&a.append("Range","bytes="+i.range),i.requestStartDate||(i.requestStartDate=r),t&&t.modifyRequestHeader({setRequestHeader:function(e,t){a.append(e,t)}});var o=void 0;"function"==typeof window.AbortController&&(o=new AbortController,e.abortController=o);var s={method:e.method,headers:a,credentials:e.withCredentials?"include":void 0,signal:o?o.signal:void 0};fetch(e.url,s).then((function(t){e.response||(e.response={}),e.response.status=t.status,e.response.statusText=t.statusText,e.response.responseURL=t.url,t.ok||e.onerror();var r="",i=!0,a=!1,o=void 0;try{for(var s,u=t.headers.keys()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r+=l+": "+t.headers.get(l)+"\n"}}catch(e){a=!0,o=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}if(e.response.responseHeaders=r,e.onHeadersReceived(),!t.body)return t.arrayBuffer().then((function(t){e.response.response=t
;var n={loaded:t.byteLength,total:t.byteLength};e.progress(n),e.onload(),e.onend()}));var d=parseInt(t.headers.get("Content-Length"),10),c=0,f=!1,p=new Uint8Array,h=0;e.reader=t.body.getReader();n(e,(function t(r){var i=r.value;if(r.done)return p&&(e.progress({loaded:c,total:isNaN(d)?c:d,lengthComputable:!0}),e.response.response=p.buffer),e.onload(),void e.onend();if(i&&i.length>0){p=function(e,t){if(0===e.length)return t;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(p,i),c+=i.length;var a=Se().getInstance().findLastTopIsoBoxCompleted(["moov","mdat"],p,h);if(a.found){var o=a.lastCompletedOffset+a.size,s=void 0;o===p.length?(s=p,p=new Uint8Array):(s=new Uint8Array(p.subarray(0,o)),p=p.subarray(o)),e.progress({data:s.buffer,lengthComputable:!1,noTrace:!0}),h=0}else h=a.lastCompletedOffset,f||(e.progress({lengthComputable:!1,noTrace:!0}),f=!0)}n(e,t)}))})).catch((function(t){e.onerror&&e.onerror(t)}))},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel()}catch(e){}}}}Ct.__dashjs_factory_name="FetchLoader";var Mt=s.a.getClassFactory(Ct);function Pt(){var e=this.context,t=d(e).getInstance();return{capabilityError:function(e){t.trigger(g.ERROR,{error:"capability",event:e})},downloadError:function(e,n,r,i,a){t.trigger(g.ERROR,{error:"download",event:{id:e,url:n,request:r},code:i,httpCode:a})},manifestError:function(e,n,r,i,a,o){t.trigger(g.ERROR,{error:"manifestError",event:{message:e,id:n,manifest:r,event:i},code:a,httpCode:o})},timedTextError:function(e,n,r){t.trigger(g.ERROR,{error:"cc",event:{message:e,id:n,cc:r}})},mediaSourceError:function(e,n){t.trigger(g.ERROR,{error:"mediasource",event:e,code:n})},mediaKeySessionError:function(e){t.trigger(g.ERROR,{error:"key_session",event:e})},mediaKeyMessageError:function(e){t.trigger(g.ERROR,{error:"key_message",event:e})},mssError:function(e){t.trigger(g.ERROR,{error:"mssError",event:e})}}}Pt.__dashjs_factory_name="ErrorHandler";var Lt=s.a.getSingletonFactory(Pt);Lt.CAPABILITY_ERROR_MEDIASOURCE="mediasource",Lt.CAPABILITY_ERROR_MEDIAKEYS="mediakeys",Lt.DOWNLOAD_ERROR_ID_MANIFEST="manifest",Lt.DOWNLOAD_ERROR_ID_SIDX="SIDX",Lt.DOWNLOAD_ERROR_ID_CONTENT="content",Lt.DOWNLOAD_ERROR_ID_INITIALIZATION="initialization",Lt.DOWNLOAD_ERROR_ID_XLINK="xlink",Lt.DOWNLOAD_ERROR_ID_PCDN_SDK="pcdnsdk",Lt.MANIFEST_ERROR_ID_CODEC="codec",Lt.MANIFEST_ERROR_ID_PARSE="parse",Lt.MANIFEST_ERROR_ID_NOSTREAMS="nostreams",Lt.TIMED_TEXT_ERROR_ID_PARSE="parse",s.a.updateSingletonFactory(Pt.__dashjs_factory_name,Lt);var bt=Lt;function wt(){return{arraybuffer2string:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},base642ab:function(e){e=window.atob(e);for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,i=e.length;r<i;r++)n[r]=e.charCodeAt(r);return t},concat:function(e,t){var n=new Uint8Array(e),r=new Uint8Array(t),i=new Uint8Array(n.length+r.length);return i.set(n),i.set(r,n.length),i.buffer}}}wt.__dashjs_factory_name="ArrayBufferHandler";var Ft=s.a.getSingletonFactory(wt);function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ut={video:null,audio:null};function Bt(e){e=e||{};var t,n=this.context,r=d(n).getInstance(),i=e.errHandler,o=e.videoModel,s=e.metricsModel,u=e.mediaPlayerModel,l=e.requestModifier,c=e.useFetch||!1,f=(e.dashMetrics,T(n).getInstance().log),p=void 0,h=void 0,m=void 0,E=void 0,_=[],y=void 0,v={},A=Ft(n).getInstance(),I=[],R=0,S=void 0,N=void 0,D=void 0,O=e.preloadData;function C(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=e.request,p="",T=0,I=0;if(d.range){var w=d.range.split("-");if(T=parseInt(w[0]),I=parseInt(w[1]),d.mediaType&&d.representationId&&O&&O[d.mediaType+"id"]===d.representationId+""&&O[d.mediaType]){if(I<O[d.mediaType].byteLength)return I+1===O[d.mediaType].byteLength&&(d.preloadEnd=1),void e.success(O[d.mediaType].slice(T,I+1));T<O[d.mediaType].byteLength&&(p=O[d.mediaType].slice(T,I+1),d.range=O[d.mediaType].byteLength+"-"+I,d.preloadEnd=1)}}d.firstByteDate=null
;var U=[],B=d.representationId,G=2e3,H=!0,V=!0,Y=new Date,q=Y,Q=0,W=void 0,K=v[B]||0,j=!1,z=1,X=0,Z=void 0;if(d.urls&&d.urls.length>1&&K&&(d.url=d.urls[K],e.url=d.urls[K]),!l||!s||!i)throw new Error("config object is not correct or missing");var J=l.modifyRequestURL(d.url),$=!(!e.params||"boolean"!=typeof e.params.canUseNC)&&e.params.canUseNC,ee=d.bufferLevel||0,te=2,ne=F(d);if(ne>1048576){var re=parseInt(ne/1024/1024,10),ie=1.5;ee=Math.max(0,ee-te-re*ie)}else ee=Math.max(0,ee-te);var ae=L($,T,J,ee),oe=function(e){V=!1;var t=new Date;d.requestStartDate=Y,d.requestEndDate=t,d.firstByteDate=d.firstByteDate||t,b(d),d.checkExistenceOnly||s.addHttpRequest(d.mediaType,null,d.type,d.url,W.response?W.response.responseURL:null,d.serviceLocation||null,d.range||null,d.requestStartDate,d.firstByteDate,d.requestEndDate,W.response?W.response.status:null,d.duration,W.response&&W.response.getAllResponseHeaders?W.response.getAllResponseHeaders():W.response?W.response.responseHeaders:null,e?U:null)},se=function(){if(clearTimeout(X),-1!==h.indexOf(W)){h.splice(h.indexOf(W),1),Z=!1;var n=W&&W.response&&W.response.status;if(V)if(oe(!1),e.params&&(e.params.canUseNC=!1),t>0){var o=0,s=0;Date.now()-Y<50&&(s=1e3*(a+1)),(n>=400&&n<500||n>=600)&&(s=0,o=0),ae&&(s=0,o=0),R=setTimeout((function(){ae||a++,r.trigger(g.REQUEST_RETRYED,{retryTimes:a,representationId:B,status:W.response&&W.response.status,url:d.url,mediaType:d.mediaType,range:d.range}),u.getP2pPermission()&&4203===n&&P(),e.request.urls&&e.request.urls.length>1?(v[B]=a%d.urls.length,K=v[B],e.request.url=d.urls[K],e.url=d.urls[K],t--,E.push(setTimeout((function(){f("[HTTPLoader] internalLoad failure retry"),C(e,t,a)}),o))):(t--,E.push(setTimeout((function(){f("[HTTPLoader] internalLoad failure retry"),C(e,t,a)}),o)))}),s)}else i.downloadError(y[d.type].type,d.url,d,y[d.type].code,W.response&&W.response.status),e.error&&e.error(d,"error",W.response&&W.response.statusText,W.response&&W.response.status),e.complete&&e.complete(d,W.response&&W.response.statusText),M(d.mediaType)}},ue=G+1e3*a+50;ae&&(ue=x(d.bufferLevel,ne),d.bitrate=ne,d.latency=ue);var le=d.timeout+3e3*a;X=setTimeout((function(){u.getP2pPermission()&&Z.getP2pType()&&u.addP2pSDKErrorCount(),j=!0,Z.abort(W),_.push(4106),e.connectTimeout&&e.connectTimeout(d,ue,ae),se()}),ue);var de=new Uint8Array,ce=function(t,n,r){var i=new Date;if(r)for(var a in d.p2pLoadInfo||(d.p2pLoadInfo={}),r)["p2p","cdn","nc"].indexOf(a)>-1?d.p2pLoadInfo[a]=(d.p2pLoadInfo[a]||0)+r[a]:d.p2pLoadInfo[a]=r[a];if(!t){if(t={lengthComputable:!1,total:0,loaded:0},n&&(de=A.concat(de,n),t.loaded=de.byteLength),d.range){var o=d.range.split("-"),s=parseInt(o[0]),u=parseInt(o[1]);u&&(t.total=u-s+1)}t.loaded&&t.total&&(t.lengthComputable=!0)}H&&(H=!1,(z=i-Y)<G&&clearTimeout(X),(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(d.firstByteDate=i)),t.lengthComputable&&(d.bytesLoaded=t.loaded,d.bytesTotal=t.total),t.noTrace||(U.push({s:q,d:i.getTime()-q.getTime(),b:[t.loaded?t.loaded-Q:0]}),q=i,Q=t.loaded),e.progress&&t.loaded&&e.progress(t.loaded)},fe=function(e){if(e)for(var t in d.p2pLoadInfo||(d.p2pLoadInfo={}),e)["p2p","cdn","nc","ncFail","ncGotFail"].indexOf(t)>-1?d.p2pLoadInfo[t]=(d.p2pLoadInfo[t]||0)+e[t]:d.p2pLoadInfo[t]=e[t]},pe=function(e){e.qn=parseInt(d.representationId,10)||0,d.NCInfo=e},he=function(){if(W.response){if(W.response.status>=200&&W.response.status<=299){var t=W.response.response;p&&(t=A.concat(p,W.response.response),d.range=T+"-"+I),oe(!0),e.success&&e.success(t,W.response.statusText,W.response.responseURL),e.complete&&e.complete(d,W.response.statusText)}}else{var n=de;p&&(n=A.concat(p,de),d.range=T+"-"+I),oe(!0),e.success&&e.success(n,"",J),e.complete&&e.complete(d,"")}},ge=function(){clearTimeout(X),clearTimeout(R),e.abort&&!j&&e.abort(d)},me=function(){_.push(4105),e.timeout&&e.timeout(d,z,le),se()},Ee=function(){d.headersReceivedDate=new Date,e.headersReceived&&e.headersReceived(W.response&&W.response.getAllResponseHeaders&&W.response.getAllResponseHeaders())};if(ae)Z=Ot(n).create({requestModifier:l,hid:S}),
r.trigger(g.CDN_LOAD_INFO,{NCInfo:{code:9999,qn:parseInt(d.representationId,10)||0,range:d.range,responseData:{}}});else if(c&&window.fetch&&"arraybuffer"===d.responseType)Z=Mt(n).create({requestModifier:l});else{var _e=function(e,t){var n=e.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)&&e.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)[1],r=t.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)&&t.match(/^.+\/([a-zA-Z0-9_\-\.]+)\??[^\/]+$/)[1];return n&&r&&n===r},Te=window.__DASH_P2P_TYPE__,ye={yf:window.YFDashIO,xl:window.xyvp&&window.xyvp.Loader,ks:window.KSLoader,pear:window.PearDownloader,bili:window.DIYSdk},ve=void 0,Ae=void 0,Ie=void 0;if(Te&&u.getP2pPermission()){var Re=Te.match(/([a-z]+)-([a-z0-9]+)/);Re&&(ve=ye[Re[1]],Ie="cg2"===Re[2],Ae="eg"===Re[2]),ve||delete window.__DASH_P2P_TYPE__}if(Ae&&ve&&d.index>=0)Ut[d.mediaType]&&Ut[d.mediaType].getP2pType()&&_e(Ut[d.mediaType].getUrl(),J)?Z=Ut[d.mediaType]:(M(d.mediaType),Z=Nt(n).create({video:o.getElement(),p2pType:Te,supplier:ve}),Ut[d.mediaType]=Z);else if(Ie&&ve&&"video"===d.mediaType){var Se=J;Se!==D&&(D=Se,N&&N.destroy(),N=new ve(J,o.getElement(),"watch"))}Z||(M(d.mediaType),Z=Rt(n).create({requestModifier:l}))}var Ne=d.checkExistenceOnly?k.HEAD:k.GET,De=u.getXHRWithCredentialsForType(d.type);W={url:J,method:Ne,withCredentials:De,timeout:le,request:d,onload:he,onend:se,onerror:se,ontimeout:me,progress:ce,onabort:ge,onHeadersReceived:Ee,onNCFail:fe,onNCInfo:pe,loader:Z};var Oe=(new Date).getTime();if(isNaN(d.delayLoadingTime)||Oe>=d.delayLoadingTime)h.push(W),Z.load(W);else{var Ce={httpRequest:W};m.push(Ce),Ce.delayTimeout=setTimeout((function(){if(-1!==m.indexOf(Ce)){m.splice(m.indexOf(Ce),1);try{Y=new Date,q=Y,h.push(Ce.httpRequest),Z.load(Ce.httpRequest)}catch(e){Ce.httpRequest.onerror()}}}),d.delayLoadingTime-Oe)}}function M(e){Ut[e]&&Ut[e].destroySdk&&(Ut[e].destroySdk(),Ut[e]=null)}function P(){r.trigger(g.PCDN_LOADED_ERROR,{code:a.DOWNLOAD_PCDN_DISABLED,from:1}),u.setP2pPermission(!1)}function L(e,t,n,r){if(isNaN(t)||t<0||!n)return!1;var i=function(){var e="bpNC";S&&(e+="_"+S);return window[e]}();if(!e||!i||"function"!=typeof i.allowDPGetDataByNC)return!1;var a=(""+n).split("?")[0].split("/"),s=a[a.length-1].split(".")[0].slice(-5);if(!s)return!1;var u=parseInt(s,10);if(isNaN(u))return!1;var l=NaN,d=!1;if(o&&o.getElement()){var c=o.getElement(),p=c.currentTime,h=0;c.buffered&&c.buffered.length&&(h=c.buffered.end(0)),l=h-p,d=c&&c.seeking}return!isNaN(l)&&(!!r&&(f("Is Use NCLoader, "+JSON.stringify({rangeStart:t,qn:u,bufferRemaining:l,bufferLevel:r,isSeeking:d})),i.allowDPGetDataByNC({rangeStart:t,qn:u,bufferRemaining:l,bufferLevel:r,isSeeking:d})))}function b(e){if(e.p2pLoadInfo&&e.loadInfo){var t=function(e){for(var t in e)["url","rType"].indexOf(e)>-1||(n[t]=(n[t]||0)+(e[t]||0))},n={};t(e.p2pLoadInfo),t(e.loadInfo),n.rType="XHR",n.url=e.loadInfo.url||e.p2pLoadInfo.url||"",e.loadInfo=n}else e.loadInfo=e.p2pLoadInfo||e.loadInfo||{};"XHR"===e.loadInfo.rType&&(e.loadInfo.cdn=e.bytesTotal||e.bytesLoaded||0,e.loadInfo.url=e.url)}function w(e){e&&e.hid&&(S=e.hid)}function F(e){var t=0;try{var n=e&&e.mediaInfo&&e.mediaInfo.bitrateList,r=e&&e.representationId;if(r&&n&&n.length){var i=n.filter((function(e){return e.id===r}));i&&i.length&&(t=i[0].bandwidth)}}catch(e){}return t}function x(e,t){var n=5e3;return n=e<15?5e3:e<25?1e3*parseInt(e-10,10):Math.max(15e3,1e4),n=Math.min(n,15e3),n=Math.max(n,5e3)}return O&&(O.video&&"string"==typeof O.video&&(O.video=A.base642ab(O.video)),O.audio&&"string"==typeof O.audio&&(O.audio=A.base642ab(O.audio))),p={load:function(e){e.request&&C(e,u.getRetryAttemptsForType(e.request.type),0)},abort:function(){N&&(N.destroy(),N=void 0,D=void 0),clearTimeout(R),I.forEach((function(e){return clearTimeout(e)})),E.forEach((function(e){return clearTimeout(e)})),E=[],m.forEach((function(e){return clearTimeout(e.delayTimeout)})),m=[],h.forEach((function(e){e&&e.request&&isNaN(e.request.index)||(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e),e.onabort())})),h=[],r.off(g.INIT_HID,w,p)},setPreloadData:function(e){
(O=e)&&(O.video&&"string"==typeof O.video&&(O.video=A.base642ab(O.video)),O.audio&&"string"==typeof O.audio&&(O.audio=A.base642ab(O.audio)))}},r.on(g.INIT_HID,w,p),h=[],m=[],E=[],xt(t={},k.MPD_TYPE,{type:bt.DOWNLOAD_ERROR_ID_MANIFEST,code:a.DOWNLOAD_MPD_ERROR}),xt(t,k.XLINK_EXPANSION_TYPE,{type:bt.DOWNLOAD_ERROR_ID_XLINK,code:a.DOWNLOAD_XINK_ERROR}),xt(t,k.INIT_SEGMENT_TYPE,{type:bt.DOWNLOAD_ERROR_ID_INITIALIZATION,code:a.DOWNLOAD_INIT_SEGMENT_ERROR}),xt(t,k.MEDIA_SEGMENT_TYPE,{type:bt.DOWNLOAD_ERROR_ID_CONTENT,code:a.DOWNLOAD_MEDIA_SEGMENT_ERROR}),xt(t,k.INDEX_SEGMENT_TYPE,{type:bt.DOWNLOAD_ERROR_ID_CONTENT,code:a.DOWNLOAD_INDEX_SEGMENT_ERROR}),xt(t,k.BITSTREAM_SWITCHING_SEGMENT_TYPE,{type:bt.DOWNLOAD_ERROR_ID_CONTENT,code:a.DOWNLOAD_SWITCHING_SEGMENT_ERROR}),xt(t,k.OTHER_TYPE,{type:bt.DOWNLOAD_ERROR_ID_CONTENT,code:a.DOWNLOAD_OTHER_ERROR}),y=t,p}Bt.__dashjs_factory_name="HTTPLoader";var Gt=s.a.getClassFactory(Bt);function kt(){var e,t=this.context,n=T(t).getInstance().log,r=d(t).getInstance(),i=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,p=void 0;function h(){if(!p||!p.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function m(e){if(e.url){var t=new E;return t.type=e.init?k.INIT_SEGMENT_TYPE:k.MEDIA_SEGMENT_TYPE,t.url=e.url,t.urls=e.urls,t.range=e.range.start+"-"+e.range.end,t.representationId=e.representationId,t.mediaType=e.mediaType,t}}function _(e,t,n){e?r.trigger(g.SEGMENTS_LOADED,{segments:e,representation:t,mediaType:n}):r.trigger(g.SEGMENTS_LOADED,{segments:null,representation:t,mediaType:n,error:new N(null,"error loading segments",null)})}return e={setConfig:function(e){e.baseURLController&&(p=e.baseURLController),e.metricsModel&&(l=e.metricsModel),e.mediaPlayerModel&&(c=e.mediaPlayerModel),e.errHandler&&(i=e.errHandler),e.videoModel&&(o=e.videoModel)},initialize:function(){s=Se(t).getInstance(),u=At(t).getInstance(),f=Gt(t).create({errHandler:i,videoModel:o,metricsModel:l,mediaPlayerModel:c,requestModifier:u,preloadData:c.getPreloadData()})},loadInitialization:function e(t,i){h();var a=null,o=null,u=p.resolve(t.path),l=i||{init:!0,url:u?u.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500};n("Start searching for initialization.");var d=m(l);f.load({request:d,success:function(i){l.bytesLoaded=l.range.end,o=s.parse(i),a=function(e){var t=e.getBox("ftyp"),r=e.getBox("moov"),i=null,a=void 0,o=void 0;n("Searching for initialization."),r&&r.isComplete&&(a=t?t.offset:r.offset,o=r.offset+r.size-1,n("Found the initialization.  Range: "+(i=a+"-"+o)));return i}(o),a?(t.range=a,r.trigger(g.INITIALIZATION_LOADED,{representation:t})):(l.range.end=l.bytesLoaded+l.bytesToLoad,e(t,l))},error:function(){r.trigger(g.INITIALIZATION_LOADED,{representation:t})}}),n("Perform init search: "+l.url)},loadSegments:function e(t,r,o,u,l){if(h(),o&&(void 0===o.start||void 0===o.end)){var d=o?o.toString().split("-"):null;o=d?{start:parseFloat(d[0]),end:parseFloat(d[1])}:null}l=l||_;var g=null,E=null,T=!!o,y=p.resolve(t.path),v={init:!1,url:y?y.url:void 0,urls:y.urls,range:T?o:{start:0,end:1500},searching:!T,bytesLoaded:u?u.bytesLoaded:0,bytesToLoad:1500,representationId:t.id,mediaType:t.adaptation.type},A=m(v),I=function(){l(null,t,r)};f.load({request:A,success:function(o){if(v.bytesLoaded=v.range.end-v.range.start,g=s.parse(o),(E=g.getBox("sidx"))&&E.isComplete){var u=E.references,d=void 0,f=void 0;if(null!=u&&u.length>0&&(d=1===u[0].reference_type),d){n("Initiate multiple SIDX load."),v.range.end=v.range.start+E.size;var p=void 0,h=void 0,m=void 0,_=void 0,T=[],y=0,A=(E.offset||v.range.start)+E.size,R=function(e){e?(T=T.concat(e),++y>=h&&l(T,t,r)):l(null,t,r)};for(p=0,h=u.length;p<h;p++)m=A,_=A+u[p].referenced_size-1,A+=u[p].referenced_size,e(t,null,{start:m,end:_},v,R)}else{n("Parsing segments from SIDX."),f=function(e,t){for(var n=e.references,r=n.length,i=e.timescale,a=e.earliest_presentation_time,o=t.range.start+e.offset+e.first_offset+e.size,s=[],u=void 0,l=void 0,d=void 0,c=void 0,f=0;f<r;f++)d=n[f].subsegment_duration,c=n[f].referenced_size,
(u=new at).duration=d,u.startTime=a,u.timescale=i,l=o+c-1,u.mediaRange=o+"-"+l,s.push(u),a+=d,o+=c;return s}(E,v);try{var S=f[f.length-1],N=(S.duration+S.startTime)/S.timescale;t.adaptation.period.min?t.adaptation.period.min=Math.min(t.adaptation.period.min,N):t.adaptation.period.min=N;var D=c.getCachedDurationOffset("offset");t.adaptation.period.duration=parseFloat((D+t.adaptation.period.min).toFixed(5)),n("Set real min period duration "+t.adaptation.period.duration+" ( "+D+" )")}catch(e){n("Set real period error "+r)}l(f,t,r)}}else I(),i.mediaSourceError("Error parsing "+r+" response.",a.MEDIA_DECODE_ERROR)},error:I}),n("Perform SIDX load: "+v.url)},resetPreloadData:function(){f&&f.setPreloadData(c.getPreloadData())},reset:function(){f.abort(),f=null,i=null,s=null,u=null}},e}kt.__dashjs_factory_name="SegmentBaseLoader";var Ht=s.a.getSingletonFactory(kt);function Vt(e){e=e||{};var t=this.context,n=d(t).getInstance(),i=it(t).getInstance(),a=void 0,o=e.timelineConverter,s=e.dashMetrics,u=e.metricsModel,l=e.mediaPlayerModel,c=e.errHandler,f=e.baseURLController,p=void 0,h=void 0,m=void 0,_=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0;function S(){m=-1,y=0,v=NaN,_=null,A=null,I=null}function D(e,t,n){var r=f.resolve(n.path),a=void 0,o=void 0,s=void 0;return r&&t!==r.url&&i.isRelative(t)?(a=r.url,o=r.urls||[],s=r.serviceLocation,t&&(a=i.resolve(t,a))):o=[a=t],!i.isRelative(a)&&(e.url=a,e.urls=o,e.serviceLocation=s,!0)}function O(e){var t=!1,n=A?A.getStreamInfo().manifestInfo.isDynamic:null;if(n||m!==e.availableSegmentsNumber){var r=ct(m,e);if(r){var i=parseFloat((r.presentationStartTime-e.adaptation.period.start).toFixed(5)),a=l.getCachedDurationOffset("duration"),o=a?Math.min(e.adaptation.period.duration,a):e.adaptation.period.duration;o=e.adaptation.period.duration,h(e.segmentInfoType+": "+i+" / "+o),t=(e.segmentInfoType!==$e.SEGMENT_TIMELINE||!n)&&i>=o}else h("isMediaFinished - no segment found")}else t=!0;return t}function C(e){I.getSegments(e,_,m,M)}function M(e,t){var n=A?A.getStreamInfo().manifestInfo.isDynamic:null;if(e.segments=t,t&&t.length>0&&(v=isNaN(v)?t[0].presentationStartTime:Math.min(t[0].presentationStartTime,v),n&&isNaN(o.getExpectedLiveEdge()))){var i=t[t.length-1].presentationStartTime,a=u.getMetricsFor(r.STREAM);o.setExpectedLiveEdge(i),u.updateManifestUpdateInfo(s.getCurrentManifestUpdate(a),{presentationStartTime:i})}}function P(e){if(!e)throw new Error("no representation");e.segments=null,C(e)}function L(e,t,n){var r=t.segments,i=r?r.length:null,a=-1,o=void 0,s=void 0,u=void 0,d=void 0,c=void 0;if(r&&i>0){for(n=null==n?l.getSegmentOverlapToleranceTime():n,c=0;c<i;c++)if(u=(s=r[c]).presentationStartTime,d=s.duration,e+(o=null==n?d/2:n)>=u&&e-o<u+d){a=s.availabilityIdx;break}0===e&&r[0].presentationStartTime>0&&(a=0)}return a}function b(e){if(null==e)return null;var t=new E,n=e.representation,r=n.adaptation.period.mpd.manifest.Period_asArray[n.adaptation.period.index].AdaptationSet_asArray[n.adaptation.index].Representation_asArray[n.index].bandwidth,i=e.media,a=A?A.getType():null;return i=ut(i,"Number",e.replacementNumber),i=ut(i,"Time",e.replacementTime),i=function(e){return e?e.split("$$").join("$"):e}(i=function(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var n=t.toString();return e.split("$RepresentationID$").join(n)}(i=ut(i,"Bandwidth",r),n.id)),t.mediaType=a,t.type=k.MEDIA_SEGMENT_TYPE,t.range=e.mediaRange,t.startTime=e.presentationStartTime,t.duration=e.duration,t.timescale=n.timescale,t.availabilityStartTime=e.availabilityStartTime,t.availabilityEndTime=e.availabilityEndTime,t.wallStartTime=e.wallStartTime,t.quality=n.index,t.index=e.availabilityIdx,t.mediaInfo=A.getMediaInfo(),t.adaptationIndex=n.adaptation.index,t.representationId=n.id,D(t,i,n)?t:void 0}function w(e,t,n){var r=void 0,i=A?A.getType():null,a=A?A.getStreamInfo().manifestInfo.isDynamic:null,o=m,s=!!n&&n.keepIdx,u=n?n.timeThreshold:null,l=!(!n||!n.ignoreIsFinished);return e?(_!==t&&(_=t,h("Getting the request for "+i+" time : "+t)),C(e),(m=L(t,e,u))<0&&(C(e),m=L(t,e,u)),
m>0&&h("Index for "+i+" time "+t+" is "+m),!l&&O(e)?((r=new E).action=E.ACTION_COMPLETE,r.index=m,r.mediaType=i,r.mediaInfo=A.getMediaInfo(),h("Signal complete in getSegmentRequestForTime -",i)):r=b(ct(m,e)),s&&o>=0&&(m=e.segmentInfoType===$e.SEGMENT_TIMELINE&&a?m:o),r):null}function F(e){var t=e.representation;t.segments&&n.trigger(g.REPRESENTATION_UPDATED,{sender:this,representation:t})}function x(e){var t=A?A.getType():null,r=A?A.getStreamInfo().manifestInfo.isDynamic:null;if(!e.error&&t===e.mediaType){var i,a=e.segments,s=e.representation,u=[],d=0,c=void 0,f=void 0,p=void 0,h=0;for(l.getAppendingSourceState()&&(R=l.getCachedDurationOffset("offset"),h=a[0].startTime,m=0),c=0,i=a.length;c<i;c++)f=a[c],p=dt(o,r,s,f.startTime+R*f.timescale-h,f.duration,f.timescale,f.media,f.mediaRange,d),u.push(p),p=null,d++;s.segmentAvailabilityRange={start:u[0].presentationStartTime,end:u[i-1].presentationStartTime},s.availableSegmentsNumber=i,M(s,u),et.hasInitialization(s)&&n.trigger(g.REPRESENTATION_UPDATED,{sender:this,representation:s})}}return p={initialize:function(n){var r=(A=n)?A.getStreamInfo().manifestInfo.isDynamic:null;a.initialize(),I=yt(t).create(e,r)},getStreamProcessor:function(){return A},getInitRequest:function(e){var t=A?A.getType():null;if(!e)return null;var n=function(e,t){var n=new E,r=e.adaptation.period,i=r.start,a=A?A.getStreamInfo().manifestInfo.isDynamic:null;if(n.mediaType=t,n.type=k.INIT_SEGMENT_TYPE,n.range=e.range,n.availabilityStartTime=o.calcAvailabilityStartTimeFromPresentationTime(i,r.mpd,a),n.availabilityEndTime=o.calcAvailabilityEndTimeFromPresentationTime(i+r.duration,r.mpd,a),n.quality=e.index,n.mediaInfo=A?A.getMediaInfo():null,n.representationId=e.id,D(n,e.initialization,e))return n}(e,t);return n},getSegmentRequestForTime:w,getNextSegmentRequest:function(e){var t=void 0,n=void 0,r=A?A.getType():null,i=A?A.getStreamInfo().manifestInfo.isDynamic:null;return e&&-1!==m?(_=null,m++,h("Getting the next request at index: "+m+", type: "+r),!ct(m,e)&&i?(h("No segment found at index: "+m+". Wait for next loop"),C(e),m--,null):(O(e)?((t=new E).action=E.ACTION_COMPLETE,t.index=m,t.mediaType=r,t.mediaInfo=A.getMediaInfo(),h("Signal complete -",r)):(C(e),t=b(n=ct(m,e)),!n&&i&&m--),t)):null},generateSegmentRequestForTime:function(e,t){var n=(e.segmentAvailabilityRange.end-e.segmentAvailabilityRange.start)/2;return e.segments=null,e.segmentAvailabilityRange={start:t-n,end:t+n},w(e,t,{keepIdx:!1,ignoreIsFinished:!0})},updateRepresentation:function(e,t){var r=et.hasInitialization(e),i=et.hasSegments(e),s=A?A.getType():null,u=A?A.getStreamInfo().manifestInfo.isDynamic:null,l=void 0;if(e.segmentDuration||e.segments||P(e),e.segmentAvailabilityRange=o.calcSegmentAvailabilityRange(e,u),e.segmentAvailabilityRange.end<e.segmentAvailabilityRange.start&&!e.useCalculatedLiveEdgeTime)return l=new N(1,"no segments are available yet",{availabilityDelay:e.segmentAvailabilityRange.start-e.segmentAvailabilityRange.end}),void n.trigger(g.REPRESENTATION_UPDATED,{sender:this,representation:e,error:l});t||(m=-1),e.segmentDuration&&P(e),r||a.loadInitialization(e),i||a.loadSegments(e,s,e.indexRange),r&&i&&n.trigger(g.REPRESENTATION_UPDATED,{sender:this,representation:e})},updateSegmentList:P,setCurrentTime:function(e){l.getCachedDurationOffset("duration")&&(e=Math.min(l.getCachedDurationOffset("duration"),e)),y=e},getCurrentTime:function(){return y},getEarliestTime:function(){return v},resetPreloadData:function(){a&&a.resetPreloadData()},reset:function(){S(),n.off(g.INITIALIZATION_LOADED,F,p),n.off(g.SEGMENTS_LOADED,x,p)}},h=T(t).getInstance().log.bind(p),S(),(a=Ht(t).getInstance()).setConfig({baseURLController:f,metricsModel:u,mediaPlayerModel:l,videoModel:e.videoModel,errHandler:c}),R=0,n.on(g.INITIALIZATION_LOADED,F,p),n.on(g.SEGMENTS_LOADED,x,p),p}Vt.__dashjs_factory_name="DashHandler";var Yt=s.a.getClassFactory(Vt);Yt.SEGMENTS_UNAVAILABLE_ERROR_CODE=1,s.a.updateClassFactory(Vt.__dashjs_factory_name,Yt);var qt=Yt;function Qt(e){e=e||{}
;var t=this.context,n=void 0,i=e.type,a=e.errHandler,o=e.mimeType,s=e.timelineConverter,u=e.adapter,l=e.manifestModel,d=e.mediaPlayerModel,c=e.stream,f=e.abrController,p=e.playbackController,h=e.streamController,g=e.mediaController,m=e.domStorage,E=e.metricsModel,_=e.dashMetrics,T=e.dashManifestModel,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,S=void 0,N=void 0,D=void 0,O=void 0;function C(){O=[]}function M(){A=[],v=null,C()}function P(){return c?c.getStreamInfo():null}function L(){return v}return y={initialize:function(v){(n=qt(t).create({mimeType:o,timelineConverter:s,dashMetrics:_,metricsModel:E,mediaPlayerModel:d,baseURLController:e.baseURLController,videoModel:e.videoModel,errHandler:a})).initialize(y),f.registerStreamType(i,y),(D=c.getFragmentController().getModel(i)).setStreamProcessor(y),I=function(e){var n=null;e!==r.VIDEO&&e!==r.AUDIO||(n=xe(t).create({type:e,metricsModel:E,mediaPlayerModel:d,manifestModel:l,errHandler:a,streamController:h,mediaController:g,adapter:u,abrController:f,playbackController:p,streamProcessor:y}));return n}(i),R=Je(t).create({type:i,metricsModel:E,adapter:u,dashMetrics:_,dashManifestModel:T,timelineConverter:s,mediaPlayerModel:d,abrController:f,playbackController:p,streamController:h,streamProcessor:y,mediaController:g}),(N=nt(t).create()).setConfig({abrController:f,domStorage:m,metricsModel:E,dashMetrics:_,dashManifestModel:T,manifestModel:l,playbackController:p,timelineConverter:s,streamProcessor:y}),I.initialize(v),R.initialize(),N.initialize()},isUpdating:function(){return!!N&&N.isUpdating()},getType:function(){return i},getBufferController:function(){return I},getFragmentModel:function(){return D},getScheduleController:function(){return R},getLiveEdgeFinder:function(){return S},getEventController:function(){return c?c.getEventController():null},getFragmentController:function(){return c?c.getFragmentController():null},getRepresentationController:function(){return N},getIndexHandler:function(){return n},getCurrentRepresentationInfo:function(){return u.getCurrentRepresentationInfo(N)},getRepresentationInfoForQuality:function(e){return u.getRepresentationInfoForQuality(N,e)},getBufferLevel:function(){return I.getBufferLevel()},switchInitData:function(e,t){I&&I.switchInitData(P().id,e,t)},isBufferingCompleted:function(){return!!I&&I.getIsBufferingCompleted()},createBuffer:function(){return I.getBuffer()||I.createBuffer(v)},getStreamInfo:P,updateMediaInfo:function(e){e===v||e&&v&&e.type!==v.type||(v=e),-1===A.indexOf(e)&&A.push(e),u.updateData(this)},switchTrackAsked:function(){R.switchTrackAsked()},getMediaInfoArr:function(){return A},getMediaInfo:L,getMediaSource:function(){return I.getMediaSource()},setMediaSource:function(e){I.setMediaSource(e,L())},dischargePreBuffer:function(){I.dischargePreBuffer()},getBuffer:function(){return I.getBuffer()},setBuffer:function(e){I.setBuffer(e)},registerExternalController:function(e){O.push(e)},unregisterExternalController:function(e){var t=O.indexOf(e);-1!==t&&O.splice(t,1)},getExternalControllers:function(){return O},unregisterAllExternalController:C,getPlaybackController:function(){return p},resetPreloadData:function(){D.resetPreloadData(),n.resetPreloadData()},reset:function(e){n.reset(),I&&(I.reset(e),I=null),R&&(R.reset(),R=null),N&&(N.reset(),N=null),f&&f.unRegisterStreamType(i),O.forEach((function(e){e.reset()})),M(),i=null,c=null,S&&(S.reset(),S=null)}},p&&p.getIsDynamic()&&(S=Ye(t).create({timelineConverter:s,streamProcessor:y})),M(),y}Qt.__dashjs_factory_name="StreamProcessor";var Wt=s.a.getClassFactory(Qt);function Kt(){var e,t="urn:mpeg:dash:event:2012",n=this.context,r=T(n).getInstance().log,i=d(n).getInstance(),a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,p=void 0,h=void 0,m=void 0;function E(){m=!1,a={},o={},s={},u=null,c=(l=100)/1e3}function _(){if(!f||!p||!h)throw new Error("setConfig function has to be called previously")}function y(){null!==u&&m&&(clearInterval(u),u=null,m=!1)}function v(e){if(1==e.eventStream.value){var t=e.eventStream.timescale||1,n=e.presentationTime/t,a=void 0
;a=4294967295==e.presentationTime?NaN:(e.presentationTime+e.duration)/t,r("Manifest validity changed: Valid until: "+n+"; remaining duration: "+a),i.trigger(g.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:n,newDuration:a,newManifestValidAfter:NaN})}}function A(){I(o),I(a),function(){if(s)for(var e=h.getTime(),t=Object.keys(s),n=0;n<t.length;n++){var i=t[n],a=s[i];null!==a&&(a.duration+a.presentationTime)/a.eventStream.timescale<e&&(r("Remove Event "+i+" at time "+e),a=null,delete s[i])}}()}function I(e){var n,a=h.getTime();if(e)for(var o=Object.keys(e),u=0;u<o.length;u++){var l=o[u],d=e[l];void 0!==d&&(0===(n=d.presentationTime/d.eventStream.timescale)||n<=a&&n+c>a)&&(r("Start Event "+l+" at "+a),d.duration>0&&(s[l]=d),d.eventStream.schemeIdUri==t&&1==d.eventStream.value?0===d.duration&&0===d.presentationTimeDelta||(_(),p.refreshManifest()):i.trigger(d.eventStream.schemeIdUri,{event:d}),delete e[l])}}return e={addInlineEvents:function(e){if(_(),a={},e)for(var t=0;t<e.length;t++){var n=e[t];a[n.id]=n,r("Add inline event with id "+n.id)}r("Added "+e.length+" inline events")},addInbandEvents:function(e){_();for(var n=0;n<e.length;n++){var i=e[n];i.id in o?r("Repeated event with id "+i.id):(i.eventStream.schemeIdUri===t&&void 0===o[i.id]&&v(i),o[i.id]=i,r("Add inband event with id "+i.id))}},stop:y,start:function(){_(),r("Start Event Controller"),m||isNaN(l)||(m=!0,u=setInterval(A,l))},setConfig:function(e){e&&(e.manifestModel&&(f=e.manifestModel),e.manifestUpdater&&(p=e.manifestUpdater),e.playbackController&&(h=e.playbackController))},reset:function(){y(),E()}},E(),e}Kt.__dashjs_factory_name="EventController";var jt=s.a.getClassFactory(Kt);var zt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null};var Xt=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return r.url=n||null,r.checkForExistenceOnly=!0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(E);function Zt(){return{verify:function(e){if(!e)return{verified:!1};var t=Ae.a.parseBuffer(e),n=t.fetchAll("moof"),r=t.fetchAll("mdat"),i=t.fetchAll("trun"),a=e.byteLength,o="",s=n.length>0&&n.length===r.length&&n.length===i.length,u=!0,l=0,d=!0;if(s){for(var c=0,f=n.length;c<f;c++){var p=n[c],h=r[c];l+=p.size+h.size,h.size!==h._raw.byteLength&&(d=!1,o+="The index "+c+" mdat box size error, decoded: "+h.size+", actually: "+h._raw.byteLength+". ")}a!==l&&(u=!1,d&&(o="Size error, decoded: "+l+", actually: "+a))}else o="Missing moof box and mdat box.";return{size:a,moofBoxesCount:n.length,isSizeCorrect:u,areAllBoxesInPairs:s,areAllMdatBoxesSizeCorrect:d,verified:u&&s&&d,msg:o}}}}Zt.__dashjs_factory_name="VerifySegment";var Jt=s.a.getSingletonFactory(Zt),$t="request timeout";function en(e){e=e||{};var t=this.context,n=d(t).getInstance(),r=Jt(t).getInstance(),i=T(t).getInstance().log,o=void 0,s=void 0,u=void 0;return o={checkForExistence:function(e){var t=function(t){n.trigger(g.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var r=new Xt(e.url);s.load({request:r,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function t(u,l){l?l.hasOwnProperty("canUseNC")||(l.canUseNC=!0):l={canUseNC:!0};var d=function(t,r){if(!r&&(n.trigger(g.LOADING_COMPLETED,{request:u,response:t||null,error:r||null,sender:o}),u.preloadEnd)){e.mediaPlayerModel.setPreloadData(null)
;var i=e.abrController.getDefaultQualityFor(u.mediaType,!1);e.abrController.setPlaybackQuality(u.mediaType,e.streamController.getActiveStreamInfo(),i)}};u?(void 0===u.retry&&(u.retry=1),s.load({request:u,progress:function(e){e&&n.trigger(g.LOADING_DATA_PROGRESS,{request:u,response:e||null,error:null,sender:o})},success:function(e){try{var o=void 0;if(u.range){var s=u.range&&u.range.split("-");o=s[1]-s[0]+1}var l={mediaType:u.mediaType,id:u.representationId,index:u.index,range:u.range,received:e&&e.byteLength||0,url:u.url,startTime:u.startTime,duration:u.duration,p2pLoadInfo:u.p2pLoadInfo};e&&e.byteLength>3e7&&(l.code=a.DOWNLOAD_FRAGMENT_ERROR_RANGE,n.trigger(g.FRAGMENT_LOADED_ERROR,l));var c=function(e,t){try{if(e&&t){if(isNaN(e.index)||"MediaSegment"!==e.type)return{verified:!0};var a=r.verify(t);return a.mediaType=e.mediaType,a.quality=e.quality,a.index=e.index,a.id=e.representationId,a&&!a.verified&&(i("VERIFY_SEGMENT_WARNING: "+JSON.stringify(a)),n.trigger(g.VERIFY_SEGMENT_WARNING,a)),a}}catch(e){throw new Error(e)}}(u,e);e&&(e.byteLength===o||!o)&&c&&c.verified?(1===u.retry||(l.code=a.DOWNLOAD_FRAGMENT_ERROR_RETRY_SUCCESS,n.trigger(g.FRAGMENT_LOADED_ERROR,l)),d(e)):(l&&l.hasOwnProperty("type")&&delete l.type,c.verified||(e.byteLength===o?l.verifiedType=1:l.verifiedType=2),u.retry&&u.retry>0?(l.code=a.DOWNLOAD_FRAGMENT_ERROR,n.trigger(g.FRAGMENT_LOADED_ERROR,l),u.retry--,t(u,{canUseNC:!1})):(l.code=a.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE,n.trigger(g.FRAGMENT_LOADED_ERROR,l)))}catch(e){console.error("FragmentLoader Load Error: ",e)}},timeout:function(e,t,r){var i={mediaType:e.mediaType,id:e.representationId,index:e.index,range:e.range,received:e.bytesLoaded,url:e.url,startTime:e.startTime,duration:e.duration,total:e.bytesTotal,latency:t,timeout:r,p2pLoadInfo:e.p2pLoadInfo};i.code=a.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT,n.trigger(g.FRAGMENT_LOADED_ERROR,i),d(void 0,new N(1,$t))},error:function(e,t,n){d(void 0,new N(1,n,t))},abort:function(e){e&&n.trigger(g.LOADING_ABANDONED,{request:e,mediaType:e.mediaType,sender:o})},connectTimeout:function(e,t,r){if(e){var i={mediaType:e.mediaType,id:e.representationId,index:e.index,range:e.range,received:e.bytesLoaded||0,url:e.url,startTime:e.startTime,duration:e.duration,total:e.bytesTotal,timeout:t,p2pLoadInfo:e.p2pLoadInfo};i.code=a.CONNECT_FRAGMENT_ERROR_TIMEOUT,r&&(i.code=a.CONNECT_NC_FRAGMENT_ERROR_TIMEOUT),n.trigger(g.FRAGMENT_LOADED_ERROR,i),d(void 0,new N(1,$t))}},headersReceived:function(e){n.trigger(g.FRAGMENT_LOADING_HEADER_RECEIVED,{request:u,headers:e})},params:l})):d(void 0,new N(2,"request is null"))},abort:function(){s&&s.abort()},reset:function(){s&&(s.abort(),s=null)},resetPreloadData:function(){u=e.mediaPlayerModel.getPreloadData(),s.setPreloadData(u)}},u=e.mediaPlayerModel.getPreloadData(),s=Gt(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.mediaPlayerModel.getLowLatencyEnabled(),dashMetrics:e.dashMetrics,preloadData:u}),o}en.__dashjs_factory_name="FragmentLoader";var tn=s.a.getClassFactory(en);tn.FRAGMENT_LOADER_ERROR_LOADING_FAILURE=1,tn.FRAGMENT_LOADER_ERROR_NULL_REQUEST=2,s.a.updateClassFactory(en.__dashjs_factory_name,tn);var nn=tn;function rn(e){e=e||{};var t=this.context,n=T(t).getInstance().log,i=d(t).getInstance(),a=e.errHandler,o=e.mediaPlayerModel,s=e.metricsModel,u=e.abrController,l=e.streamController,c=e.videoModel,f=void 0,p=void 0;function h(e){return e&&e.type&&e.type===k.INIT_SEGMENT_TYPE}function m(){for(var e in p)p[e].reset();p={}}function E(e){if(p[e.request.mediaType]===e.sender){var t=e.request,a=e.response,o=h(t),s=t.mediaInfo.streamInfo;if(e.error&&(e.request.mediaType!==r.AUDIO&&e.request.mediaType!==r.VIDEO&&e.request.mediaType!==r.FRAGMENTED_TEXT||i.trigger(g.SERVICE_LOCATION_BLACKLIST_ADD,{entry:e.request.serviceLocation})),a&&s){var u=function(e,t,n,r){var i=new zt;return i.streamId=n,i.mediaInfo=t.mediaInfo,i.segmentType=t.type,i.start=t.startTime,i.duration=t.duration,i.end=i.start+i.duration,i.bytes=e,
i.index=t.index,i.quality=t.quality,i.representationId=t.representationId,i.endFragment=r,i}(a,t,s.id,e.type!==g.FRAGMENT_LOADING_PROGRESS);i.trigger(o?g.INIT_FRAGMENT_LOADED:g.MEDIA_FRAGMENT_LOADED,{chunk:u,fragmentModel:e.sender})}else n("No "+t.mediaType+" bytes to push or stream is inactive.")}}return f={getModel:function(n){var r=p[n];return r||(r=S(t).create({metricsModel:s,fragmentLoader:nn(t).create({metricsModel:s,videoModel:c,mediaPlayerModel:o,errHandler:a,requestModifier:At(t).getInstance(),dashMetrics:e.dashMetrics,abrController:u,streamController:l})}),p[n]=r),r},isInitializationRequest:h,reset:function(){i.off(g.FRAGMENT_LOADING_COMPLETED,E,this),m()}},m(),i.on(g.FRAGMENT_LOADING_COMPLETED,E,f),f}rn.__dashjs_factory_name="FragmentController";var an=s.a.getClassFactory(rn);function on(e){e=e||{};var t=this.context,n=T(t).getInstance().log,i=d(t).getInstance(),a=e.manifestModel,o=e.dashManifestModel,s=e.mediaPlayerModel,u=e.manifestUpdater,l=e.adapter,c=e.capabilities,f=e.errHandler,p=e.timelineConverter,h=e.metricsModel,m=e.abrController,E=e.playbackController,_=e.mediaController,y=e.videoModel,v=e.streamController,A=void 0,I=void 0,R=void 0,S=void 0,N=void 0,D=void 0,O=void 0,C=void 0,M=void 0,P=void 0;function L(){for(var e=I?I.length:0,t=0;t<e;t++){I[t].getFragmentModel().removeExecutedRequestsBeforeTime(x()+F()),I[t].reset()}I=[],R=!1,S=!1,i.off(g.CURRENT_TRACK_CHANGED,H,A)}function b(){L(),N=null,D={},O=!1}function w(){E&&E.pause(),C&&(C.reset(),C=null),b(),n=null,i.off(g.DATA_UPDATE_COMPLETED,K,A),i.off(g.BUFFERING_COMPLETED,W,A),i.off(g.KEY_ERROR,B,A),i.off(g.SERVER_CERTIFICATE_UPDATED,B,A),i.off(g.LICENSE_REQUEST_COMPLETE,B,A),i.off(g.KEY_SYSTEM_SELECTED,B,A),i.off(g.KEY_SESSION_CREATED,B,A),i.off(g.KEY_STATUSES_CHANGED,B,A)}function F(){return N?N.duration:NaN}function x(){return N?N.start:NaN}function U(){if(!(m&&m.hasOwnProperty("getBitrateList")&&l&&l.hasOwnProperty("getAllMediaInfoForType")&&l.hasOwnProperty("getEventsFor")))throw new Error("Missing config parameter(s)")}function B(e){e.error&&(f.mediaKeySessionError(e.error),n(e.error),w())}function G(e){return e.type===r.TEXT?e.mimeType:e.type}function k(e){var t,i=e.type,o=void 0;if(i===r.MUXED&&e)return n(o="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines"),f.manifestError(o,"multiplexedrep",a.getValue()),!1;if(i===r.TEXT||i===r.FRAGMENTED_TEXT||i===r.EMBEDDED_TEXT||i===r.IMAGE)return!0;if(t=e.codec,n(i+" codec: "+t),e.contentProtection&&!c.supportsEncryptedMedia())f.capabilityError("encryptedmedia");else if(!c.supportsCodec(t))return n(o=i+"Codec ("+t+") is not supported."),!1;return!0}function H(e){if(e.newMediaInfo.streamInfo.id===N.id){var t=j(e.oldMediaInfo);if(t){var i=E.getTime();n("Stream -  Process track changed at current time "+i);var o=e.newMediaInfo,s=a.getValue();n("Stream -  Update stream controller"),s.refreshManifestOnSwitchTrack?(n("Stream -  Refreshing manifest for switch track"),P=e,u.refreshManifest()):(t.updateMediaInfo(o),o.type!==r.FRAGMENTED_TEXT&&(m.updateTopQualityIndex(o),t.switchTrackAsked(),t.getFragmentModel().abortRequests()))}}}function V(i,u){var d=l.getAllMediaInfoForType(N,i),c=null;if(d&&0!==d.length){for(var g=0,T=d.length;g<T;g++)if(c=d[g],i===r.EMBEDDED_TEXT);else{if(!k(c))continue;_.addTrack(c)}i!==r.EMBEDDED_TEXT&&0!==_.getTracksFor(i,N).length&&(_.checkInitialMediaSettingsForType(i,N),function(n,i,u,d){var c=Wt(t).create({type:G(n),mimeType:n.mimeType,timelineConverter:p,adapter:l,manifestModel:a,dashManifestModel:o,mediaPlayerModel:s,metricsModel:h,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,stream:A,abrController:m,domStorage:e.domStorage,playbackController:E,mediaController:_,streamController:v,videoModel:y,errHandler:f});c.initialize(u),m.updateTopQualityIndex(n),d?(c.setBuffer(d.buffer),c.getIndexHandler().setCurrentTime(d.currentTime),I[d.replaceIdx]=c):I.push(c),d&&d.ignoreMediaInfo||n.type===r.TEXT||n.type===r.FRAGMENTED_TEXT||c.updateMediaInfo(n)}(_.getCurrentTrackFor(i,N),0,u))
}else n("No "+i+" data.")}function Y(e){var t=o.getAdaptationForType(a.getValue(),N.index,e,N);if(!t||!Array.isArray(t.Representation_asArray))return null;t.Representation_asArray=t.Representation_asArray.filter((function(e,r){if(0===r)return!0;var i=o.getCodec(t,r,!0);return!!c.supportsCodec(i)||(n("[Stream] codec not supported: "+i),!1)}))}function q(){for(var e=I.length,t=!!D.audio||!!D.video?new Error(1,"Data update failed",null):null,n=0;n<e;n++)if(I[n].isUpdating()||O)return;S&&i.trigger(g.STREAM_INITIALIZED,{streamInfo:N,error:t})}function Q(){for(var e=0,t=I.length;e<t;e++)I[e].createBuffer()}function W(e){if(e.streamInfo===N){var t=z(),a=t.length;if(0!==a){for(var o=0;o<a;o++)if(!t[o].isBufferingCompleted()&&(t[o].getType()===r.AUDIO||t[o].getType()===r.VIDEO))return void n("[Stream] onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because streamProcessor "+t[o].getType()+" is not buffering completed");n("[Stream] onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),i.trigger(g.STREAM_BUFFERING_COMPLETED,{streamInfo:N})}else n("[Stream] onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}}function K(e){var t=e.sender.getStreamProcessor();t.getStreamInfo()===N&&(D[t.getType()]=e.error,q())}function j(e){return!!e&&z().filter((function(t){return t.getType()===e.type}))[0]}function z(){for(var e=I.length,t=[],n=void 0,i=void 0,a=0;a<e;a++)(n=(i=I[a]).getType())!==r.AUDIO&&n!==r.VIDEO&&n!==r.FRAGMENTED_TEXT||t.push(i);return t}return A={initialize:function(e){N=e},activate:function(e){R||(i.on(g.CURRENT_TRACK_CHANGED,H,A),function(e){U();var i=void 0,o=y.getElement();M||((M=jt(t).create()).setConfig({manifestModel:a,manifestUpdater:u,playbackController:E}),i=l.getEventsFor(N),M.addInlineEvents(i));O=!0,Y(r.VIDEO),Y(r.AUDIO),(null===o||o&&("VIDEO"===o.nodeName||"BWP-VIDEO"===o.nodeName))&&V(r.VIDEO,e);V(r.AUDIO,e),"open"!==e.readyState?(e.addEventListener("sourceopen",Q,!1),e.addEventListener("webkitsourceopen",Q,!1)):Q();if(S=!0,O=!1,0===I.length){var s="No streams to play.";f.manifestError(s,"nostreams",a.getValue()),n(s)}else q()}(e),R=!0)},deactivate:L,getDuration:F,getStartTime:x,getId:function(){return N?N.id:NaN},getStreamInfo:function(){return N},getFragmentController:function(){return C},getEventController:function(){return M},getBitrateListFor:function(e){U();var t=function(e){for(var t=I.length,n=null,r=0;r<t;r++)if((n=I[r]).getType()===e)return n.getMediaInfo();return null}(e);return m.getBitrateList(t)},startEventController:function(){M&&M.start()},stopEventController:function(){M&&M.stop()},updateData:function(e){if(n("Manifest updated... updating data system wide."),R=!1,O=!0,N=e,M){var t=l.getEventsFor(N);M.addInlineEvents(t)}Y(r.VIDEO),Y(r.AUDIO);for(var i=0,a=I.length;i<a;i++){var o=I[i],s=l.getMediaInfoForType(N,o.getType());m.updateTopQualityIndex(s),o.updateMediaInfo(s)}if(P&&"fragmentedText"!==P.newMediaInfo.type){var u=j(P.oldMediaInfo);if(!u)return;u.switchTrackAsked(),P=void 0}O=!1,q()},reset:w,getProcessors:z,setMediaSource:function(e){for(var t=0;t<I.length;)k(I[t].getMediaInfo())?(I[t].setMediaSource(e),t++):(I[t].reset(),I.splice(t,1));for(var r=0;r<I.length;r++)I[r].dischargePreBuffer();if(0===I.length){var i="No streams to play.";f.manifestError(i,"nostreams",a.getValue()),n(i)}}},b(),C=an(t).create({mediaPlayerModel:s,videoModel:y,metricsModel:h,errHandler:f,dashMetrics:e.dashMetrics,abrController:m,streamController:v}),i.on(g.BUFFERING_COMPLETED,W,A),i.on(g.DATA_UPDATE_COMPLETED,K,A),A}on.__dashjs_factory_name="Stream";var sn=s.a.getClassFactory(on);function un(){var e=this.context,t=T(e).getInstance().log,n=d(e).getInstance(),r=void 0,i=void 0,a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0;function p(){r=NaN,o=!1,a=!0,h()}function h(){null!==i&&(clearInterval(i),i=null)}function m(e){h(),isNaN(e)&&!isNaN(r)&&(e=1e3*r),isNaN(e)||(t("Refresh manifest in "+e+" milliseconds."),i=setTimeout(y,e))}function E(){o=!0;var e=u.getValue(),t=e.url,n=l.getLocation(e);n&&(t=n),s.load(t)}function _(e){
if(c.getAppendingSourceState()){var i=c.getCachedDurationOffset("offset");e.mediaPresentationDuration+=i,e.Period.duration+=i,e.Period_asArray.duration+=i}u.setValue(e);var o=new Date,s=(o.getTime()-e.loadedTime.getTime())/1e3;1e3*(r=l.getManifestUpdatePeriod(e,s))>2147483647&&(r=2147483.647),n.trigger(g.MANIFEST_UPDATED,{manifest:e}),t("Manifest has been refreshed at "+o+"["+o.getTime()/1e3+"] "),a||m()}function y(){a&&!c.getScheduleWhilePaused()||(o?m(c.getManifestUpdateRetryInterval()):E())}function v(e){e.error?f.manifestError(e.error.message,e.error.code,"","",e.error.errorCode,e.error.httpCode):_(e.manifest)}function A(){a=!1,m()}function I(){a=!0,h()}function R(){o=!1}return{initialize:function(){p(),n.on(g.STREAMS_COMPOSED,R,this),n.on(g.PLAYBACK_STARTED,A,this),n.on(g.PLAYBACK_PAUSED,I,this),n.on(g.INTERNAL_MANIFEST_LOADED,v,this)},setManifest:function(e){_(e)},refreshManifest:E,setConfig:function(e){e&&(e.manifestModel&&(u=e.manifestModel),e.dashManifestModel&&(l=e.dashManifestModel),e.mediaPlayerModel&&(c=e.mediaPlayerModel),e.manifestLoader&&(s=e.manifestLoader),e.errHandler&&(f=e.errHandler))},reset:function(){n.off(g.PLAYBACK_STARTED,A,this),n.off(g.PLAYBACK_PAUSED,I,this),n.off(g.STREAMS_COMPOSED,R,this),n.off(g.INTERNAL_MANIFEST_LOADED,v,this),p()}}}un.__dashjs_factory_name="ManifestUpdater";var ln=s.a.getClassFactory(un);function dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var cn=1e3;function fn(){var e,t,n,i=void 0,a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,d=void 0,c=void 0,f=void 0,p=void 0,h=void 0,g=void 0,m=void 0,E=void 0,_=void 0,T=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,S=void 0,N=void 0,D=void 0,O=void 0,C=void 0,M=void 0,P=void 0,L=void 0,b=void 0,w=void 0,F=void 0,x=void 0,U=void 0,B=void 0,G=void 0,H=void 0,V=void 0,Y=void 0;function q(e){var t=void 0;for(t=0;t<C.length;t++)if(C[t].rulename===e)return t;return-1}function Q(e){H=e}return e={setABRStrategy:function(e){S=e},getABRStrategy:function(){return S},setUseDefaultABRRules:function(e){N=e},getUseDefaultABRRules:function(){return N},getABRCustomRules:function(){return C},addABRCustomRule:function(e,t,n){var r=q(t);-1===r?C.push({type:e,rulename:t,rule:n}):(C[r].type=e,C[r].rule=n)},removeABRCustomRule:function(e){var t=q(e);-1!==t&&C.splice(t,1)},removeAllABRCustomRule:function(){C=[]},setBandwidthSafetyFactor:function(e){y=e},getBandwidthSafetyFactor:function(){return y},setAbandonLoadTimeout:function(e){v=e},getAbandonLoadTimeout:function(){return v},setLastBitrateCachingInfo:function(e,t){p.enabled=e,void 0===t||isNaN(t)||"number"!=typeof t||(p.ttl=t)},getLastBitrateCachingInfo:function(){return p},setLastMediaSettingsCachingInfo:function(e,t){h.enabled=e,void 0===t||isNaN(t)||"number"!=typeof t||(h.ttl=t)},getLastMediaSettingsCachingInfo:function(){return h},setStableBufferTime:function(e){g=e},getStableBufferTime:function(){return isNaN(g)?O?20:12:g},setBufferTimeAtTopQuality:function(e){m=e},getBufferTimeAtTopQuality:function(){return m},setBufferTimeAtTopQualityLongForm:function(e){E=e},getBufferTimeAtTopQualityLongForm:function(){return E},setLongFormContentDurationThreshold:function(e){_=e},getLongFormContentDurationThreshold:function(){return _},setSegmentOverlapToleranceTime:function(e){T=e},getSegmentOverlapToleranceTime:function(){return T},getCacheLoadThresholdForType:function(e){return P[e]},setCacheLoadThresholdForType:function(e,t){P[e]=t},setBufferToKeep:function(e){d=e},getBufferToKeep:function(){return d},setBufferAheadToKeep:function(e){c=e},getBufferAheadToKeep:function(){return c},setBufferPruningInterval:function(e){f=e},getBufferPruningInterval:function(){return f},setFragmentRetryAttempts:function(e){A[k.MEDIA_SEGMENT_TYPE]=e},getFragmentRetryAttempts:function(){return A[k.MEDIA_SEGMENT_TYPE]},setManifestRetryAttempts:function(e){A[k.MPD_TYPE]=e},getManifestRetryAttempts:function(){return A[k.MPD_TYPE]},setRetryAttemptsForType:function(e,t){A[e]=t},getRetryAttemptsForType:function(e){return A[e]},
setFragmentRetryInterval:function(e){I[k.MEDIA_SEGMENT_TYPE]=e},getFragmentRetryInterval:function(){return I[k.MEDIA_SEGMENT_TYPE]},setManifestRetryInterval:function(e){I[k.MPD_TYPE]=e},getManifestRetryInterval:function(){return I[k.MPD_TYPE]},setRetryIntervalForType:function(e,t){I[e]=t},getRetryIntervalForType:function(e){return I[e]},setWallclockTimeUpdateInterval:function(e){R=e},getWallclockTimeUpdateInterval:function(){return R},setScheduleWhilePaused:function(e){l=e},getScheduleWhilePaused:function(){return l},getUseSuggestedPresentationDelay:function(){return a},setUseSuggestedPresentationDelay:function(e){a=e},setLiveDelayFragmentCount:function(e){s=e},getLiveDelayFragmentCount:function(){return s},getLiveDelay:function(){return w?u||3:u},setLiveDelay:function(e){u=e},setUseManifestDateHeaderTimeSource:function(e){i=e},getUseManifestDateHeaderTimeSource:function(){return i},setUTCTimingSources:function(e){o=e},getUTCTimingSources:function(){return o},setXHRWithCredentialsForType:function e(t,n){t?D[t]=!!n:Object.keys(D).forEach((function(t){e(t,n)}))},getXHRWithCredentialsForType:function(e){var t=D[e];return void 0===t?D.default:t},setFastSwitchEnabled:function(e){O=e},getFastSwitchEnabled:function(){return O},setMovingAverageMethod:function(e){M=e},getMovingAverageMethod:function(){return M},setJumpGaps:function(e){L=e},getJumpGaps:function(){return L},setSmallGapLimit:function(e){b=e},getSmallGapLimit:function(){return b},getLowLatencyEnabled:function(){return w},setLowLatencyEnabled:function(e){w=e},getPreloadData:function(){return F},setPreloadData:function(e){F=e},setManifestUpdateRetryInterval:function(e){x=e},getManifestUpdateRetryInterval:function(){return x},setAppendingSourceState:function(e){e!==U&&(U=e)},getAppendingSourceState:function(){return U},setCachedDurationOffset:function(e,t){t=parseFloat(t.toFixed(5)),B[e]=t},getCachedDurationOffset:function(e){return e?B[e]:B},clearCachedDruationOffset:function(){B={offset:0,duration:0}},setEndOfStreamState:function(e){G=e},getEndOfStreamState:function(){return G},setP2pPermission:Q,getP2pPermission:function(){return H},addP2pSDKErrorCount:function(){(V+=1)>12&&Q(!1)},getP2pSDKErrorCount:function(){return V},addBufferingCount:function(){Y+=1},getBufferingCount:function(){return Y},reset:function(){}},o=[],a=!1,i=!0,l=!0,S=r.ABR_STRATEGY_DYNAMIC,N=!0,O=!1,p={enabled:!0,ttl:36e4},h={enabled:!0,ttl:36e4},s=4,u=void 0,d=20,c=80,f=10,g=NaN,m=30,E=60,_=600,T=.2,y=.8,v=1e4,R=50,L=!1,b=.8,x=100,D={default:!1},C=[],M=r.MOVING_AVERAGE_SLIDING_WINDOW,w=!1,U=!1,B={time:0,duration:0,offset:0},dn(t={},k.MPD_TYPE,3),dn(t,k.XLINK_EXPANSION_TYPE,1),dn(t,k.MEDIA_SEGMENT_TYPE,3),dn(t,k.INIT_SEGMENT_TYPE,3),dn(t,k.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),dn(t,k.INDEX_SEGMENT_TYPE,3),dn(t,k.OTHER_TYPE,3),A=t,dn(n={},k.MPD_TYPE,500),dn(n,k.XLINK_EXPANSION_TYPE,500),dn(n,k.MEDIA_SEGMENT_TYPE,cn),dn(n,k.INIT_SEGMENT_TYPE,cn),dn(n,k.BITSTREAM_SWITCHING_SEGMENT_TYPE,cn),dn(n,k.INDEX_SEGMENT_TYPE,cn),dn(n,k.OTHER_TYPE,cn),I=n,(P={})[r.VIDEO]=25,P[r.AUDIO]=5,G=!0,H=!0,V=0,Y=0,e}fn.__dashjs_factory_name="MediaPlayerModel";var pn=s.a.getSingletonFactory(fn);pn.DEFAULT_UTC_TIMING_SOURCE={scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso"},s.a.updateSingletonFactory(fn.__dashjs_factory_name,pn);var hn=pn;var gn=new(function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return n.AST_IN_FUTURE="astInFuture",n.BUFFER_EMPTY="bufferStalled",n.BUFFER_LOADED="bufferLoaded",n.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",n.ERROR="error",n.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",n.FRAGMENT_LOADING_HEADER_RECEIVED="fragmentLoadingHeaderReceived",n.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",n.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",n.FRAGMENT_P2P_LOAD_INFO="fragmentP2pLoadInfo",
n.CDN_LOAD_INFO="cdnLoadInfo",n.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",n.FRAGMENT_LOADED_ERROR="fragmentLoadedError",n.PCDN_LOADED_ERROR="pcdnLoadedError",n.LOG="log",n.MANIFEST_LOADED="manifestLoaded",n.METRICS_CHANGED="metricsChanged",n.METRIC_CHANGED="metricChanged",n.METRIC_ADDED="metricAdded",n.METRIC_UPDATED="metricUpdated",n.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",n.PERIOD_SWITCH_STARTED="periodSwitchStarted",n.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",n.QUALITY_CHANGE_DOWNLOADED="qualityChangeDownloaded",n.QUALITY_CHANGE_RENDERED="qualityChangeRendered",n.TRACK_CHANGE_RENDERED="trackChangeRendered",n.SOURCE_INITIALIZED="sourceInitialized",n.STREAM_INITIALIZED="streamInitialized",n.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",n.TEXT_TRACKS_ADDED="allTextTracksAdded",n.TEXT_TRACK_ADDED="textTrackAdded",n.TTML_PARSED="ttmlParsed",n.TTML_TO_PARSE="ttmlToParse",n.CAN_PLAY="canPlay",n.PLAYBACK_ENDED="playbackEnded",n.PLAYBACK_ERROR="playbackError",n.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",n.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",n.PLAYBACK_PAUSED="playbackPaused",n.PLAYBACK_PLAYING="playbackPlaying",n.PLAYBACK_PROGRESS="playbackProgress",n.PLAYBACK_RATE_CHANGED="playbackRateChanged",n.PLAYBACK_SEEKED="playbackSeeked",n.PLAYBACK_SEEKING="playbackSeeking",n.PLAYBACK_SEEK_ASKED="playbackSeekAsked",n.PLAYBACK_STALLED="playbackStalled",n.PLAYBACK_STARTED="playbackStarted",n.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",n.PLAYBACK_WAITING="playbackWaiting",n.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",n.DELAY_TO_APPEND_TO_BUFFER="delayToAppendBuffer",n.GET_NEXT_FRAGMENT="getNextFragment",n.APPENDING_NEXT_SOURCE="appendingNextSource",n.APPENDED_NEXT_SOURCE="appendedNextSource",n.APPENDED_NEXT_SOURCE_DURATION_CHANGED="appendedNextSourceDurationChanged",n.START_OFFSET_TIME_WARNING="startOffsetTimeWarning",n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(c));function mn(){var e=this.context,t=T(e).getInstance().log,n=d(e).getInstance(),i=it(e).getInstance(),a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0;function p(e){o=e}function h(e){e}function m(e){a=e}function E(e){var t=Date.parse(e);return isNaN(t)&&(t=function(e){var t=void 0,n=void 0,r=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10),parseInt(r[4],10),parseInt(r[5],10),r[6]&&(parseInt(r[6],10)||0),r[7]&&1e3*parseFloat(r[7])||0),r[9]&&r[10]&&(n=60*parseInt(r[9],10)+parseInt(r[10],10),t+=("+"===r[8]?-1:1)*n*60*1e3),new Date(t).getTime()}(e)),t}function _(e){return Date.parse(e)}function y(e){return Date.parse(e)}function v(e,t,n){n()}function A(e,t,n){var r=E(e);isNaN(r)?n():t(r)}function I(e,t,n,r,a){var o,s,u=!1,l=new XMLHttpRequest,d=a?k.HEAD:k.GET,c=t.match(/\S+/g);if(t=c.shift(),o=function(){u||(u=!0,c.length?I(e,c.join(" "),n,r,a):r())},s=function(){var t=void 0,r=void 0;200===l.status&&(t=a?l.getResponseHeader("Date"):l.response,r=e(t),isNaN(r)||(n(r),u=!0))},i.isRelative(t)){var p=f.resolve();p&&(t=i.resolve(t,p.url))}l.open(d,t),l.timeout=5e3,l.onload=s,l.onloadend=o,l.send()}function R(e,t,n){I(y,e,t,n,!0)}function S(e,t,r){p(!1),n.trigger(g.TIME_SYNCHRONIZATION_COMPLETED,{time:t,offset:r,error:e?new N(1):null})}function D(e,n){var i=n||0,o=e[i],d=function(e,t){var n,i,o,u=!e||!t;u&&s?(n=l.getReadOnlyMetricsFor(r.STREAM),i=c.getLatestMPDRequestHeaderValueByID(n,"Date"),o=null!==i?new Date(i).getTime():Number.NaN,isNaN(o)?S(!0):(m(o-(new Date).getTime()),S(!1,o/1e3,a))):S(u,e,t)};p(!0),o?u.hasOwnProperty(o.schemeIdUri)?u[o.schemeIdUri](o.value,(function(e){var n=(new Date).getTime(),r=e-n;m(r),t("Local time:      "+new Date(n)),t("Server time:     "+new Date(e)),
t("Difference (ms): "+r),d(e,r)}),(function(){D(e,i+1)})):D(e,i+1):(m(0),d())}return{initialize:function(e,t){s=t,a=0,o=!1,!1,u={"urn:mpeg:dash:utc:http-head:2014":R,"urn:mpeg:dash:utc:http-xsdate:2014":I.bind(null,E),"urn:mpeg:dash:utc:http-iso:2014":I.bind(null,_),"urn:mpeg:dash:utc:direct:2014":A,"urn:mpeg:dash:utc:http-head:2012":R,"urn:mpeg:dash:utc:http-xsdate:2012":I.bind(null,E),"urn:mpeg:dash:utc:http-iso:2012":I.bind(null,_),"urn:mpeg:dash:utc:direct:2012":A,"urn:mpeg:dash:utc:http-ntp:2014":v,"urn:mpeg:dash:utc:ntp:2014":v,"urn:mpeg:dash:utc:sntp:2014":v},o||(D(e),h(!0))},getOffsetToDeviceTimeMs:function(){return a},setConfig:function(e){e&&(e.metricsModel&&(l=e.metricsModel),e.dashMetrics&&(c=e.dashMetrics),e.baseURLController&&(f=e.baseURLController))},reset:function(){h(!1),p(!1)}}}mn.__dashjs_factory_name="TimeSyncController";var En=s.a.getSingletonFactory(mn);En.TIME_SYNC_FAILED_ERROR_CODE=1,En.HTTP_TIMEOUT_MS=5e3,s.a.updateSingletonFactory(mn.__dashjs_factory_name,En);var _n=En,Tn=n(8),yn=n.n(Tn);function vn(){return{areEqual:function(e,t){return yn()(e,t)}}}vn.__dashjs_factory_name="ObjectUtils";var An=s.a.getSingletonFactory(vn);var In=NaN,Rn=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={baseUrls:t||null,selectedIdx:n||In},this.children=[]};function Sn(){var e,t=void 0,n=void 0,r=this.context,i=An(r).getInstance();function a(e,t,r){var a=n.getBaseURLsFromElement(r);e[t]?i.areEqual(a,e[t].data.baseUrls)||(e[t].data.baseUrls=a,e[t].data.selectedIdx=In):e[t]=new Rn(a)}function o(e,n){var r=n||t;e(r.data),r.children&&r.children.forEach((function(t){return o(e,t)}))}function s(){t=new Rn}return e={reset:s,update:function(e){!function(e){var r=n.getBaseURLsFromElement(e);i.areEqual(r,t.data.baseUrls)||(t.data.baseUrls=r,t.data.selectedIdx=In),e.Period_asArray&&e.Period_asArray.forEach((function(e,r){a(t.children,r,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach((function(e,i){a(t.children[r].children,i,e),e.Representation_asArray&&e.Representation_asArray.sort(n.getRepresentationSortFunction()).forEach((function(e,n){a(t.children[r].children[i].children,n,e)}))}))}))}(e)},getForPath:function(e){var n=t,r=[n.data];return e&&e.forEach((function(e){(n=n.children[e])&&r.push(n.data)})),r.filter((function(e){return e.baseUrls.length}))},invalidateSelectedIndexes:function(e){o((function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=In)}))},setConfig:function(e){e.dashManifestModel&&(n=e.dashManifestModel)}},s(),e}Sn.__dashjs_factory_name="BaseURLTreeModel";var Nn=s.a.getClassFactory(Sn);function Dn(e){e=e||{};return{select:function(e){return e&&function(e){var t=0,n=[],r=0,i=void 0,a=void 0;if(a=e.sort((function(e,t){var n=e.dvb_priority-t.dvb_priority;return isNaN(n)?0:n})).filter((function(e,t,n){return!t||n[0].dvb_priority&&e.dvb_priority&&n[0].dvb_priority===e.dvb_priority})),a.length)return a.length>1&&(a.forEach((function(e){t+=e.dvb_weight,n.push(t)})),i=Math.floor(Math.random()*(t-1)),n.every((function(e,t){return r=t,!(i<e)}))),a[r]}((t=[],e.filter((function(){return!0})).filter((function(e){return!t.length||!e.dvb_priority||-1===t.indexOf(e.dvb_priority)}))));var t}}}Dn.__dashjs_factory_name="DVBSelector";var On=s.a.getClassFactory(Dn);function Cn(e){e=e||{};return{select:function(e){var t=0,n=void 0;return e&&e.some((function(e,n){return t=n,!0}))&&(n=e[t]),n}}}Cn.__dashjs_factory_name="BasicSelector";var Mn=s.a.getClassFactory(Cn),Pn="Failed to resolve a valid URL";function Ln(){var e,t=this.context,n=d(t).getInstance(),r=void 0,i=void 0,a=void 0,o=void 0;function s(){}return e={chooseSelectorFromManifest:function(e){!function(){if(!r||!r.hasOwnProperty("getIsDVB"))throw new Error("Missing config parameter(s)")}(),o=r.getIsDVB(e)?a:i},select:function(e){var t=e.baseUrls,r=e.selectedIdx;if(!isNaN(r))return t[r];var i=o.select(t);if(i)return e.selectedIdx=t.indexOf(i),i;n.trigger(g.URL_RESOLUTION_FAILED,{error:new Error(1,Pn)})},reset:s,setConfig:function(e){
e.selector&&(o=e.selector),e.dashManifestModel&&(r=e.dashManifestModel)}},i=Mn(t).create({}),a=On(t).create({}),o=i,e}Ln.__dashjs_factory_name="BaseURLSelector";var bn=s.a.getClassFactory(Ln);bn.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=1,bn.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE=Pn,s.a.updateClassFactory(Ln.__dashjs_factory_name,bn);var wn=bn;var Fn=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=n||t||"",this.dvb_priority=r||1,this.dvb_weight=i||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0};Fn.DEFAULT_DVB_PRIORITY=1,Fn.DEFAULT_DVB_WEIGHT=1;var xn=Fn;function Un(){var e=void 0,t=void 0,n=this.context,r=d(n).getInstance(),i=it(n).getInstance(),a=void 0,o=void 0;function s(e){a.invalidateSelectedIndexes(e.entry)}return e={reset:function(){a.reset(),o.reset()},initialize:function(e){var n;a.setConfig({dashManifestModel:t}),o.setConfig({dashManifestModel:t}),n=e,a.update(n),o.chooseSelectorFromManifest(n)},resolve:function(e){var t=a.getForPath(e).reduce((function(e,t){var n=o.select(t);return n?(i.isRelative(n.url)?e.url=i.resolve(n.url,e.url):(e.url=n.url,e.serviceLocation=n.serviceLocation),e.urls=n.urls,e.availabilityTimeOffset=n.availabilityTimeOffset,e.availabilityTimeComplete=n.availabilityTimeComplete,e):new xn}),new xn);if(!i.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(a=e.baseURLTreeModel),e.baseURLSelector&&(o=e.baseURLSelector),e.dashManifestModel&&(t=e.dashManifestModel)}},a=Nn(n).create(),o=wn(n).create(),r.on(g.SERVICE_LOCATION_BLACKLIST_CHANGED,s,e),e}Un.__dashjs_factory_name="BaseURLController";var Bn=s.a.getSingletonFactory(Un);function Gn(){var e;return e={createMediaSource:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e&&window.BwpElement&&e instanceof window.BwpElement&&window.BwpMediaSource)return new BwpMediaSource;var t="WebKitMediaSource"in window,n="MediaSource"in window;return n?new MediaSource:t?new WebKitMediaSource:null},attachMediaSource:function(e,t){var n=void 0;return n=window.BwpMediaSource&&e instanceof window.BwpMediaSource&&e.createObjectURL?e.createObjectURL():window.URL.createObjectURL(e),t.setSource(n),n},detachMediaSource:function(e){e.setSource(null)},setDuration:function e(t,n){return t.duration!=n&&function(e,t){var n=void 0,r=50,i=function(){for(var t=!1,n=0;n<e.length;n++)e[n].updating&&(t=!0);return t};if(!e.length||!i())return void t();var a=function(){i()||(clearInterval(n),t())},o=function e(){this.removeEventListener("updateend",e,!1),this.removeEventListener("abort",e,!1),this.removeEventListener("error",e,!1),i()||t()};if("function"==typeof e[0].addEventListener)try{for(var s=0;s<e.length;s++)e[s].updating&&(e[s].addEventListener("updateend",o,!1),e[s].addEventListener("abort",o,!1),e[s].addEventListener("error",o,!1))}catch(e){n=setInterval(a,r)}else n=setInterval(a,r)}(t.sourceBuffers,(function(){if("open"===t.readyState)t.duration=n;else var r=setTimeout((function(){clearTimeout(r),e(t,n)}),50)})),t.duration},setSeekable:function(e,t,n){e&&"function"==typeof e.setLiveSeekableRange&&"function"==typeof e.clearLiveSeekableRange&&"open"===e.readyState&&t>=0&&t<n&&(e.clearLiveSeekableRange(),e.setLiveSeekableRange(t,n))},signalEndOfStream:function(e){var t=e.sourceBuffers,n=t.length;if("open"===e.readyState){for(var r=0;r<n;r++){if(t[r].updating)return;if(0===t[r].buffered.length)return}e.endOfStream()}}},e}Gn.__dashjs_factory_name="MediaSourceController";var kn=s.a.getSingletonFactory(Gn);function Hn(){var e=this.context,t=T(e).getInstance().log,n=d(e).getInstance(),o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,p=void 0,h=void 0,m=void 0,E=void 0,_=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,S=void 0,N=void 0,D=void 0,O=void 0,C=void 0,M=void 0,P=void 0,L=void 0,b=void 0,w=void 0,F=void 0,x=void 0,U=void 0,B=void 0,G=void 0,k=void 0,H=void 0,V=void 0,Y=void 0,q=void 0,Q=void 0,W=void 0,K=void 0,j=void 0;function z(){if(fe()){var e=U.getPlaybackQuality()
;e&&h.addDroppedFrames(r.VIDEO,e)}}function X(){if(!(!G.getJumpGaps()||!C||0===C.getProcessors().length||B.isSeeking()||k||b||w||F)&&++K>=40){var e=B.getTime();j===e?function(e){for(var r=C.getProcessors(),i=G.getSmallGapLimit(),a=void 0,o=0;o<r.length;o++){var s=r[o].getBuffer(),u=s&&s.getAllBufferRanges&&s.getAllBufferRanges(),l=void 0;if(u&&!(u.length<=1)){for(var d=0;d<u.length;d++)if(e<u.start(d)){l=u.start(d);break}if(l>0){var c=l-e;c>0&&c<=i&&(void 0===a||l>a)&&(a=l)}}}var f=B.getTimeToStreamEnd();void 0===a&&!isNaN(f)&&f<i&&(a=e+f);a>0&&(!isNaN(f)&&a>=e+f?(t("Jumping media gap (discontinuity) at time ",e,". Jumping to end of the stream"),n.trigger(g.PLAYBACK_ENDED)):(t("Jumping media gap (discontinuity) at time ",e,". Jumping to time position",a),B.seek(a)))}(e):j=e,K=0}}function Z(e){var t=re(e.seekTime);W&&(ee(),Q=!1),t&&t!==C?(he(We.END_OF_PERIOD_STOP_REASON),ae(C,t,e.seekTime)):he(We.USER_REQUEST_STOP_REASON),ge(Qe.SEEK_START_REASON)}function J(){t("[StreamController][onPlaybackStarted]"),H?(H=!1,ge(Qe.INITIAL_PLAYOUT_START_REASON)):k&&(k=!1,ge(Qe.RESUME_FROM_PAUSE_START_REASON),te())}function $(e){t("[StreamController][onPlaybackPaused]"),e.ended||(k=!0,he(We.USER_REQUEST_STOP_REASON),te())}function ee(){t("[StreamController][toggleEndPeriodTimer] stop end period timer."),clearTimeout(W),W=void 0}function te(){if(Q)if(W)ee();else{var e=B.getTimeToStreamEnd(),r=e>0?1e3*e:0;t("[StreamController][toggleEndPeriodTimer] start-up of timer to notify PLAYBACK_ENDED event. It will be triggered in "+r+" milliseconds"),W=setTimeout((function(){n.trigger(g.PLAYBACK_ENDED)}),r)}}function ne(){var e=Ee().isLast,n=G.getEndOfStreamState();x&&e?(t("[StreamController][onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),n&&E.signalEndOfStream(x)):x&&void 0===W&&(t("[StreamController][onStreamBufferingCompleted] end of period detected"),Q=!0,!1===k&&te())}function re(e){var t=0,n=null,r=O.length;r>0&&(t+=O[0].getStartTime());for(var i=0;i<r;i++)if(n=O[i],e<(t=parseFloat((t+n.getDuration()).toFixed(5))))return n;return null}function ie(e){var n=function(){if(C){var e=C.getStreamInfo().start,t=C.getStreamInfo().duration;return O.filter((function(n){return n.getStreamInfo().start===parseFloat((e+t).toFixed(5))}))[0]}}();n?(q=void 0,Y=void 0,ae(C,n,NaN)):t("StreamController no next stream found"),he(n?We.END_OF_PERIOD_STOP_REASON:We.END_OF_CONTENT_STOP_REASON),W=void 0,Q=!1;try{if(G.getEndOfStreamState()&&!e.isNativeEnded){var r=Ie("video"),i=Ie("audio");isNaN(r)&&isNaN(i)||(B.seek(B.getTime()-.3),E.signalEndOfStream(x))}}catch(e){console.error("Hack PLAYBACK_END trigger native ended event error",e)}}function ae(e,t,r){!b&&t&&e!==t&&(b=!0,n.trigger(g.PERIOD_SWITCH_STARTED,{fromStreamInfo:e?e.getStreamInfo():null,toStreamInfo:t.getStreamInfo()}),e&&(e.stopEventController(),e.deactivate()),C=t,B.initialize(C.getStreamInfo()),U.getElement()?oe(r,e,!1):function(e){se(e)}(r))}function oe(e,r,i){var a=void 0;function o(){x&&(t("MediaSource is open!"),window.URL.revokeObjectURL(a),x.removeEventListener("sourceopen",o),x.removeEventListener("webkitsourceopen",o),ue(),r||n.trigger(g.SOURCE_INITIALIZED),i&&C.setMediaSource(x))}x?E.detachMediaSource(U):x=E.createMediaSource(U.getElement()),se(e),x.addEventListener("sourceopen",o,!1),x.addEventListener("webkitsourceopen",o,!1),a=E.attachMediaSource(x,U),t("MediaSource attached to element.  Waiting on open...")}function se(e){if(C.activate(x),q=pe(r.AUDIO),Y=pe(r.VIDEO),!H)if(isNaN(e)){var t=B.getStreamStartTime(!0);C.getProcessors().forEach((function(e){p.setIndexHandlerTime(e,t)}))}else B.seek(e);C.startEventController(),!L&&H||B.play(),b=!1,n.trigger(g.PERIOD_SWITCH_COMPLETED,{toStreamInfo:C.getStreamInfo()})}function ue(e){var n=e||C.getStreamInfo().manifestInfo.duration,r=E.setDuration(x,n);t("Duration successfully set to: "+r)}function le(e){for(var t=0,n=O.length;t<n;t++)if(O[t].getId()===e.id)return O[t];return null}function de(){var t=c.getValue();M&&(n.trigger(g.PROTECTION_CREATED,{controller:M,manifest:t}),M.setMediaElement(U.getElement()),
P&&M.setProtectionData(P)),function(){try{var t=p.getStreamsInfo();if(0===t.length)throw new Error("There are no streams");var i=m.getCurrentManifestUpdate(h.getMetricsFor(r.STREAM));h.updateManifestUpdateInfo(i,{currentTime:B.getTime(),buffered:U.getBufferRange(),presentationStartTime:t[0].start,clientTimeOffset:D.getClientTimeOffset()});for(var a=0,l=t.length;a<l;a++){var d=t[a],E=le(d);E?E.updateData(d):(E=sn(e).create({manifestModel:c,dashManifestModel:f,mediaPlayerModel:G,metricsModel:h,dashMetrics:m,manifestUpdater:u,adapter:p,timelineConverter:D,capabilities:s,errHandler:N,baseURLController:y,domStorage:v,abrController:A,playbackController:B,mediaController:I,videoModel:U,streamController:o}),O.push(E),E.initialize(d,M)),h.addManifestUpdateStreamInfo(i,d.id,d.index,d.start,d.duration)}if(!C){var _=B.getStartTimeFromUriParameters(),T=null;_&&(T=re(isNaN(_.fragS)?_.fragT:_.fragS)),ae(null,null!==T?T:O[0],NaN)}n.trigger(g.STREAMS_COMPOSED)}catch(e){N.manifestError(e.message,"nostreamscomposed",c.getValue()),F=!0,ve()}}()}function ce(e){if(e.error)F=!0,ve();else{var n=e.manifest;G.getAppendingSourceState()&&ue(n.mediaPresentationDuration),p.updatePeriods(n);var i=p.getStreamsInfo(void 0,1)[0],a=p.getMediaInfoForType(i,r.VIDEO)||p.getMediaInfoForType(i,r.AUDIO),o=void 0;a&&(o=f.getUseCalculatedLiveEdgeTimeForAdaptation(p.getDataForMedia(a)))&&(t("SegmentTimeline detected using calculated Live Edge Time"),G.setUseManifestDateHeaderTimeSource(!1));var s=f.getUTCTimingSources(e.manifest),u=!f.getIsDynamic(n)||o?s:s.concat(G.getUTCTimingSources()),l=S.isHTTPS(e.manifest.url);u.forEach((function(e){e.value.replace(/.*?:\/\//g,"")===hn.DEFAULT_UTC_TIMING_SOURCE.value.replace(/.*?:\/\//g,"")&&(e.value=e.value.replace(l?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),l?"https://":"http://"),t("Matching default timing source protocol to manifest protocol: ",e.value))})),y.initialize(n),_.setConfig({metricsModel:h,dashMetrics:m,baseURLController:y}),_.initialize(u,G.getUseManifestDateHeaderTimeSource())}}function fe(){return Y}function pe(e){var t=!1;return C&&C.getProcessors().forEach((function(n){n.getMediaInfo().type===e&&(t=!0)})),t}function he(e,t){t=t||new Date,V&&(C&&C.getProcessors().forEach((function(n){var r=n.getScheduleController();r&&r.finalisePlayList(t,e)})),h.addPlayList(V),V=null)}function ge(e){(V=new Qe).start=new Date,V.mstart=1e3*B.getTime(),V.starttype=e,C&&C.getProcessors().forEach((function(e){var t=e.getScheduleController();t&&t.setPlayList(V)}))}function me(e){if(e.error){var n="",r=a.MEDIA_ERROR;switch(this.MEDIA_DOWNLOAD_ERROR=5001,e.error.code){case 1:n="MEDIA_ERR_ABORTED",r=a.MEDIA_ABORTED_ERROR;break;case 2:n="MEDIA_ERR_NETWORK",r=a.MEDIA_NETWORK_ERROR;break;case 3:n="MEDIA_ERR_DECODE",r=a.MEDIA_DECODE_ERROR;break;case 4:n="MEDIA_ERR_SRC_NOT_SUPPORTED",r=a.MEDIA_SUPPORTED_ERROR;break;case 5:n="MEDIA_ERR_ENCRYPTED",r=a.MEDIA_ENCRYPTED_ERROR;break;default:n="UNKNOWN",r=a.MEDIA_UNKNOWN_ERROR}e.errorCode=r,w=!0,e.error.message&&(n+=" ("+e.error.message+")"),e.error.msExtendedCode&&(n+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),t("Video Element Error: "+n),e.error&&t(e.error),N.mediaSourceError(n,r),ve()}}function Ee(){return C?C.getStreamInfo():null}function _e(){if(!(l&&l.hasOwnProperty("load")&&D&&D.hasOwnProperty("initialize")&&D.hasOwnProperty("reset")&&D.hasOwnProperty("getClientTimeOffset")))throw new Error("setConfig function has to be called previously")}function Te(e){isNaN(e.newDuration)||ue(e.newDuration)}function ye(){O=[],M=null,b=!1,C=null,w=!1,F=!1,Y=void 0,q=void 0,H=!0,k=!1,L=!0,V=null,W=void 0,Q=!1,K=0}function ve(){_e(),_.reset(),he(w||F?We.FAILURE_STOP_REASON:We.USER_REQUEST_STOP_REASON);for(var e=0,t=O?O.length:0;e<t;e++){O[e].reset(w)}n.off(g.PLAYBACK_TIME_UPDATED,z,this),n.off(g.PLAYBACK_SEEKING,Z,this),n.off(g.PLAYBACK_ERROR,me,this),n.off(g.PLAYBACK_STARTED,J,this),n.off(g.PLAYBACK_PAUSED,$,this),n.off(g.PLAYBACK_ENDED,ie,this),n.off(g.MANIFEST_UPDATED,ce,this),n.off(g.STREAM_BUFFERING_COMPLETED,ne,this),n.off(gn.METRIC_ADDED,Ae,this),
n.off(g.MANIFEST_VALIDITY_CHANGED,Te,this),y.reset(),u.reset(),h.clearAllCurrentMetrics(),c.setValue(null),l.reset(),D.reset(),R.reset(),x&&(E.detachMediaSource(U),x=null),U=null,M&&(M.setMediaElement(null),M=null,P=null,c.getValue()&&n.trigger(g.PROTECTION_DESTROYED,{data:c.getValue().url})),n.trigger(g.STREAM_TEARDOWN_COMPLETE),ye()}function Ae(e){e.metric===i.DVR_INFO&&e.mediaType===r.AUDIO&&E.setSeekable(x,e.value.range.start,e.value.range.end)}function Ie(e){if(-1!==[r.VIDEO,r.AUDIO,r.FRAGMENTED_TEXT].indexOf(e)){var n=m.getCurrentBufferLevel(h.getReadOnlyMetricsFor(e));return n||NaN}return t("Warning  - getBufferLength requested for invalid type"),NaN}return o={initialize:function(t,r){_e(),L=t,P=r,D.initialize(),(u=ln(e).create()).setConfig({manifestModel:c,dashManifestModel:f,mediaPlayerModel:G,manifestLoader:l,errHandler:N}),u.initialize(),y.setConfig({dashManifestModel:f}),n.on(g.TIME_SYNCHRONIZATION_COMPLETED,de,this),n.on(g.PLAYBACK_SEEKING,Z,this),n.on(g.PLAYBACK_TIME_UPDATED,z,this),n.on(g.PLAYBACK_ENDED,ie,this),n.on(g.PLAYBACK_ERROR,me,this),n.on(g.PLAYBACK_STARTED,J,this),n.on(g.PLAYBACK_PAUSED,$,this),n.on(g.MANIFEST_UPDATED,ce,this),n.on(g.STREAM_BUFFERING_COMPLETED,ne,this),n.on(g.MANIFEST_VALIDITY_CHANGED,Te,this),n.on(g.WALLCLOCK_TIME_UPDATED,X,this),n.on(gn.METRIC_ADDED,Ae,this)},getActiveStreamInfo:Ee,isVideoTrackPresent:fe,isAudioTrackPresent:function(){return q},switchToVideoElement:function(e){B.initialize(C.getStreamInfo()),oe(e,null,!0)},getStreamById:function(e){return O.filter((function(t){return t.getId()===e}))[0]},getStreamForTime:re,getDuration:function(){if(C)return C.getStreamInfo().duration},getTimeRelativeToStreamId:function(e,t){for(var n=null,r=0,i=0,a=null,o=O.length,s=0;s<o;s++){if(i=(n=O[s]).getStartTime(),a=n.getDuration(),Number.isFinite(i)&&(r=i),n.getId()===t)return e-r;Number.isFinite(a)&&(r+=a)}return null},load:function(e,t,n){_e(),l.load(e,t,n)},loadWithManifest:function(e){!function(){if(!u||!u.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}(),u.setManifest(e)},getActiveStreamProcessors:function(){return C?C.getProcessors():[]},setConfig:function(e){e&&(e.capabilities&&(s=e.capabilities),e.manifestLoader&&(l=e.manifestLoader),e.manifestModel&&(c=e.manifestModel),e.dashManifestModel&&(f=e.dashManifestModel),e.mediaPlayerModel&&(G=e.mediaPlayerModel),e.protectionController&&(M=e.protectionController),e.adapter&&(p=e.adapter),e.metricsModel&&(h=e.metricsModel),e.dashMetrics&&(m=e.dashMetrics),e.errHandler&&(N=e.errHandler),e.timelineConverter&&(D=e.timelineConverter),e.videoModel&&(U=e.videoModel),e.playbackController&&(B=e.playbackController),e.domStorage&&(v=e.domStorage),e.abrController&&(A=e.abrController),e.mediaController&&(I=e.mediaController))},setProtectionData:function(e){P=e},setMediaDuration:ue,reset:ve},_=_n(e).getInstance(),y=Bn(e).getInstance(),E=kn(e).getInstance(),R=De(e).getInstance(),S=it(e).getInstance(),ye(),o}Hn.__dashjs_factory_name="StreamController";var Vn=s.a.getSingletonFactory(Hn);var Yn=function(e){function t(n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return a.url=n||null,a.type=i||null,a.mediaType=r.STREAM,a.responseType="",a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(E);function qn(e){e=e||{};var t=this.context,n=d(t).getInstance(),r=Gt(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier});return{load:function(e,t,i){var a=function(r,a){t.resolved=!0,
t.resolvedContent=r||null,n.trigger(g.XLINK_ELEMENT_LOADED,{element:t,resolveObject:i,error:r||a?null:new N(1,"Failed loading Xlink element: "+e)})};if("urn:mpeg:dash:resolve-to-zero:2013"===e)a(null,!0);else{var o=new Yn(e,k.XLINK_TYPE);r.load({request:o,success:function(e){a(e)},error:function(){a(null)}})}},reset:function(){r&&(r.abort(),r=null)}}}qn.__dashjs_factory_name="XlinkLoader";var Qn=s.a.getClassFactory(qn);Qn.XLINK_LOADER_ERROR_LOADING_FAILURE=1,s.a.updateClassFactory(qn.__dashjs_factory_name,Qn);var Wn=Qn;var Kn=function(e){e=e||{},function(){void 0===e.escapeMode&&(e.escapeMode=!0);void 0===e.attributePrefix&&(e.attributePrefix="_");e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0);e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0);void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0);e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1);e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1);void 0===e.ignoreRoot&&(e.ignoreRoot=!1)}();var t=1,n=3,r=4,i=8,a=9;function o(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function s(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function u(e,t,n,r){for(var i=0;i<e.length;i++){var a=e[i];if("string"==typeof a){if(a==r)break}else if(a instanceof RegExp){if(a.test(r))break}else if("function"==typeof a&&a(t,n,r))break}return i!=e.length}function l(t,n,r){if("property"===e.arrayAccessForm)t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]];!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&u(e.arrayAccessFormPaths,t,n,r)&&(t[n]=[t[n]])}function d(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(n.setHours(t[3],t[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function c(n,r,i,a){return!(r==t&&e.xmlElementsFilter.length>0)||u(e.xmlElementsFilter,n,i,a)}function f(s,p){if(s.nodeType==a){for(var h=new Object,g=s.childNodes,m=0;m<g.length;m++){if((_=g[m]).nodeType==t)if(e.ignoreRoot)h=f(_);else(h={})[T=o(_)]=f(_)}return h}if(s.nodeType==t){(h=new Object).__cnt=0;var E=[];for(g=s.childNodes,m=0;m<g.length;m++){var _,T=o(_=g[m]);if(_.nodeType!=i){var y=p+"."+T;if(c(h,_.nodeType,T,y))if(h.__cnt++,null==h[T]){var v=f(_,y);if("#text"!=T||/[^\s]/.test(v))(A={})[T]=v,E.push(A);h[T]=v,l(h,T,y)}else{null!=h[T]&&(h[T]instanceof Array||(h[T]=[h[T]],l(h,T,y)));var A;v=f(_,y);if("#text"!=T||/[^\s]/.test(v))(A={})[T]=v,E.push(A);h[T][h[T].length]=v}}}h.__children=E;for(var I=o(s),R=0;R<s.attributes.length;R++){var S=s.attributes[R];h.__cnt++;for(var N=S.value,D=0,O=e.matchers.length;D<O;D++){var C=e.matchers[D];C.test(S,I)&&(N=C.converter(S.value))}h[e.attributePrefix+S.name]=N}var M=function(e){return e.prefix}(s);return null!=M&&""!=M&&(h.__cnt++,h.__prefix=M),null!=h["#text"]&&(h.__text=h["#text"],h.__text instanceof Array&&(h.__text=h.__text.join("\n")),e.stripWhitespaces&&(h.__text=h.__text.trim()),delete h["#text"],"property"==e.arrayAccessForm&&delete h["#text_asArray"],h.__text=function(t,n,r){if(e.datetimeAccessFormPaths.length>0){var i=r.split(".#")[0];return u(e.datetimeAccessFormPaths,t,n,i)?d(t):t}return t}(h.__text,T,p+"."+T)),null!=h["#cdata-section"]&&(h.__cdata=h["#cdata-section"],delete h["#cdata-section"],"property"==e.arrayAccessForm&&delete h["#cdata-section_asArray"]),
0==h.__cnt&&"text"==e.emptyNodeForm?h="":1==h.__cnt&&null!=h.__text?h=h.__text:1!=h.__cnt||null==h.__cdata||e.keepCData?h.__cnt>1&&null!=h.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==h.__text||""==h.__text.trim())&&delete h.__text:h=h.__cdata,delete h.__cnt,!e.enableToStringFunc||null==h.__text&&null==h.__cdata||(h.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),h}if(s.nodeType==n||s.nodeType==r)return s.nodeValue}function p(t,n,r,i){var a="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+n;if(null!=r)for(var o=0;o<r.length;o++){var u=r[o],l=t[u];e.escapeMode&&(l=s(l)),a+=" "+u.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?a+='"'+l+'"':a+="'"+l+"'"}return a+=i?"/>":">"}function h(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function g(t,n){return"property"==e.arrayAccessForm&&(r=n.toString(),i="_asArray",-1!==r.indexOf(i,r.length-i.length))||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function;var r,i}function m(e){var t=0;if(e instanceof Object)for(var n in e)g(e,n)||t++;return t}function E(t,n,r){return 0==e.jsonPropertiesFilter.length||""==r||u(e.jsonPropertiesFilter,t,n,r)}function _(t){var n=[];if(t instanceof Object)for(var r in t)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(e.attributePrefix)&&n.push(r);return n}function T(t){var n="";return t instanceof Object?n+=function(t){var n="";return null!=t.__cdata&&(n+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?n+=s(t.__text):n+=t.__text),n}(t):null!=t&&(e.escapeMode?n+=s(t):n+=t),n}function y(e,t){return""===e?t:e+"."+t}function v(e,t,n,r){var i="";if(0==e.length)i+=p(e,t,n,!0);else for(var a=0;a<e.length;a++)i+=p(e[a],t,_(e[a]),!1),i+=A(e[a],y(r,t)),i+=h(e[a],t);return i}function A(e,t){var n="";if(m(e)>0)for(var r in e)if(!g(e,r)&&(""==t||E(e,r,y(t,r)))){var i=e[r],a=_(i);if(null==i||null==i)n+=p(i,r,a,!0);else if(i instanceof Object)if(i instanceof Array)n+=v(i,r,a,t);else if(i instanceof Date)n+=p(i,r,a,!1),n+=i.toISOString(),n+=h(i,r);else{m(i)>0||null!=i.__text||null!=i.__cdata?(n+=p(i,r,a,!1),n+=A(i,y(t,r)),n+=h(i,r)):n+=p(i,r,a,!0)}else n+=p(i,r,a,!1),n+=T(i),n+=h(i,r)}return n+=T(e)}this.parseXmlString=function(e){var t;window.ActiveXObject||window;if(void 0===e)return null;if(window.DOMParser){var n=new window.DOMParser;try{(t=n.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?d(e):e},this.xml2json=function(e){return f(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return A(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},jn="onLoad",zn="Period",Xn="AdaptationSet",Zn="EventStream";function Jn(e){e=e||{};var t=this.context,n=d(t).getInstance(),r=it(t).getInstance(),i=void 0,a=void 0,o=void 0,s=void 0,u=void 0,l=void 0;function c(e,t,n){var i={},a=void 0,o=void 0;i.elements=e,i.type=t,i.resolveType=n,0===i.elements.length&&p(i);for(var s=0;s<i.elements.length;s++)a=i.elements[s],o=r.isHTTPURL(a.url)?a.url:a.originalContent.BaseURL+a.url,l.load(o,a,i)}function f(e){var t,n=void 0,r="";if(n=e.element,t=e.resolveObject,n.resolvedContent){var i=0;0===n.resolvedContent.indexOf("<?xml")&&(i=n.resolvedContent.indexOf("?>")+2),r=n.resolvedContent.substr(0,i)+"<response>"+n.resolvedContent.substr(i)+"</response>",n.resolvedContent=u.xml_str2json(r)}(function(e){var t=void 0;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0})(t)&&p(t)}function p(e){
var t=[],r=void 0,i=void 0;if(function(e){var t=[],n=void 0,r=void 0,i=void 0,a=void 0,u=void 0,l=void 0;for(a=e.elements.length-1;a>=0;a--){if(r=(n=e.elements[a]).type+"_asArray",n.resolvedContent){if(n.resolvedContent)for(u=0;u<n.resolvedContent[r].length;u++)i=n.resolvedContent[r][u],t.push(i)}else delete n.originalContent["xlink:actuate"],delete n.originalContent["xlink:href"],t.push(n.originalContent);for(n.parentElement[r].splice(n.index,1),l=0;l<t.length;l++)n.parentElement[r].splice(n.index+l,0,t[l]);t=[]}e.elements.length>0&&o.run(s)}(e),"onActuate"===e.resolveType&&n.trigger(g.XLINK_READY,{manifest:s}),e.resolveType===jn)switch(e.type){case zn:for(r=0;r<s.Period_asArray.length;r++)(i=s.Period_asArray[r]).hasOwnProperty("AdaptationSet_asArray")&&(t=t.concat(h(i.AdaptationSet_asArray,i,Xn,jn))),i.hasOwnProperty("EventStream_asArray")&&(t=t.concat(h(i.EventStream_asArray,i,Zn,jn)));c(t,Xn,jn);break;case Xn:n.trigger(g.XLINK_READY,{manifest:s})}}function h(e,t,n,r){var i=[],a=void 0,o=void 0,s=void 0;for(o=e.length-1;o>=0;o--)(a=e[o]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===a["xlink:href"]&&e.splice(o,1);for(o=0;o<e.length;o++)(a=e[o]).hasOwnProperty("xlink:href")&&a.hasOwnProperty("xlink:actuate")&&a["xlink:actuate"]===r&&(s=m(a["xlink:href"],t,n,o,r,a),i.push(s));return i}function m(e,t,n,r,i,a){return{url:e,parentElement:t,type:n,index:r,resolveType:i,originalContent:a,resolvedContent:null,resolved:!1}}return i={resolveManifestOnLoad:function(e){u=new Kn({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:a}),c(h((s=e).Period_asArray,s,zn,jn),zn,jn)},setMatchers:function(e){e&&(a=e)},setIron:function(e){e&&(o=e)},reset:function(){n.off(g.XLINK_ELEMENT_LOADED,f,i),l&&(l.reset(),l=null)}},n.on(g.XLINK_ELEMENT_LOADED,f,i),l=Wn(t).create({errHandler:e.errHandler,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),i}Jn.__dashjs_factory_name="XlinkController";var $n=s.a.getClassFactory(Jn),er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function tr(e){function t(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function n(e,n,r){for(var i=0,a=e.length;i<a;++i){var o=e[i];if(n[o.name])if(r[o.name]){if(o.merge){var s=n[o.name],u=r[o.name];"object"===(void 0===s?"undefined":er(s))&&"object"===(void 0===u?"undefined":er(u))?t(s,u):r[o.name]=s+u}}else r[o.name]=n[o.name]}}function r(e,t){for(var i=0,a=e.children.length;i<a;++i){var o=e.children[i],s=t[o.name+"_asArray"];if(s)for(var u=0,l=s.length;u<l;++u){var d=s[u];n(e.properties,t,d),r(o,d)}}}return{run:function(t){if(null===t||"object"!==(void 0===t?"undefined":er(t)))return t;if("period"in e)for(var n=e.period,i=t.Period_asArray,a=0,o=i.length;a<o;++a){var s=i[a];if(r(n,s),"adaptationset"in e){var u=s.AdaptationSet_asArray;if(u)for(var l=e.adaptationset,d=0,c=u.length;d<c;++d)r(l,u[d])}}return t}}}tr.__dashjs_factory_name="ObjectIron";var nr=s.a.getClassFactory(tr),rr=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var ir=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._test=t,this._converter=n}return rr(e,[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}]),e}();function ar(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var or=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){
if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,(function(e,t){var n,r=(ar(n={},$e.MPD,[$e.ID,$e.PROFILES]),ar(n,$e.PERIOD,[$e.ID]),ar(n,$e.BASE_URL,[$e.SERVICE_LOCATION,$e.BYTE_RANGE]),ar(n,$e.SEGMENT_BASE,[$e.INDEX_RANGE]),ar(n,$e.INITIALIZATION,[$e.RANGE]),ar(n,$e.REPRESENTATION_INDEX,[$e.RANGE]),ar(n,$e.SEGMENT_LIST,[$e.INDEX_RANGE]),ar(n,$e.BITSTREAM_SWITCHING,[$e.RANGE]),ar(n,$e.SEGMENT_URL,[$e.MEDIA_RANGE,$e.INDEX_RANGE]),ar(n,$e.SEGMENT_TEMPLATE,[$e.INDEX_RANGE,$e.MEDIA,$e.INDEX,$e.INITIALIZATION_MINUS,$e.BITSTREAM_SWITCHING_MINUS]),ar(n,$e.ASSET_IDENTIFIER,[$e.VALUE,$e.ID]),ar(n,$e.EVENT_STREAM,[$e.VALUE]),ar(n,$e.ADAPTATION_SET,[$e.PROFILES,$e.MIME_TYPE,$e.SEGMENT_PROFILES,$e.CODECS,$e.CONTENT_TYPE]),ar(n,$e.FRAME_PACKING,[$e.VALUE,$e.ID]),ar(n,$e.AUDIO_CHANNEL_CONFIGURATION,[$e.VALUE,$e.ID]),ar(n,$e.CONTENT_PROTECTION,[$e.VALUE,$e.ID]),ar(n,$e.ESSENTIAL_PROPERTY,[$e.VALUE,$e.ID]),ar(n,$e.SUPPLEMENTAL_PROPERTY,[$e.VALUE,$e.ID]),ar(n,$e.INBAND_EVENT_STREAM,[$e.VALUE,$e.ID]),ar(n,$e.ACCESSIBILITY,[$e.VALUE,$e.ID]),ar(n,$e.ROLE,[$e.VALUE,$e.ID]),ar(n,$e.RATING,[$e.VALUE,$e.ID]),ar(n,$e.VIEWPOINT,[$e.VALUE,$e.ID]),ar(n,$e.CONTENT_COMPONENT,[$e.CONTENT_TYPE]),ar(n,$e.REPRESENTATION,[$e.ID,$e.DEPENDENCY_ID,$e.MEDIA_STREAM_STRUCTURE_ID]),ar(n,$e.SUBSET,[$e.ID]),ar(n,$e.METRICS,[$e.METRICS_MINUS]),ar(n,$e.REPORTING,[$e.VALUE,$e.ID]),n);if(r.hasOwnProperty(t)){var i=r[t];return void 0!==i&&i.indexOf(e.name)>=0}return!1}),(function(e){return String(e)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(ir);var sr=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,ur=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,(function(e){for(var t=[$e.MIN_BUFFER_TIME,$e.MEDIA_PRESENTATION_DURATION,$e.MINIMUM_UPDATE_PERIOD,$e.TIMESHIFT_BUFFER_DEPTH,$e.MAX_SEGMENT_DURATION,$e.MAX_SUBSEGMENT_DURATION,r.SUGGESTED_PRESENTATION_DELAY,$e.START,r.START_TIME,$e.DURATION],n=t.length,i=0;i<n;i++)if(e.nodeName===t[i])return sr.test(e.value);return!1}),(function(e){var t=sr.exec(e),n=31536e3*parseFloat(t[2]||0)+2592e3*parseFloat(t[4]||0)+86400*parseFloat(t[6]||0)+3600*parseFloat(t[8]||0)+60*parseFloat(t[10]||0)+parseFloat(t[12]||0);return void 0!==t[1]&&(n=-n),n})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(ir);var lr=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,dr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,(function(e){return lr.test(e.value)}),(function(e){var t=lr.exec(e),n=void 0;if(n=Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[4],10),parseInt(t[5],10),t[6]&&parseInt(t[6],10)||0,t[7]&&1e3*parseFloat(t[7])||0),t[9]&&t[10]){var r=60*parseInt(t[9],10)+parseInt(t[10],10);n+=("+"===t[8]?-1:1)*r*60*1e3}return new Date(n)})))}return function(e,t){
if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(ir);var cr=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,fr=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,(function(e){return cr.test(e.value)}),(function(e){return parseFloat(e)})))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(ir),pr=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var hr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n;this._name=t,this._merge=(n=t)&&n.length&&n.charAt(0)===n.charAt(0).toUpperCase()}return pr(e,[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}]),e}(),gr=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var mr=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t||"",this._properties=[],this._children=r||[],Array.isArray(n)&&n.forEach((function(e){i._properties.push(new hr(e))}))}return gr(e,[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),e}();var Er=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=[$e.PROFILES,$e.WIDTH,$e.HEIGHT,$e.SAR,$e.FRAMERATE,$e.AUDIO_SAMPLING_RATE,$e.MIME_TYPE,$e.SEGMENT_PROFILES,$e.CODECS,$e.MAXIMUM_SAP_PERIOD,$e.START_WITH_SAP,$e.MAX_PLAYOUT_RATE,$e.CODING_DEPENDENCY,$e.SCAN_TYPE,$e.FRAME_PACKING,$e.AUDIO_CHANNEL_CONFIGURATION,$e.CONTENT_PROTECTION,$e.ESSENTIAL_PROPERTY,$e.SUPPLEMENTAL_PROPERTY,$e.INBAND_EVENT_STREAM];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,$e.ADAPTATION_SET,n,[new mr($e.REPRESENTATION,n,[new mr($e.SUB_REPRESENTATION,n)])]))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(mr);var _r=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=[$e.SEGMENT_BASE,$e.SEGMENT_TEMPLATE,$e.SEGMENT_LIST];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,$e.PERIOD,n,[new mr($e.ADAPTATION_SET,n,[new mr($e.REPRESENTATION,n)])]))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t)
;e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(mr);function Tr(){var e,t=this.context,n=T(t).getInstance().log,r=void 0,i=void 0,a=void 0;return e={parse:function(e){var t,r=window.performance.now();if(!(t=i.xml_str2json(e)))throw new Error("parsing the manifest failed");var o=window.performance.now();a.run(t);var s=window.performance.now();return n("Parsing complete: ( xml2json: "+(o-r).toPrecision(3)+"ms, objectiron: "+(s-o).toPrecision(3)+"ms, total: "+((s-r)/1e3).toPrecision(3)+"s)"),t},getMatchers:function(){return r},getIron:function(){return a}},r=[new ur,new dr,new fr,new or],i=new Kn({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:r}),a=nr(t).create({adaptationset:new Er,period:new _r}),e}Tr.__dashjs_factory_name="DashParser";var yr=s.a.getClassFactory(Tr),vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Ar(){var e,t=this.context,n=T(t).getInstance().log,r=void 0;function i(e,t){return t?e&&e.replace(/http:\/\//g,"https://"):e}return e={parse:function(e,t){var r={},a=window.performance.now();try{e=function e(t){var n={};if(t instanceof Object){var r=function(r){var i=r.replace(/[\x41-\x5A]/g,(function(e,t){var n=String.fromCharCode(e.charCodeAt(0)+32);return t?"_"+n:n}));"[object Array]"===Object.prototype.toString.call(t[r])?(n[i]=[],t[r].forEach((function(t){n[i].push(e(t))}))):"[object Object]"===Object.prototype.toString.call(t[r])?n[i]=e(t[r]):n[i]=t[r]};for(var i in t)r(i)}else n=t;return n}(e)}catch(e){throw new Error("Convert bilibili mpd failed, "+e)}if(r.ProgramInformation={Title:""},r.loadedTime=new Date,r.mediaPresentationDuration=e.duration,r.minBufferTime=e.min_buffer_time,r.profiles="urn:mpeg:dash:profile:isoff-on-demand:2011",r.xmlns="urn:mpeg:dash:profile:isoff-on-demand:2011",r.type="static",r.interactive="interactive"===e.type,r.originalUrl=location.href,r.url=location.href,r.Period={duration:e.duration,AdaptationSet:[]},e.video&&(r.Period.AdaptationSet[0]={},r.Period.AdaptationSet[0].Representation=e.video.map((function(e){var n={__text:i(e.base_url,t)};return e.backup_url&&e.backup_url.forEach((function(e,r){n["backupUrl"+(r+1)]=i(e,t)})),{BaseURL:n,SegmentBase:{Initialization:{range:e.segment_base.initialization},indexRange:e.segment_base.index_range,indexRangeExact:"true"},bandwidth:e.bandwidth,codecs:e.codecs,frameRate:e.frame_rate,height:e.height,width:e.width,id:e.id+"",mimeType:e.mime_type,sar:e.sar,startWithSAP:e.start_with_sap}}))),e.audio&&(r.Period.AdaptationSet[1]={},r.Period.AdaptationSet[1].Representation=e.audio.map((function(e){var n={__text:i(e.base_url,t)};return e.backup_url&&e.backup_url.forEach((function(e,r){n["backupUrl"+(r+1)]=i(e,t)})),{BaseURL:n,SegmentBase:{Initialization:{range:e.segment_base.initialization},indexRange:e.segment_base.index_range,indexRangeExact:"true"},bandwidth:e.bandwidth,codecs:e.codecs,id:e.id+"",mimeType:e.mime_type}}))),r.ProgramInformation={Title:""},function e(t){var n="[object Array]"!==Object.prototype.toString.call(t);for(var r in t)"object"===vr(t[r])&&(e(t[r]),n&&(t[r+"_asArray"]="[object Array]"===Object.prototype.toString.call(t[r])?t[r]:[t[r]]))}(r),!r)throw new Error("parsing the manifest failed");var o=window.performance.now(),s=window.performance.now();return n("Parsing complete: ( xml2json: "+(o-a).toPrecision(3)+"ms, objectiron: "+(s-o).toPrecision(3)+"ms, total: "+((s-a)/1e3).toPrecision(3)+"s)"),r},getMatchers:function(){return null},getIron:function(){return r}},r=nr(t).create({adaptationset:new Er,period:new _r}),e}Ar.__dashjs_factory_name="DashBilibiliParser";var Ir=s.a.getClassFactory(Ar);function Rr(e){e=e||{}
;var t=this.context,n=d(t).getInstance(),i=it(t).getInstance(),o=T(t).getInstance().log,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,p=e.mssHandler,h=e.errHandler;function m(e){n.trigger(g.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}function E(e,s,u,d){if(l){var h=void 0,m=void 0,E=void 0;if(window.location&&window.location&&"https:"===window.location.protocol&&(f=!0),d&&d!==e?(m=i.parseBaseUrl(d),h=d):(i.isRelative(e)&&(e=i.resolve(e,window.location.href)),m=i.parseBaseUrl(e)),null===c&&(c=function(e){var n=null;return e.video||e.audio?Ir(t).create():e.indexOf("SmoothStreamingMedia")>-1?(p&&(n=p.createMssParser(),p.registerEvents()),n):e.indexOf("MPD")>-1?yr(t).create():n}(s)),null!==c){l.setMatchers(c.getMatchers()),l.setIron(c.getIron());try{E=c.parse(s,f)}catch(t){return void n.trigger(g.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new N(1,"Failed parsing manifest : "+(d?e:"MPD String"),null,a.MANIFEST_RESOLVE_ERROR)})}E?(E.url=h||e,E.originalUrl||(E.originalUrl=E.url),E.hasOwnProperty(r.LOCATION)&&(m=i.parseBaseUrl(E.Location_asArray[0]),o("BaseURI set by Location to: "+m)),E.baseUri=function(e,t){if(t)return e&&e.replace(/http:\/\//g,"https://");return e}(m,f),E.loadedTime=new Date,l.resolveManifestOnLoad(E)):n.trigger(g.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new N(1,"parsing failed",null,a.MANIFEST_ERROR)})}else n.trigger(g.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new N(1,"Failed detecting manifest type or manifest type unsupported : "+(d?e:"MPD String"),null,a.MANIFEST_TYPE_ERROR)})}}return s={load:function(e,t){if(f=t,!e||"string"!=typeof e||0!==e.indexOf("http")&&0!==e.indexOf("/"))E("",e,"OK","");else{var r=new Yn(e,k.MPD_TYPE);u.load({request:r,success:function(t,n,r){E(e,t,n,r)},error:function(t,r,i,o){n.trigger(g.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new N(2,"Failed loading manifest: "+e+", "+i,null,a.MANIFEST_DOWNLOAD_ERROR,o)})}})}},reset:function(){n.off(g.XLINK_READY,m,s),l&&(l.reset(),l=null),u&&(u.abort(),u=null),p&&p.reset()}},n.on(g.XLINK_READY,m,s),u=Gt(t).create({errHandler:h,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),l=$n(t).create({errHandler:h,videoModel:e.videoModel,metricsModel:e.metricsModel,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier}),c=null,s}Rr.__dashjs_factory_name="ManifestLoader";var Sr=s.a.getClassFactory(Rr);Sr.MANIFEST_LOADER_ERROR_PARSING_FAILURE=1,Sr.MANIFEST_LOADER_ERROR_LOADING_FAILURE=2,s.a.updateClassFactory(Rr.__dashjs_factory_name,Sr);var Nr=Sr;function Dr(){var e,t=void 0;return e={supportsMediaSource:function(){var e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t},supportsEncryptedMedia:function(){return t},supportsCodec:function(e){return!(!("MediaSource"in window)||!MediaSource.isTypeSupported(e))||(!(!("WebKitMediaSource"in window)||!WebKitMediaSource.isTypeSupported(e))||!!(window.__ENABLE_WASM_PLAYER__&&"BwpMediaSource"in window&&BwpMediaSource.isTypeSupported(e)))},setEncryptedMediaSupported:function(e){t=e}},t=!1,e}Dr.__dashjs_factory_name="Capabilities";var Or=s.a.getSingletonFactory(Dr);function Cr(){var e=this.context,t=d(e).getInstance(),n=void 0;return{getValue:function(){return n},setValue:function(e){n=e,e&&t.trigger(g.MANIFEST_LOADED,{data:e})}}}Cr.__dashjs_factory_name="ManifestModel";var Mr=s.a.getSingletonFactory(Cr);var Pr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]};var Lr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null};var br=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,
this.mt=null,this.to=null,this.lto=null};var wr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null};var Fr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=xe.BUFFER_EMPTY};var xr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null};var Ur=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null};function Br(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Gr=function e(){Br(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},kr=function e(){Br(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},Hr=function e(){Br(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null};var Vr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null};var Yr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]};function qr(){var e,t=this.context,n=d(t).getInstance(),a=void 0;function o(){n.trigger(g.METRICS_CHANGED)}function s(e){n.trigger(g.METRIC_CHANGED,{mediaType:e}),o()}function u(e,t,r){n.trigger(g.METRIC_UPDATED,{mediaType:e,metric:t,value:r}),s(e)}function l(e,t,r){n.trigger(g.METRIC_ADDED,{mediaType:e,metric:t,value:r}),s(e)}function c(e){var t=void 0;return a.hasOwnProperty(e)?t=a[e]:(t=new Pr,a[e]=t),t}function f(e,t,n){var r=c(e);r[t].push(n),r[t].length>1e3&&r[t].shift()}function p(e,t,n){f(e,t,n),l(e,t,n)}return e={clearCurrentMetricsForType:function(e){delete a[e],s(e)},clearAllCurrentMetrics:function(){a={},o()},getReadOnlyMetricsFor:function(e){return a.hasOwnProperty(e)?a[e]:null},getMetricsFor:c,addTcpConnection:function(e,t,n,r,a,o){var s=new Lr;return s.tcpid=t,s.dest=n,s.topen=r,s.tclose=a,s.tconnect=o,p(e,i.TCP_CONNECTION,s),s},addHttpRequest:function e(t,n,r,a,o,s,u,l,d,c,f,h,g,m){var E=new k;return o&&o!==a&&(e(t,null,r,a,null,null,u,l,null,null,null,h,null,null),E.actualurl=o),E.tcpid=n,E.type=r,E.url=a,E.range=u,E.trequest=l,E.tresponse=d,E.responsecode=f,E._tfinish=c,E._stream=t,E._mediaduration=h,E._responseHeaders=g,E._serviceLocation=s,m?m.forEach((function(e){!function(e,t,n,r){var i=new H;i.s=t,i.d=n,i.b=r,e.trace.push(i),e.interval||(e.interval=0),e.interval+=n}(E,e.s,e.d,e.b)})):(delete E.interval,delete E.trace),p(t,i.HTTP_REQUEST,E),E},addRepresentationSwitch:function(e,t,n,r,a){var o=new br;return o.t=t,o.mt=n,o.to=r,a?o.lto=a:delete o.lto,p(e,i.TRACK_SWITCH,o),o},addBufferLevel:function(e,t,n){var r=new wr;return r.t=t,r.level=n,p(e,i.BUFFER_LEVEL,r),r},addBufferState:function(e,t,n){var r=new Fr;return r.target=n,r.state=t,p(e,i.BUFFER_STATE,r),r},addDVRInfo:function(e,t,n,r){var a=new xr;return a.time=t,a.range=r,a.manifestInfo=n,p(e,i.DVR_INFO,a),a},addDroppedFrames:function(e,t){var n=new Ur,r=c(e).DroppedFrames;return n.time=t.creationTime,n.droppedFrames=t.droppedVideoFrames,r.length>0&&r[r.length-1]==n?r[r.length-1]:(p(e,i.DROPPED_FRAMES,n),n)},addSchedulingInfo:function(e,t,n,r,a,o,s,u,l){var d=new Vr;return d.mediaType=e,d.t=t,d.type=n,d.startTime=r,d.availabilityStartTime=a,d.duration=o,d.quality=s,d.range=u,d.state=l,p(e,i.SCHEDULING_INFO,d),d},addRequestsQueue:function(e,t,n){var r=new Yr
;r.loadingRequests=t,r.executedRequests=n,c(e).RequestsQueue=r,l(e,i.REQUESTS_QUEUE,r)},addManifestUpdate:function(e,t,n,a,o,s,u,d,c,p){var h=new Gr;return h.mediaType=e,h.type=t,h.requestTime=n,h.fetchTime=a,h.availabilityStartTime=o,h.presentationStartTime=s,h.clientTimeOffset=u,h.currentTime=d,h.buffered=c,h.latency=p,f(r.STREAM,i.MANIFEST_UPDATE,h),l(e,i.MANIFEST_UPDATE,h),h},updateManifestUpdateInfo:function(e,t){if(e){for(var n in t)e[n]=t[n];u(e.mediaType,i.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,n,r,a){if(e){var o=new kr;return o.id=t,o.index=n,o.start=r,o.duration=a,e.streamInfo.push(o),u(e.mediaType,i.MANIFEST_UPDATE_STREAM_INFO,e),o}return null},addManifestUpdateRepresentationInfo:function(e,t,n,r,a,o,s,l){if(e){var d=new Hr;return d.id=t,d.index=n,d.streamIndex=r,d.mediaType=a,d.startNumber=s,d.fragmentInfoType=l,d.presentationTimeOffset=o,e.representationInfo.push(d),u(e.mediaType,i.MANIFEST_UPDATE_TRACK_INFO,e),d}return null},addPlayList:function(e){var t=r.STREAM;return e.trace&&Array.isArray(e.trace)?e.trace.forEach((function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel})):delete e.trace,p(t,i.PLAY_LIST,e),e},addDVBErrors:function(e){return p(r.STREAM,i.DVB_ERRORS,e),e},setConfig:function(e){e&&e.adapter&&e.adapter}},a={},e}qr.__dashjs_factory_name="MetricsModel";var Qr=s.a.getSingletonFactory(qr);function Wr(){var e,t=void 0,n=void 0,r=void 0,i=void 0,a=this.context,o=T(a).getInstance().log,s=d(a).getInstance(),u=[];function l(){t&&(t.playbackRate=i||1,t.removeEventListener("canplay",l))}function c(){return u.length>0}function f(e){var n,r=u.indexOf(e),a=void 0;null!==e&&(-1!==r&&u.splice(r,1),t&&!1===c()&&0===t.playbackRate&&(n=i||1,t&&(t.readyState<=2&&n>0?t.addEventListener("canplay",l):t.playbackRate=n),t.paused||((a=document.createEvent("Event")).initEvent("playing",!0,!1),t.dispatchEvent(a))))}function p(){if(t&&c()&&0===t.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),t.dispatchEvent(e)}}return e={initialize:function(){s.on(g.PLAYBACK_PLAYING,p,this)},setCurrentTime:function(e){if(t){if(t.currentTime==e)return;try{t.currentTime=e}catch(n){0===t.readyState&&n.code===n.INVALID_STATE_ERR&&setTimeout((function(){t.currentTime=e}),400)}}},play:function(){if(t){t.autoplay=!0;var e=t.play();return e&&"undefined"!=typeof Promise&&e instanceof Promise&&e.catch((function(e){"NotAllowedError"===e.name&&s.trigger(g.PLAYBACK_NOT_ALLOWED),o("Caught pending play exception - continuing ("+e+")")})),e}},isPaused:function(){return t?t.paused:null},pause:function(){t&&(t.pause(),t.autoplay=!1)},isSeeking:function(){return t?t.seeking:null},getTime:function(){return t?t.currentTime:null},getPlaybackRate:function(){return t?t.playbackRate:null},getPlayedRanges:function(){return t?t.played:null},getEnded:function(){return t?t.ended:null},setStallState:function(e,n){!function(e,n){n?function(e){var n=void 0;if(null===e||t.seeking||-1!==u.indexOf(e))return;u.push(e),t&&1===u.length&&((n=document.createEvent("Event")).initEvent("waiting",!0,!1),i=t.playbackRate,t.dispatchEvent(n))}(e):f(e)}(e,n)},getElement:function(){return t},setElement:function(e){if(null!=e&&(!e||!e.nodeName||"VIDEO"!==e.nodeName&&"AUDIO"!==e.nodeName&&"BWP-VIDEO"!==e.nodeName))throw"element is not video or audio DOM type!";(t=e)&&(t.preload="auto")},setSource:function(e){t&&(e?t.src=e:(t.removeAttribute("src"),t.load()))},getSource:function(){return t?t.src:null},getVideoContainer:function(){return r},setVideoContainer:function(e){r=e},getTTMLRenderingDiv:function(){return n},setTTMLRenderingDiv:function(e){(n=e).style.position="absolute",n.style.display="flex",n.style.overflow="hidden",n.style.pointerEvents="none",n.style.top=0,n.style.left=0},getPlaybackQuality:function(){if(!t)return null;var e="webkitDroppedFrameCount"in t&&"webkitDecodedFrameCount"in t,n=null;return"getVideoPlaybackQuality"in t?n=t.getVideoPlaybackQuality():e&&(n={droppedVideoFrames:t.webkitDroppedFrameCount,totalVideoFrames:t.webkitDroppedFrameCount+t.webkitDecodedFrameCount,creationTime:new Date
}),n},addEventListener:function(e,n){t&&t.addEventListener(e,n)},removeEventListener:function(e,n){t&&t.removeEventListener(e,n)},getReadyState:function(){return t?t.readyState:NaN},getBufferRange:function(){return t?t.buffered:null},getClientWidth:function(){return t?t.clientWidth:NaN},getClientHeight:function(){return t?t.clientHeight:NaN},getTextTracks:function(){return t?t.textTracks:[]},getTextTrack:function(e,n,r,i,a){if(t)for(var o=0;o<t.textTracks.length;o++)if(t.textTracks[o].kind===e&&(!n||t.textTracks[o].label==n)&&t.textTracks[o].language===r&&t.textTracks[o].isTTML===i&&t.textTracks[o].isEmbedded===a)return t.textTracks[o];return null},addTextTrack:function(e,n,r){return t?t.addTextTrack(e,n,r):null},appendChild:function(e){t&&(t.appendChild(e),void 0!==e.isTTML&&(t.textTracks[t.textTracks.length-1].isTTML=e.isTTML,t.textTracks[t.textTracks.length-1].isEmbedded=e.isEmbedded))},removeChild:function(e){t&&t.removeChild(e)},getVideoWidth:function(){return t?t.videoWidth:NaN},getVideoHeight:function(){return t?t.videoHeight:NaN},getVideoRelativeOffsetTop:function(){return t&&t.parentNode?t.getBoundingClientRect().top-t.parentNode.getBoundingClientRect().top:NaN},getVideoRelativeOffsetLeft:function(){return t&&t.parentNode?t.getBoundingClientRect().left-t.parentNode.getBoundingClientRect().left:NaN},setDataOffsetAttr:function(e){t&&t.setAttribute("data-offset",e)},reset:function(){s.off(g.PLAYBACK_PLAYING,p,this)}},e}Wr.__dashjs_factory_name="VideoModel";var Kr=s.a.getSingletonFactory(Wr),jr=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],zr="dashjs_?_bitrate",Xr="dashjs_?_settings",Zr="localStorage",Jr="LastBitrate",$r="LastMediaSettings";function ei(e){e=e||{};var t,n=this.context,r=T(n).getInstance().log,i=e.mediaPlayerModel,a=void 0;function o(e){if(void 0!==a)return a;a=!1;var t=void 0;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return r("Warning: DOMStorage access denied: "+e.message),a}if(!t||e!==Zr&&"sessionStorage"!==e)return a;try{t.setItem("1","1"),t.removeItem("1"),a=!0}catch(e){r("Warning: DOMStorage is supported, but cannot be used: "+e.message)}return a}function s(){var e=6e5;return Math.round((new Date).getTime()/e)*e}function u(e,t){return o(e)&&i["get"+t+"CachingInfo"]().enabled}function l(){if(!i||!i.hasOwnProperty("getLastMediaSettingsCachingInfo"))throw new Error("Missing config parameter(s)")}return t={getSavedBitrateSettings:function(e){var t=NaN;if(l(),u(Zr,Jr)){var n=zr.replace(/\?/,e);try{var a=JSON.parse(localStorage.getItem(n))||{},o=(new Date).getTime()-parseInt(a.timestamp,10)>=i.getLastMediaSettingsCachingInfo().ttl||!1,s=parseFloat(a.bitrate);isNaN(s)||o?o&&localStorage.removeItem(n):(t=s,r("Last saved bitrate for "+e+" was "+s))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(u(Zr,Jr)&&t){var n=zr.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({bitrate:t.toFixed(3),timestamp:s()}))}catch(e){r(e.message)}}},getSavedMediaSettings:function(e){if(l(),!u(Zr,$r))return null;var t=null,n=Xr.replace(/\?/,e);try{var r=JSON.parse(localStorage.getItem(n))||{},a=(new Date).getTime()-parseInt(r.timestamp,10)>=i.getLastMediaSettingsCachingInfo().ttl||!1;t=r.settings,a&&(localStorage.removeItem(n),t=null)}catch(e){return null}return t},setSavedMediaSettings:function(e,t){if(u(Zr,$r)){var n=Xr.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({settings:t,timestamp:s()}))}catch(e){r(e.message)}}}},o(Zr)&&jr.forEach((function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){r(e.message)}}})),t}ei.__dashjs_factory_name="DOMStorage";var ti=s.a.getSingletonFactory(ei),ni=n(2);var ri=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,
this.mediaInfo=null,this.MSETimeOffset=null};var ii=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null};var ai=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0};var oi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null};var si=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},ui=n(9),li=n.n(ui);function di(){var e,t=void 0,n=void 0,i=void 0;function a(e,t){return t&&e?t.getRepresentationForQuality(e.quality):null}function o(e){return e&&e.streamInfo&&void 0!==e.streamInfo.id&&i[e.streamInfo.id]?i[e.streamInfo.id][e.index]:null}function s(e,t){for(var n=t.length,r=0;r<n;r++){var i=t[r];if(e.id===i.id)return i}return null}function u(e){var n=new ri,r=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],i=t.getRepresentationFor(e.index,r);return n.id=e.id,n.quality=e.index,n.bandwidth=t.getBandwidth(i),n.DVRWindow=e.segmentAvailabilityRange,n.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),n.MSETimeOffset=e.MSETimeOffset,n.useCalculatedLiveEdgeTime=e.useCalculatedLiveEdgeTime,n.mediaInfo=l(e.adaptation),n}function l(e){var n,r=new ii,i=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];return r.id=e.id,r.index=e.index,r.type=e.type,r.streamInfo=c(e.period),r.representationCount=t.getRepresentationCount(i),r.lang=t.getLanguageForAdaptation(i),n=t.getViewpointForAdaptation(i),r.viewpoint=n?n.value:void 0,r.accessibility=t.getAccessibilityForAdaptation(i).map((function(e){var t=e.value,n=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==li.a&&(n=t?"cea-608:"+t:"cea-608",r.embeddedCaptions=!0),n})),r.audioChannelConfiguration=t.getAudioChannelConfigurationForAdaptation(i).map((function(e){return e.value})),r.roles=t.getRolesForAdaptation(i).map((function(e){return e.value})),r.codec=t.getCodec(i),r.mimeType=t.getMimeType(i),r.contentProtection=t.getContentProtectionData(i),r.bitrateList=t.getBitrateListForAdaptation(i),r.contentProtection&&r.contentProtection.forEach((function(e){e.KID=t.getKID(e)})),r.isText=t.getIsTextTrack(r.mimeType),r}function d(e,t,n){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=r.EMBEDDED_TEXT,e.codec="cea-608-in-SEI",e.isText=!0,e.isEmbedded=!0,e.lang=n,e.roles=["caption"]}function c(e){var n,r,i=new ai;return i.id=e.id,i.index=e.index,i.start=e.start,i.duration=e.duration,i.manifestInfo=(n=e.mpd,(r=new oi).DVRWindowSize=n.timeShiftBufferDepth,r.loadedTime=n.manifest.loadedTime,r.availableFrom=n.availabilityStartTime,r.minBufferTime=n.manifest.minBufferTime,r.maxFragmentDuration=n.maxSegmentDuration,r.duration=t.getDuration(n.manifest),r.isDynamic=t.getIsDynamic(n.manifest),r),i.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(i.start+i.duration-i.manifestInfo.duration)<1,i}function f(){if(!t||!t.hasOwnProperty("getMpd")||!t.hasOwnProperty("getRegularPeriods"))throw new Error("setConfig function has to be called previously")}function p(e){
if(!(e&&e.hasOwnProperty("getRepresentationController")&&e.hasOwnProperty("getIndexHandler")&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getType")&&e.hasOwnProperty("getStreamInfo")))throw new Error("streamProcessor parameter is missing or malformed!")}function h(e){if(!e||!e.hasOwnProperty("getRepresentationForQuality")||!e.hasOwnProperty("getCurrentRepresentation"))throw new Error("representationController parameter is missing or malformed!")}function g(e){if(!(null!==e&&!isNaN(e)&&e%1==0))throw new Error("quality argument is not an integer")}function m(){n=[],i={}}return e={convertDataToRepresentationInfo:u,getDataForMedia:o,getStreamsInfo:function(e,r){var i=[],a=n;if(e){f();var o=t.getMpd(e);a=t.getRegularPeriods(o)}r||(r=a.length);for(var s=0;s<r;s++)i.push(c(a[s]));return i},getMediaInfoForType:function(e,r){if(0===n.length)return null;var a=n[0].mpd.manifest,o=t.getAdaptationForType(a,e.index,r,e);if(!o)return null;var u=s(e,n),d=u.id,c=t.getIndexForAdaptation(o,a,e.index);return i[d]=i[d]||t.getAdaptationsForPeriod(u),l(i[d][c])},getAllMediaInfoForType:function(e,a,o){var u,c=n,p=o,h=[],g=void 0,m=void 0,E=void 0,_=void 0,T=void 0;if(p){f();var y=t.getMpd(p);c=t.getRegularPeriods(y)}else{if(!(n.length>0))return h;p=n[0].mpd.manifest}var v=s(e,c),A=v.id,I=t.getAdaptationsForType(p,e.index,a!==r.EMBEDDED_TEXT?a:r.VIDEO);if(!I)return h;for(i[A]=i[A]||t.getAdaptationsForPeriod(v),_=0,u=I.length;_<u;_++)if(g=I[_],E=t.getIndexForAdaptation(g,p,e.index),m=l(i[A][E]),a===r.EMBEDDED_TEXT){var R=m.accessibility.length;for(T=0;T<R;T++)if(m){var S=m.accessibility[T];if(0===S.indexOf("cea-608:")){var N=S.substring(8).split(";");if("CC"===N[0].substring(0,2))for(T=0;T<N.length;T++)m||(m=l.call(this,i[A][E])),d(m,N[T].substring(0,3),N[T].substring(4)),h.push(m),m=null;else for(T=0;T<N.length;T++)m||(m=l.call(this,i[A][E])),d(m,"CC"+(T+1),N[T]),h.push(m),m=null}else 0===S.indexOf("cea-608")&&(d(m,r.CC1,"eng"),h.push(m),m=null)}}else a===r.IMAGE?(m.type=r.IMAGE,h.push(m),m=null):m&&h.push(m);return h},getCurrentRepresentationInfo:function(e){h(e);var t=e.getCurrentRepresentation();return t?u(t):null},getRepresentationInfoForQuality:function(e,t){h(e),g(t);var n=e.getRepresentationForQuality(t);return n?u(n):null},updateData:function(e){p(e);var r,i=s(e.getStreamInfo(),n),a=e.getMediaInfo(),u=o(a),l=e.getType(),d=void 0;r=a?a.id:null,n.length>0&&(d=r?t.getAdaptationForId(r,n[0].mpd.manifest,i.index):t.getAdaptationForIndex(a.index,n[0].mpd.manifest,i.index),e.getRepresentationController().updateData(d,u,l))},getInitRequest:function(e,t){var n,r=void 0,i=void 0;return p(e),g(t),r=e.getRepresentationController(),i=e.getIndexHandler(),n=r?r.getRepresentationForQuality(t):null,i?i.getInitRequest(n):null},getNextFragmentRequest:function(e,t){var n,r=void 0;return p(e),n=a(t,e.getRepresentationController()),(r=e.getIndexHandler())?r.getNextSegmentRequest(n):null},getFragmentRequestForTime:function(e,t,n,r){var i,o=void 0;return p(e),i=a(t,e.getRepresentationController()),(o=e.getIndexHandler())?o.getSegmentRequestForTime(i,n,r):null},generateFragmentRequestForTime:function(e,t,n){var r,i=void 0;return p(e),r=a(t,e.getRepresentationController()),(i=e.getIndexHandler())?i.generateSegmentRequestForTime(r,n):null},getIndexHandlerTime:function(e){p(e);var t=e.getIndexHandler();return t?t.getCurrentTime():NaN},setIndexHandlerTime:function(e,t){p(e);var n=e.getIndexHandler();n&&n.setCurrentTime(t)},getEventsFor:function(e,r){var i=[];if(0===n.length)return i;var u=n[0].mpd.manifest;return e instanceof ai?i=t.getEventsForPeriod(s(e,n)):e instanceof ii?i=t.getEventStreamForAdaptationSet(u,o(e)):e instanceof ri&&(i=t.getEventStreamForRepresentation(u,a(e,r.getRepresentationController()))),i},getEvent:function(e,t,n){if(!e||!t)return null;var r=new si,i=e.scheme_id_uri,a=e.value,o=e.timescale,s=e.presentation_time_delta,u=e.event_duration,l=e.id,d=e.message_data,c=n*o+s;return t[i]?(r.eventStream=t[i],r.eventStream.value=a,r.eventStream.timescale=o,r.duration=u,r.id=l,r.presentationTime=c,r.messageData=d,r.presentationTimeDelta=s,r):null
},setConfig:function(e){e&&e.dashManifestModel&&(t=e.dashManifestModel)},updatePeriods:function(e){if(!e)return null;f();var r=t.getMpd(e);n=t.getRegularPeriods(r),i={}},reset:m},m(),e}di.__dashjs_factory_name="DashAdapter";var ci=s.a.getSingletonFactory(di);var fi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null};var pi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null};pi.DEFAULT_ID="defaultId";var hi=pi;var gi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN};var mi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""};function Ei(e){e=e||{};var t,n=this.context,i=it(n).getInstance(),a=e.mediaController,s=e.timelineConverter,u=e.adapter,l=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function d(e,t){var n=void 0,i=void 0,a=void 0,o=void 0,s=void 0,u=void 0,l=!1,d=!1;if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.hasOwnProperty("ContentComponent_asArray")&&(o=e.ContentComponent_asArray),s=t!==r.TEXT?new RegExp(t):new RegExp("(vtt|ttml)"),e.Representation_asArray&&e.Representation_asArray.length&&e.Representation_asArray.length>0&&e.Representation_asArray[0].hasOwnProperty($e.CODECS)&&(0===(u=e.Representation_asArray[0].codecs).search(r.STPP)||0===u.search(r.WVTT)))return t===r.FRAGMENTED_TEXT;if(o){if(o.length>1)return t===r.MUXED;o[0]&&o[0].contentType===t&&(l=!0,d=!0)}if(e.hasOwnProperty($e.MIME_TYPE)&&(l=s.test(e.mimeType),d=!0),!d)for(n=0,i=e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0;!d&&n<i;)(a=e.Representation_asArray[n]).hasOwnProperty($e.MIME_TYPE)&&(l=s.test(a.mimeType),d=!0),n++;return l}function c(e){return d(e,r.AUDIO)}function f(e){return d(e,r.VIDEO)}function p(e){return d(e,r.FRAGMENTED_TEXT)}function h(e){return d(e,r.MUXED)}function g(e){return d(e,r.IMAGE)}function m(e){return"text/vtt"===e||"application/ttml+xml"===e}function E(e){return e&&e.hasOwnProperty($e.ROLE_ASARRAY)?e.Role_asArray:[]}function _(e){return E(e).filter((function(e){return e.value===$e.MAIN}))[0]}function T(){return function(e,t){return e.bandwidth-t.bandwidth}}function y(e){return e&&void 0!==e.Representation_asArray&&null!==e.Representation_asArray&&e.Representation_asArray.sort((function(e,t){return e.bandwidth-t.bandwidth})),e}function v(e,t,n){var r,i=e&&e.Period_asArray&&l(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[],a=void 0,o=[];for(a=0,r=i.length;a<r;a++)d(i[a],n)&&o.push(y(i[a]));return o}function A(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===$e.DYNAMIC),t}function I(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}})):null}function R(e){if(e&&e.period&&l(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&l(e.index))return y(t.AdaptationSet_asArray[e.index])}}function S(e){var t=e.S_asArray[e.S_asArray.length-1];return!t.hasOwnProperty("r")||t.r>=0}function N(e,t){if(!e)throw new Error("Period cannot be null or undefined");var n=hi.DEFAULT_ID+"_"+t;return e.hasOwnProperty($e.ID)&&e.id.length>0&&"__proto__"!==e.id&&(n=e.id),n}function D(e,t){var n=[],i=void 0;if(!e)return n
;for(i=0;i<e.length;i++){var a=new mi;if(a.timescale=1,a.representation=t,!e[i].hasOwnProperty(r.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");a.schemeIdUri=e[i].schemeIdUri,e[i].hasOwnProperty($e.TIMESCALE)&&(a.timescale=e[i].timescale),e[i].hasOwnProperty($e.VALUE)&&(a.value=e[i].value),n.push(a)}return n}function O(e){var t=[],n=e.BaseURL_asArray||[e.baseUri],r=!1;return n.some((function(n){if(n){var a=new xn,o=n.__text||n;i.isRelative(o)&&(r=!0,e.baseUri&&(o=i.resolve(o,e.baseUri))),a.url=o;for(var s=[],u=1;n["backupUrl"+u];u++)s.push(n["backupUrl"+u]);return a.urls=[a.url].concat(s),n.hasOwnProperty($e.SERVICE_LOCATION)&&n.serviceLocation.length?a.serviceLocation=n.serviceLocation:a.serviceLocation=o,n.hasOwnProperty($e.DVB_PRIORITY)&&(a.dvb_priority=n[$e.DVB_PRIORITY]),n.hasOwnProperty($e.DVB_WEIGHT)&&(a.dvb_weight=n[$e.DVB_WEIGHT]),n.hasOwnProperty($e.AVAILABILITY_TIME_OFFSET)&&(a.availabilityTimeOffset=n[$e.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty($e.AVAILABILITY_TIME_COMPLETE)&&(a.availabilityTimeComplete="false"!==n[$e.AVAILABILITY_TIME_COMPLETE]),t.push(a),r}})),t}return t={getIsTypeOf:d,getIsAudio:c,getIsVideo:f,getIsText:function(e){return d(e,r.TEXT)},getIsMuxed:h,getIsTextTrack:m,getIsFragmentedText:p,getIsImage:g,getIsMain:_,getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty($e.LANG)&&(t=e.lang.replace(/[^A-Za-z0-9-]/g,"")),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty($e.VIEWPOINT)?e.Viewpoint:null},getRolesForAdaptation:E,getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty($e.ACCESSIBILITY_ASARRAY)?e.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty($e.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAdaptationForIndex:function(e,t,n){var r=t&&t.Period_asArray&&l(n)&&t.Period_asArray[n]?t.Period_asArray[n].AdaptationSet_asArray:null;return r&&l(e)?r[e]:null},getIndexForAdaptation:function(e,t,r){var i=t&&t.Period_asArray&&l(r)&&t.Period_asArray[r]?t.Period_asArray[r].AdaptationSet_asArray:[],a=i.length;if(e)for(var o=0;o<a;o++){if(An(n).getInstance().areEqual(i[o],e))return o}return-1},getAdaptationForId:function(e,t,n){var r,i=t&&t.Period_asArray&&l(n)&&t.Period_asArray[n]?t.Period_asArray[n].AdaptationSet_asArray:[],a=void 0;for(a=0,r=i.length;a<r;a++)if(i[a].hasOwnProperty($e.ID)&&i[a].id===e)return i[a];return null},getAdaptationsForType:v,getAdaptationForType:function(e,t,n,r){var i=v(e,t,n);if(!i||0===i.length)return null;if(i.length>1&&r){var o=a.getCurrentTrackFor(n,r),s=u.getAllMediaInfoForType(r,n);if(o)for(var l=0,d=i.length;l<d;l++)if(a.isTracksEqual(o,s[l]))return i[l];for(var c=0,f=i.length;c<f;c++)if(_(i[c]))return i[c]}return i[0]},getCodec:function(e,t,n){if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var r=l(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0],i=r.mimeType+';codecs="'+r.codecs+'"';return n&&void 0!==r.width&&(i+=';width="'+r.width+'";height="'+r.height+'"'),i}return null},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty($e.CENC_DEFAULT_KID)?e[$e.CENC_DEFAULT_KID]:null},getContentProtectionData:function(e){return e&&e.hasOwnProperty($e.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:A,getIsDVB:function(e){return function(e,t){var n=!1;return e&&e.profiles&&e.profiles.length>0&&(n=-1!==e.profiles.indexOf(t)),n}(e,"urn:dvb:dash:profile:dvb-dash:2014")},getDuration:function(e){return e&&e.hasOwnProperty($e.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=NaN
;return e&&e.hasOwnProperty($e.MINIMUM_UPDATE_PERIOD)&&(n=e.minimumUpdatePeriod),isNaN(n)?n:Math.max(n-t,1)},getRepresentationCount:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length?y(e).Representation_asArray.map((function(e){return{id:e.id||"",bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null}})):null},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&l(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t=[],n=R(e),r=void 0,i=void 0;if(e&&e.period&&l(e.period.index)){var a=O(e.period.mpd.manifest);a&&(i=a[0])}if(n&&n.Representation_asArray)for(var o=0,u=n.Representation_asArray.length;o<u;++o){var d=n.Representation_asArray[o],c=new et;if(c.index=o,c.adaptation=e,d.hasOwnProperty($e.ID)&&(c.id=d.id),d.hasOwnProperty($e.CODECS)&&(c.codecs=d.codecs),d.hasOwnProperty($e.CODEC_PRIVATE_DATA)&&(c.codecPrivateData=d.codecPrivateData),d.hasOwnProperty($e.BANDWITH)&&(c.bandwidth=d.bandwidth),d.hasOwnProperty($e.WIDTH)&&(c.width=d.width),d.hasOwnProperty($e.HEIGHT)&&(c.height=d.height),d.hasOwnProperty($e.SCAN_TYPE)&&(c.scanType=d.scanType),d.hasOwnProperty($e.MAX_PLAYOUT_RATE)&&(c.maxPlayoutRate=d.maxPlayoutRate),d.hasOwnProperty($e.SEGMENT_BASE)?(r=d.SegmentBase,c.segmentInfoType=$e.SEGMENT_BASE):d.hasOwnProperty($e.SEGMENT_LIST)?(r=d.SegmentList).hasOwnProperty($e.SEGMENT_TIMELINE)?(c.segmentInfoType=$e.SEGMENT_TIMELINE,c.useCalculatedLiveEdgeTime=S(r.SegmentTimeline)):(c.segmentInfoType=$e.SEGMENT_LIST,c.useCalculatedLiveEdgeTime=!0):d.hasOwnProperty($e.SEGMENT_TEMPLATE)?((r=d.SegmentTemplate).hasOwnProperty($e.SEGMENT_TIMELINE)?(c.segmentInfoType=$e.SEGMENT_TIMELINE,c.useCalculatedLiveEdgeTime=S(r.SegmentTimeline)):c.segmentInfoType=$e.SEGMENT_TEMPLATE,r.hasOwnProperty($e.INITIALIZATION_MINUS)&&(c.initialization=r.initialization.split("$Bandwidth$").join(d.bandwidth).split("$RepresentationID$").join(d.id))):c.segmentInfoType=$e.BASE_URL,c.essentialProperties=I(d),r){if(r.hasOwnProperty($e.INITIALIZATION)){var f=r.Initialization;f.hasOwnProperty($e.SOURCE_URL)?c.initialization=f.sourceURL:f.hasOwnProperty($e.RANGE)&&(c.range=f.range)}else d.hasOwnProperty($e.MIME_TYPE)&&m(d.mimeType)&&(c.range=0);r.hasOwnProperty($e.TIMESCALE)&&(c.timescale=r.timescale),r.hasOwnProperty($e.DURATION)&&(c.segmentDuration=r.duration/c.timescale),r.hasOwnProperty($e.MEDIA)&&(c.media=r.media),r.hasOwnProperty($e.START_NUMBER)&&(c.startNumber=r.startNumber),r.hasOwnProperty($e.INDEX_RANGE)&&(c.indexRange=r.indexRange),r.hasOwnProperty($e.PRESENTATION_TIME_OFFSET)&&(c.presentationTimeOffset=r.presentationTimeOffset/c.timescale),r.hasOwnProperty($e.AVAILABILITY_TIME_OFFSET)?c.availabilityTimeOffset=r.availabilityTimeOffset:i&&void 0!==i.availabilityTimeOffset&&(c.availabilityTimeOffset=i.availabilityTimeOffset),r.hasOwnProperty($e.AVAILABILITY_TIME_COMPLETE)?c.availabilityTimeComplete="false"!==r.availabilityTimeComplete:i&&void 0!==i.availabilityTimeComplete&&(c.availabilityTimeComplete=i.availabilityTimeComplete)}c.MSETimeOffset=s.calcMSETimeOffset(c),c.path=[e.period.index,e.index,o],t.push(c)}return t},getAdaptationsForPeriod:function(e){var t=e&&l(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,n=[],i=void 0,a=void 0,o=void 0;if(t&&t.AdaptationSet_asArray)for(o=0;o<t.AdaptationSet_asArray.length;o++)a=t.AdaptationSet_asArray[o],i=new fi,a.hasOwnProperty($e.ID)&&(i.id=a.id),i.index=o,i.period=e,h(a)?i.type=r.MUXED:c(a)?i.type=r.AUDIO:f(a)?i.type=r.VIDEO:p(a)?i.type=r.FRAGMENTED_TEXT:g(a)?i.type=r.IMAGE:i.type=r.TEXT,n.push(i);return n},getRegularPeriods:function(e){var t,n=!!e&&A(e.manifest),r=[],i=null,a=null,o=null,s=null,u=void 0;for(u=0,
t=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;u<t;u++)(a=e.manifest.Period_asArray[u]).hasOwnProperty($e.START)?(s=new hi).start=a.start:null!==i&&a.hasOwnProperty($e.DURATION)&&null!==o?((s=new hi).start=parseFloat((o.start+o.duration).toFixed(5)),s.duration=a.duration):0!==u||n||((s=new hi).start=0),null!==o&&isNaN(o.duration)&&(o.duration=parseFloat((s.start-o.start).toFixed(5))),null!==s&&(s.id=N(a,u)),null!==s&&a.hasOwnProperty($e.DURATION)&&(s.duration=a.duration),null!==s&&(s.index=u,s.mpd=e,r.push(s),i=a,o=s),a=null,s=null;return 0===r.length||null!==o&&isNaN(o.duration)&&(o.duration=parseFloat((function(e){var t=A(e.mpd.manifest),n=void 0;if(e.mpd.manifest.mediaPresentationDuration)n=e.mpd.manifest.mediaPresentationDuration;else if(e.duration)n=e.duration;else{if(!t)throw new Error("Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.");n=Number.POSITIVE_INFINITY}return n}(o)-o.start).toFixed(5))),r},getMpd:function(e){var t=new gi;return e&&(t.manifest=e,e.hasOwnProperty($e.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):t.availabilityStartTime=new Date(e.loadedTime.getTime()),e.hasOwnProperty($e.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty($e.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty($e.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(r.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty($e.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty($e.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration)),t},getEventsForPeriod:function(e){var t=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,n=t?t.Period_asArray:null,i=n&&e&&l(e.index)?n[e.index].EventStream_asArray:null,a=[],o=void 0,s=void 0;if(i)for(o=0;o<i.length;o++){var u=new mi;if(u.period=e,u.timescale=1,!i[o].hasOwnProperty(r.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(u.schemeIdUri=i[o].schemeIdUri,i[o].hasOwnProperty($e.TIMESCALE)&&(u.timescale=i[o].timescale),i[o].hasOwnProperty($e.VALUE)&&(u.value=i[o].value),s=0;s<i[o].Event_asArray.length;s++){var d=new si;d.presentationTime=0,d.eventStream=u,i[o].Event_asArray[s].hasOwnProperty($e.PRESENTATION_TIME)&&(d.presentationTime=i[o].Event_asArray[s].presentationTime),i[o].Event_asArray[s].hasOwnProperty($e.DURATION)&&(d.duration=i[o].Event_asArray[s].duration),i[o].Event_asArray[s].hasOwnProperty($e.ID)&&(d.id=i[o].Event_asArray[s].id),a.push(d)}}return a},getEventStreamForAdaptationSet:function(e,t){var n=void 0,r=void 0,i=void 0;return e&&e.Period_asArray&&t&&t.period&&l(t.period.index)&&(r=e.Period_asArray[t.period.index])&&r.AdaptationSet_asArray&&l(t.index)&&(i=r.AdaptationSet_asArray[t.index])&&(n=i.InbandEventStream_asArray),D(n,null)},getEventStreamForRepresentation:function(e,t){var n=void 0,r=void 0,i=void 0,a=void 0;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&l(t.adaptation.period.index)&&(r=e.Period_asArray[t.adaptation.period.index])&&r.AdaptationSet_asArray&&l(t.adaptation.index)&&(i=r.AdaptationSet_asArray[t.adaptation.index])&&i.Representation_asArray&&l(t.index)&&(a=i.Representation_asArray[t.index])&&(n=a.InbandEventStream_asArray),D(n,t)},getUTCTimingSources:function(e){var t=A(e),n=!!e&&e.hasOwnProperty($e.AVAILABILITY_START_TIME),i=e?e.UTCTiming_asArray:null,a=[];return(t||n)&&i&&i.forEach((function(e){var t=new o;e.hasOwnProperty(r.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty($e.VALUE)&&(t.value=e.value.toString(),a.push(t)))})),a},getBaseURLsFromElement:O,getRepresentationSortFunction:T,getLocation:function(e){if(e&&e.hasOwnProperty(r.LOCATION))return e.Location=e.Location_asArray[0],e.Location},getUseCalculatedLiveEdgeTimeForAdaptation:function(e){var t=R(e).Representation_asArray[0],n=void 0
;return t.hasOwnProperty($e.SEGMENT_LIST)?!(n=t.SegmentList).hasOwnProperty($e.SEGMENT_TIMELINE)||S(n.SegmentTimeline):!(!t.hasOwnProperty($e.SEGMENT_TEMPLATE)||!(n=t.SegmentTemplate).hasOwnProperty($e.SEGMENT_TIMELINE))&&S(n.SegmentTimeline)}},t}Ei.__dashjs_factory_name="DashManifestModel";var _i=s.a.getSingletonFactory(Ei);var Ti=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.round10=function(e,t){return function(e,t,n){if(void 0===n||0==+n)return Math[e](t);if(n=+n,null===(t=+t)||isNaN(t)||!("number"==typeof n&&n%1==0))return NaN;return t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+n:n))}("round",e,t)},e}();function yi(e){var t=(e=e||{}).dashManifestModel,n=e.manifestModel;function r(e){return s(e,i.BUFFER_LEVEL)}function a(e){if(!e)return null;var t=e.HttpList,n=null,r=void 0;if(!t||t.length<=0)return null;for(r=t.length-1;r>=0;){if(t[r].responsecode){n=t[r];break}r--}return n}function o(e){return e&&e.HttpList?e.HttpList:[]}function s(e,t){if(!e)return null;var n=e[t];if(!n)return null;var r=n.length;return r<=0?null:n[r-1]}function u(e){var t={};if(!e)return t;for(var n=e.trim().split("\r\n"),r=0,i=n.length;r<i;r++){var a=n[r],o=a.indexOf(": ");o>0&&(t[a.substring(0,o)]=a.substring(o+2))}return t}function l(e,t,n){var r=void 0,i=void 0,a=void 0,o=void 0,s=void 0;if(e)for(r=e.AdaptationSet_asArray,o=0;o<r.length;o+=1)for(a=r[o].Representation_asArray,s=0;s<a.length;s+=1)if(t===(i=a[s]).id)return n?s:i;return null}function d(e,n){return t.getIsTypeOf(e,n)}return{getBandwidthForRepresentation:function(e,t){var r;return null===(r=l(n.getValue().Period_asArray[t],e))?null:r.bandwidth},getIndexForRepresentation:function(e,t){var r;return r=function(e,t){var n=l(e,t,!0);if(null!==n)return n;return-1}(n.getValue().Period_asArray[t],e),r},getMaxIndexForBufferType:function(e,t){var r,i=n.getValue();return i?(r=function(e,t){var n=void 0,r=void 0,i=void 0,a=void 0;if(!e||!t)return-1;for(r=e.AdaptationSet_asArray,a=0;a<r.length;a+=1)if(i=(n=r[a]).Representation_asArray,d(n,t))return i.length;return-1}(i.Period_asArray[t],e),r):-1},getCurrentRepresentationSwitch:function(e){return s(e,i.TRACK_SWITCH)},getLatestBufferLevelVO:r,getCurrentBufferLevel:function(e){var t=r(e);return t?Ti.round10(t.level/1e3,-3):0},getCurrentHttpRequest:a,getHttpRequests:o,getCurrentDroppedFrames:function(e){return s(e,i.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return s(e,i.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return s(e,i.DVR_INFO)},getCurrentManifestUpdate:function(e){return s(e,i.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){var n={},r=a(e);return r&&(n=u(r._responseHeaders)),void 0===n[t]?null:n[t]},getLatestMPDRequestHeaderValueByID:function(e,t){var n,r={},i=void 0,a=void 0;for(a=(n=o(e)).length-1;a>=0;a--)if((i=n[a]).type===k.MPD_TYPE){r=u(i._responseHeaders);break}return void 0===r[t]?null:r[t]},getRequestsQueue:function(e){return e?e.RequestsQueue:null}}}yi.__dashjs_factory_name="DashMetrics";var vi=s.a.getSingletonFactory(yi);function Ai(){var e=this.context,t=d(e).getInstance(),n=void 0,r=void 0,i=void 0;function a(e){n=e}function o(e,t,r,i){return i?r&&t.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(t.availabilityStartTime.getTime()+1e3*(e+t.timeShiftBufferDepth)):t.availabilityEndTime:r?new Date(t.availabilityStartTime.getTime()+1e3*(e-n)):t.availabilityStartTime}function s(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*n)/1e3}function u(e){r||void 0!==e.offset&&(a(e.offset/1e3),r=!0)}function l(){n=0,r=!1,i=NaN}return{initialize:function(){l(),t.on(g.TIME_SYNCHRONIZATION_COMPLETED,u,this)},isTimeSyncCompleted:function(){return r},setTimeSyncCompleted:function(e){r=e},getClientTimeOffset:function(){return n},setClientTimeOffset:a,getExpectedLiveEdge:function(){return i},setExpectedLiveEdge:function(e){i=e},calcAvailabilityStartTimeFromPresentationTime:function(e,t,n){return o.call(this,e,t,n)},
calcAvailabilityEndTimeFromPresentationTime:function(e,t,n){return o.call(this,e,t,n,!0)},calcPresentationTimeFromWallTime:s,calcPresentationTimeFromMediaTime:function(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)},calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcSegmentAvailabilityRange:function(e,t){var n=e.adaptation.period,i={start:n.start,end:n.start+n.duration};if(!t)return i;if(!r&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;var a=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0),o=s(new Date,n),u=n.start+n.duration;i.start=Math.max(o-n.mpd.timeShiftBufferDepth,n.start);var l=void 0!==e.availabilityTimeOffset&&e.availabilityTimeOffset<a?a-e.availabilityTimeOffset:a;return i.end=o>=u&&o-l<u?u:o-l,i},calcWallTimeForSegment:function(e,t){var n=void 0,r=void 0,i=void 0;return t&&(n=e.representation.adaptation.period.mpd.suggestedPresentationDelay,r=e.presentationStartTime+n,i=new Date(e.availabilityStartTime.getTime()+1e3*r)),i},calcMSETimeOffset:function(e){var t=e.presentationTimeOffset;return e.adaptation.period.start-t},reset:function(){t.off(g.TIME_SYNCHRONIZATION_COMPLETED,u,this),l()}}}Ai.__dashjs_factory_name="TimelineConverter";var Ii=s.a.getSingletonFactory(Ai),Ri=n(6),Si=n.n(Ri);function Ni(){var e="You must first call initialize() and set a source before calling this method",t="You must first call initialize() and set a valid source and view before calling this method",n="You must first call attachView() to set the video element before calling this method",u="You must first call attachSource() with a valid source before calling this method",l="MediaPlayer not initialized!",c=this.context,f=d(c).getInstance(),p=T(c).getInstance(),h=p.log,m=NaN,E=void 0,_=void 0,y=void 0,v=void 0,A=void 0,I=void 0,R=void 0,S=void 0,N=void 0,D=void 0,O=void 0,C=void 0,M=void 0,P=void 0,L=void 0,b=void 0,w=void 0,F=void 0,x=void 0,U=void 0,B=void 0,G=void 0,H=void 0,V=void 0,Y=void 0,q=void 0,Q=void 0,W=void 0,K=void 0,j=void 0,z=void 0,X=void 0,Z=void 0,J=void 0,$={video:{},audio:{}},ee={min:0,video:0,audio:0},te=null,ne={};function re(){return!!_&&!!V.getElement()}function ie(){return Object(ni.a)()}function ae(){if(!I)throw t;return U.isPaused()}function oe(e){var t=[r.VIDEO,r.AUDIO,r.FRAGMENTED_TEXT];if(e){if(-1!==t.indexOf(e)){var n=ge().getCurrentBufferLevel(me(e));return n||NaN}return h("Warning  - getBufferLength requested for invalid type"),NaN}var i=t.map((function(e){return ye(e).length>0?ge().getCurrentBufferLevel(me(e)):Number.MAX_VALUE})).reduce((function(e,t){return Math.min(e,t)}));return i===Number.MAX_VALUE?NaN:i}function se(e){var t=Ne(),n=U.getLiveDelay();if(!t)return 0;var r=t.range.start+e;return r>t.range.end-n&&(r=t.range.end-n),r}function ue(e,n){if(!I)throw t;var r=_e().currentTime;if(void 0!==e)r=x.getTimeRelativeToStreamId(r,e);else if(U.getIsDynamic()){var i=Ne();r=null===i?0:de()-(i.range.end-i.time)}var a=b.getCachedDurationOffset("time");return n&&r-a>0&&(r-=a,r=Math.min(r,de(void 0))),r=parseFloat(r.toFixed(5))}function de(e){if(!I)throw t;var n=_e().duration;if(U.getIsDynamic()){var r,i=Ne();if(!i)return 0;n=(r=i.range.end-i.range.start)<i.manifestInfo.DVRWindowSize?r:i.manifestInfo.DVRWindowSize}if(e){var a=_e().currentTime,o=b.getCachedDurationOffset("time"),s=b.getCachedDurationOffset("offset");o?a>o&&(n=a<s?s-o:n-s):n=s?Math.min(n,s):n,n=parseFloat(n.toFixed(5))}return n}function ce(e){R=e}function fe(e,t){pe(e,t);var n=new o;n.schemeIdUri=e,n.value=t,b.getUTCTimingSources().push(n)}function pe(e,t){var n=b.getUTCTimingSources();n.forEach((function(r,i){r.schemeIdUri===e&&r.value===t&&n.splice(i,1)}))}function he(){fe(hn.DEFAULT_UTC_TIMING_SOURCE.scheme,hn.DEFAULT_UTC_TIMING_SOURCE.value)}function ge(){return B}function me(e){return L.getReadOnlyMetricsFor(e)}function _e(){if(!V.getElement())throw n;return V.getElement()}function Te(e){if(!v)throw l
;V.setElement(e),e&&(Se(),function(){if(C)return;var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(c).create();C=t.createMetricsReporting({log:h,eventBus:f,mediaElement:_e(),dashManifestModel:G,metricsModel:L,events:g,constants:r,metricsConstants:i})}}(),function(){if(M)return;var e=dashjs.MssHandler;"function"==typeof e&&(M=e(c).create({eventBus:f,mediaPlayerModel:b,metricsModel:L,playbackController:U,protectionController:O,errHandler:w,events:g,constants:r,log:h,initSegmentType:k.INIT_SEGMENT_TYPE,BASE64:Si.a,ISOBoxer:Ae.a}))}(),x&&x.switchToVideoElement()),I&&Ie(),Ce()}function ye(t){if(!A)throw e;var n=x.getActiveStreamInfo();return n?D.getTracksFor(t,n):[]}function ve(e){if(!v)throw l;"string"==typeof e&&Ge(c).getInstance().initialize(e),$.video={},$.audio={},_=e,(A||I)&&Ie(),re()&&Ce()}function Ie(){I=!1,A=!1,P.reset(),x.reset(),U.reset(),S.reset(),D.reset(),O&&(O.reset(),O=null,Se())}function Re(){return Nr(c).create({errHandler:w,videoModel:V,metricsModel:L,mediaPlayerModel:b,requestModifier:At(c).getInstance(),mssHandler:M})}function Se(){if(O)return O;var e=dashjs.Protection;if("function"==typeof e){var t=e(c).create();return g.extend(e.events),gn.extend(e.events,{publicOnly:!0}),F||(F=Or(c).getInstance()),O=t.createProtectionSystem({log:h,errHandler:w,videoModel:V,capabilities:F,eventBus:f,events:g,BASE64:Si.a,constants:r})}return null}function Ne(){var e=L.getReadOnlyMetricsFor(r.VIDEO)||L.getReadOnlyMetricsFor(r.AUDIO);return B.getCurrentDVRInfo(e)}function De(e){var t=Ne();return t?e+(t.manifestInfo.availableFrom.getTime()/1e3+t.range.start):0}function Oe(){if(!A)throw e;var t=x.getActiveStreamInfo();return t?x.getStreamById(t.id):null}function Ce(){var e;!A&&_&&(A=!0,h("Streaming Initialized"),e=Re(),x||(x=Vn(c).getInstance()),D.setConfig({errHandler:w,domStorage:Y}),x.setConfig({capabilities:F,manifestLoader:e,manifestModel:H,dashManifestModel:G,mediaPlayerModel:b,protectionController:O,adapter:P,metricsModel:L,dashMetrics:B,errHandler:w,timelineConverter:N,videoModel:V,playbackController:U,domStorage:Y,abrController:S,mediaController:D}),U.setConfig({streamController:x,metricsModel:L,dashMetrics:B,manifestModel:H,mediaPlayerModel:b,dashManifestModel:G,adapter:P,videoModel:V}),S.setConfig({streamController:x,domStorage:Y,mediaPlayerModel:b,metricsModel:L,dashMetrics:B,dashManifestModel:G,manifestModel:H,videoModel:V,adapter:P,initializeDate:we()}),S.createAbrRulesCollection(),x.initialize(R,y),_.video||_.audio||"string"==typeof _?x.load(_,q):x.loadWithManifest(_,q)),!I&&re()&&(I=!0,h("Playback Initialized"))}function Me(e){var t=b.getCachedDurationOffset("offset");t&&e.time>=t&&X&&(b.setCachedDurationOffset("time",t),X=!1,V.setDataOffsetAttr(t),f.trigger(g.APPENDED_NEXT_SOURCE_DURATION_CHANGED,{offset:t,totalTime:e.time,totalDuration:de(),time:ue(void 0,!0),duration:ee.min||de(!0)}))}function Pe(e){try{if(e&&e.mediaType&&e.segments){var t=e.mediaType,n=$[t],r=e.segments,i=e.representation&&e.representation.index,a=!0,o=[],s={},u=0,l=0;if(n.total&&n.total===r.length&&(n.segments.forEach((function(e,t){e.duration&&e.duration!==r[t].duration&&t<n.total-1&&(Math.ceil(1e3*Math.abs(e.duration/e.timescale-r[t].duration/r[t].timescale))>100&&o.push(t))})),o.length)){a=!1,s={old:n.qualityIndex,new:i};var d=V.getTime(),c=Math.floor(d/5);-1===o.indexOf(c)&&-1===o.indexOf(c+1)&&-1===o.indexOf(c+2)&&(a=!0)}var f=0,p=e.segments&&e.segments[e.segments.length-1];p&&(f=(p.duration+p.startTime)/p.timescale,ee[t]=f,(!ee.min||ee.min>0&&ee.min>f)&&(ee.min=f));var h=0;r&&r.length&&(h=r[0].startTime/r[0].timescale,D.setStartOffsetTimeForType(t,h),u=parseInt(r[0].mediaRange.split("-")[0],10),l=parseInt(r[r.length-1].mediaRange.split("-")[1],10),Z=Math.max(Z,h)),ee.min===f&&b.getCachedDurationOffset("duration")&&h>0&&(ee.min-=h),b.setCachedDurationOffset("duration",ee.min+W);var g={total:r&&r.length,segments:r,isDurationAllEqual:a,qualityIndex:i,realDuration:f,startOffsetTime:h,rangeStart:u,rangeEnd:l};a||(g.notEqualIndexList=o,g.notEqualQualityIndex=s),$[e.mediaType]=g,"function"==typeof te&&te(t,g)}}catch(e){
throw new Error("Parse segment loaded error, "+e)}}function Le(){K=!0;var e=V.getBufferRange(),t=V.getElement().duration,n=e&&e.length&&e.end(e.length-1),r=V.getTime(),i=[t,n,r+oe("video"),r+oe("audio")],a=i.filter((function(e){return!isNaN(e)})),o=a.reduce((function(e,t){return e+t}))/a.length,s=Math.min.apply(null,a);if(h("onStreamBufferingCompleted",W,i,b.getAppendingSourceState(),j),Math.abs(s-o)<1&&(W=parseFloat(s.toFixed(5)),j.length)){var u=j.splice(0,1)[0];h("Appending delay next source",u),Fe(u.manifest,u.preloadData)}}function be(e){if(U.getEnded()&&b.getAppendingSourceState()){var t=e.sender.getType();if(ne[t]=e.bufferLevel,ne.audio>0&&ne.video>0){var n=V.getBufferRange(),r=n&&n.length&&n.end(n.length-1),i=U.getTime();r>i+.01&&(console.log("Playing next appending source after prev playback ended.",ne),U.seek(i+.01),U.play())}}if(b.getAppendingSourceState()&&z){for(var a=b.getCachedDurationOffset("offset"),o=V.getBufferRange(),s=U.getTime(),u=0,l=0;l<o.length;l++)o.start(l)<s&&o.end(l)>=s&&(u=o.end(l));a>0&&u>a+1&&(b.setAppendingSourceState(!1),h("Appended Next Source, currentTime: "+s+" , buffered end: "+u),z=!1,f.trigger(g.APPENDED_NEXT_SOURCE,{time:s,ended:u}))}if(!J){var d=V.getBufferRange(),c=U.getTime(),p=d&&d.length&&d.start(0);d&&d.length&&p>=Z&&(J=!0,c<p&&(f.trigger(g.START_OFFSET_TIME_WARNING,{time:p}),U.seek(p+.2)))}}function we(){return m}function Fe(e,t){if(h("Append Next Source",V.getTime(),V.isSeeking()),!v)throw l;if("string"==typeof e&&Ge(c).getInstance().initialize(e),V.isSeeking()){f.on(g.PLAYBACK_SEEKED,(function t(){h("Seeked to append next source"),f.off(g.PLAYBACK_SEEKED,t),Fe(e)}))}else{if(!K)return h("Stream buffering is not completed, delay to append!"),void(j=[{manifest:e,preloadData:t}]);b.setAppendingSourceState(!0),b.setCachedDurationOffset("offset",W),f.trigger(g.APPENDING_NEXT_SOURCE,{manifest:e,time:U.getTime(),offset:W}),z=!0,X=!0,K=!1,$.video={},$.audio={},_=e,ee.min=0,ee.video=0,ee.audio=0,x.load(e,!0,!0)}}return E={initialize:function(e,t,n,r,i){i=i,q=!!r,m=new Date,delete window.__DASH_P2P_TYPE__,F||(F=Or(c).getInstance()),w=bt(c).getInstance(),F.supportsMediaSource()?v||(v=!0,N=Ii(c).getInstance(),S||(S=le(c).getInstance()),U||(U=He(c).getInstance()),D||(D=Ee(c).getInstance()),P=ci(c).getInstance(),G=_i(c).getInstance({mediaController:D,timelineConverter:N,adapter:P}),H=Mr(c).getInstance(),B=vi(c).getInstance({manifestModel:H,dashManifestModel:G}),L=Qr(c).getInstance(),Y=ti(c).getInstance({mediaPlayerModel:b}),P.setConfig({dashManifestModel:G,mediaPlayerModel:b}),L.setConfig({adapter:P}),he(),ce(void 0===n||n),e&&Te(e),t&&ve(t),f.trigger(g.INIT_HID,{hid:i}),h("[dash.js "+ie()+"] MediaPlayer has been initialized")):w.capabilityError("mediasource")},setConfig:function(e){e&&(e.capabilities&&(F=e.capabilities),e.streamController&&(x=e.streamController),e.playbackController&&(U=e.playbackController),e.mediaPlayerModel&&(b=e.mediaPlayerModel),e.abrController&&(S=e.abrController),e.mediaController&&(D=e.mediaController))},on:function(e,t,n){f.on(e,t,n)},off:function(e,t,n){f.off(e,t,n)},extend:function(e,t,n){s.a.extend(e,t,n,c)},attachView:Te,attachSource:ve,isReady:re,preload:function(){if(V.getElement()||A)return!1;if(!_)throw u;Ce()},play:function(){if(!I)throw t;if(!R||ae()&&I)return U.play()},isPaused:ae,pause:function(){if(!I)throw t;U.pause()},isSeeking:function(){if(!I)throw t;return U.isSeeking()},isDynamic:function(){if(!I)throw t;return U.getIsDynamic()},seek:function(e,n){if(!I)throw t;if("number"!=typeof e||isNaN(e))throw"MediaPlayer Invalid Arguments!";var r=U.getIsDynamic()?se(e):e;n&&(r+=b.getCachedDurationOffset("time")),U.seek(r)},setPlaybackRate:function(e){if(!V.getElement())throw n;_e().playbackRate=e},getPlaybackRate:function(){if(!V.getElement())throw n;return _e().playbackRate},setMute:function(e){if(!V.getElement())throw n;_e().muted=e},isMuted:function(){if(!V.getElement())throw n;return _e().muted},setVolume:function(e){if(!V.getElement())throw n;_e().volume=e},getVolume:function(){if(!V.getElement())throw n;return _e().volume},time:ue,duration:de,
timeAsUTC:function(){if(!I)throw t;return ue()<0?NaN:De(ue())},durationAsUTC:function(){if(!I)throw t;return De(de())},getActiveStream:Oe,getDVRWindowSize:function(){var e=Ne();return e?e.manifestInfo.DVRWindowSize:0},getDVRSeekOffset:se,convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(n<10?"0"+n.toString():n.toString())+":"+(r<10?"0"+r.toString():r.toString())},formatUTC:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=new Date(1e3*e),a=i.toLocaleDateString(t),o=i.toLocaleTimeString(t,{hour12:n});return r?o+" "+a:o},getVersion:ie,getDebug:function(){return p},getBufferLength:oe,getVideoContainer:function(){return V?V.getVideoContainer():null},getTTMLRenderingDiv:function(){return V?V.getTTMLRenderingDiv():null},getVideoElement:_e,getSource:function(){if(!_)throw u;return _},setLiveDelayFragmentCount:function(e){b.setLiveDelayFragmentCount(e)},setLiveDelay:function(e){b.setLiveDelay(e)},getLiveDelay:function(){return b.getLiveDelay()},getCurrentLiveLatency:function(){if(!v)throw l;return I?U.getCurrentLiveLatency():NaN},useSuggestedPresentationDelay:function(e){b.setUseSuggestedPresentationDelay(e)},enableLastBitrateCaching:function(e,t){b.setLastBitrateCachingInfo(e,t)},enableLastMediaSettingsCaching:function(e,t){b.setLastMediaSettingsCachingInfo(e,t)},setMaxAllowedBitrateFor:function(e,t){S.setMaxAllowedBitrateFor(e,t)},getMaxAllowedBitrateFor:function(e){return S.getMaxAllowedBitrateFor(e)},getTopBitrateInfoFor:function(t){if(!A)throw e;return S.getTopBitrateInfoFor(t)},setMinAllowedBitrateFor:function(e,t){S.setMinAllowedBitrateFor(e,t)},getMinAllowedBitrateFor:function(e){return S.getMinAllowedBitrateFor(e)},setMaxAllowedRepresentationRatioFor:function(e,t){S.setMaxAllowedRepresentationRatioFor(e,t)},getMaxAllowedRepresentationRatioFor:function(e){return S.getMaxAllowedRepresentationRatioFor(e)},setAutoPlay:ce,getAutoPlay:function(){return R},setScheduleWhilePaused:function(e){b.setScheduleWhilePaused(e)},getScheduleWhilePaused:function(){return b.getScheduleWhilePaused()},getDashMetrics:ge,getMetricsFor:me,getQualityFor:function(t){if(!A)throw e;return S.getQualityFor(t,x.getActiveStreamInfo())},setQualityFor:function(t,n){if(!A)throw e;S.setPlaybackQuality(t,x.getActiveStreamInfo(),n)},updatePortalSize:function(){S.setElementSize(),S.setWindowResizeEventCalled(!0)},getLimitBitrateByPortal:function(){return S.getLimitBitrateByPortal()},setLimitBitrateByPortal:function(e){S.setLimitBitrateByPortal(e)},getUsePixelRatioInLimitBitrateByPortal:function(){return S.getUsePixelRatioInLimitBitrateByPortal()},setUsePixelRatioInLimitBitrateByPortal:function(e){S.setUsePixelRatioInLimitBitrateByPortal(e)},getBitrateInfoListFor:function(t){if(!A)throw e;var n=Oe();return n?n.getBitrateListFor(t):[]},setInitialBitrateFor:function(e,t){S.setInitialBitrateFor(e,t)},getInitialBitrateFor:function(t){if(!A)throw e;return S.getInitialBitrateFor(t)},setInitialRepresentationRatioFor:function(e,t){S.setInitialRepresentationRatioFor(e,t)},getInitialRepresentationRatioFor:function(e){return S.getInitialRepresentationRatioFor(e)},getStreamsFromManifest:function(t){if(!A)throw e;return P.getStreamsInfo(t)},getTracksFor:ye,getTracksForTypeFromManifest:function(t,n,r){if(!A)throw e;return(r=r||P.getStreamsInfo(n,1)[0])?P.getAllMediaInfoForType(r,t,n):[]},getCurrentTrackFor:function(t){if(!A)throw e;var n=x.getActiveStreamInfo();return n?D.getCurrentTrackFor(t,n):null},setInitialMediaSettingsFor:function(e,t){if(!v)throw l;D.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!v)throw l;return D.getInitialSettings(e)},setCurrentTrack:function(t){if(!A)throw e;D.setTrack(t)},getTrackSwitchModeFor:function(e){if(!v)throw l;return D.getSwitchMode(e)},setTrackSwitchModeFor:function(e,t){if(!v)throw l;D.setSwitchMode(e,t)},setSelectionModeForInitialTrack:function(e){if(!v)throw l;D.setSelectionModeForInitialTrack(e)},getSelectionModeForInitialTrack:function(){if(!v)throw l
;return D.getSelectionModeForInitialTrack()},setFastSwitchEnabled:function(e){b.setFastSwitchEnabled(e)},getFastSwitchEnabled:function(){return b.getFastSwitchEnabled()},setMovingAverageMethod:function(e){e===r.MOVING_AVERAGE_SLIDING_WINDOW||e===r.MOVING_AVERAGE_EWMA?b.setMovingAverageMethod(e):h("Warning: Ignoring setMovingAverageMethod("+e+") - unknown value.")},getMovingAverageMethod:function(){return b.getMovingAverageMethod()},getAutoSwitchQualityFor:function(e){return S.getAutoSwitchBitrateFor(e)},setAutoSwitchQualityFor:function(e,t){S.setAutoSwitchBitrateFor(e,t)},setABRStrategy:function(e){e===r.ABR_STRATEGY_DYNAMIC||e===r.ABR_STRATEGY_BOLA||e===r.ABR_STRATEGY_THROUGHPUT?b.setABRStrategy(e):h("Warning: Ignoring setABRStrategy("+e+") - unknown value.")},getABRStrategy:function(){return b.getABRStrategy()},useDefaultABRRules:function(e){b.setUseDefaultABRRules(e)},addABRCustomRule:function(e,t,n){b.addABRCustomRule(e,t,n)},removeABRCustomRule:function(e){b.removeABRCustomRule(e)},removeAllABRCustomRule:function(){b.removeAllABRCustomRule()},setBandwidthSafetyFactor:function(e){b.setBandwidthSafetyFactor(e)},getBandwidthSafetyFactor:function(){return b.getBandwidthSafetyFactor()},getAverageThroughput:function(e){var t=S.getThroughputHistory();return t?t.getAverageThroughput(e):0},setAbandonLoadTimeout:function(e){b.setAbandonLoadTimeout(e)},retrieveManifest:function(e,t){var n=Re(),r=this;f.on(g.INTERNAL_MANIFEST_LOADED,(function e(i){i.error?t(null,i.error):t(i.manifest),f.off(g.INTERNAL_MANIFEST_LOADED,e,r),n.reset()}),r),Ge(c).getInstance().initialize(e),n.load(e,q)},addUTCTimingSource:fe,removeUTCTimingSource:pe,clearDefaultUTCTimingSources:function(){b.setUTCTimingSources([])},restoreDefaultUTCTimingSources:he,setBufferToKeep:function(e){b.setBufferToKeep(e)},setBufferAheadToKeep:function(e){b.setBufferAheadToKeep(e)},setBufferPruningInterval:function(e){b.setBufferPruningInterval(e)},setStableBufferTime:function(e){b.setStableBufferTime(e)},getStableBufferTime:function(){return b.getStableBufferTime()},setBufferTimeAtTopQuality:function(e){b.setBufferTimeAtTopQuality(e)},getBufferTimeAtTopQuality:function(){return b.getBufferTimeAtTopQuality()},setBufferTimeAtTopQualityLongForm:function(e){b.setBufferTimeAtTopQualityLongForm(e)},getBufferTimeAtTopQualityLongForm:function(){return b.getBufferTimeAtTopQualityLongForm()},setFragmentLoaderRetryAttempts:function(e){b.setFragmentRetryAttempts(e)},setFragmentLoaderRetryInterval:function(e){b.setFragmentRetryInterval(e)},setManifestLoaderRetryAttempts:function(e){b.setManifestRetryAttempts(e)},setManifestLoaderRetryInterval:function(e){b.setManifestRetryInterval(e)},setXHRWithCredentialsForType:function(e,t){b.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return b.getXHRWithCredentialsForType(e)},setJumpGaps:function(e){b.setJumpGaps(e)},getJumpGaps:function(){return b.getJumpGaps()},setSmallGapLimit:function(e){b.setSmallGapLimit(e)},getSmallGapLimit:function(){return b.getSmallGapLimit()},getLowLatencyEnabled:function(){return b.getLowLatencyEnabled()},setLowLatencyEnabled:function(e){return b.setLowLatencyEnabled(e)},setPreloadData:function(e){return b.setPreloadData(e)},setManifestUpdateRetryInterval:function(e){b.setManifestUpdateRetryInterval(e)},getManifestUpdateRetryInterval:function(){return b.getManifestUpdateRetryInterval()},setLongFormContentDurationThreshold:function(e){b.setLongFormContentDurationThreshold(e)},setSegmentOverlapToleranceTime:function(e){b.setSegmentOverlapToleranceTime(e)},setCacheLoadThresholdForType:function(e,t){b.setCacheLoadThresholdForType(e,t)},getProtectionController:function(){return Se()},attachProtectionController:function(e){O=e},setProtectionData:function(e){y=e,x&&x.setProtectionData(y)},enableManifestDateHeaderTimeSource:function(e){b.setUseManifestDateHeaderTimeSource(e)},attachVideoContainer:function(e){if(!V.getElement())throw n;V.setVideoContainer(e)},attachTTMLRenderingDiv:function(e){if(!V.getElement())throw n;V.setTTMLRenderingDiv(e)},getUseDeadTimeLatencyForAbr:function(){
return S.getUseDeadTimeLatency()},setUseDeadTimeLatencyForAbr:function(e){S.setUseDeadTimeLatency(e)},getThumbnail:function(e){if(e<0)return null;var t=U.getIsDynamic()?se(e):e,n=x.getStreamForTime(t);if(null===n)return null;var r=n.getThumbnailController(),i=n.getStreamInfo();if(!r||!i)return null;var a=x.getTimeRelativeToStreamId(t,n.getId());return r.get(a)},setDefaultQualityFor:function(e,t){S||(S=le(c).getInstance()),S.setDefaultQualityFor(e,t)},getDefaultQualityFor:function(e){return S.getDefaultQualityFor(e)},getDroppedFramesInfo:function(){return S.getDroppedFramesInfo()},getCurrentSegmentInfoFor:function(e){return S.getCurrentSegmentInfoFor(e)},onInitSegmentsLoaded:function(e){te=e},getThroughputDict:function(e){var t=S.getThroughputHistory();return t?t.getDict(e):{}},getInitializeDate:we,updateSource:function(e){if(!v)throw l;"string"==typeof e&&Ge(c).getInstance().initialize(e),$.video={},$.audio={},_=e,x.load(_,q)},switchSource:function(e){if(!v)throw l;"string"==typeof e&&Ge(c).getInstance().initialize(e),$.video={},$.audio={},ee.min=0,ee.video=0,ee.audio=0,_=e,W=0,V.setDataOffsetAttr(0),b.setCachedDurationOffset("offset",0),b.setCachedDurationOffset("time",0),b.setCachedDurationOffset("duration",0),b.setAppendingSourceState(!1),X=!1,j=[],(A||I)&&Ie(),re()&&Ce()},appendSource:Fe,setEndOfStreamState:function(e){b&&b.setEndOfStreamState(e)},setP2pPermission:function(e){e||b.addBufferingCount()},setP2pType:function(e,t){var n,r=!1;switch(e){case"yf-eg":case"yf-cg2":window.YFDashIO&&(r=!0);break;case"xl-eg":case"xl-cg2":window.xyvp&&(r=!0);break;case"ks-eg":case"ks-cg2":window.KSLoader&&(r=!0);break;case"bili-eg":case"bili-cg2":window.DIYSdk&&(r=!0);break;case"pear-eg":case"pear-cg2":window.PearDownloader&&(r=!0)}r?window.__DASH_P2P_TYPE__=e:t?(n=t,new Promise((function(e,t){var r=document.createElement("script");r.src=n,r.onload=function(){window.clearTimeout(Q),e()},r.onerror=function(){window.clearTimeout(Q),t(),f.trigger(g.PCDN_LOADED_ERROR,{code:a.DOWNLOAD_PCDN_SCRIPT_ERROR,url:n})},document.body.appendChild(r),Q=window.setTimeout((function(){t(),f.trigger(g.PCDN_LOADED_ERROR,{code:a.DOWNLOAD_PCDN_SCRIPT_TIMEOUT,url:n})}),2e3)}))).then((function(){window.__DASH_P2P_TYPE__=e,h("[MediaPlayer] p2p Sdk Scripts Loaded")})).catch((function(){console.warn("load p2p sdk scripts failed")})):console.warn("lack p2p sdk scripts")},reset:function(){ve(null),Te(null),y=null,z=!1,X=!1,W=0,j=[],O&&(O.reset(),O=null),C&&(C.reset(),C=null),f.off(g.SEGMENTS_LOADED,Pe,E),f.off(g.BUFFER_LEVEL_UPDATED,be,E),f.off(g.PLAYBACK_ENDED,Le,this),f.off(g.STREAM_BUFFERING_COMPLETED,Le,this),f.off(g.PLAYBACK_TIME_UPDATED,Me,this)}},function(){v=!1,I=!1,A=!1,R=!0,O=null,y=null,P=null,g.extend(gn),b=hn(c).getInstance(),V=Kr(c).getInstance(),W=0,K=!1,j=[],ne={video:0,audio:0},Z=0,f.on(g.SEGMENTS_LOADED,Pe,E),f.on(g.BUFFER_LEVEL_UPDATED,be,E),f.on(g.PLAYBACK_ENDED,Le,this),f.on(g.STREAM_BUFFERING_COMPLETED,Le,this),f.on(g.PLAYBACK_TIME_UPDATED,Me,this)}(),E}Ni.__dashjs_factory_name="MediaPlayer";var Di=s.a.getClassFactory(Ni);Di.events=gn,s.a.updateClassFactory(Ni.__dashjs_factory_name,Di);t.a=Di},function(e,t,n){var r,i,o,u,l,d={encode:function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},decode:function(e){for(var t=[],n=0;n<e.length;){var r=e[n++];r<128||(r<224?(r=(31&r)<<6,r|=63&e[n++]):r<240?(r=(15&r)<<12,r|=(63&e[n++])<<6,r|=63&e[n++]):(r=(7&r)<<18,r|=(63&e[n++])<<12,r|=(63&e[n++])<<6,r|=63&e[n++])),t.push(String.fromCharCode(r))}return t.join("")}},c={};r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t=0,n=[],i=0|e.length/3;0<i--;){var a=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),n.push(r.charAt(63&a>>6)),n.push(r.charAt(63&a))}return 2==e.length-t?(a=(e[t]<<16)+(e[t+1]<<8),n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),
n.push(r.charAt(63&a>>6)),n.push("=")):1==e.length-t&&(a=e[t]<<16,n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),n.push("==")),n.join("")},o=function(){for(var e=[],t=0;t<r.length;++t)e[r.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),u=function(e){for(var t=0,n=[],r=0|e.length/4;0<r--;){var i=(o[e.charCodeAt(t)]<<18)+(o[e.charCodeAt(t+1)]<<12)+(o[e.charCodeAt(t+2)]<<6)+o[e.charCodeAt(t+3)];n.push(255&i>>16),n.push(255&i>>8),n.push(255&i),t+=4}return n&&("="==e.charAt(t-2)?(n.pop(),n.pop()):"="==e.charAt(t-1)&&n.pop()),n},l={encode:function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},c.decodeArray=function(e){var t=u(e);return new Uint8Array(t)},c.encodeASCII=function(e){var t=l.encode(e);return i(t)},c.decodeASCII=function(e){var t=u(e);return l.decode(t)},c.encode=function(e){var t=d.encode(e);return i(t)},c.decode=function(e){var t=u(e);return d.decode(t)},t.decode=c.decode,t.decodeArray=c.decodeArray,t.encode=c.encode,t.encodeASCII=c.encodeASCII},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BUFFERING=void 0;var r=n(4),i=.5;t.BUFFERING={PLAYBACK:{PLAYING:1,SEEKING:2,SWITCHING_QUALITY:3,SWITCHING_SOURCE:4,UPDATING_SOURCE:5,APPENDING_SOURCE:6},TYPE:{UNKNOWN:0,SEEKING:10,SEEKING_INSIDE_BUFFERED:11,SEEKING_OUTSIDE_BUFFERED:12,NETWORK:20,NETWORK_CONNECT_TIMEOUT:21,NETWORK_READING_TIMEOUT:22,NETWORK_DOWNLOAD_TIMEOUT:23,NETWORK_DOWNLOAD_ERROR:24,NETWORK_POOR:25,MEDIA:30,MEDIA_ERR_ABORTED:31,MEDIA_ERR_NETWORK:32,MEDIA_ERR_DECODE:33,MEDIA_ERR_SRC_NOT_SUPPORTED:34,MEDIA_DECODING_PERFORMANCE:35,GAP:40,GAP_BEFORE_CURRENT:41,GAP_AFTER_CURRENT:42,PERFORMANCE:50,PERFORMANCE_UNKNOWN:51,INTERNAL:60,INTERNAL_STARTING:61,INTERNAL_ENDING:62,INTERNAL_UNNORMAL_RANGES:63}};var a=function(){function e(e){this.video=e}return e.prototype.getInfo=function(e){var n={type:-1};if(!e)return n;try{var r=this.video,a=r.currentTime,o=r.duration,s=r.readyState,u=r.buffered,l=u&&u.length,d=r.seeking,c=t.BUFFERING.TYPE.UNKNOWN,f=e.playbackState||t.BUFFERING.PLAYBACK.PLAYING;if(d&&f===t.BUFFERING.PLAYBACK.PLAYING&&(f=t.BUFFERING.PLAYBACK.SEEKING),n={type:c,isSeeking:d,cTime:a,duration:o,rState:s,nRanges:l,vLength:e.videoBufferLength,aLength:e.audioBufferLength,activity:e.networkActivity,vSpeed:Math.round(e.videoSpeed),aSpeed:Math.round(e.audioSpeed)},f===t.BUFFERING.PLAYBACK.SEEKING)c=0===l?t.BUFFERING.TYPE.SEEKING_OUTSIDE_BUFFERED:t.BUFFERING.TYPE.SEEKING_INSIDE_BUFFERED;else{var p=this.checkGapInfo(),h=p.nativeBufferLength;if(n.nLength=h,n.cRange=p.start+"-"+p.end,p.hasGap)c=p.type,n.gap=p.gapStart+"-"+p.gapEnd,n.gapLength=p.gapLength;else if(h<i){var g=this.checkLackOfBufferInfo(e);c=g.type,n.vCode=g.videoErrorCode,n.aCode=g.audioErrorCode}else c=s>=2?t.BUFFERING.TYPE.PERFORMANCE:t.BUFFERING.TYPE.PERFORMANCE_UNKNOWN}var m=this.checkNativeErrorInfo();m.type&&(c=m.type,n.nCode=m.code);var E=e.fragmentLoadingInfo;if(E&&E.video){var _=E.video;n.vFragment=_.id+"-"+_.index,e.latestPlayurlErrorHTTPCode&&(n.hCode=e.latestPlayurlErrorHTTPCode)}if(E&&E.audio){_=E.audio;n.aFragment=_.id+"-"+_.index,e.latestPlayurlErrorHTTPCode&&(n.hCode=e.latestPlayurlErrorHTTPCode)}n.type=""+f+(c||"00")}catch(e){throw new Error(e.message)}return n},e.prototype.checkGapInfo=function(){var e=this.video,n=e.currentTime,r=e.buffered,i=r&&r.length,a=0,o=!1,s=0,u=0,l={start:0,end:0},d=0,c=t.BUFFERING.TYPE.UNKNOWN;if(i&&i>1)for(var f=0;f<i;f++){var p=r.start(f),h=r.end(f);p<=n&&h>=n&&(a=Math.floor(1e3*(h-n))/1e3,l={start:p,end:h},c===t.BUFFERING.TYPE.GAP_BEFORE_CURRENT?u=p:s=h),p>n&&p-n<=1&&c!==t.BUFFERING.TYPE.GAP_BEFORE_CURRENT&&(o=!0,c=t.BUFFERING.TYPE.GAP_AFTER_CURRENT,u=u?Math.min(u,p):p,s=l.end),n-h<3&&n-h>=0&&(o=!0,c=t.BUFFERING.TYPE.GAP_BEFORE_CURRENT,s=h,u=l.start)}else if(1===i){h=r.end(0);l={start:r.start(0),end:h},a=Math.floor(1e3*(h-n))/1e3}return o&&(d=Math.round(1e3*(u-s))/1e3),{type:c,start:l.start,end:l.end,nativeBufferLength:a,hasGap:o,gapStart:s,gapEnd:u,gapLength:d}},
e.prototype.checkLackOfBufferInfo=function(e){var n=t.BUFFERING.TYPE.UNKNOWN,r=this.video,a=r.currentTime,o=r.buffered,s=r.duration,u=r.readyState,l=0,d=0;if(o&&o.length)if(s&&s-a<i)n=t.BUFFERING.TYPE.INTERNAL_ENDING;else{var c=this.checkNetworkInfo(e);n=c.type,l=c.videoErrorCode,d=c.audioErrorCode}else n=a<=e.startOffsetTime&&u<=1?t.BUFFERING.TYPE.INTERNAL_STARTING:(e.networkActivity.length&&e.networkActivity.reduce((function(e,t){return e+t})))<100?t.BUFFERING.TYPE.NETWORK_POOR:t.BUFFERING.TYPE.INTERNAL_UNNORMAL_RANGES;return{type:n,videoErrorCode:l,audioErrorCode:d}},e.prototype.checkNetworkInfo=function(e){var n=t.BUFFERING.TYPE.UNKNOWN,a=this.video.currentTime,o=e.videoBufferLength||0,s=e.audioBufferLength||0,u=e.networkWarningHistory,l=this.getCurrentNetworkWarningInfo({mediaType:r.STRING.VIDEO,currentQn:e.videoCurrentQn,networkWarningHistory:u,warningTime:a+o,bufferLength:o},i),d=this.getCurrentNetworkWarningInfo({mediaType:r.STRING.AUDIO,currentQn:e.audioCurrentQn,networkWarningHistory:u,warningTime:a+s,bufferLength:s},i),c=l.code,f=d.code,p=this.getBufferingTypeByPoorNetwork(c),h=this.getBufferingTypeByPoorNetwork(f);return p||h?(n=p||"00",h&&(n=""+n+h)):n=t.BUFFERING.TYPE.NETWORK,{type:n,videoErrorCode:c,audioErrorCode:f,videoBufferLength:o,audioBufferLength:s}},e.prototype.checkNativeErrorInfo=function(){var e=this.video.error,n=e&&e.code||0,r=t.BUFFERING.TYPE.UNKNOWN;if(e&&n)switch(n){case 1:r=t.BUFFERING.TYPE.MEDIA_ERR_ABORTED;break;case 2:r=t.BUFFERING.TYPE.MEDIA_ERR_NETWORK;break;case 3:r=t.BUFFERING.TYPE.MEDIA_ERR_DECODE;break;case 4:r=t.BUFFERING.TYPE.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:r=t.BUFFERING.TYPE.MEDIA}return{type:r,code:n}},e.prototype.getCurrentNetworkWarningInfo=function(e,t){if(void 0===t&&(t=1),!e)return{code:0};var n=e.mediaType,r={code:0,type:"",mediaType:e.mediaType},i=e.networkWarningHistory,a=e.warningTime,o=e.bufferLength,s=e.currentQn;if(i.length&&o<t){a+=t;try{var u=i.filter((function(e){return e.mediaType===n&&e.startTime<=a+t&&e.startTime+e.duration>=a&&e.id===s.toString()}));u.length&&(r=u[u.length-1])}catch(e){throw new Error("getCurrentNetworkWarningInfo error, "+JSON.stringify(e))}}return r},e.prototype.getBufferingTypeByPoorNetwork=function(e){var n=t.BUFFERING.TYPE.UNKNOWN;if(e)switch(e){case r.ERROR.CONNECT_FRAGMENT_ERROR_TIMEOUT:n=t.BUFFERING.TYPE.NETWORK_CONNECT_TIMEOUT;break;case r.ERROR.DOWNLOAD_FRAGMENT_ERROR_TIMEOUT:n=t.BUFFERING.TYPE.NETWORK_DOWNLOAD_TIMEOUT;break;case r.ERROR.DOWNLOAD_FRAGMENT_ERROR:n=t.BUFFERING.TYPE.NETWORK_DOWNLOAD_ERROR}return n},e}();t.default=a},function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n}},function(e,t,n){!function(e){"use strict";var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(e){
var n=e;return t.hasOwnProperty(e)&&(n=t[e]),String.fromCharCode(n)},r=15,i=32,a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},o={17:2,18:4,21:6,22:8,23:10,19:13,20:15},s={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u={25:2,26:4,29:6,30:8,31:10,27:13,28:15},l=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],d={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},c=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},f=function(e,t,n,r,i){this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1};f.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var p=function(e,t,n,r,i,a){this.uchar=e||" ",this.penState=new f(t,n,r,i,a)};p.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var h=function(){this.chars=[];for(var e=0;e<i;e++)this.chars.push(new p);this.pos=0,this.currPenState=new f};h.prototype={equals:function(e){for(var t=!0,n=0;n<i;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(d.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(d.log("ERROR","Too large cursor position "+this.pos),this.pos=i)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=n(e);this.pos>=i?d.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<i;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,n=0;n<i;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var g=function(){this.rows=[];for(var e=0;e<r;e++)this.rows.push(new h);this.currRow=14,this.nrRollUpRows=null,this.reset()};g.prototype={reset:function(){for(var e=0;e<r;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,n=0;n<r;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<r;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){
for(var e=!0,t=0;t<r;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){d.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){d.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var n=this.rows[this.currRow];if(null!==e.indent){var r=e.indent,i=Math.max(r-1,0);n.setCursor(e.indent),e.color=n.chars[i].penState.foreground}var a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)},setBkgData:function(e){d.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){d.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),d.log("INFO","Rolling up")}else d.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],n="",i=-1,a=0;a<r;a++){var o=this.rows[a].getTextString();o&&(i=a+1,e?t.push("Row "+i+': "'+o+'"'):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},getTextAndFormat:function(){return this.rows}};var m=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new g,this.nonDisplayedMemory=new g,this.lastOutputScreen=new g,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,d.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";d.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(d.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){d.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){d.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){d.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){d.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){d.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){d.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){d.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){d.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){d.log("INFO","EDM - Erase Displayed Memory"),
this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){d.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){d.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(d.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,d.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){d.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}d.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=d.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var E=function(e,t,n){this.field=e||1,this.outputs=[t,n],this.channels=[new m(1,t),new m(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};E.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var n,r,i,a=!1;this.lastTime=e,d.setTime(e);for(var o=0;o<t.length;o+=2)if(r=127&t[o],i=127&t[o+1],r>=16&&r<=31&&r===this.lastCmdA&&i===this.lastCmdB)this.lastCmdA=null,this.lastCmdB=null,d.log("DEBUG","Repeated command ("+c([r,i])+") is dropped");else if(0!==r||0!==i){if(d.log("DATA","["+c([t[o],t[o+1]])+"] -> ("+c([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n)if(a=this.parseChars(r,i))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(a);else d.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,d.log("WARNING","Couldn't parse cleaned data "+c([r,i])+" orig: "+c([t[o],t[o+1]])))}else this.dataCounters.padding+=2},parseCmd:function(e,t){var n=null;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47)&&!((23===e||31===e)&&33<=t&&t<=35))return!1;n=20===e||21===e||23===e?1:2;var r=this.channels[n-1];return 20===e||21===e||28===e||29===e?32===t?r.cc_RCL():33===t?r.cc_BS():34===t?r.cc_AOF():35===t?r.cc_AON():36===t?r.cc_DER():37===t?r.cc_RU(2):38===t?r.cc_RU(3):39===t?r.cc_RU(4):40===t?r.cc_FON():41===t?r.cc_RDC():42===t?r.cc_TR():43===t?r.cc_RTD():44===t?r.cc_EDM():45===t?r.cc_CR():46===t?r.cc_ENM():47===t&&r.cc_EOC():r.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},parseMidrow:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return d.log("ERROR","Mismatch channel in midrow parsing"),!1;var r=this.channels[n-1];return r.insertChars([32]),r.cc_MIDROW(t),d.log("DEBUG","MIDROW ("+c([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var n,r=null;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127)&&!((16===e||24===e)&&64<=t&&t<=95))return!1;n=e<=23?1:2,r=64<=t&&t<=95?1===n?a[e]:s[e]:1===n?o[e]:u[e];var i=this.interpretPAC(r,t);return this.channels[n-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},interpretPAC:function(e,t){var n=t,r={
color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},parseChars:function(e,t){var r=null,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),17<=a&&a<=19){var o=t;o=17===a?t+80:18===a?t+112:t+144,d.log("INFO","Special char '"+n(o)+"' in channel "+r),i=[o],this.lastCmdA=e,this.lastCmdB=t}else 32<=e&&e<=127&&(i=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null);if(i){var s=c(i);d.log("DEBUG","Char codes =  "+s.join(","))}return i},parseBackgroundAttributes:function(e,t){var n,r,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=l[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(n),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}};e.logger=d,e.PenState=f,e.CaptionScreen=g,e.Cea608Parser=E,e.findCea608Nalus=function(e,t,n){for(var r=0,i=t,a=[],o=function(e,t,n,r){if(4!==e||t<8)return null;var i=n.getUint8(r),a=n.getUint16(r+1),o=n.getUint32(r+3),s=n.getUint8(r+7);return 181==i&&49==a&&1195456820==o&&3==s};i<t+n;){if(r=e.getUint32(i),6===(31&e.getUint8(i+4)))for(var s=i+5,u=-1;s<i+4+r-1;){u=0;for(var l=255;255===l;)u+=l=e.getUint8(s),s++;var d=0;for(l=255;255===l;)d+=l=e.getUint8(s),s++;o(u,d,e,s)&&a.push([s,d]),s+=d}i+=r+4}return a},e.extractCea608DataFromRange=function(e,t){var n=t[0],r=[[],[]];n+=8;var i=31&e.getUint8(n);n+=2;for(var a=0;a<i;a++){var o=e.getUint8(n),s=4&o,u=3&o;n++;var l=e.getUint8(n);n++;var d=e.getUint8(n);n++,s&&(127&l)+(127&d)!=0&&(0===u?(r[0].push(l),r[0].push(d)):1===u&&(r[1].push(l),r[1].push(d)))}return r}}(t)},function(e,t,n){var r=n(11).default,i=n(13).default;window.dashjs=r,e.exports=i},function(e,t,n){"use strict";n.r(t),function(e){var r=n(5);n.d(t,"MediaPlayer",(function(){return r.a}));var i=n(0);n.d(t,"FactoryMaker",(function(){return i.a}));var a=n(2),o="undefined"!=typeof window&&window||e,s=o.dashjs;s||(s=o.dashjs={}),s.MediaPlayer=r.a,s.FactoryMaker=i.a,s.Version=Object(a.a)(),t.default=s}.call(this,n(12))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(14),l=n(15),d=s(n(3)),c=n(4),f=s(n(16)),p=o(n(7)),h=s(n(17)),g=function(){function e(e,t){if(this.config={scriptSrc:"https://static.hdslb.com/player/js/dash.mediaplayer.min.js",scriptMaxLoadTime:1e4,minQualityNumberMappingNumber:6,videoInfoScheduleTime:1e3},(null==t?void 0:t.hid)&&"string"==typeof t.hid&&(this.config.hid=t.hid),this.state={defaultVideoQuality:0,defaultAudioQuality:0,setTheDefaultVideoQualityState:!1,stableBufferTime:60,isAutoPlay:!1,
abrStrategy:c.STRING.ABR_THROUGHPUT,isAutoSwitch:{video:!1,audio:!1},autoSwitchTopQualityMap:{video:-1,audio:-1},onScriptLoading:!1,initialized:!1,mpd:null,manifest:null,manifestInfo:{},currentQualityIndex:{video:0,audio:0},maxQualityIndex:{video:-1,audio:-1},qualityNumberMap:{video:{},audio:{}},segmentsInfoMap:{video:{},audio:{}},mediaInfo:{},statisticsInfo:{},autoSwitchStartTime:0,preloadData:null,startOffsetTime:0,enforceSSLStream:!1,latestPlayurlExpireTimeStamp:0,latestPlayurlErrorHTTPCode:0,fragmentLoadingInfo:{},appendingSourceState:!1,logHistory:[],networkWarningHistory:[],playbackState:p.BUFFERING.PLAYBACK.PLAYING,enableHEVC:!1,cdnInfo:{cdn:0,p2p:0,nc:0,business:0,mcdn:0,bcache:0,vcache:0,ncFail:0,ncGotFail:0},NCInfo:{}},this.timer={loadScript:0,videoInfoSchedule:0,removeSwitchSourceTransition:0,qnChangeTimeOutFlag:{video:-1,audio:-1}},this.events={},this.components={networkActivity:new f.default,bufferingInfo:new p.default(e),bufferingStrategy:new h.default},this.video=e,this.mixin(t),!e||!(e instanceof HTMLVideoElement||window.__ENABLE_WASM_PLAYER__&&e instanceof window.BwpElement))throw new Error("Video parameter is not a HTMLVideoElement")}return e.prototype.mergeDolbyAtmosToAudio=function(e){var t,n=e.audio,r=e.dolby;r&&(null===(t=null==r?void 0:r.audio)||void 0===t?void 0:t.length)&&l.isEC3DolbyATMOSTypeSupported()&&n.push.apply(n,r.audio)},e.prototype.processManifest=function(e,t){return"string"!=typeof e&&this.mergeDolbyAtmosToAudio(e),this.filterManifestByEnableHEVC(e,t)},e.prototype.preload=function(){var e=this;this.detectDashJSExists()||this.loadDashPlayerScript().then((function(){e.fire(c.EVENTS.SCRIPT_LOADED)})).catch((function(t){e.error({msg:"Load dash player script error",detail:t})}))},e.prototype.initialize=function(e,t){var n=this;this.mixin(t);var r=this.processManifest(e,this.state.enableHEVC);return this.state.mpd=r.manifest,this.state.enableHEVC=r.isHEVCTypeSupported,this.components.bufferingStrategy.setHEVCEnableFlag(r.isHEVCTypeSupported).setOnOptimizingCallback(this.fire.bind(this)),new Promise((function(t,r){e||r({msg:"Manifest parameter error, manifest: "+JSON.stringify(e)}),n.detectDashJSExists()?n.createPlayer(t,r):n.state.onScriptLoading?n.on(c.EVENTS.SCRIPT_LOADED,(function(){n.off(c.EVENTS.SCRIPT_LOADED),n.createPlayer(t,r)})):n.loadDashPlayerScript().then((function(){n.createPlayer(t,r)})).catch((function(e){n.error(e)}))}))},e.prototype.on=function(e,t){e&&"function"==typeof t&&(this.events[e]||(this.events[e]=[]),this.events[e].push(t))},e.prototype.off=function(e,t){if(e)if("function"==typeof t){if(this.events[e]&&this.events[e].length){var n=this.events[e].indexOf(t);n>=0&&this.events[e].splice(n,1)}}else this.events[e]=[]},e.prototype.fire=function(e,t){if(e){var n=this.events[e];n&&n.length&&n.forEach((function(e){"function"==typeof e&&e.call(null,t)}))}},e.prototype.play=function(){try{return this.player.play()}catch(e){this.error({msg:"Call play function error",detail:e})}},e.prototype.pause=function(){try{this.player.pause()}catch(e){this.error({msg:"Call pause function error",detail:e})}},e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);try{return this.player.time(void 0,e)}catch(e){this.error({type:c.STRING.WARNING,msg:"Call getCurrentTime function error",detail:e})}return 0},e.prototype.getBufferedTime=function(){this.getCurrentTime();var e=this.video;try{e.buffered}catch(e){this.error({msg:"Call getBufferedTime function error",detail:e})}return 0},e.prototype.getDuration=function(e){void 0===e&&(e=!0);try{return this.player.duration(e)}catch(e){this.error({msg:"Call getDuration function error",detail:e})}},e.prototype.seek=function(e,t){var n=this;return void 0===t&&(t=!1),new Promise((function(r,i){if(isNaN(parseInt(""+e,10))||e<0)i({msg:"Seek time value error, time: "+e});else if(n.state.appendingSourceState)i({msg:"Call seek function error while appending source, time: "+e});else try{var a=n.getCurrentTime(),o=Date.now();n.changePlaybackState(p.BUFFERING.PLAYBACK.SEEKING);var s=n.getStartOffsetTime();e<s&&(e=s+.3)
;var u=999999,l=n.state.segmentsInfoMap,d=parseInt(n.video.getAttribute("data-offset"),10)||0;if(l)for(var f in l)u=Math.min(l[f].realDuration+d,u);u=Math.min(n.state.manifest.mediaPresentationDuration,u),e>u-.6&&(e=u-.6),n.player.seek(e,t);var h=function(){n.changePlaybackState(p.BUFFERING.PLAYBACK.PLAYING).player.off(c.EVENTS.PLAYBACK_SEEKED,h),r({cost:Math.floor(Date.now()-o),currentTime:a,seekedTime:e,isRelative:t})};n.player.on(c.EVENTS.PLAYBACK_SEEKED,h)}catch(e){n.error({msg:"Call seek function error",detail:e})}}))},e.prototype.getCorePlayer=function(){return this.player},e.prototype.setVolume=function(e){if(isNaN(parseInt(""+e,10))||e<0||e>1)this.error({msg:"SetVolume value error, value: "+e});else try{this.player.setVolume(e)}catch(e){this.error({msg:"Call setVolume function error",detail:e})}},e.prototype.getVolume=function(){try{return this.player.getVolume()}catch(e){this.error({msg:"Call getVolume function error",detail:e})}},e.prototype.setPlaybackRate=function(e){try{this.player.setPlaybackRate(e)}catch(e){this.error({msg:"Call setPlaybackRate function error",detail:e})}},e.prototype.getPlaybackRate=function(){try{return this.player.getPlaybackRate()}catch(e){this.error({msg:"Call getPlaybackRate function error",detail:e})}},e.prototype.getAutoSwitchQualityFor=function(e){try{return this.player.getAutoSwitchQualityFor(e)}catch(e){this.error({msg:"Call getAutoSwitchQualityFor function error",detail:e})}},e.prototype.setAutoSwitchQualityFor=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);try{this.state.isAutoSwitch&&n&&(this.state.isAutoSwitch[e]=t),t||this.setMaxAllowedBitrateFor(e,0),this.player.setAutoSwitchQualityFor(e,t)}catch(e){this.error({msg:"Call setAutoSwitchQualityFor function error",detail:e})}return this},e.prototype.checkIsDolbyAudioCanUse=function(){var e=this.state.mpd&&this.state.mpd[c.STRING.AUDIO]?this.state.mpd[c.STRING.AUDIO]:this.state.manifest&&this.state.manifest.audio?this.state.manifest.audio:void 0;return!!(l.isEC3DolbyATMOSTypeSupported()&&e&&e.length)&&-1!==e.findIndex((function(e){return e.id===c.DOLBY_AUDIO_QN.AUDIO||e.id===c.DOLBY_AUDIO_QN.AMTOS}))},e.prototype.getAudioQuallityCanBeUsed=function(e){return e===c.DOLBY_AUDIO_QN.AUDIO||e===c.DOLBY_AUDIO_QN.AMTOS?this.checkIsDolbyAudioCanUse()&&e||30280:e},e.prototype.getQualityList=function(e){try{return this.player.getBitrateInfoListFor(e)}catch(e){this.error({msg:"Call getQualityList function error",detail:e})}},e.prototype.setDefaultQualityFor=function(e,t){void 0===t&&(t=0);var n=this.getQualityIndexFromQualityNumber(t,e);try{var r=this.state.mpd&&this.state.mpd[e];if(!r)return;var i=r.length;i&&(n=Math.min(n,i-1)),n>=0?(this.state.currentQualityIndex[e]=n,this.player.setDefaultQualityFor(e,n)):this.error({msg:"Call setDefaultQualityFor function error, quality: "+t})}catch(e){this.error({msg:"Call setDefaultQualityFor function error, quality: "+t+", qualityIndex = "+n,detail:e})}},e.prototype.setAutoSwitchTopQualityFor=function(e,t){var n=this;try{if(!this.state.initialized){var r=function(){n.off(c.EVENTS.STREAM_INITIALIZED,r),n.setAutoSwitchTopQualityFor(e,t)};return void this.on(c.EVENTS.STREAM_INITIALIZED,r)}if(!t&&0!==t)return void this.setMaxAllowedBitrateFor(e,0);if(!(this.state.isAutoSwitch&&this.state.isAutoSwitch[e]))return;var i=this.getQualityIndexFromQualityNumber(t,e),a=this.getQualityList(e),o=a&&a[i],s=Math.floor(o.bitrate/1e3)+1;this.state.autoSwitchTopQualityMap[e]=i,this.setMaxAllowedBitrateFor(e,s)}catch(e){this.error({msg:"Call setAutoSwitchTopQualityFor function error",detail:e})}},e.prototype.setQualityFor=function(e,t){var n=this;return new Promise((function(r,i){if(isNaN(parseInt(""+t,10))||t<0)i({msg:"Set quality value error, quality: "+t,code:c.ERROR_CODE.SET_QUALITY_VALUE_ERR});else if(n.detectQualityTypeIsLegal(e))i({msg:"Set quality type error, type: "+e,code:c.ERROR_CODE.SET_QUALITY_TYPE_ERR});else if(n.state.appendingSourceState)i({msg:"Reject setQualityFor by appending next source.",code:c.ERROR_CODE.SET_QUALITY_APENDING_ERR});else try{var a=t
;if((t=n.getQualityIndexFromQualityNumber(t,e))===n.state.currentQualityIndex[e])return void i({msg:"Set quality equal current quality, quality: "+t,code:c.ERROR_CODE.SET_QUALITY_SAME_VALUE,isChange:a!==n.getQualityNumberFromQualityIndex(t)&&t!==a});n.player.setQualityFor(e,t);var o=Date.now(),s=function(e){-1!==n.timer.qnChangeTimeOutFlag[e]&&(clearTimeout(n.timer.qnChangeTimeOutFlag[e]),n.timer.qnChangeTimeOutFlag[e]=-1)};s(e);n.timer.qnChangeTimeOutFlag[e]=window.setTimeout((function(){n.player.off(c.EVENTS.QUALITY_CHANGE_RENDERED,u),i({msg:"Call setQualityFor timeout",code:c.ERROR_CODE.SET_QUALITY_TIME_OUT})}),1e4);var u=function(l){var d=l.newQuality;if(s(l.mediaType),n.player.off(c.EVENTS.QUALITY_CHANGE_RENDERED,u),d===t){var f=n.getQualityNumberFromQualityIndex(d,e);d!==a&&a!==f?i({msg:"Quality rendered and quality is not "+a+" but "+f,code:c.ERROR_CODE.SET_QUALITY_RENDER_CHANGED,newQuality:d,newQnNumber:f}):r(n.getQualityChangedData(l,o))}};n.player.on(c.EVENTS.QUALITY_CHANGE_RENDERED,u)}catch(e){i({msg:"Call setQualityFor function error",code:c.ERROR_CODE.SET_QUALITY_ERR,detail:e})}}))},e.prototype.getQualityFor=function(e){try{return this.player.getQualityFor(e)}catch(e){this.error({msg:"Call getQualityFor function error",detail:e})}},e.prototype.setStableBufferTime=function(e){void 0===e&&(e=60);try{this.player.setStableBufferTime(e),this.player.setBufferTimeAtTopQuality(e),this.player.setBufferTimeAtTopQualityLongForm(e),this.player.setBufferAheadToKeep(e+10)}catch(e){this.error({msg:"Call setStableBufferTime function error",detail:e})}},e.prototype.getStableBufferTime=function(){try{return this.player.getStableBufferTime()}catch(e){this.error({msg:"Call getStableBufferTime function error",detail:e})}},e.prototype.getBufferLength=function(e){try{return this.player.getBufferLength(e)}catch(e){this.error({msg:"Call getBufferLength function error",detail:e})}},e.prototype.getCurrentPlayURLFor=function(e){try{return this.player.getCurrentSegmentInfoFor(e).url||""}catch(t){this.error({msg:"Call getCurrentPlayURLFor function error, type: "+e+", qualityIndex: "+this.state.currentQualityIndex[e],detail:t})}},e.prototype.getVideoInfo=function(){return{mediaInfo:this.state.mediaInfo,statisticsInfo:this.state.statisticsInfo}},e.prototype.getCurrentCodecID=function(e){void 0===e&&(e=c.STRING.VIDEO);var t=0;if(e===c.STRING.VIDEO){t=7,this.state.enableHEVC&&(t=12)}return t},e.prototype.getAverageConnectionSpeed=function(e){void 0===e&&(e=c.STRING.VIDEO);try{return Number(this.player.getAverageThroughput(e))||0}catch(e){this.error({msg:"Call getAverageConnectionSpeed function error",detail:e})}},e.prototype.switchSource=function(e,t,n){var r=this;void 0===n&&(n=!1),window.clearTimeout(this.timer.removeSwitchSourceTransition),this.onVideoSwitchSourceEnded();if(t&&("string"!=typeof t.videoid||"string"!=typeof t.audioid?this.error({type:c.STRING.WARNING,msg:"Preload data videoid/audioid value must be string type.",detail:t}):this.player&&this.player.setPreloadData(t)),n){var i=document.createElement("canvas"),a=this.video.offsetWidth,o=this.video.offsetHeight,s=this.video.videoWidth/this.video.videoHeight,u=a/o;i.width=a,i.height=o,i.style.zIndex="10",i.style.position="absolute",i.className=c.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME;var l=i.getContext("2d"),d=void 0,f=void 0;u>=s?(d=o*s,f=o):(d=a,f=a/s),l.fillRect(0,0,i.width,i.height),l.drawImage(this.video,Math.abs(a-d)/2,Math.abs(o-f)/2,d,f),this.video.parentNode.appendChild(i),this.timer.removeSwitchSourceTransition=window.setTimeout((function(){r.onVideoSwitchSourceEnded()}),1e4),i=null,l=null,this.video.removeEventListener("canplay",this.onVideoSwitchSourceEnded),this.video.removeEventListener("playing",this.onVideoSwitchSourceEnded),this.video.addEventListener("canplay",this.onVideoSwitchSourceEnded),this.video.addEventListener("playing",this.onVideoSwitchSourceEnded)}return new Promise((function(t,n){try{if(e=r.filterManifestByEnableHEVC(e,r.state.enableHEVC).manifest,r.state.mpd=e,r.player){
for(var i in r.state.currentQualityIndex)r.state.currentQualityIndex[i]>=0&&r.setDefaultQualityFor(i,r.state.currentQualityIndex[i]);r.state.defaultVideoQuality=r.state.currentQualityIndex.video,r.state.defaultAudioQuality=r.state.currentQualityIndex.audio,r.bindSwitchSourceEvents(t,n,1e4),r.player.switchSource(e)}else n("Dash Player Error")}catch(e){n(e)}}))},e.prototype.updateSource=function(e){var t=this;return new Promise((function(n,r){try{e=t.filterManifestByEnableHEVC(e,t.state.enableHEVC).manifest,t.player.updateSource(e);var i=window.setTimeout((function(){r({msg:"Update Source Timeout"})}),5e3),a=function(){t.player.off(c.EVENTS.STREAM_INITIALIZED,a),clearTimeout(i),n(null)};t.player.on(c.EVENTS.STREAM_INITIALIZED,a)}catch(e){r({msg:"Call updateSource function error, "+JSON.stringify(e),detail:e})}}))},e.prototype.appendSource=function(e,t){var n=this,r=this.state.appendingSourceState,i=this.state;return new Promise((function(a,o){r&&o("Dash Player is Appending Next Source!"),n.setAutoSwitchQualityFor("video",!1,!1),n.setAutoSwitchQualityFor("audio",!1,!1);var s=Date.now();t&&("string"!=typeof t.videoid||"string"!=typeof t.audioid?n.error({type:c.STRING.WARNING,msg:"Preload data videoid/audioid value must be string type.",detail:t}):n.player&&n.player.setPreloadData(t));var u=setTimeout((function(){n.state.appendingSourceState=!1,o({msg:"Append source time out."})}),5e3);n.state.appendingSourceState=!0;try{if(n.player){for(var l in n.state.currentQualityIndex)n.state.currentQualityIndex[l]>=0&&n.setDefaultQualityFor(l,n.state.currentQualityIndex[l]);e=n.filterManifestByEnableHEVC(e,i.enableHEVC).manifest,n.player.setEndOfStreamState(!1),n.player.appendSource(e);var d=function(e){clearTimeout(u),n.player.off(c.EVENTS.APPENDED_NEXT_SOURCE,d),a({cost:Date.now()-s})};n.player.on(c.EVENTS.APPENDED_NEXT_SOURCE,d);var f=function(e){n.player.off(c.EVENTS.APPENDED_NEXT_SOURCE_DURATION_CHANGED,f),n.state.appendingSourceState=!1,i.autoSwitchTopQualityMap.video>=0&&n.setAutoSwitchTopQualityFor("video",i.autoSwitchTopQualityMap.video),n.setAutoSwitchQualityFor("video",i.isAutoSwitch[c.STRING.VIDEO],!1),n.setAutoSwitchQualityFor("audio",i.isAutoSwitch[c.STRING.AUDIO],!1)};n.player.on(c.EVENTS.APPENDED_NEXT_SOURCE_DURATION_CHANGED,f)}else clearTimeout(u),n.state.appendingSourceState=!1,o({msg:"Missing dash player instance!"})}catch(e){clearTimeout(u),n.state.appendingSourceState=!1,o({msg:"Append Source Error",detail:e})}}))},e.prototype.getNextFragmentHistoryInfo=function(){var e="";try{var t=function(e){return e?1:0};if(this.state.getNextFragmentHistory){var n=function(n){var i=r.state.getNextFragmentHistory[n],a="";i.forEach((function(e){var n,r,i=[t(e.final),e.currentTime,e.bufferLevel.toFixed(3),(n=[e.bufferResetInProgress,e.isReplacement,e.switchTrack,e.hasTopQualityChanged,e.lastInitQuality,e.bufferLevelRule],r="",n.length&&n.forEach((function(e){r+=""+t(e)})),parseInt(r,2))];a+=i.join(",")+";"})),e+=n+":"+a+"!"},r=this;for(var i in this.state.getNextFragmentHistory)n(i)}}catch(e){}return e},e.prototype.isLoadingFragment=function(e){if(e)return!!this.state.fragmentLoadingInfo[e]},e.prototype.getNetworkActivity=function(){return this.components.networkActivity&&this.components.networkActivity.getNetworkActivity()},e.prototype.getNetworkActivityHistory=function(e){return void 0===e&&(e=0),this.components.networkActivity&&this.components.networkActivity.getNetworkActivityHistory(e)},e.prototype.setEndOfStreamState=function(e){void 0===e&&(e=!1);try{return this.player.setEndOfStreamState(e)}catch(e){this.error({msg:"Call setEndOfStreamState function error",detail:e})}},e.prototype.getLogHistory=function(){var e=this.state&&this.state.logHistory||[],t=e.join("\n");return{length:e.length,log:t,size:function(e){for(var t=[],n=[e],r=0;n.length;){var i=n.pop();if("boolean"==typeof i)r+=4;else if("string"==typeof i)r+=2*i.length;else if("number"==typeof i)r+=8;else if("object"==typeof i&&-1===t.indexOf(i))for(var a in t.push(i),i)n.push(i[a])}return r}(t)}},e.prototype.getBufferingInfo=function(){var e,t={type:-1};try{
var n=this.state.currentQualityIndex.video,r=this.state.currentQualityIndex.audio;t=this.components.bufferingInfo&&this.components.bufferingInfo.getInfo({videoBufferLength:this.getBufferLength("video"),audioBufferLength:this.getBufferLength("audio"),videoCurrentIndex:n,audioCurrentIndex:r,videoCurrentQn:this.getQualityNumberFromQualityIndex(n,c.STRING.VIDEO),audioCurrentQn:this.getQualityNumberFromQualityIndex(r,c.STRING.AUDIO),videoSpeed:this.getAverageConnectionSpeed(c.STRING.VIDEO),audioSpeed:this.getAverageConnectionSpeed(c.STRING.AUDIO),networkActivity:this.getNetworkActivityHistory(5),playbackState:this.state.playbackState,latestPlayurlErrorHTTPCode:this.state.latestPlayurlErrorHTTPCode,fragmentLoadingInfo:this.state.fragmentLoadingInfo,networkWarningHistory:this.state.networkWarningHistory,startOffsetTime:this.state.startOffsetTime}),null===(e=this.components)||void 0===e||e.bufferingStrategy.push(t)}catch(e){throw new Error(e.message)}return t},e.prototype.getCDNInfo=function(e){if(void 0===e&&(e=!1),this.state){var t=r({},this.state.cdnInfo);return e&&(this.state.cdnInfo={cdn:0,p2p:0,nc:0,business:0,mcdn:0,bcache:0,vcache:0,ncFail:0,ncGotFail:0}),t}return{}},e.prototype.getNCInfo=function(e){if(void 0===e&&(e=!1),this.state){var t={};for(var n in this.state.NCInfo)t[n]=r({},this.state.NCInfo[n]);return e&&(this.state.NCInfo={}),t}return{}},e.prototype.destroy=function(){try{this.player.off(c.EVENTS.FRAGMENT_LOADING_STARTED,this.onFragmentLoading,this),this.player.off(c.EVENTS.FRAGMENT_LOADING_PROGRESS,this.onFragmentLoading,this),this.player.off(c.EVENTS.FRAGMENT_LOADING_COMPLETED,this.onFragmentLoading,this),this.player.off(c.EVENTS.LOG,this.onDashJSLog,this),this.player&&this.player.reset(),this.onVideoSwitchSourceEnded(),this.events={},this.config=null,this.state=null,this.video=null,this.player=null,clearTimeout(this.timer&&this.timer.networkActivity),clearTimeout(this.timer&&this.timer.loadScript),clearTimeout(this.timer&&this.timer.videoInfoSchedule),clearTimeout(this.timer&&this.timer.removeSwitchSourceTransition),clearTimeout(this.timer.qnChangeTimeOutFlag.video),clearTimeout(this.timer.qnChangeTimeOutFlag.audio),this.timer=null}catch(e){this.error({msg:"Call destroy function error, "+(e&&e.message),detail:e})}},e.prototype.mixin=function(e){if(e&&e instanceof Object)for(var t in e)e.hasOwnProperty(t)&&this.state.hasOwnProperty(t)&&(this.state[t]=e[t]);this.state&&this.state.isAutoSwitch||(this.state.isAutoSwitch={video:!1,audio:!1})},e.prototype.loadDashPlayerScript=function(){var e=this,t=this.config.scriptSrc;return new Promise((function(n,r){try{var i=document.createElement("script");i.src=t,i.onload=function(){e.state.onScriptLoading=!1,clearTimeout(e.timer.loadScript),n()},i.onerror=function(n){e.state.onScriptLoading=!1,clearTimeout(e.timer.loadScript),r({msg:"Load dash player script error, src: "+t,detail:n})},document.body.appendChild(i),e.state.onScriptLoading=!0,e.timer.loadScript=window.setTimeout((function(){r({msg:"Call loadDashPlayerScript function timeout"})}),e.config.scriptMaxLoadTime)}catch(e){r({msg:"Call loadDashPlayerScript function error",detail:e})}}))},e.prototype.createPlayer=function(t,n){var r,i=window.dashjs,a=this.state;this.state.defaultVideoQuality=this.getQualityIndexFromQualityNumber(a.defaultVideoQuality,c.STRING.VIDEO),this.state.defaultAudioQuality=this.getQualityIndexFromQualityNumber(a.defaultAudioQuality,c.STRING.AUDIO);try{var o=i.MediaPlayer().create();this.player=o,this.setDebugLog(),this.bindEvents(t),this.state.logHistory.push("Dash player log history, "+JSON.stringify(e.CONFIG)),a.preloadData&&o.setPreloadData(a.preloadData),o.initialize(this.video,a.mpd,a.isAutoPlay,a.enforceSSLStream,null===(r=this.config)||void 0===r?void 0:r.hid),o.setABRStrategy(a.abrStrategy||c.STRING.ABR_THROUGHPUT),o.setAutoSwitchQualityFor(c.STRING.VIDEO,a.isAutoSwitch[c.STRING.VIDEO]),o.setAutoSwitchQualityFor(c.STRING.AUDIO,a.isAutoSwitch[c.STRING.AUDIO]),o.setFastSwitchEnabled(!0),o.enableLastBitrateCaching(!1),o.setBufferPruningInterval(20),
a.mpd&&a.mpd.interactive&&o.setEndOfStreamState(!1),o.setJumpGaps(!0),this.setStableBufferTime(this.state.stableBufferTime)}catch(e){n({msg:"Call createPlayer function error",detail:e})}},e.prototype.bindEvents=function(e){var t=this,n=this.player,r=function(){n.off(c.EVENTS.STREAM_INITIALIZED,r,t),t.state.initialized=!0;var i=t.player.getBitrateInfoListFor("video");e&&e(i),t.fire(c.EVENTS.STREAM_INITIALIZED),t.videoInfoSchedule(),t.detectDefaultQualityChangeAbnormal()};n.on(c.EVENTS.STREAM_INITIALIZED,r,this),n.on(c.EVENTS.MANIFEST_LOADED,this.parseManifestInfo,this),n.on(c.EVENTS.GET_NEXT_FRAGMENT,this.getNextFragmentInfo,this),n.on(c.EVENTS.FRAGMENT_LOADING_STARTED,this.onFragmentLoading,this),n.on(c.EVENTS.FRAGMENT_LOADING_PROGRESS,this.onFragmentLoading,this),n.on(c.EVENTS.FRAGMENT_LOADING_COMPLETED,this.onFragmentLoading,this),n.on(c.EVENTS.LOG,this.onDashJSLog,this),n.onInitSegmentsLoaded(this.onInitSegmentsLoaded.bind(this)),n.on(c.EVENTS.DELAY_TO_APPEND_TO_BUFFER,(function(e){})),n.on(c.EVENTS.START_OFFSET_TIME_WARNING,(function(e){var n=e&&e.time;n&&n>t.state.startOffsetTime&&(t.error({type:c.STRING.WARNING,code:c.ERROR.START_OFFSET_TIME_WARNING,msg:"Start offset time is less than buffer.start(0), "+t.state.startOffsetTime+" < "+n}),t.state.startOffsetTime=n+.2)}));var i=function(){var e;null===(e=t.video)||void 0===e||e.removeEventListener("loadedmetadata",i);setTimeout((function(){if(t.video){var e=t.video.buffered,r=e.length&&e.start(0),i=t.video.currentTime;i<r&&(t.error({type:c.STRING.WARNING,code:c.ERROR.START_OFFSET_TIME_WARNING,msg:"Current offset time is less than buffer.start(0), "+i+" < "+r}),t.state.startOffsetTime=r+.2,n.seek(r+.2))}}),3e3)};this.video.addEventListener("loadedmetadata",i),this.bindDashCorePlayerEvents()},e.prototype.bindSwitchSourceEvents=function(e,t,n){var r=this,i=Date.now(),a=window.setTimeout((function(){r.onVideoSwitchSourceEnded(),t({err:"Dash Player Switch Source timeout",cost:Date.now()-i})}),n),o=function(){window.clearTimeout(a),r.player.off(c.EVENTS.STREAM_INITIALIZED,o,r),e({cost:Date.now()-i})};this.player.on(c.EVENTS.STREAM_INITIALIZED,o,this)},e.prototype.error=function(e){e.code=e.code||c.ERROR.INTERNAL_ERROR,e.msg="[Dash] "+e.msg,e.type=e.type||c.STRING.ERROR,this.state&&this.state.logHistory.push("Dash player "+e.type+" - "+e.code+": "+e.msg),c.STRING.ERROR===e.type?this.fire(c.EVENTS.ERROR,e):this.fire(c.EVENTS.WARNING,e)},e.prototype.bindDashCorePlayerEvents=function(){var e=this,t=this.events;this.player.on(c.EVENTS.ERROR,(function(t){e.errorHandler(t)})),this.on(c.EVENTS.QUALITY_CHANGE_REQUESTED,(function(t){e.changePlaybackState(p.BUFFERING.PLAYBACK.SWITCHING_QUALITY)})),this.on(c.EVENTS.QUALITY_CHANGE_RENDERED,(function(t){e.changePlaybackState(p.BUFFERING.PLAYBACK.PLAYING),e.state.currentQualityIndex[t.mediaType]=t.newQuality})),[{key:c.EVENTS.QUALITY_CHANGE_REQUESTED,callbackQueue:function(){return t[c.EVENTS.QUALITY_CHANGE_REQUESTED]}},{key:c.EVENTS.QUALITY_CHANGE_RENDERED,callbackQueue:function(){return t[c.EVENTS.QUALITY_CHANGE_RENDERED]}},{key:c.EVENTS.QUALITY_CHANGE_DOWNLOADED,callbackQueue:function(){return t[c.EVENTS.QUALITY_CHANGE_DOWNLOADED]}}].forEach((function(t){e.player.on(t.key,(function(n){try{var r=t.callbackQueue();r&&r.forEach((function(t){"function"==typeof t&&t(e.getQualityChangedData(n))}))}catch(n){e.error({msg:"Call "+t.key+" callback queue error",detail:n,type:c.STRING.WARNING})}}))})),this.player.on(c.EVENTS.FRAGMENT_LOADED_ERROR,(function(t){if(t){if(!t.code)return;var n=c.STRING.WARNING;t.code===c.ERROR.DOWNLOAD_FRAGMENT_ERROR_RETRY_FAILURE&&(n=c.STRING.ERROR),e.saveNetworkWarningInfo(t),e.error({code:t.code,detail:t,msg:"Fragment Loaded Error, "+JSON.stringify(t),type:n})}})),this.player.on(c.EVENTS.PCDN_LOADED_ERROR,(function(t){if(t){if(!t.code)return;e.error({code:t.code,detail:t,msg:"Pcdn Loaded Error, "+JSON.stringify(t),type:c.STRING.WARNING})}})),this.player.on(c.EVENTS.CDN_LOAD_INFO,this.onDashCDNLoadInfo,this),this.player.on(c.EVENTS.QUOTA_EXCEEDED,(function(e){}))},e.prototype.errorHandler=function(e){if(e)try{
var t=e.code,n=e.error,r=e.event.message;switch(t){case c.ERROR.DOWNLOAD_ERROR:case c.ERROR.DOWNLOAD_MPD_ERROR:case c.ERROR.DOWNLOAD_XINK_ERROR:case c.ERROR.DOWNLOAD_INIT_SEGMENT_ERROR:case c.ERROR.DOWNLOAD_MEDIA_SEGMENT_ERROR:case c.ERROR.DOWNLOAD_INDEX_SEGMENT_ERROR:case c.ERROR.DOWNLOAD_SWITCHING_SEGMENT_ERROR:case c.ERROR.DOWNLOAD_OTHER_ERROR:var i=e.event.url,a=e.httpCode,o=!0;if(a&&a>=400){var s=0;if(i){var u=i.match(/expires=\d+/g),l=i.match(/deadline=\d+/g);s=u&&parseInt(u[0].substr(8),10)||l&&parseInt(l[0].substr(9),10)}s&&this.state.latestPlayurlExpireTimeStamp===s&&this.state.latestPlayurlErrorHTTPCode===a&&(o=!1),this.state.latestPlayurlExpireTimeStamp=s,this.state.latestPlayurlErrorHTTPCode=a}o&&this.error({code:t,msg:a+" downloadError - "+i,detail:e});break;case c.ERROR.MANIFEST_ERROR:case c.ERROR.MANIFEST_TYPE_ERROR:case c.ERROR.MANIFEST_RESOLVE_ERROR:this.error({code:t,msg:n+" - "+r,detail:e});break;case c.ERROR.MEDIA_ERROR:case c.ERROR.MEDIA_ABORTED_ERROR:case c.ERROR.MEDIA_NETWORK_ERROR:case c.ERROR.MEDIA_DECODE_ERROR:case c.ERROR.MEDIA_SUPPORTED_ERROR:case c.ERROR.MEDIA_ENCRYPTED_ERROR:case c.ERROR.MEDIA_UNKNOWN_ERROR:d.default.setSessionStorage("enableHEVCError","1");var f=e.event;this.error({code:t,msg:n+" - "+f,detail:e});break;default:this.error({msg:"Unknown error.",detail:e}),console.error(e)}}catch(e){this.error({msg:"Unknown error.",detail:e})}},e.prototype.detectDashJSExists=function(){return!(!window.dashjs||!window.dashjs.MediaPlayer)},e.prototype.detectQualityTypeIsLegal=function(e){return!(e===c.STRING.VIDEO||e===c.STRING.AUDIO)},e.prototype.parseManifestInfo=function(e){var t=this;try{var n=e.data;if(this.state.manifest=n,n&&n.Period){var r={baseUri:n.baseUri,representation:{video:[],audio:[]}},i={video:{},audio:{}},a=n.Period.AdaptationSet_asArray;a.length&&a.forEach((function(e){var n=e.Representation_asArray;if(n){var a="";n instanceof Array||(n=[n]),n.length&&(n.sort((function(e,t){return e.bandwidth-t.bandwidth})),n.forEach((function(n,o){var s=n.frameRate,u=n.mimeType||e.mimeType;try{if(s&&(""+s).indexOf("/")>-1){var l=s.split("/");s=(s=parseInt(l[0],10)/parseInt(l[1],10)).toFixed(3)}}catch(e){t.error({msg:"Parse fps error, fps: "+s,detail:e})}var d={id:n.id,baseURL:n.BaseURL,width:n.width,height:n.height,bandwidth:n.bandwidth,codecs:n.codecs,fps:s,mimeType:u,sar:n.sar,startWithSAP:n.startWithSAP,audioSamplingRate:n.audioSamplingRate};u.indexOf(c.STRING.VIDEO)>-1?a=c.STRING.VIDEO:u.indexOf(c.STRING.AUDIO)>-1?a=c.STRING.AUDIO:t.error({msg:"Manifest missing mimeType",detail:n}),a&&(function(e){var t,n,r,i,a,o,s;return i=e.mimeType,a=e.codecs,o=e.width,s=e.height,t=i+';codecs="'+a+'"'+(o&&s?';width="'+o+'";height="'+s+'"':";"),null===(r=(n=window.MediaSource).isTypeSupported)||void 0===r?void 0:r.call(n,t)}(d)||t.isUsingWasmPlayer())?(r.representation[a].push(d),i[a][d.id]=o):t.onDashJSLog({type:"FilterCodecNotSupportedQn",message:"abandon qn: "+d.id})}))),t.state.maxQualityIndex[a]=n.length-1}})),this.state.manifestInfo=r,this.state.qualityNumberMap=i,this.state.setTheDefaultVideoQualityState||(this.state.setTheDefaultVideoQualityState=!0,this.setDefaultQualityFor("video",this.state.defaultVideoQuality),this.setDefaultQualityFor("audio",this.state.defaultAudioQuality))}}catch(t){this.error({msg:"Parse dash player manifest error",detail:e})}},e.prototype.getQualityIndexFromQualityNumber=function(e,t){void 0===t&&(t=c.STRING.VIDEO);var n=0;t===c.STRING.AUDIO&&[c.DOLBY_AUDIO_QN.AMTOS,c.DOLBY_AUDIO_QN.AUDIO].includes(e)&&(e=this.getAudioQuallityCanBeUsed(e));try{var r=this.state.qualityNumberMap[t];e=parseInt(""+e,10);var i=this.state.maxQualityIndex[t];if(r&&r[e]>=0&&e>=this.config.minQualityNumberMappingNumber){var a=r[e];a>=0&&(n=a)}else if(-1===i||e>=0&&e<=i)n=e;else if(r){for(var o in r)if(r.hasOwnProperty(o)){var s=parseInt(o,10);s<e&&(n=r[""+Math.max(n,s)])}this.error({msg:"Quality number or index is error, qn or index: "+e+",using lower quality number: "+this.getQualityNumberFromQualityIndex(n)+" with quality index: "+n,type:c.STRING.WARNING})}else this.error({
msg:"Quality number or index is error, qn or index: "+e+", qn map: "+JSON.stringify(r)+", max quality index: "+i,type:c.STRING.WARNING})}catch(t){this.error({msg:"Call getQualityIndexFromQualityNumber error, qn: "+e,detail:t})}return n},e.prototype.getQualityNumberFromQualityIndex=function(e,t){void 0===t&&(t=c.STRING.VIDEO);try{var n=this.state.qualityNumberMap[t];if(e=parseInt(""+e,10),n)for(var r in n)if(n.hasOwnProperty(r)&&n[r]===e)return parseInt(r,10)}catch(t){this.error({msg:"Call getQualityNumberFromQualityIndex error, qn: "+e,detail:t})}return 32},e.prototype.getDroppedFramesInfo=function(){try{return this.player.getDroppedFramesInfo()||{}}catch(e){this.error({msg:"Call getDroppedFramesInfo function error",detail:e,type:c.STRING.WARNING})}},e.prototype.getCurrentTrackFor=function(e){try{return this.player.getCurrentTrackFor(e)||{}}catch(e){this.error({msg:"Call getCurrentTrackFor function error, "+(e&&e.message),detail:e,type:c.STRING.WARNING})}},e.prototype.getCurrentSegmentInfoFor=function(e){void 0===e&&(e=c.STRING.VIDEO);try{return this.player.getCurrentSegmentInfoFor(e)||{}}catch(e){this.error({msg:"Call getCurrentSegmentInfoFor function error",detail:e,type:c.STRING.WARNING})}},e.prototype.onInitSegmentsLoaded=function(e,t){try{if(this.state.segmentsInfoMap[e]=t,!t.isDurationAllEqual){var n=t.notEqualQualityIndex;this.error({code:c.ERROR.DURATION_IS_NOT_ALL_EQUAL,msg:"Segments duration is not all equal, type: "+e+", quality index switch: "+n.old+" => "+n.new+", segment index list: "+t.notEqualIndexList+" } "})}var r=this.state.segmentsInfoMap,i=this.state.appendingSourceState;if(r&&r.video&&r.audio&&!i){var a=r.video.realDuration,o=r.audio.realDuration,s=Math.abs(a-o);if(s>3){var u=this.getQualityNumberFromQualityIndex(r.video.qualityIndex,c.STRING.VIDEO),l=this.getQualityNumberFromQualityIndex(r.audio.qualityIndex,c.STRING.AUDIO),d=r.video.segments.length,f=r.audio.segments.length;this.error({type:c.STRING.WARNING,code:c.ERROR.DURATION_DEVIATION_IS_TOO_LARGE,msg:"Video / audio duration deviation is too large, deviation: "+s+"s. Video qn:"+u+", segments:"+d+", duration:"+a+". Audio qn:"+l+", segments:"+f+", duration:"+o})}}if(this.state.startOffsetTime<t.startOffsetTime&&(this.state.startOffsetTime=t.startOffsetTime,t.segments&&t.segments.length)){var p=t.segments[0];p.duration,p.timescale;this.state.startOffsetTime>.1&&(this.player.seek(this.state.startOffsetTime+.2),this.error({type:c.STRING.WARNING,code:c.ERROR.START_OFFSET_TIME_WARNING,msg:e+" start offset time is greater than 0, "+this.state.startOffsetTime}))}}catch(e){this.error({msg:"Call onInitSegmentsLoaded function error",detail:e})}},e.prototype.setMaxAllowedBitrateFor=function(e,t){try{this.player.setMaxAllowedBitrateFor(e,t)}catch(e){this.error({msg:"Call setMaxAllowedBitrateFor function error",detail:e})}},e.prototype.videoInfoSchedule=function(){var e=this,t={},n={};try{var r=this.state,i=r.manifestInfo,a=r.currentQualityIndex,o=i.representation[c.STRING.VIDEO][a[c.STRING.VIDEO]]||{},s=i.representation[c.STRING.AUDIO][a[c.STRING.AUDIO]]||{},u=o.mimeType+';codecs="'+o.codecs+'"',l=this.getCurrentSegmentInfoFor(c.STRING.VIDEO),d=s.mimeType+';codecs="'+s.codecs+'"',f=this.getCurrentSegmentInfoFor(c.STRING.AUDIO),p=this.getDroppedFramesInfo(),h=this.getCurrentCodecID(c.STRING.VIDEO);t={width:o.width,height:o.height,sar:o.sar,mimeType:u+", "+d,fps:o.fps,videoDataRate:o.bandwidth,videoCodec:o.codecs,videoCodecID:h,audioDataRate:s.bandwidth,audioCodec:s.codecs,audioCodecID:0,audioSampleRate:s.audioSamplingRate||0,audioChannelCount:0},n={playerType:"DashPlayer",speed:Math.round(this.getAverageConnectionSpeed(c.STRING.VIDEO)),videoConnectionSpeed:Math.round(this.getAverageConnectionSpeed(c.STRING.VIDEO)),audioConnectionSpeed:Math.round(this.getAverageConnectionSpeed(c.STRING.AUDIO)),networkActivity:this.components.networkActivity&&this.components.networkActivity.getNetworkActivity(),videoBufferHealth:this.getBufferLength("video")||0,audioBufferHealth:this.getBufferLength("audio")||0,droppedFrames:p.droppedFrames||0,decodedFrames:p.totalFrames||0,
audioURL:f.url||"",audioCurrentSegmentIndex:f.index||0,audioCurrentSegmentStartTime:f.startTime||0,audioCurrentSegmentDuration:f.duration||0,audioTotalSegmentCount:r.segmentsInfoMap[c.STRING.AUDIO].total||0,videoURL:l.url||"",videoCurrentSegmentIndex:l.index||0,videoCurrentSegmentStartTime:l.startTime||0,videoCurrentSegmentDuration:l.duration||0,videoTotalSegmentCount:r.segmentsInfoMap[c.STRING.VIDEO].total||0},this.state.mediaInfo=t,this.state.statisticsInfo=n,this.fire(c.EVENTS.VIDEO_INFO,{mediaInfo:t,statisticsInfo:n})}catch(e){}clearTimeout(this.timer&&this.timer.videoInfoSchedule),this.config&&this.config.videoInfoScheduleTime&&this.timer&&(this.timer.videoInfoSchedule=window.setTimeout((function(){e.videoInfoSchedule()}),this.config.videoInfoScheduleTime))},e.prototype.getQualityChangedData=function(e,t){var n={};try{var r=e.mediaType,i=e.type,a=e.newQuality,o=e.oldQuality,s=this.state.isAutoSwitch[r];n={mediaType:r,type:i,newQuality:a,newQualityNumber:this.getQualityNumberFromQualityIndex(a,r),oldQuality:o,oldQualityNumber:this.getQualityNumberFromQualityIndex(o,r),currentTime:this.getCurrentTime(),isAutoSwitch:s,dict:this.player.getThroughputDict("video")},c.EVENTS.QUALITY_CHANGE_RENDERED===i?((t=t||this.state.autoSwitchStartTime||0)&&(n.cost=Math.floor(Date.now()-t)),this.state.autoSwitchStartTime=0):c.EVENTS.QUALITY_CHANGE_REQUESTED===i&&(this.state.autoSwitchStartTime=Date.now())}catch(e){this.error({msg:"Call getQualityChangedData error",detail:e,type:c.STRING.WARNING})}return n},e.prototype.onVideoSwitchSourceEnded=function(e){try{var t=void 0;if(e&&e.target){var n=e.target.parentElement;t=n&&n.querySelectorAll("."+c.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME)}else t=document.querySelectorAll("."+c.STRING.SWITCH_SOURCE_TRANSITION_ELEMENT_CLASS_NAME);t&&t.length&&t.forEach((function(e){e&&e.parentElement.removeChild(e)}))}catch(e){console.error("Remove transition canvas error.",e)}},e.prototype.getStartOffsetTime=function(){var e=0;try{var t=this.state.segmentsInfoMap;t&&(e=Math.max(t.video.startOffsetTime||0,t.audio.startOffsetTime||0))}catch(e){}return e},e.prototype.setDebugLog=function(){try{var e=location.href;e&&e.indexOf("debug=1")>0&&this.player.getDebug().setLogToBrowserConsole(!0)}catch(e){}},e.prototype.getNextFragmentInfo=function(e){if(e&&e.mediaType){var t=e.mediaType;this.state.getNextFragmentHistory||(this.state.getNextFragmentHistory={video:[],audio:[]});var n=!1,r=this.state.getNextFragmentHistory[t].length;if(r){var i=this.state.getNextFragmentHistory[t][this.state.getNextFragmentHistory[t].length-1];for(var a in i)if(i[a]!==e[a]){n=!0;break}}!n&&r||(r>=30&&this.state.getNextFragmentHistory[e.mediaType].splice(0,1),this.state.getNextFragmentHistory[e.mediaType].push(e))}},e.prototype.onFragmentLoading=function(e){if(e&&e.type){var t=e.type,n=e.request,r=this.covertFragmentInfoObject(n);if(r.loadingType=t,t===c.EVENTS.FRAGMENT_LOADING_STARTED)this.state.fragmentLoadingInfo[r.mediaType]=r;else if(t===c.EVENTS.FRAGMENT_LOADING_COMPLETED){var i=this.state.fragmentLoadingInfo[r.mediaType];r.isError=!!e.error;var a=e.response&&e.response.byteLength||0,o=Number(n.firstByteDate)-Number(n.requestStartDate);o=o?Math.max(o,1):1;var s=Number(n.requestEndDate)-Number(n.firstByteDate);s=s?Math.max(s,1):1;var u=Number(n.requestEndDate)-Number(n.requestStartDate);u=u?Math.max(u,1):1;var l=Math.round(8*a/u);r.latencyTime=o,r.downloadTime=s,r.totalTime=u,r.downloadBytes=a,r.connectionSpeed=l,r.data=e.response,r.totalSize=this.state.segmentsInfoMap[r.mediaType].rangeEnd+1;var d=!0;for(var f in i)if(i[f]!==r[f]&&"loadingType"!==f&&!isNaN(i[f])){d=!1;break}d&&(this.state.fragmentLoadingInfo[r.mediaType]=null,this.fire(c.EVENTS.FRAGMENT_LOADING_COMPLETED,r)),this.bpNCSaveData(r)}else this.components.networkActivity&&this.components.networkActivity.onFragmentLoadingProgess(e)}},e.prototype.bpNCSaveData=function(e){if(e&&e.url&&e.range&&e.data){var t=this.getBPNC();if(t&&t.saveDataEnabled){var n=(""+e.url).split("?")[0].split("/"),r=n[n.length-1].split(".")[0].slice(-5);if(!r)return;var i=parseInt(r,10)
;if(isNaN(i))return;if(!(i>3e4&&i<=30080||i>30200&&i<=30280))return;var a={url:e.url,range:e.range,data:e.data,totalSize:e.totalSize,token:t.getToken()};t.saveData(a)}}},e.prototype.getBPNC=function(){var e,t="bpNC";return(null===(e=this.config)||void 0===e?void 0:e.hid)&&(t+="_"+this.config.hid),window[t]},e.prototype.covertFragmentInfoObject=function(e){var t={};try{t={loadingType:"",type:e.type,mediaType:e.mediaType,startTime:e.startTime,url:e.url,index:e.index,id:e.representationId,qn:this.getQualityNumberFromQualityIndex(e.quality,e.mediaType),range:e.range,duration:e.duration,isError:!1}}catch(e){}return t},e.prototype.onDashJSLog=function(e){this.state.logHistory||(this.state.logHistory=[]),this.state.logHistory.length>=2e4&&this.state.logHistory.shift(),e&&this.state.logHistory.push(e.message)},e.prototype.onDashCDNLoadInfo=function(e){var t,n,r,i,a,o,s,u;if(null==e?void 0:e.loadInfo){var l=e.loadInfo;for(var d in this.state.cdnInfo)l[d]&&(this.state.cdnInfo[d]+=l[d]);if("XHR"===l.rType&&l.url&&l.cdn){var f=l.url;f.indexOf("upos-")>-1?this.state.cdnInfo.business+=l.cdn:f.indexOf("os=mcdn")>-1?this.state.cdnInfo.mcdn+=l.cdn:f.indexOf("os=bcache")>-1?this.state.cdnInfo.bcache+=l.cdn:f.indexOf("os=vcache")>-1&&(this.state.cdnInfo.vcache+=l.cdn)}this.fire(c.EVENTS.CDN_LOAD_INFO,l)}if((null===(t=null==e?void 0:e.NCInfo)||void 0===t?void 0:t.responseData)&&this.state.NCInfo){var p=null==e?void 0:e.NCInfo,h=p.qn,g=this.state.NCInfo[h]||{total:0,response:0,expect:0};if(9999===p.code){if(g.total++,p.range){var m=p.range.split("-"),E=parseInt(m[0],10),_=parseInt(m[1],10);_&&(g.expect+=_-E+1||0)}return void(this.state.NCInfo[h]=g)}if(g[p.code]||(g[p.code]={}),4999===p.code)return g[p.code].count=(null===(n=g[p.code])||void 0===n?void 0:n.count)+1||1,(null===(r=this.video)||void 0===r?void 0:r.seeking)&&(g[p.code].seeking=g[p.code].seeking+1||1),void(this.state.NCInfo[h]=g);var T=p.responseData,y=T.gotDataByte,v=T.getDataTime,A=T.usePeerSids,I=T.retryCount;y=y||0,v=v||0,I=I||0;var R=(null==(A=A||[])?void 0:A.length)||0;if(g.response++,g[p.code].count=(null===(i=g[p.code])||void 0===i?void 0:i.count)+1||1,g[p.code].bytes=(null===(a=g[p.code])||void 0===a?void 0:a.bytes)+y||y,g[p.code].time=(null===(o=g[p.code])||void 0===o?void 0:o.time)+v||v,g[p.code].peers=(null===(s=g[p.code])||void 0===s?void 0:s.peers)+R||R,g[p.code].retry=(null===(u=g[p.code])||void 0===u?void 0:u.retry)+I||I,4003===p.code&&0===y&&(g[p.code].abnormal=g[p.code].abnormal+1||1),2e3===p.code){var S="peers_"+R;g[p.code][S]=g[p.code][S]+1||1}this.state.NCInfo[h]=g}},e.prototype.changePlaybackState=function(e){return this.state.playbackState=e,this},e.prototype.saveNetworkWarningInfo=function(e){this.state.networkWarningHistory||(this.state.networkWarningHistory=[]),this.state.networkWarningHistory.length>=100&&this.state.networkWarningHistory.shift(),this.state.networkWarningHistory.push(e)},e.prototype.filterManifestByEnableHEVC=function(e,t){void 0===t&&(t=!1);var n=!1;if(t=this.applyEnableHEVCStrategy(t),e&&e.video&&e.video instanceof Array){var r=e.video;if(r.length&&r instanceof Array){var i=7;if(t){var a=r.filter((function(e){return 12===e.codecid}));n=!0,a&&a.length?(i=12,window.__ENABLE_WASM_PLAYER__||a.forEach((function(e){var t,r;(null===(r=(t=window.MediaSource).isTypeSupported)||void 0===r?void 0:r.call(t,'video/mp4; codecs="'+e.codecs+'"'))||(i=7,n=!1)}))):(i=7,n=!1)}e.video=e.video.filter((function(e){return e.codecid===i}))}}return{manifest:e,isHEVCTypeSupported:n}},e.prototype.applyEnableHEVCStrategy=function(e){if(e){var t=navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase(),n=t.indexOf("edge/")>-1,r=this.state.defaultVideoQuality,i=r>112&&!n&&t.indexOf("chrome/")>0,a=r>120,o=t.indexOf("edg/")>-1,s=d.default.getSessionStorage("enableHEVCError");(i||a)&&(e=!1);var u="bilibili_player_codec_prefer_type",l=parseInt(d.default.getLocalStorage(u),10);if(1===l)e=!0;else if(2===l)e=!1,this.resetHEVCDefaultStrategy().then((function(){d.default.setLocalStorage(u,"0")})).catch((function(){}));else{
this.resetHEVCDefaultStrategy().catch((function(){}));var c=parseInt(d.default.getLocalStorage("bilibili_player_codec_prefer_strategy"),10);2===c&&(this.onDashJSLog({type:"HEVCStrategyDisabledByPerf",message:"HEVC perfer strategy disabled by performance, strategy type: "+c}),e=!1)}[125,126,127].includes(r)&&(e=!0),(!window.__ENABLE_WASM_PLAYER__&&o||s)&&(e=!1),this.state.logHistory&&(this.state.logHistory.push(t),this.state.logHistory.push("Apply strategy: "+e+" ("+l+", "+i+", "+a+", "+o+", "+s+") \n"))}return e},e.prototype.resetHEVCDefaultStrategy=function(){var e=this;return new Promise((function(t,n){var r="bilibili_player_codec_prefer_reset",i="1.5.2";d.default.getLocalStorage(r)!==i?(e.onDashJSLog({type:"HEVCStrategyReset",message:"Reset HEVC perfer strategy, latest version: 1.5.2"}),d.default.setLocalStorage(r,i),t()):n()}))},e.prototype.detectDefaultQualityChangeAbnormal=function(){var e=this,t=this.state,n=t.defaultVideoQuality,r=t.defaultAudioQuality,i=t.currentQualityIndex,a=i.video,o=i.audio;return[{type:c.STRING.VIDEO,defaultQuality:n,currentIndex:a},{type:c.STRING.AUDIO,defaultQuality:r,currentIndex:o}].forEach((function(t){var n=e.getQualityNumberFromQualityIndex(t.currentIndex,t.type),r=t.defaultQuality,i=t.currentIndex;r>=0&&i>=0&&-1===[i,n].indexOf(r)&&e.fire(c.EVENTS.QUALITY_CHANGE_ABNORMAL,{type:c.EVENTS.QUALITY_CHANGE_ABNORMAL,mediaType:t.type,defaultQuality:r,currentIndex:i,qualityNumber:n})})),this},e.prototype.isUsingWasmPlayer=function(){return window.__ENABLE_WASM_PLAYER__&&this.video instanceof window.BwpElement},e.EVENTS=c.EVENTS,e.ERROR=c.ERROR,e.STRING=c.STRING,e.BUFFERING=p.BUFFERING,e.CONFIG=u.CONFIG,e.ERROR_CODE=c.ERROR_CODE,e.isHEVCTypeSupported=l.isHEVCTypeSupported,e.isBwpHEVCPrefSupported=l.isBwpHEVCPrefSupported,e.isHEVCHDR10TypeSupported=l.isHEVCHDR10TypeSupported,e.isEC3DolbyATMOSTypeSupported=l.isEC3DolbyATMOSTypeSupported,e.isHEVCDolbyVisionTypeSupported=l.isHEVCDolbyVisionTypeSupported,e.isHEVC8kTypeSupported=l.isHEVC8kTypeSupported,e}();t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONFIG=void 0;var r={version:"1.10.3",gitHash:"878b8464",build:233,release:"2021-12-07T03:22:53.025Z",mode:"production"};t.CONFIG=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isHEVC8kTypeSupported=t.isHEVCDolbyVisionTypeSupported=t.isEC3DolbyATMOSTypeSupported=t.isHEVCHDR10TypeSupported=t.isBwpHEVCPrefSupported=t.isHEVCTypeSupported=void 0;var i=r(n(3));t.isHEVCTypeSupported=function(){return!!window.__ENABLE_WASM_PLAYER__||window.MediaSource&&window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="hev1.1.6.L120.90"')};t.isBwpHEVCPrefSupported=function(){if("1"===i.default.getSessionStorage("enableHEVCError"))return!1;var e=parseInt(i.default.getLocalStorage("bilibili_player_codec_prefer_type"),10);if(1===e)return!0;if(2===e)return!1;return 2!==parseInt(i.default.getLocalStorage("bilibili_player_codec_prefer_strategy"),10)};t.isHEVCHDR10TypeSupported=function(){var e,t,n,r,a=!1,o=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),s=o.indexOf("safari")>-1&&o.indexOf("chrom")<0,u=0,l=o.match(/version\/\d+/);s&&l&&l.length&&(u=Number(l[0].substr(8)));var d=o.indexOf("edge/")>-1,c=0,f=o.match(/edge\/\d+/);d&&f&&f.length&&(c=Number(f[0].substr(5)));var p=window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="hev1.2.4.H150.90"'),h=null===(n=window.matchMedia("(color-gamut:p3)"))||void 0===n?void 0:n.matches,g=(null===(r=window.screen)||void 0===r||r.colorDepth,parseInt(i.default.getLocalStorage("bilibili_player_force_hdr"),10));return p&&(s&&h&&u>=13||d&&c>=18||g)&&(a=!0),a};var a=function(e){var t=window.MediaSource;return t&&!!t.isTypeSupported(e)},o=function(e){var t,n;e||(e=null===(n=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===n?void 0:n.toLowerCase())
;var r=e.indexOf("safari")>-1&&e.indexOf("chrom")<0,i=e.match(/version\/\d+/);return{isSafari:r,version:r&&(null==i?void 0:i.length)?+i[0].substr(8):-1}},s=function(e){var t,n;e||(e=null===(n=null===(t=window.navigator)||void 0===t?void 0:t.userAgent)||void 0===n?void 0:n.toLowerCase());var r=e.indexOf("edge/")>-1,i=e.match(/edge\/\d+/);return{isEdge:r,version:r&&(null==i?void 0:i.length)?+i[0].substr(5):-1}};t.isHEVCDolbyVisionTypeSupported=function(){var e,t,n,r=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),u=o(r),l=s(r),d=a('video/mp4; codecs="hev1.1.6.L153.90"'),c=a('video/mp4; codecs="dvh1.05.06"'),f=d&&c,p=parseInt(i.default.getLocalStorage("bilibili_player_force_hdr"),10);if(!f)return!1;var h=!1;u.isSafari&&(h=(null===(n=window.matchMedia("(color-gamut:p3)"))||void 0===n?void 0:n.matches)&&u.version>=13||!1);return l.isEdge&&(h=l.version>=18),!!p||h};t.isEC3DolbyATMOSTypeSupported=function(){var e,t,n=a('audio/mp4; codecs="ec-3"'),r=null===(t=null===(e=window.navigator)||void 0===e?void 0:e.userAgent)||void 0===t?void 0:t.toLowerCase(),i=o(r),u=s(r);return!!n&&(i.isSafari&&i.version>=13||u.isEdge)};t.isHEVC8kTypeSupported=function(e){var t=(null==e?void 0:e.width)||7680,n=(null==e?void 0:e.height)||4320;if(!a('video/mp4;codecs="hev1.1.6.L180.90";width='+t+";height="+n))return!1;var r=o();return!!parseInt(i.default.getLocalStorage("bilibili_player_force_8k"),10)||r.isSafari&&r.version>=13}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.state={runningInterval:1e3,maxCacheLength:200,fragmentLoadingProgressInfo:{},networkActivityLoadedList:[],networkActivityHistory:[],networkActivityLatestTraceTime:0},this.initalize()}return e.prototype.onFragmentLoadingProgess=function(e){var t=e.request,n=0,r=Math.floor(performance.now()),i=t.quality+"-"+t.index+"-"+t.ts,a=!1;if(this.state.fragmentLoadingProgressInfo[t.mediaType]&&this.state.fragmentLoadingProgressInfo[t.mediaType][i]){var o=this.state.fragmentLoadingProgressInfo[t.mediaType][i],s=!1;for(var u in o)if("bytesLoaded"!==u&&o[u]!==t[u])s=!0;else if(o.bytesLoaded===t.bytesLoaded)return;n=s?t.bytesLoaded:t.bytesLoaded-o.bytesLoaded}else this.state.fragmentLoadingProgressInfo[t.mediaType]||(this.state.fragmentLoadingProgressInfo[t.mediaType]={}),n=t.bytesLoaded;t.bytesLoaded===t.bytesTotal&&(a=!0),a?delete this.state.fragmentLoadingProgressInfo[t.mediaType][i]:this.state.fragmentLoadingProgressInfo[t.mediaType][i]={bytesLoaded:t.bytesLoaded,bytesTotal:t.bytesTotal,quality:t.quality,index:t.index,mediaType:t.mediaType,range:t.range},this.state.networkActivityLoadedList.length>=this.state.maxCacheLength&&this.state.networkActivityLoadedList.splice(0,1),n&&this.state.networkActivityLoadedList.push({time:r,loaded:Math.max(n,0)})},e.prototype.getNetworkActivity=function(){return this.state.networkActivityHistory.length?this.state.networkActivityHistory[this.state.networkActivityHistory.length-1]:0},e.prototype.getNetworkActivityHistory=function(e){return void 0===e&&(e=0),e?this.state.networkActivityHistory.slice(this.state.networkActivityHistory.length-e):this.state.networkActivityHistory},e.prototype.destroy=function(){clearTimeout(this.state&&this.state.networkActivityTimer),this.state=null},e.prototype.initalize=function(){this.runNewWorkActivityTimer()},e.prototype.runNewWorkActivityTimer=function(){var e=this;this.runNetworkActivity(),clearTimeout(this.state.networkActivityTimer),this.state.networkActivityTimer=window.setTimeout((function(){e.runNewWorkActivityTimer()}),this.state.runningInterval)},e.prototype.runNetworkActivity=function(){var e=this.state.runningInterval,t=Math.floor(performance.now()),n=this.state.networkActivityLatestTraceTime,r=this.state.networkActivityLoadedList.filter((function(r){return t-r.time<e&&t>n}));this.state.networkActivityLatestTraceTime=t;var i=0;r&&r.length&&r.forEach((function(e){return i+=e.loaded})),
this.state.networkActivityHistory.length>=this.state.maxCacheLength&&this.state.networkActivityHistory.splice(0,1),this.state.networkActivityHistory.push(Math.max(i,0))},e}();t.default=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),a=n(7),o=r(n(3)),s="hevcPerf",u=function(){function e(){this.bufferingHistory=[],this.state={enableHEVC:!1}}return e.prototype.setHEVCEnableFlag=function(e){return void 0===e&&(e=!1),this.state.enableHEVC=e,this},e.prototype.push=function(e){this.bufferingHistory.length>=this.MAX_HISTORY_LENGTH&&this.bufferingHistory.shift(),e.timestamp=this.getNow(),this.bufferingHistory.push(e),this.optimize()},e.prototype.setOnOptimizingCallback=function(e){this.state.onOptimizingCallback=e},e.prototype.onOptimzing=function(e,t){"function"==typeof this.state.onOptimizingCallback&&this.state.onOptimizingCallback(e,t)},e.prototype.optimize=function(){var e=this.getNow(),t=this.bufferingHistory.filter((function(t){return e-t.timestamp<=2e4}));if(this.state.enableHEVC){var n=""+a.BUFFERING.PLAYBACK.PLAYING+a.BUFFERING.TYPE.PERFORMANCE,r=t.filter((function(e){return n===e.type}));r&&r.length>=10&&(this.state.enableHEVC=!1,this.disableHEVCFlag())}},e.prototype.disableHEVCFlag=function(){1!==parseInt(o.default.getLocalStorage("bilibili_player_codec_prefer_type"),10)&&(o.default.setLocalStorage("bilibili_player_codec_prefer_strategy","2"),this.onOptimzing(i.EVENTS.BUFFERING_OPTIMIZATION,{type:s}))},e.prototype.getNow=function(){var e;return(null===(e=window.performance)||void 0===e?void 0:e.now())||Date.now()},e}();t.default=u}])}));